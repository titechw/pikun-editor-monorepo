"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ability/dimensions/route";
exports.ids = ["app/api/ability/dimensions/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("string_decoder");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = import("pg");;

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fability%2Fdimensions%2Froute&page=%2Fapi%2Fability%2Fdimensions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fability%2Fdimensions%2Froute.ts&appDir=%2FUsers%2Fpikun%2FDocuments%2Ftech_projects%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fpikun%2FDocuments%2Ftech_projects%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fability%2Fdimensions%2Froute&page=%2Fapi%2Fability%2Fdimensions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fability%2Fdimensions%2Froute.ts&appDir=%2FUsers%2Fpikun%2FDocuments%2Ftech_projects%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fpikun%2FDocuments%2Ftech_projects%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_pikun_Documents_tech_projects_pikun_editor_monorepo_apps_server_src_app_api_ability_dimensions_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/ability/dimensions/route.ts */ \"(rsc)/./src/app/api/ability/dimensions/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_Users_pikun_Documents_tech_projects_pikun_editor_monorepo_apps_server_src_app_api_ability_dimensions_route_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_Users_pikun_Documents_tech_projects_pikun_editor_monorepo_apps_server_src_app_api_ability_dimensions_route_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ability/dimensions/route\",\n        pathname: \"/api/ability/dimensions\",\n        filename: \"route\",\n        bundlePath: \"app/api/ability/dimensions/route\"\n    },\n    resolvedPagePath: \"/Users/pikun/Documents/tech_projects/pikun-editor-monorepo/apps/server/src/app/api/ability/dimensions/route.ts\",\n    nextConfigOutput,\n    userland: _Users_pikun_Documents_tech_projects_pikun_editor_monorepo_apps_server_src_app_api_ability_dimensions_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/ability/dimensions/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGYWJpbGl0eSUyRmRpbWVuc2lvbnMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmFiaWxpdHklMkZkaW1lbnNpb25zJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYWJpbGl0eSUyRmRpbWVuc2lvbnMlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZwaWt1biUyRkRvY3VtZW50cyUyRnRlY2hfcHJvamVjdHMlMkZwaWt1bi1lZGl0b3ItbW9ub3JlcG8lMkZhcHBzJTJGc2VydmVyJTJGc3JjJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRnBpa3VuJTJGRG9jdW1lbnRzJTJGdGVjaF9wcm9qZWN0cyUyRnBpa3VuLWVkaXRvci1tb25vcmVwbyUyRmFwcHMlMkZzZXJ2ZXImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzhEO0FBQzNJO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZILHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLz8wMjlmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9waWt1bi9Eb2N1bWVudHMvdGVjaF9wcm9qZWN0cy9waWt1bi1lZGl0b3ItbW9ub3JlcG8vYXBwcy9zZXJ2ZXIvc3JjL2FwcC9hcGkvYWJpbGl0eS9kaW1lbnNpb25zL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hYmlsaXR5L2RpbWVuc2lvbnMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hYmlsaXR5L2RpbWVuc2lvbnNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2FiaWxpdHkvZGltZW5zaW9ucy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9waWt1bi9Eb2N1bWVudHMvdGVjaF9wcm9qZWN0cy9waWt1bi1lZGl0b3ItbW9ub3JlcG8vYXBwcy9zZXJ2ZXIvc3JjL2FwcC9hcGkvYWJpbGl0eS9kaW1lbnNpb25zL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9hYmlsaXR5L2RpbWVuc2lvbnMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fability%2Fdimensions%2Froute&page=%2Fapi%2Fability%2Fdimensions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fability%2Fdimensions%2Froute.ts&appDir=%2FUsers%2Fpikun%2FDocuments%2Ftech_projects%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fpikun%2FDocuments%2Ftech_projects%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/api/ability/ability-level-config.controller.ts":
/*!************************************************************!*\
  !*** ./src/api/ability/ability-level-config.controller.ts ***!
  \************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AbilityLevelConfigController: () => (/* binding */ AbilityLevelConfigController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/ability-level-config.service */ \"(rsc)/./src/services/ability-level-config.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_2__]);\n_services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nclass AbilityLevelConfigController {\n    constructor(levelConfigService){\n        this.levelConfigService = levelConfigService;\n    }\n    /**\n   * 获取等级配置列表\n   */ async getConfigs(req) {\n        try {\n            const itemId = req.nextUrl.searchParams.get(\"itemId\") || undefined;\n            const configs = await this.levelConfigService.getConfigs(itemId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: configs\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get configs\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取等级配置详情\n   */ async getConfigById(req, configId) {\n        try {\n            const config = await this.levelConfigService.getConfigById(configId);\n            if (!config) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Config not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: config\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get config\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取全局模板配置\n   */ async getTemplate(req) {\n        try {\n            const template = await this.levelConfigService.getTemplate();\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: template\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get template\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 创建等级配置\n   */ async createConfig(req) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                item_id: zod__WEBPACK_IMPORTED_MODULE_3__.string().uuid().nullable().optional(),\n                level: zod__WEBPACK_IMPORTED_MODULE_3__.number().int().min(1),\n                required_exp: zod__WEBPACK_IMPORTED_MODULE_3__.number().int().min(0),\n                requires_assessment: zod__WEBPACK_IMPORTED_MODULE_3__.boolean().optional(),\n                level_name: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                level_description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                is_template: zod__WEBPACK_IMPORTED_MODULE_3__.boolean().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const config = await this.levelConfigService.createConfig(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: config\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create config\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 更新等级配置\n   */ async updateConfig(req, configId) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                level: zod__WEBPACK_IMPORTED_MODULE_3__.number().int().min(1).optional(),\n                required_exp: zod__WEBPACK_IMPORTED_MODULE_3__.number().int().min(0).optional(),\n                requires_assessment: zod__WEBPACK_IMPORTED_MODULE_3__.boolean().optional(),\n                level_name: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                level_description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const config = await this.levelConfigService.updateConfig(configId, validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: config\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update config\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 删除等级配置\n   */ async deleteConfig(req, configId) {\n        try {\n            await this.levelConfigService.deleteConfig(configId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete config\"\n            }, {\n                status: 400\n            });\n        }\n    }\n}\nAbilityLevelConfigController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_2__.AbilityLevelConfigService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:paramtypes\", [\n        typeof _services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_2__.AbilityLevelConfigService === \"undefined\" ? Object : _services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_2__.AbilityLevelConfigService\n    ])\n], AbilityLevelConfigController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL2FiaWxpdHkvYWJpbGl0eS1sZXZlbC1jb25maWcuY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQXdEO0FBQ2hDO0FBQ3NCO0FBQ3NDO0FBTTdFLE1BQU1LO0lBQ1hDLFlBQ0Usa0JBQXdGLENBQ3hGO2FBRDJDQyxxQkFBQUE7SUFDMUM7SUFFSDs7R0FFQyxHQUNELE1BQU1DLFdBQVdDLEdBQWdCLEVBQXlCO1FBQ3hELElBQUk7WUFDRixNQUFNQyxTQUFTRCxJQUFJRSxPQUFPLENBQUNDLFlBQVksQ0FBQ0MsR0FBRyxDQUFDLGFBQWFDO1lBQ3pELE1BQU1DLFVBQVUsTUFBTSxJQUFJLENBQUNSLGtCQUFrQixDQUFDQyxVQUFVLENBQUNFO1lBQ3pELE9BQU9WLHFEQUFZQSxDQUFDZ0IsSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztnQkFDVEMsTUFBTUg7WUFDUjtRQUNGLEVBQUUsT0FBT0ksT0FBWTtZQUNuQixPQUFPbkIscURBQVlBLENBQUNnQixJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNURyxTQUFTRCxNQUFNQyxPQUFPLElBQUk7WUFDNUIsR0FDQTtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1DLGNBQWNiLEdBQWdCLEVBQUVjLFFBQWdCLEVBQXlCO1FBQzdFLElBQUk7WUFDRixNQUFNQyxTQUFTLE1BQU0sSUFBSSxDQUFDakIsa0JBQWtCLENBQUNlLGFBQWEsQ0FBQ0M7WUFDM0QsSUFBSSxDQUFDQyxRQUFRO2dCQUNYLE9BQU94QixxREFBWUEsQ0FBQ2dCLElBQUksQ0FDdEI7b0JBQ0VDLFNBQVM7b0JBQ1RHLFNBQVM7Z0JBQ1gsR0FDQTtvQkFBRUMsUUFBUTtnQkFBSTtZQUVsQjtZQUNBLE9BQU9yQixxREFBWUEsQ0FBQ2dCLElBQUksQ0FBQztnQkFDdkJDLFNBQVM7Z0JBQ1RDLE1BQU1NO1lBQ1I7UUFDRixFQUFFLE9BQU9MLE9BQVk7WUFDbkIsT0FB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QUYvRUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBpL2FiaWxpdHkvYWJpbGl0eS1sZXZlbC1jb25maWcuY29udHJvbGxlci50cz8xNWU5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcbmltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ3RzeXJpbmdlJztcbmltcG9ydCB7IEFiaWxpdHlMZXZlbENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2FiaWxpdHktbGV2ZWwtY29uZmlnLnNlcnZpY2UnO1xuXG4vKipcbiAqIOiDveWKm+mhueetiee6p+mFjee9ruaOp+WItuWZqFxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQWJpbGl0eUxldmVsQ29uZmlnQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIEBpbmplY3QoQWJpbGl0eUxldmVsQ29uZmlnU2VydmljZSkgcHJpdmF0ZSBsZXZlbENvbmZpZ1NlcnZpY2U6IEFiaWxpdHlMZXZlbENvbmZpZ1NlcnZpY2VcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiDojrflj5bnrYnnuqfphY3nva7liJfooahcbiAgICovXG4gIGFzeW5jIGdldENvbmZpZ3MocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGl0ZW1JZCA9IHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2l0ZW1JZCcpIHx8IHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IGNvbmZpZ3MgPSBhd2FpdCB0aGlzLmxldmVsQ29uZmlnU2VydmljZS5nZXRDb25maWdzKGl0ZW1JZCk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjb25maWdzLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBjb25maWdzJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnrYnnuqfphY3nva7or6bmg4VcbiAgICovXG4gIGFzeW5jIGdldENvbmZpZ0J5SWQocmVxOiBOZXh0UmVxdWVzdCwgY29uZmlnSWQ6IHN0cmluZyk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHRoaXMubGV2ZWxDb25maWdTZXJ2aWNlLmdldENvbmZpZ0J5SWQoY29uZmlnSWQpO1xuICAgICAgaWYgKCFjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0NvbmZpZyBub3QgZm91bmQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjb25maWcsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGNvbmZpZycsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5YWo5bGA5qih5p2/6YWN572uXG4gICAqL1xuICBhc3luYyBnZXRUZW1wbGF0ZShyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdGVtcGxhdGUgPSBhd2FpdCB0aGlzLmxldmVsQ29uZmlnU2VydmljZS5nZXRUZW1wbGF0ZSgpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogdGVtcGxhdGUsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IHRlbXBsYXRlJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rnrYnnuqfphY3nva5cbiAgICovXG4gIGFzeW5jIGNyZWF0ZUNvbmZpZyhyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIGl0ZW1faWQ6IHouc3RyaW5nKCkudXVpZCgpLm51bGxhYmxlKCkub3B0aW9uYWwoKSxcbiAgICAgICAgbGV2ZWw6IHoubnVtYmVyKCkuaW50KCkubWluKDEpLFxuICAgICAgICByZXF1aXJlZF9leHA6IHoubnVtYmVyKCkuaW50KCkubWluKDApLFxuICAgICAgICByZXF1aXJlc19hc3Nlc3NtZW50OiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICAgICAgICBsZXZlbF9uYW1lOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGxldmVsX2Rlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGlzX3RlbXBsYXRlOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICAgICAgICBzb3J0X29yZGVyOiB6Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gICAgICAgIG1ldGFkYXRhOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBzY2hlbWEucGFyc2UoYm9keSk7XG4gICAgICBjb25zdCBjb25maWcgPSBhd2FpdCB0aGlzLmxldmVsQ29uZmlnU2VydmljZS5jcmVhdGVDb25maWcodmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGNvbmZpZyxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBjcmVhdGUgY29uZmlnJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrDnrYnnuqfphY3nva5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZUNvbmZpZyhyZXE6IE5leHRSZXF1ZXN0LCBjb25maWdJZDogc3RyaW5nKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIGxldmVsOiB6Lm51bWJlcigpLmludCgpLm1pbigxKS5vcHRpb25hbCgpLFxuICAgICAgICByZXF1aXJlZF9leHA6IHoubnVtYmVyKCkuaW50KCkubWluKDApLm9wdGlvbmFsKCksXG4gICAgICAgIHJlcXVpcmVzX2Fzc2Vzc21lbnQ6IHouYm9vbGVhbigpLm9wdGlvbmFsKCksXG4gICAgICAgIGxldmVsX25hbWU6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgbGV2ZWxfZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgc29ydF9vcmRlcjogei5udW1iZXIoKS5vcHRpb25hbCgpLFxuICAgICAgICBtZXRhZGF0YTogei5yZWNvcmQoei5hbnkoKSkub3B0aW9uYWwoKSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gc2NoZW1hLnBhcnNlKGJvZHkpO1xuICAgICAgY29uc3QgY29uZmlnID0gYXdhaXQgdGhpcy5sZXZlbENvbmZpZ1NlcnZpY2UudXBkYXRlQ29uZmlnKGNvbmZpZ0lkLCB2YWxpZGF0ZWREYXRhKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogY29uZmlnLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHVwZGF0ZSBjb25maWcnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOetiee6p+mFjee9rlxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQ29uZmlnKHJlcTogTmV4dFJlcXVlc3QsIGNvbmZpZ0lkOiBzdHJpbmcpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmxldmVsQ29uZmlnU2VydmljZS5kZWxldGVDb25maWcoY29uZmlnSWQpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBkZWxldGUgY29uZmlnJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwieiIsImluamVjdGFibGUiLCJpbmplY3QiLCJBYmlsaXR5TGV2ZWxDb25maWdTZXJ2aWNlIiwiQWJpbGl0eUxldmVsQ29uZmlnQ29udHJvbGxlciIsImNvbnN0cnVjdG9yIiwibGV2ZWxDb25maWdTZXJ2aWNlIiwiZ2V0Q29uZmlncyIsInJlcSIsIml0ZW1JZCIsIm5leHRVcmwiLCJzZWFyY2hQYXJhbXMiLCJnZXQiLCJ1bmRlZmluZWQiLCJjb25maWdzIiwianNvbiIsInN1Y2Nlc3MiLCJkYXRhIiwiZXJyb3IiLCJtZXNzYWdlIiwic3RhdHVzIiwiZ2V0Q29uZmlnQnlJZCIsImNvbmZpZ0lkIiwiY29uZmlnIiwiZ2V0VGVtcGxhdGUiLCJ0ZW1wbGF0ZSIsImNyZWF0ZUNvbmZpZyIsImJvZHkiLCJzY2hlbWEiLCJvYmplY3QiLCJpdGVtX2lkIiwic3RyaW5nIiwidXVpZCIsIm51bGxhYmxlIiwib3B0aW9uYWwiLCJsZXZlbCIsIm51bWJlciIsImludCIsIm1pbiIsInJlcXVpcmVkX2V4cCIsInJlcXVpcmVzX2Fzc2Vzc21lbnQiLCJib29sZWFuIiwibGV2ZWxfbmFtZSIsImxldmVsX2Rlc2NyaXB0aW9uIiwiaXNfdGVtcGxhdGUiLCJzb3J0X29yZGVyIiwibWV0YWRhdGEiLCJyZWNvcmQiLCJhbnkiLCJ2YWxpZGF0ZWREYXRhIiwicGFyc2UiLCJab2RFcnJvciIsImVycm9ycyIsInVwZGF0ZUNvbmZpZyIsImRlbGV0ZUNvbmZpZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/api/ability/ability-level-config.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/ability/ability-model.controller.ts":
/*!*****************************************************!*\
  !*** ./src/api/ability/ability-model.controller.ts ***!
  \*****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AbilityModelController: () => (/* binding */ AbilityModelController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_ability_model_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/ability-model.service */ \"(rsc)/./src/services/ability-model.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_ability_model_service__WEBPACK_IMPORTED_MODULE_2__]);\n_services_ability_model_service__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nclass AbilityModelController {\n    constructor(abilityModelService){\n        this.abilityModelService = abilityModelService;\n    }\n    /**\n   * 获取能力模型树形结构\n   */ async getModelTree(req) {\n        try {\n            const tree = await this.abilityModelService.getModelTree();\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: tree\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get model tree\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取能力类别列表\n   */ async getCategories(req) {\n        try {\n            const categories = await this.abilityModelService.getCategories();\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: categories\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get categories\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取能力类别详情\n   */ async getCategoryById(req, categoryId) {\n        try {\n            const category = await this.abilityModelService.getCategoryById(categoryId);\n            if (!category) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Category not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: category\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get category\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 创建能力类别\n   */ async createCategory(req) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const category = await this.abilityModelService.createCategory(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: category\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create category\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 更新能力类别\n   */ async updateCategory(req, categoryId) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1).optional(),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1).optional(),\n                description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const category = await this.abilityModelService.updateCategory(categoryId, validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: category\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update category\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 删除能力类别\n   */ async deleteCategory(req, categoryId) {\n        try {\n            await this.abilityModelService.deleteCategory(categoryId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete category\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 获取能力维度列表\n   */ async getDimensions(req) {\n        try {\n            const categoryId = req.nextUrl.searchParams.get(\"categoryId\") || undefined;\n            const dimensions = await this.abilityModelService.getDimensions(categoryId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: dimensions\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get dimensions\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取能力维度详情\n   */ async getDimensionById(req, dimensionId) {\n        try {\n            const dimension = await this.abilityModelService.getDimensionById(dimensionId);\n            if (!dimension) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Dimension not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: dimension\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get dimension\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 创建能力维度\n   */ async createDimension(req) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                category_id: zod__WEBPACK_IMPORTED_MODULE_3__.string().uuid(),\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const dimension = await this.abilityModelService.createDimension(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: dimension\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create dimension\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 更新能力维度\n   */ async updateDimension(req, dimensionId) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1).optional(),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1).optional(),\n                description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const dimension = await this.abilityModelService.updateDimension(dimensionId, validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: dimension\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update dimension\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 删除能力维度\n   */ async deleteDimension(req, dimensionId) {\n        try {\n            await this.abilityModelService.deleteDimension(dimensionId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete dimension\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 获取能力项列表\n   */ async getItems(req) {\n        try {\n            const dimensionId = req.nextUrl.searchParams.get(\"dimensionId\") || undefined;\n            const items = await this.abilityModelService.getItems(dimensionId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: items\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get items\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取能力项详情\n   */ async getItemById(req, itemId) {\n        try {\n            const item = await this.abilityModelService.getItemById(itemId);\n            if (!item) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Item not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: item\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get item\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 创建能力项\n   */ async createItem(req) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                dimension_id: zod__WEBPACK_IMPORTED_MODULE_3__.string().uuid(),\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                definition: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                performance_description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                evaluation_points: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                training_strategies: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                theoretical_basis: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                talent_ratio: zod__WEBPACK_IMPORTED_MODULE_3__.number().min(0).max(100).optional(),\n                acquired_training_ratio: zod__WEBPACK_IMPORTED_MODULE_3__.number().min(0).max(100).optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const item = await this.abilityModelService.createItem(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: item\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create item\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 更新能力项\n   */ async updateItem(req, itemId) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1).optional(),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1).optional(),\n                description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                definition: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                performance_description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                evaluation_points: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                training_strategies: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                theoretical_basis: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                talent_ratio: zod__WEBPACK_IMPORTED_MODULE_3__.number().min(0).max(100).optional(),\n                acquired_training_ratio: zod__WEBPACK_IMPORTED_MODULE_3__.number().min(0).max(100).optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const item = await this.abilityModelService.updateItem(itemId, validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: item\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update item\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 删除能力项\n   */ async deleteItem(req, itemId) {\n        try {\n            await this.abilityModelService.deleteItem(itemId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete item\"\n            }, {\n                status: 400\n            });\n        }\n    }\n}\nAbilityModelController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_ability_model_service__WEBPACK_IMPORTED_MODULE_2__.AbilityModelService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:paramtypes\", [\n        typeof _services_ability_model_service__WEBPACK_IMPORTED_MODULE_2__.AbilityModelService === \"undefined\" ? Object : _services_ability_model_service__WEBPACK_IMPORTED_MODULE_2__.AbilityModelService\n    ])\n], AbilityModelController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL2FiaWxpdHkvYWJpbGl0eS1tb2RlbC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDaEM7QUFDc0I7QUFDeUI7QUFNaEUsTUFBTUs7SUFDWEMsWUFBWSxtQkFBNkUsQ0FBRTthQUExQ0Msc0JBQUFBO0lBQTJDO0lBRTVGOztHQUVDLEdBQ0QsTUFBTUMsYUFBYUMsR0FBZ0IsRUFBeUI7UUFDMUQsSUFBSTtZQUNGLE1BQU1DLE9BQU8sTUFBTSxJQUFJLENBQUNILG1CQUFtQixDQUFDQyxZQUFZO1lBQ3hELE9BQU9SLHFEQUFZQSxDQUFDVyxJQUFJLENBQUM7Z0JBQ3ZCQyxTQUFTO2dCQUNUQyxNQUFNSDtZQUNSO1FBQ0YsRUFBRSxPQUFPSSxPQUFZO1lBQ25CLE9BQU9kLHFEQUFZQSxDQUFDVyxJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNURyxTQUFTRCxNQUFNQyxPQUFPLElBQUk7WUFDNUIsR0FDQTtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1DLGNBQWNSLEdBQWdCLEVBQXlCO1FBQzNELElBQUk7WUFDRixNQUFNUyxhQUFhLE1BQU0sSUFBSSxDQUFDWCxtQkFBbUIsQ0FBQ1UsYUFBYTtZQUMvRCxPQUFPakIscURBQVlBLENBQUNXLElBQUksQ0FBQztnQkFDdkJDLFNBQVM7Z0JBQ1RDLE1BQU1LO1lBQ1I7UUFDRixFQUFFLE9BQU9KLE9BQVk7WUFDbkIsT0FBT2QscURBQVlBLENBQUNXLElBQUksQ0FDdEI7Z0JBQ0VDLFNBQVM7Z0JBQ1RHLFNBQVNELE1BQU1DLE9BQU8sSUFBSTtZQUM1QixHQUNBO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTUcsZ0JBQWdCVixHQUFnQixFQUFFVyxVQUFrQixFQUF5QjtRQUNqRixJQUFJO1lBQ0YsTUFBTUMsV0FBVyxNQUFNLElBQUksQ0FBQ2QsbUJBQW1CLENBQUNZ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QUNGLE1BQU0sSUFBSSxDQUFDckQsbUJBQW1CLENBQUNrRSxVQUFVLENBQUNiO1lBQzFDLE9BQU81RCxxREFBWUEsQ0FBQ1csSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztZQUNYO1FBQ0YsRUFBRSxPQUFPRSxPQUFZO1lBQ25CLE9BQU9kLHFEQUFZQSxDQUFDVyxJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNURyxTQUFTRCxNQUFNQyxPQUFPLElBQUk7WUFDNUIsR0FDQTtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO0lBQ0Y7QUFDRjtBQTFmYVgseUJBQUFBLG9FQUFBQTtJQURaSCxvREFBVUE7SUFFSUMsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDQyxnRkFBbUJBOzs7ZUFBK0IsZ0ZBQW1CLDRCQUFuQixnRkFBbUI7O0dBRDlFQyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9hcGkvYWJpbGl0eS9hYmlsaXR5LW1vZGVsLmNvbnRyb2xsZXIudHM/ODY4NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgeyBBYmlsaXR5TW9kZWxTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hYmlsaXR5LW1vZGVsLnNlcnZpY2UnO1xuXG4vKipcbiAqIOiDveWKm+aooeWei+aOp+WItuWZqFxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQWJpbGl0eU1vZGVsQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKEBpbmplY3QoQWJpbGl0eU1vZGVsU2VydmljZSkgcHJpdmF0ZSBhYmlsaXR5TW9kZWxTZXJ2aWNlOiBBYmlsaXR5TW9kZWxTZXJ2aWNlKSB7fVxuXG4gIC8qKlxuICAgKiDojrflj5bog73lipvmqKHlnovmoJHlvaLnu5PmnoRcbiAgICovXG4gIGFzeW5jIGdldE1vZGVsVHJlZShyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdHJlZSA9IGF3YWl0IHRoaXMuYWJpbGl0eU1vZGVsU2VydmljZS5nZXRNb2RlbFRyZWUoKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHRyZWUsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IG1vZGVsIHRyZWUnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluiDveWKm+exu+WIq+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0Q2F0ZWdvcmllcyhyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY2F0ZWdvcmllcyA9IGF3YWl0IHRoaXMuYWJpbGl0eU1vZGVsU2VydmljZS5nZXRDYXRlZ29yaWVzKCk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjYXRlZ29yaWVzLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBjYXRlZ29yaWVzJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bog73lipvnsbvliKvor6bmg4VcbiAgICovXG4gIGFzeW5jIGdldENhdGVnb3J5QnlJZChyZXE6IE5leHRSZXF1ZXN0LCBjYXRlZ29yeUlkOiBzdHJpbmcpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjYXRlZ29yeSA9IGF3YWl0IHRoaXMuYWJpbGl0eU1vZGVsU2VydmljZS5nZXRDYXRlZ29yeUJ5SWQoY2F0ZWdvcnlJZCk7XG4gICAgICBpZiAoIWNhdGVnb3J5KSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdDYXRlZ29yeSBub3QgZm91bmQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjYXRlZ29yeSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgY2F0ZWdvcnknLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuiDveWKm+exu+WIq1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlQ2F0ZWdvcnkocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuICAgICAgY29uc3Qgc2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICBjb2RlOiB6LnN0cmluZygpLm1pbigxKSxcbiAgICAgICAgbmFtZTogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHNvcnRfb3JkZXI6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IGNhdGVnb3J5ID0gYXdhaXQgdGhpcy5hYmlsaXR5TW9kZWxTZXJ2aWNlLmNyZWF0ZUNhdGVnb3J5KHZhbGlkYXRlZERhdGEpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjYXRlZ29yeSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBjcmVhdGUgY2F0ZWdvcnknLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOiDveWKm+exu+WIq1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlQ2F0ZWdvcnkocmVxOiBOZXh0UmVxdWVzdCwgY2F0ZWdvcnlJZDogc3RyaW5nKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIGNvZGU6IHouc3RyaW5nKCkubWluKDEpLm9wdGlvbmFsKCksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLm9wdGlvbmFsKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHNvcnRfb3JkZXI6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IGNhdGVnb3J5ID0gYXdhaXQgdGhpcy5hYmlsaXR5TW9kZWxTZXJ2aWNlLnVwZGF0ZUNhdGVnb3J5KGNhdGVnb3J5SWQsIHZhbGlkYXRlZERhdGEpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjYXRlZ29yeSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgY2F0ZWdvcnknLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOiDveWKm+exu+WIq1xuICAgKi9cbiAgYXN5bmMgZGVsZXRlQ2F0ZWdvcnkocmVxOiBOZXh0UmVxdWVzdCwgY2F0ZWdvcnlJZDogc3RyaW5nKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hYmlsaXR5TW9kZWxTZXJ2aWNlLmRlbGV0ZUNhdGVnb3J5KGNhdGVnb3J5SWQpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBkZWxldGUgY2F0ZWdvcnknLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluiDveWKm+e7tOW6puWIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0RGltZW5zaW9ucyhyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY2F0ZWdvcnlJZCA9IHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2NhdGVnb3J5SWQnKSB8fCB1bmRlZmluZWQ7XG4gICAgICBjb25zdCBkaW1lbnNpb25zID0gYXdhaXQgdGhpcy5hYmlsaXR5TW9kZWxTZXJ2aWNlLmdldERpbWVuc2lvbnMoY2F0ZWdvcnlJZCk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBkaW1lbnNpb25zLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkaW1lbnNpb25zJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bog73lipvnu7Tluqbor6bmg4VcbiAgICovXG4gIGFzeW5jIGdldERpbWVuc2lvbkJ5SWQocmVxOiBOZXh0UmVxdWVzdCwgZGltZW5zaW9uSWQ6IHN0cmluZyk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRpbWVuc2lvbiA9IGF3YWl0IHRoaXMuYWJpbGl0eU1vZGVsU2VydmljZS5nZXREaW1lbnNpb25CeUlkKGRpbWVuc2lvbklkKTtcbiAgICAgIGlmICghZGltZW5zaW9uKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdEaW1lbnNpb24gbm90IGZvdW5kJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogZGltZW5zaW9uLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkaW1lbnNpb24nLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuiDveWKm+e7tOW6plxuICAgKi9cbiAgYXN5bmMgY3JlYXRlRGltZW5zaW9uKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgY2F0ZWdvcnlfaWQ6IHouc3RyaW5nKCkudXVpZCgpLFxuICAgICAgICBjb2RlOiB6LnN0cmluZygpLm1pbigxKSxcbiAgICAgICAgbmFtZTogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHNvcnRfb3JkZXI6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IGRpbWVuc2lvbiA9IGF3YWl0IHRoaXMuYWJpbGl0eU1vZGVsU2VydmljZS5jcmVhdGVEaW1lbnNpb24odmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGRpbWVuc2lvbixcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBjcmVhdGUgZGltZW5zaW9uJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrDog73lipvnu7TluqZcbiAgICovXG4gIGFzeW5jIHVwZGF0ZURpbWVuc2lvbihyZXE6IE5leHRSZXF1ZXN0LCBkaW1lbnNpb25JZDogc3RyaW5nKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIGNvZGU6IHouc3RyaW5nKCkubWluKDEpLm9wdGlvbmFsKCksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLm9wdGlvbmFsKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHNvcnRfb3JkZXI6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IGRpbWVuc2lvbiA9IGF3YWl0IHRoaXMuYWJpbGl0eU1vZGVsU2VydmljZS51cGRhdGVEaW1lbnNpb24oZGltZW5zaW9uSWQsIHZhbGlkYXRlZERhdGEpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBkaW1lbnNpb24sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gdXBkYXRlIGRpbWVuc2lvbicsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk6IO95Yqb57u05bqmXG4gICAqL1xuICBhc3luYyBkZWxldGVEaW1lbnNpb24ocmVxOiBOZXh0UmVxdWVzdCwgZGltZW5zaW9uSWQ6IHN0cmluZyk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuYWJpbGl0eU1vZGVsU2VydmljZS5kZWxldGVEaW1lbnNpb24oZGltZW5zaW9uSWQpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBkZWxldGUgZGltZW5zaW9uJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bog73lipvpobnliJfooahcbiAgICovXG4gIGFzeW5jIGdldEl0ZW1zKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkaW1lbnNpb25JZCA9IHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2RpbWVuc2lvbklkJykgfHwgdW5kZWZpbmVkO1xuICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCB0aGlzLmFiaWxpdHlNb2RlbFNlcnZpY2UuZ2V0SXRlbXMoZGltZW5zaW9uSWQpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogaXRlbXMsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGl0ZW1zJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bog73lipvpobnor6bmg4VcbiAgICovXG4gIGFzeW5jIGdldEl0ZW1CeUlkKHJlcTogTmV4dFJlcXVlc3QsIGl0ZW1JZDogc3RyaW5nKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaXRlbSA9IGF3YWl0IHRoaXMuYWJpbGl0eU1vZGVsU2VydmljZS5nZXRJdGVtQnlJZChpdGVtSWQpO1xuICAgICAgaWYgKCFpdGVtKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJdGVtIG5vdCBmb3VuZCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGl0ZW0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGl0ZW0nLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuiDveWKm+mhuVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlSXRlbShyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIGRpbWVuc2lvbl9pZDogei5zdHJpbmcoKS51dWlkKCksXG4gICAgICAgIGNvZGU6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgICBuYW1lOiB6LnN0cmluZygpLm1pbigxKSxcbiAgICAgICAgZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgZGVmaW5pdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBwZXJmb3JtYW5jZV9kZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBldmFsdWF0aW9uX3BvaW50czogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICB0cmFpbmluZ19zdHJhdGVnaWVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHRoZW9yZXRpY2FsX2Jhc2lzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHRhbGVudF9yYXRpbzogei5udW1iZXIoKS5taW4oMCkubWF4KDEwMCkub3B0aW9uYWwoKSxcbiAgICAgICAgYWNxdWlyZWRfdHJhaW5pbmdfcmF0aW86IHoubnVtYmVyKCkubWluKDApLm1heCgxMDApLm9wdGlvbmFsKCksXG4gICAgICAgIHNvcnRfb3JkZXI6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IGl0ZW0gPSBhd2FpdCB0aGlzLmFiaWxpdHlNb2RlbFNlcnZpY2UuY3JlYXRlSXRlbSh2YWxpZGF0ZWREYXRhKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogaXRlbSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBjcmVhdGUgaXRlbScsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5pu05paw6IO95Yqb6aG5XG4gICAqL1xuICBhc3luYyB1cGRhdGVJdGVtKHJlcTogTmV4dFJlcXVlc3QsIGl0ZW1JZDogc3RyaW5nKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIGNvZGU6IHouc3RyaW5nKCkubWluKDEpLm9wdGlvbmFsKCksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLm9wdGlvbmFsKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGRlZmluaXRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgcGVyZm9ybWFuY2VfZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgZXZhbHVhdGlvbl9wb2ludHM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgdHJhaW5pbmdfc3RyYXRlZ2llczogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICB0aGVvcmV0aWNhbF9iYXNpczogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICB0YWxlbnRfcmF0aW86IHoubnVtYmVyKCkubWluKDApLm1heCgxMDApLm9wdGlvbmFsKCksXG4gICAgICAgIGFjcXVpcmVkX3RyYWluaW5nX3JhdGlvOiB6Lm51bWJlcigpLm1pbigwKS5tYXgoMTAwKS5vcHRpb25hbCgpLFxuICAgICAgICBzb3J0X29yZGVyOiB6Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gICAgICAgIG1ldGFkYXRhOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBzY2hlbWEucGFyc2UoYm9keSk7XG4gICAgICBjb25zdCBpdGVtID0gYXdhaXQgdGhpcy5hYmlsaXR5TW9kZWxTZXJ2aWNlLnVwZGF0ZUl0ZW0oaXRlbUlkLCB2YWxpZGF0ZWREYXRhKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogaXRlbSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgaXRlbScsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk6IO95Yqb6aG5XG4gICAqL1xuICBhc3luYyBkZWxldGVJdGVtKHJlcTogTmV4dFJlcXVlc3QsIGl0ZW1JZDogc3RyaW5nKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hYmlsaXR5TW9kZWxTZXJ2aWNlLmRlbGV0ZUl0ZW0oaXRlbUlkKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZGVsZXRlIGl0ZW0nLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ6IiwiaW5qZWN0YWJsZSIsImluamVjdCIsIkFiaWxpdHlNb2RlbFNlcnZpY2UiLCJBYmlsaXR5TW9kZWxDb250cm9sbGVyIiwiY29uc3RydWN0b3IiLCJhYmlsaXR5TW9kZWxTZXJ2aWNlIiwiZ2V0TW9kZWxUcmVlIiwicmVxIiwidHJlZSIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImdldENhdGVnb3JpZXMiLCJjYXRlZ29yaWVzIiwiZ2V0Q2F0ZWdvcnlCeUlkIiwiY2F0ZWdvcnlJZCIsImNhdGVnb3J5IiwiY3JlYXRlQ2F0ZWdvcnkiLCJib2R5Iiwic2NoZW1hIiwib2JqZWN0IiwiY29kZSIsInN0cmluZyIsIm1pbiIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsIm9wdGlvbmFsIiwic29ydF9vcmRlciIsIm51bWJlciIsIm1ldGFkYXRhIiwicmVjb3JkIiwiYW55IiwidmFsaWRhdGVkRGF0YSIsInBhcnNlIiwiWm9kRXJyb3IiLCJlcnJvcnMiLCJ1cGRhdGVDYXRlZ29yeSIsImRlbGV0ZUNhdGVnb3J5IiwiZ2V0RGltZW5zaW9ucyIsIm5leHRVcmwiLCJzZWFyY2hQYXJhbXMiLCJnZXQiLCJ1bmRlZmluZWQiLCJkaW1lbnNpb25zIiwiZ2V0RGltZW5zaW9uQnlJZCIsImRpbWVuc2lvbklkIiwiZGltZW5zaW9uIiwiY3JlYXRlRGltZW5zaW9uIiwiY2F0ZWdvcnlfaWQiLCJ1dWlkIiwidXBkYXRlRGltZW5zaW9uIiwiZGVsZXRlRGltZW5zaW9uIiwiZ2V0SXRlbXMiLCJpdGVtcyIsImdldEl0ZW1CeUlkIiwiaXRlbUlkIiwiaXRlbSIsImNyZWF0ZUl0ZW0iLCJkaW1lbnNpb25faWQiLCJkZWZpbml0aW9uIiwicGVyZm9ybWFuY2VfZGVzY3JpcHRpb24iLCJldmFsdWF0aW9uX3BvaW50cyIsInRyYWluaW5nX3N0cmF0ZWdpZXMiLCJ0aGVvcmV0aWNhbF9iYXNpcyIsInRhbGVudF9yYXRpbyIsIm1heCIsImFjcXVpcmVkX3RyYWluaW5nX3JhdGlvIiwidXBkYXRlSXRlbSIsImRlbGV0ZUl0ZW0iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/api/ability/ability-model.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/auth/auth.controller.ts":
/*!*****************************************!*\
  !*** ./src/api/auth/auth.controller.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthController: () => (/* binding */ AuthController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_auth_service__WEBPACK_IMPORTED_MODULE_2__]);\n_services_auth_service__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nclass AuthController {\n    constructor(authService){\n        this.authService = authService;\n    }\n    /**\n   * 用户注册\n   */ async register(req) {\n        try {\n            const body = await req.json();\n            const registerSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                email: zod__WEBPACK_IMPORTED_MODULE_3__.string().email(),\n                password: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(6),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1)\n            });\n            const validatedData = registerSchema.parse(body);\n            const result = await this.authService.register(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Registration failed\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 用户登录\n   */ async login(req) {\n        try {\n            const body = await req.json();\n            const loginSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                email: zod__WEBPACK_IMPORTED_MODULE_3__.string().email(),\n                password: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1)\n            });\n            const validatedData = loginSchema.parse(body);\n            const result = await this.authService.login(validatedData.email, validatedData.password);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Login failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 管理员登录（仅允许 role 为 'admin' 的用户登录）\n   */ async adminLogin(req) {\n        try {\n            const body = await req.json();\n            const loginSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                email: zod__WEBPACK_IMPORTED_MODULE_3__.string().email(),\n                password: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1)\n            });\n            const validatedData = loginSchema.parse(body);\n            const result = await this.authService.adminLogin(validatedData.email, validatedData.password);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Admin login failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 刷新 token\n   */ async refreshToken(req) {\n        try {\n            const body = await req.json();\n            const refreshSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                refreshToken: zod__WEBPACK_IMPORTED_MODULE_3__.string()\n            });\n            const validatedData = refreshSchema.parse(body);\n            const result = await this.authService.refreshToken(validatedData.refreshToken);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Token refresh failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 验证 token\n   */ async verifyToken(req) {\n        try {\n            const authHeader = req.headers.get(\"authorization\");\n            if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"No token provided\"\n                }, {\n                    status: 401\n                });\n            }\n            const token = authHeader.substring(7);\n            const decoded = await this.authService.verifyToken(token);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    is_new: false,\n                    uid: decoded.uid,\n                    uuid: decoded.uuid\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Token verification failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 获取当前用户信息\n   */ async getMe(req) {\n        try {\n            const user = await this.authService.getCurrentUserWithType(req);\n            // 移除敏感信息\n            const { password, ...userWithoutPassword } = user;\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: userWithoutPassword\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get user info\"\n            }, {\n                status: 401\n            });\n        }\n    }\n}\nAuthController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:paramtypes\", [\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService\n    ])\n], AuthController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RjtZQUM3QyxPQUFPOUMscURBQVlBLENBQUNXLElBQUksQ0FBQztnQkFDdkJXLFNBQVM7Z0JBQ1RDLE1BQU15QjtZQUNSO1FBQ0YsRUFBRSxPQUFPeEIsT0FBWTtZQUNuQixPQUFPeEIscURBQVlBLENBQUNXLElBQUksQ0FDdEI7Z0JBQ0VXLFNBQVM7Z0JBQ1RJLFNBQVNGLE1BQU1FLE9BQU8sSUFBSTtZQUM1QixHQUNBO2dCQUFFRSxRQUFRO1lBQUk7UUFFbEI7SUFDRjtBQUNGO0FBL05hdkIsaUJBQUFBLG9FQUFBQTtJQURaSCxvREFBVUE7SUFFSUMsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDQywrREFBV0E7OztlQUF1QiwrREFBVyw0QkFBWCwrREFBVzs7R0FEdERDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2FwaS9hdXRoL2F1dGguY29udHJvbGxlci50cz8xMTVmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcbmltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ3RzeXJpbmdlJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xuXG4vKipcbiAqIOiupOivgeaOp+WItuWZqFxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQXV0aENvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihAaW5qZWN0KEF1dGhTZXJ2aWNlKSBwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdXRoU2VydmljZSkge31cblxuICAvKipcbiAgICog55So5oi35rOo5YaMXG4gICAqL1xuICBhc3luYyByZWdpc3RlcihyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCByZWdpc3RlclNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKSxcbiAgICAgICAgcGFzc3dvcmQ6IHouc3RyaW5nKCkubWluKDYpLFxuICAgICAgICBuYW1lOiB6LnN0cmluZygpLm1pbigxKSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gcmVnaXN0ZXJTY2hlbWEucGFyc2UoYm9keSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLnJlZ2lzdGVyKHZhbGlkYXRlZERhdGEpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyDlpITnkIYgWm9kIOmqjOivgemUmeivr1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnUmVnaXN0cmF0aW9uIGZhaWxlZCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog55So5oi355m75b2VXG4gICAqL1xuICBhc3luYyBsb2dpbihyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBsb2dpblNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKSxcbiAgICAgICAgcGFzc3dvcmQ6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBsb2dpblNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UubG9naW4odmFsaWRhdGVkRGF0YS5lbWFpbCwgdmFsaWRhdGVkRGF0YS5wYXNzd29yZCk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIC8vIOWkhOeQhiBab2Qg6aqM6K+B6ZSZ6K+vXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdMb2dpbiBmYWlsZWQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOeuoeeQhuWRmOeZu+W9le+8iOS7heWFgeiuuCByb2xlIOS4uiAnYWRtaW4nIOeahOeUqOaIt+eZu+W9le+8iVxuICAgKi9cbiAgYXN5bmMgYWRtaW5Mb2dpbihyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBsb2dpblNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKSxcbiAgICAgICAgcGFzc3dvcmQ6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBsb2dpblNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UuYWRtaW5Mb2dpbih2YWxpZGF0ZWREYXRhLmVtYWlsLCB2YWxpZGF0ZWREYXRhLnBhc3N3b3JkKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8g5aSE55CGIFpvZCDpqozor4HplJnor69cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0FkbWluIGxvZ2luIGZhaWxlZCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yi35pawIHRva2VuXG4gICAqL1xuICBhc3luYyByZWZyZXNoVG9rZW4ocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuICAgICAgY29uc3QgcmVmcmVzaFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgcmVmcmVzaFRva2VuOiB6LnN0cmluZygpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSByZWZyZXNoU2NoZW1hLnBhcnNlKGJvZHkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5yZWZyZXNoVG9rZW4odmFsaWRhdGVkRGF0YS5yZWZyZXNoVG9rZW4pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyDlpITnkIYgWm9kIOmqjOivgemUmeivr1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnVG9rZW4gcmVmcmVzaCBmYWlsZWQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOmqjOivgSB0b2tlblxuICAgKi9cbiAgYXN5bmMgdmVyaWZ5VG9rZW4ocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ05vIHRva2VuIHByb3ZpZGVkJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UudmVyaWZ5VG9rZW4odG9rZW4pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaXNfbmV3OiBmYWxzZSwgLy8g5Y+v5Lul5qC55o2u6ZyA6KaB5a6e546wXG4gICAgICAgICAgdWlkOiBkZWNvZGVkLnVpZCxcbiAgICAgICAgICB1dWlkOiBkZWNvZGVkLnV1aWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdUb2tlbiB2ZXJpZmljYXRpb24gZmFpbGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blvZPliY3nlKjmiLfkv6Hmga9cbiAgICovXG4gIGFzeW5jIGdldE1lKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcldpdGhUeXBlKHJlcSk7XG4gICAgICAvLyDnp7vpmaTmlY/mhJ/kv6Hmga9cbiAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLnVzZXJXaXRob3V0UGFzc3dvcmQgfSA9IHVzZXI7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB1c2VyV2l0aG91dFBhc3N3b3JkLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCB1c2VyIGluZm8nLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwieiIsImluamVjdGFibGUiLCJpbmplY3QiLCJBdXRoU2VydmljZSIsIkF1dGhDb250cm9sbGVyIiwiY29uc3RydWN0b3IiLCJhdXRoU2VydmljZSIsInJlZ2lzdGVyIiwicmVxIiwiYm9keSIsImpzb24iLCJyZWdpc3RlclNjaGVtYSIsIm9iamVjdCIsImVtYWlsIiwic3RyaW5nIiwicGFzc3dvcmQiLCJtaW4iLCJuYW1lIiwidmFsaWRhdGVkRGF0YSIsInBhcnNlIiwicmVzdWx0Iiwic3VjY2VzcyIsImRhdGEiLCJlcnJvciIsIlpvZEVycm9yIiwibWVzc2FnZSIsImVycm9ycyIsInN0YXR1cyIsImxvZ2luIiwibG9naW5TY2hlbWEiLCJhZG1pbkxvZ2luIiwicmVmcmVzaFRva2VuIiwicmVmcmVzaFNjaGVtYSIsInZlcmlmeVRva2VuIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJzdGFydHNXaXRoIiwidG9rZW4iLCJzdWJzdHJpbmciLCJkZWNvZGVkIiwiaXNfbmV3IiwidWlkIiwidXVpZCIsImdldE1lIiwidXNlciIsImdldEN1cnJlbnRVc2VyV2l0aFR5cGUiLCJ1c2VyV2l0aG91dFBhc3N3b3JkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/api/auth/auth.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/documents/document.controller.ts":
/*!**************************************************!*\
  !*** ./src/api/documents/document.controller.ts ***!
  \**************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentController: () => (/* binding */ DocumentController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_document_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/document.service */ \"(rsc)/./src/services/document.service.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_document_service__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_services_document_service__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\nclass DocumentController {\n    constructor(documentService, authService){\n        this.documentService = documentService;\n        this.authService = authService;\n    }\n    /**\n   * 获取当前用户（从 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.authService.verifyToken(token);\n    }\n    /**\n   * 创建文档\n   */ async createDocument(req, context) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const body = await req.json();\n            const createSchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n                title: zod__WEBPACK_IMPORTED_MODULE_4__.string().min(1),\n                content: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_4__.record(zod__WEBPACK_IMPORTED_MODULE_4__.any()).optional().nullable()\n            });\n            const validatedData = createSchema.parse(body);\n            // 如果没有提供 content，创建一个空的 Buffer（空 Yjs 文档）\n            const contentBuffer = validatedData.content ? Buffer.from(validatedData.content, \"base64\") : Buffer.alloc(0);\n            const document = await this.documentService.createDocument({\n                workspace_id: context.params.workspace_id,\n                title: validatedData.title,\n                content: contentBuffer,\n                owner_uid: user.uid,\n                metadata: validatedData.metadata || {}\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    workspace_id: document.workspace_id,\n                    created_at: document.created_at instanceof Date ? document.created_at.toISOString() : document.created_at\n                }\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_5__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 400\n            });\n        }\n    }\n    /**\n   * 获取文档\n   */ async getDocument(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const includeContent = req.nextUrl.searchParams.get(\"include_content\") === \"true\";\n            const document = await this.documentService.getDocument(context.params.object_id, includeContent);\n            if (!document) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Document not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    workspace_id: document.workspace_id,\n                    title: document.title,\n                    content: includeContent ? document.content.toString(\"base64\") : undefined,\n                    content_length: document.content_length,\n                    owner_uid: document.owner_uid,\n                    metadata: document.metadata,\n                    created_at: document.created_at instanceof Date ? document.created_at.toISOString() : document.created_at,\n                    updated_at: document.updated_at instanceof Date ? document.updated_at.toISOString() : document.updated_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 更新文档\n   */ async updateDocument(req, context) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const body = await req.json();\n            const updateSchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n                title: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                content: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                change_data: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                snapshot: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_4__.record(zod__WEBPACK_IMPORTED_MODULE_4__.any()).optional().nullable(),\n                forceSnapshot: zod__WEBPACK_IMPORTED_MODULE_4__.boolean().optional().default(false)\n            });\n            const validatedData = updateSchema.parse(body);\n            const updates = {};\n            if (validatedData.title) updates.title = validatedData.title;\n            if (validatedData.content) {\n                updates.content = Buffer.from(validatedData.content, \"base64\");\n            }\n            if (validatedData.change_data) {\n                updates.change_data = Buffer.from(validatedData.change_data, \"base64\");\n            }\n            if (validatedData.snapshot) {\n                updates.snapshot = Buffer.from(validatedData.snapshot, \"base64\");\n            }\n            if (validatedData.metadata) updates.metadata = validatedData.metadata;\n            if (validatedData.forceSnapshot !== undefined) {\n                updates.forceSnapshot = validatedData.forceSnapshot;\n            }\n            const document = await this.documentService.updateDocument(context.params.object_id, updates);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    updated_at: document.updated_at instanceof Date ? document.updated_at.toISOString() : document.updated_at\n                }\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_5__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 400\n            });\n        }\n    }\n    /**\n   * 获取文档列表\n   */ async getDocuments(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const page = parseInt(req.nextUrl.searchParams.get(\"page\") || \"1\", 10);\n            const page_size = parseInt(req.nextUrl.searchParams.get(\"page_size\") || \"20\", 10);\n            const sort_by = req.nextUrl.searchParams.get(\"sort_by\") || \"updated_at\";\n            const order = req.nextUrl.searchParams.get(\"order\") || \"desc\";\n            const result = await this.documentService.getDocuments(context.params.workspace_id, {\n                page,\n                page_size,\n                sort_by,\n                order\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get documents\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 删除文档\n   */ async deleteDocument(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            await this.documentService.deleteDocument(context.params.object_id);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: \"Document deleted successfully\"\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const limit = parseInt(req.nextUrl.searchParams.get(\"limit\") || \"20\", 10);\n            const offset = parseInt(req.nextUrl.searchParams.get(\"offset\") || \"0\", 10);\n            const result = await this.documentService.getSnapshots(context.params.object_id, {\n                limit,\n                offset\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get snapshots\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const snapshot = await this.documentService.getLatestSnapshot(context.params.object_id);\n            if (!snapshot) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Snapshot not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    snapshot_id: snapshot.snapshot_id,\n                    doc_state: snapshot.doc_state?.toString(\"base64\"),\n                    snapshot: snapshot.snapshot_data.toString(\"base64\"),\n                    created_at: snapshot.created_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get latest snapshot\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 根据 snapshot_id 获取快照内容\n   */ async getSnapshotById(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const snapshot = await this.documentService.getSnapshotById(context.params.snapshot_id);\n            if (!snapshot) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Snapshot not found\"\n                }, {\n                    status: 404\n                });\n            }\n            // 从数据库获取快照内容\n            let docStateBase64 = null;\n            if (snapshot.doc_state) {\n                docStateBase64 = snapshot.doc_state.toString(\"base64\");\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    snapshot_id: snapshot.snapshot_id,\n                    doc_state: docStateBase64,\n                    snapshot: snapshot.snapshot_data?.toString(\"base64\") || null,\n                    created_at: snapshot.created_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get snapshot\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 搜索文档\n   */ async searchDocuments(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const query = req.nextUrl.searchParams.get(\"query\");\n            if (!query) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Query parameter is required\"\n                }, {\n                    status: 400\n                });\n            }\n            const limit = parseInt(req.nextUrl.searchParams.get(\"limit\") || \"10\", 10);\n            const offset = parseInt(req.nextUrl.searchParams.get(\"offset\") || \"0\", 10);\n            const threshold = parseFloat(req.nextUrl.searchParams.get(\"threshold\") || \"0.5\");\n            const results = await this.documentService.searchDocuments(context.params.workspace_id, query, {\n                limit,\n                offset,\n                threshold\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: results\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to search documents\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n}\nDocumentController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService === \"undefined\" ? Object : _services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService,\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService\n    ])\n], DocumentController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL2RvY3VtZW50cy9kb2N1bWVudC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXdEO0FBQ2hDO0FBQ3NCO0FBQ2dCO0FBQ1I7QUFNL0MsTUFBTU07SUFDWEMsWUFDRSxlQUFpRSxFQUNqRSxXQUFxRCxDQUNyRDthQUZpQ0Msa0JBQUFBO2FBQ0pDLGNBQUFBO0lBQzVCO0lBRUg7O0dBRUMsR0FDRCxNQUFjQyxlQUFlQyxHQUFnQixFQUEwQztRQUNyRixNQUFNQyxhQUFhRCxJQUFJRSxPQUFPLENBQUNDLEdBQUcsQ0FBQztRQUNuQyxJQUFJLENBQUNGLGNBQWMsQ0FBQ0EsV0FBV0csVUFBVSxDQUFDLFlBQVk7WUFDcEQsTUFBTSxJQUFJQyxNQUFNO1FBQ2xCO1FBRUEsTUFBTUMsUUFBUUwsV0FBV00sU0FBUyxDQUFDO1FBQ25DLE9BQU8sTUFBTSxJQUFJLENBQUNULFdBQVcsQ0FBQ1UsV0FBVyxDQUFDRjtJQUM1QztJQUVBOztHQUVDLEdBQ0QsTUFBTUcsZUFDSlQsR0FBZ0IsRUFDaEJVLE9BQTZDLEVBQ3RCO1FBQ3ZCLElBQUk7WUFDRixNQUFNQyxPQUFPLE1BQU0sSUFBSSxDQUFDWixjQUFjLENBQUNDO1lBQ3ZDLE1BQU1ZLE9BQU8sTUFBTVosSUFBSWEsSUFBSTtZQUUzQixNQUFNQyxlQUFleEIsdUNBQVEsQ0FBQztnQkFDNUIwQixPQUFPMUIsdUNBQVEsR0FBRzRCLEdBQUcsQ0FBQztnQkFDdEJDLFNBQVM3Qix1Q0FBUSxHQUFHOEIsUUFBUSxHQUFHQyxRQUFRO2dCQUN2Q0MsVUFBVWhDLHVDQUFRLENBQUNBLG9DQUFLLElBQUk4QixRQUFRLEdBQUdDLFFBQVE7WUFDakQ7WUFFQSxNQUFNSSxnQkFBZ0JYLGFBQWFZLEtBQUssQ0FBQ2Q7WUFDekMseUNBQXlDO1lBQ3pDLE1BQU1lLGdCQUFnQkYsY0FBY04sT0FBTyxHQUN2Q1MsT0FBT0MsSUFBSSxDQUFDSixjQUFjTixPQUFPLEVBQUUsWUFDbkNT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SUFBSSxDQUFDO2dCQUN2QnVCLFNBQVM7Z0JBQ1RDLE1BQU0rQztZQUNSO1FBQ0YsRUFBRSxPQUFPMUMsT0FBWTtZQUNuQixPQUFPckQscURBQVlBLENBQUN3QixJQUFJLENBQ3RCO2dCQUNFdUIsU0FBUztnQkFDVFEsU0FBU0YsTUFBTUUsT0FBTyxJQUFJO1lBQzVCLEdBQ0E7Z0JBQUVFLFFBQVFKLE1BQU1FLE9BQU8sS0FBSyxpQkFBaUIsTUFBTTtZQUFJO1FBRTNEO0lBQ0Y7QUFDRjtBQWxjYWpELHFCQUFBQSxvRUFBQUE7SUFEWkosb0RBQVVBO0lBR05DLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQ0MsdUVBQWVBO0lBQ3RCRCxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUNFLCtEQUFXQTs7O2VBRCtCLHVFQUFlLDRCQUFmLHVFQUFlO2VBQ3ZCLCtEQUFXLDRCQUFYLCtEQUFXOztHQUg1Q0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBpL2RvY3VtZW50cy9kb2N1bWVudC5jb250cm9sbGVyLnRzPzJlZjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgRG9jdW1lbnRTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9kb2N1bWVudC5zZXJ2aWNlJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xuXG4vKipcbiAqIOaWh+aho+aOp+WItuWZqFxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQGluamVjdChEb2N1bWVudFNlcnZpY2UpIHByaXZhdGUgZG9jdW1lbnRTZXJ2aWNlOiBEb2N1bWVudFNlcnZpY2UsXG4gICAgQGluamVjdChBdXRoU2VydmljZSkgcHJpdmF0ZSBhdXRoU2VydmljZTogQXV0aFNlcnZpY2VcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiDojrflj5blvZPliY3nlKjmiLfvvIjku44gdG9rZW7vvIlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q3VycmVudFVzZXIocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8eyB1aWQ6IG51bWJlcjsgdXVpZDogc3RyaW5nIH0+IHtcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJyk7XG4gICAgaWYgKCFhdXRoSGVhZGVyIHx8ICFhdXRoSGVhZGVyLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmF1dGhvcml6ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLnZlcmlmeVRva2VuKHRva2VuKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlofmoaNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZURvY3VtZW50KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmcgfSB9XG4gICk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcblxuICAgICAgY29uc3QgY3JlYXRlU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICB0aXRsZTogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICAgIGNvbnRlbnQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5udWxsYWJsZSgpLCAvLyBCYXNlNjQg57yW56CB55qE5YaF5a6577yM5Y+v6YCJXG4gICAgICAgIG1ldGFkYXRhOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNyZWF0ZVNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIC8vIOWmguaenOayoeacieaPkOS+myBjb250ZW5077yM5Yib5bu65LiA5Liq56m655qEIEJ1ZmZlcu+8iOepuiBZanMg5paH5qGj77yJXG4gICAgICBjb25zdCBjb250ZW50QnVmZmVyID0gdmFsaWRhdGVkRGF0YS5jb250ZW50XG4gICAgICAgID8gQnVmZmVyLmZyb20odmFsaWRhdGVkRGF0YS5jb250ZW50LCAnYmFzZTY0JylcbiAgICAgICAgOiBCdWZmZXIuYWxsb2MoMCk7XG5cbiAgICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2UuY3JlYXRlRG9jdW1lbnQoe1xuICAgICAgICB3b3Jrc3BhY2VfaWQ6IGNvbnRleHQucGFyYW1zLndvcmtzcGFjZV9pZCxcbiAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRCdWZmZXIsXG4gICAgICAgIG93bmVyX3VpZDogdXNlci51aWQsXG4gICAgICAgIG1ldGFkYXRhOiB2YWxpZGF0ZWREYXRhLm1ldGFkYXRhIHx8IHt9LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBvYmplY3RfaWQ6IGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICB3b3Jrc3BhY2VfaWQ6IGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgICBjcmVhdGVkX2F0OlxuICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlZF9hdCBpbnN0YW5jZW9mIERhdGVcbiAgICAgICAgICAgICAgPyBkb2N1bWVudC5jcmVhdGVkX2F0LnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgOiBkb2N1bWVudC5jcmVhdGVkX2F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8g5aSE55CGIFpvZCDpqozor4HplJnor69cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBjcmVhdGUgZG9jdW1lbnQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGjXG4gICAqL1xuICBhc3luYyBnZXREb2N1bWVudChcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBjb25zdCBpbmNsdWRlQ29udGVudCA9IHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2luY2x1ZGVfY29udGVudCcpID09PSAndHJ1ZSc7XG4gICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmdldERvY3VtZW50KFxuICAgICAgICBjb250ZXh0LnBhcmFtcy5vYmplY3RfaWQsXG4gICAgICAgIGluY2x1ZGVDb250ZW50XG4gICAgICApO1xuXG4gICAgICBpZiAoIWRvY3VtZW50KSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdEb2N1bWVudCBub3QgZm91bmQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBvYmplY3RfaWQ6IGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICB3b3Jrc3BhY2VfaWQ6IGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgICB0aXRsZTogZG9jdW1lbnQudGl0bGUsXG4gICAgICAgICAgY29udGVudDogaW5jbHVkZUNvbnRlbnQgPyBkb2N1bWVudC5jb250ZW50LnRvU3RyaW5nKCdiYXNlNjQnKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICBjb250ZW50X2xlbmd0aDogZG9jdW1lbnQuY29udGVudF9sZW5ndGgsXG4gICAgICAgICAgb3duZXJfdWlkOiBkb2N1bWVudC5vd25lcl91aWQsXG4gICAgICAgICAgbWV0YWRhdGE6IGRvY3VtZW50Lm1ldGFkYXRhLFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6XG4gICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZVxuICAgICAgICAgICAgICA/IGRvY3VtZW50LmNyZWF0ZWRfYXQudG9JU09TdHJpbmcoKVxuICAgICAgICAgICAgICA6IGRvY3VtZW50LmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDpcbiAgICAgICAgICAgIGRvY3VtZW50LnVwZGF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlXG4gICAgICAgICAgICAgID8gZG9jdW1lbnQudXBkYXRlZF9hdC50b0lTT1N0cmluZygpXG4gICAgICAgICAgICAgIDogZG9jdW1lbnQudXBkYXRlZF9hdCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgZG9jdW1lbnQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5pu05paw5paH5qGjXG4gICAqL1xuICBhc3luYyB1cGRhdGVEb2N1bWVudChcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXIocmVxKTtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuXG4gICAgICBjb25zdCB1cGRhdGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIHRpdGxlOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICAgICAgY29udGVudDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksIC8vIEJhc2U2NCDnvJbnoIHnmoTlhoXlrrnvvIhEb2MgU3RhdGXvvIlcbiAgICAgICAgY2hhbmdlX2RhdGE6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5udWxsYWJsZSgpLCAvLyBCYXNlNjQg57yW56CB55qE5aKe6YeP5pu05paw77yIWWpzIFVwZGF0Ze+8iVxuICAgICAgICBzbmFwc2hvdDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksIC8vIEJhc2U2NCDnvJbnoIHnmoQgU25hcHNob3TvvIjnirbmgIHlkJHph4/vvIlcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICAgICAgZm9yY2VTbmFwc2hvdDogei5ib29sZWFuKCkub3B0aW9uYWwoKS5kZWZhdWx0KGZhbHNlKSwgLy8g5piv5ZCm5by65Yi25Yib5bu65b+r54WnXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHVwZGF0ZVNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IHVwZGF0ZXM6IGFueSA9IHt9O1xuXG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS50aXRsZSkgdXBkYXRlcy50aXRsZSA9IHZhbGlkYXRlZERhdGEudGl0bGU7XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5jb250ZW50KSB7XG4gICAgICAgIHVwZGF0ZXMuY29udGVudCA9IEJ1ZmZlci5mcm9tKHZhbGlkYXRlZERhdGEuY29udGVudCwgJ2Jhc2U2NCcpO1xuICAgICAgfVxuICAgICAgaWYgKHZhbGlkYXRlZERhdGEuY2hhbmdlX2RhdGEpIHtcbiAgICAgICAgdXBkYXRlcy5jaGFuZ2VfZGF0YSA9IEJ1ZmZlci5mcm9tKHZhbGlkYXRlZERhdGEuY2hhbmdlX2RhdGEsICdiYXNlNjQnKTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWxpZGF0ZWREYXRhLnNuYXBzaG90KSB7XG4gICAgICAgIHVwZGF0ZXMuc25hcHNob3QgPSBCdWZmZXIuZnJvbSh2YWxpZGF0ZWREYXRhLnNuYXBzaG90LCAnYmFzZTY0Jyk7XG4gICAgICB9XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5tZXRhZGF0YSkgdXBkYXRlcy5tZXRhZGF0YSA9IHZhbGlkYXRlZERhdGEubWV0YWRhdGE7XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5mb3JjZVNuYXBzaG90ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXBkYXRlcy5mb3JjZVNuYXBzaG90ID0gdmFsaWRhdGVkRGF0YS5mb3JjZVNuYXBzaG90O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLnVwZGF0ZURvY3VtZW50KGNvbnRleHQucGFyYW1zLm9iamVjdF9pZCwgdXBkYXRlcyk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBvYmplY3RfaWQ6IGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICB1cGRhdGVkX2F0OlxuICAgICAgICAgICAgZG9jdW1lbnQudXBkYXRlZF9hdCBpbnN0YW5jZW9mIERhdGVcbiAgICAgICAgICAgICAgPyBkb2N1bWVudC51cGRhdGVkX2F0LnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgOiBkb2N1bWVudC51cGRhdGVkX2F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8g5aSE55CGIFpvZCDpqozor4HplJnor69cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgZG9jdW1lbnQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGj5YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXREb2N1bWVudHMoXG4gICAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgncGFnZScpIHx8ICcxJywgMTApO1xuICAgICAgY29uc3QgcGFnZV9zaXplID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgncGFnZV9zaXplJykgfHwgJzIwJywgMTApO1xuICAgICAgY29uc3Qgc29ydF9ieSA9XG4gICAgICAgIChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdzb3J0X2J5JykgYXMgJ2NyZWF0ZWRfYXQnIHwgJ3VwZGF0ZWRfYXQnIHwgJ3RpdGxlJykgfHxcbiAgICAgICAgJ3VwZGF0ZWRfYXQnO1xuICAgICAgY29uc3Qgb3JkZXIgPSAocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnb3JkZXInKSBhcyAnYXNjJyB8ICdkZXNjJykgfHwgJ2Rlc2MnO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5nZXREb2N1bWVudHMoY29udGV4dC5wYXJhbXMud29ya3NwYWNlX2lkLCB7XG4gICAgICAgIHBhZ2UsXG4gICAgICAgIHBhZ2Vfc2l6ZSxcbiAgICAgICAgc29ydF9ieSxcbiAgICAgICAgb3JkZXIsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkb2N1bWVudHMnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5paH5qGjXG4gICAqL1xuICBhc3luYyBkZWxldGVEb2N1bWVudChcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5kZWxldGVEb2N1bWVudChjb250ZXh0LnBhcmFtcy5vYmplY3RfaWQpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnRG9jdW1lbnQgZGVsZXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGRlbGV0ZSBkb2N1bWVudCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPlv6vnhafliJfooahcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90cyhcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzIwJywgMTApO1xuICAgICAgY29uc3Qgb2Zmc2V0ID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnb2Zmc2V0JykgfHwgJzAnLCAxMCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmdldFNuYXBzaG90cyhjb250ZXh0LnBhcmFtcy5vYmplY3RfaWQsIHtcbiAgICAgICAgbGltaXQsXG4gICAgICAgIG9mZnNldCxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IHNuYXBzaG90cycsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmnIDmlrDlv6vnhadcbiAgICovXG4gIGFzeW5jIGdldExhdGVzdFNuYXBzaG90KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2UuZ2V0TGF0ZXN0U25hcHNob3QoY29udGV4dC5wYXJhbXMub2JqZWN0X2lkKTtcblxuICAgICAgaWYgKCFzbmFwc2hvdCkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnU25hcHNob3Qgbm90IGZvdW5kJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc25hcHNob3RfaWQ6IHNuYXBzaG90LnNuYXBzaG90X2lkLFxuICAgICAgICAgIGRvY19zdGF0ZTogc25hcHNob3QuZG9jX3N0YXRlPy50b1N0cmluZygnYmFzZTY0JyksXG4gICAgICAgICAgc25hcHNob3Q6IHNuYXBzaG90LnNuYXBzaG90X2RhdGEudG9TdHJpbmcoJ2Jhc2U2NCcpLFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IHNuYXBzaG90LmNyZWF0ZWRfYXQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGxhdGVzdCBzbmFwc2hvdCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja4gc25hcHNob3RfaWQg6I635Y+W5b+r54Wn5YaF5a65XG4gICAqL1xuICBhc3luYyBnZXRTbmFwc2hvdEJ5SWQoXG4gICAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZzsgb2JqZWN0X2lkOiBzdHJpbmc7IHNuYXBzaG90X2lkOiBzdHJpbmcgfSB9XG4gICk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXIocmVxKTtcblxuICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5nZXRTbmFwc2hvdEJ5SWQoY29udGV4dC5wYXJhbXMuc25hcHNob3RfaWQpO1xuXG4gICAgICBpZiAoIXNuYXBzaG90KSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTbmFwc2hvdCBub3QgZm91bmQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIOS7juaVsOaNruW6k+iOt+WPluW/q+eFp+WGheWuuVxuICAgICAgbGV0IGRvY1N0YXRlQmFzZTY0OiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgIGlmIChzbmFwc2hvdC5kb2Nfc3RhdGUpIHtcbiAgICAgICAgZG9jU3RhdGVCYXNlNjQgPSBzbmFwc2hvdC5kb2Nfc3RhdGUudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc25hcHNob3RfaWQ6IHNuYXBzaG90LnNuYXBzaG90X2lkLFxuICAgICAgICAgIGRvY19zdGF0ZTogZG9jU3RhdGVCYXNlNjQsXG4gICAgICAgICAgc25hcHNob3Q6IHNuYXBzaG90LnNuYXBzaG90X2RhdGE/LnRvU3RyaW5nKCdiYXNlNjQnKSB8fCBudWxsLFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IHNuYXBzaG90LmNyZWF0ZWRfYXQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IHNuYXBzaG90JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOaQnOe0ouaWh+aho1xuICAgKi9cbiAgYXN5bmMgc2VhcmNoRG9jdW1lbnRzKFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmcgfSB9XG4gICk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXIocmVxKTtcblxuICAgICAgY29uc3QgcXVlcnkgPSByZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdxdWVyeScpO1xuICAgICAgaWYgKCFxdWVyeSkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnUXVlcnkgcGFyYW1ldGVyIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzEwJywgMTApO1xuICAgICAgY29uc3Qgb2Zmc2V0ID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnb2Zmc2V0JykgfHwgJzAnLCAxMCk7XG4gICAgICBjb25zdCB0aHJlc2hvbGQgPSBwYXJzZUZsb2F0KHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ3RocmVzaG9sZCcpIHx8ICcwLjUnKTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLnNlYXJjaERvY3VtZW50cyhcbiAgICAgICAgY29udGV4dC5wYXJhbXMud29ya3NwYWNlX2lkLFxuICAgICAgICBxdWVyeSxcbiAgICAgICAge1xuICAgICAgICAgIGxpbWl0LFxuICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICB0aHJlc2hvbGQsXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdHMsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gc2VhcmNoIGRvY3VtZW50cycsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInoiLCJpbmplY3RhYmxlIiwiaW5qZWN0IiwiRG9jdW1lbnRTZXJ2aWNlIiwiQXV0aFNlcnZpY2UiLCJEb2N1bWVudENvbnRyb2xsZXIiLCJjb25zdHJ1Y3RvciIsImRvY3VtZW50U2VydmljZSIsImF1dGhTZXJ2aWNlIiwiZ2V0Q3VycmVudFVzZXIiLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInN0YXJ0c1dpdGgiLCJFcnJvciIsInRva2VuIiwic3Vic3RyaW5nIiwidmVyaWZ5VG9rZW4iLCJjcmVhdGVEb2N1bWVudCIsImNvbnRleHQiLCJ1c2VyIiwiYm9keSIsImpzb24iLCJjcmVhdGVTY2hlbWEiLCJvYmplY3QiLCJ0aXRsZSIsInN0cmluZyIsIm1pbiIsImNvbnRlbnQiLCJvcHRpb25hbCIsIm51bGxhYmxlIiwibWV0YWRhdGEiLCJyZWNvcmQiLCJhbnkiLCJ2YWxpZGF0ZWREYXRhIiwicGFyc2UiLCJjb250ZW50QnVmZmVyIiwiQnVmZmVyIiwiZnJvbSIsImFsbG9jIiwiZG9jdW1lbnQiLCJ3b3Jrc3BhY2VfaWQiLCJwYXJhbXMiLCJvd25lcl91aWQiLCJ1aWQiLCJzdWNjZXNzIiwiZGF0YSIsIm9iamVjdF9pZCIsImNyZWF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJlcnJvciIsIlpvZEVycm9yIiwibWVzc2FnZSIsImVycm9ycyIsInN0YXR1cyIsImdldERvY3VtZW50IiwiaW5jbHVkZUNvbnRlbnQiLCJuZXh0VXJsIiwic2VhcmNoUGFyYW1zIiwidG9TdHJpbmciLCJ1bmRlZmluZWQiLCJjb250ZW50X2xlbmd0aCIsInVwZGF0ZWRfYXQiLCJ1cGRhdGVEb2N1bWVudCIsInVwZGF0ZVNjaGVtYSIsImNoYW5nZV9kYXRhIiwic25hcHNob3QiLCJmb3JjZVNuYXBzaG90IiwiYm9vbGVhbiIsImRlZmF1bHQiLCJ1cGRhdGVzIiwiZ2V0RG9jdW1lbnRzIiwicGFnZSIsInBhcnNlSW50IiwicGFnZV9zaXplIiwic29ydF9ieSIsIm9yZGVyIiwicmVzdWx0IiwiZGVsZXRlRG9jdW1lbnQiLCJnZXRTbmFwc2hvdHMiLCJsaW1pdCIsIm9mZnNldCIsImdldExhdGVzdFNuYXBzaG90Iiwic25hcHNob3RfaWQiLCJkb2Nfc3RhdGUiLCJzbmFwc2hvdF9kYXRhIiwiZ2V0U25hcHNob3RCeUlkIiwiZG9jU3RhdGVCYXNlNjQiLCJzZWFyY2hEb2N1bWVudHMiLCJxdWVyeSIsInRocmVzaG9sZCIsInBhcnNlRmxvYXQiLCJyZXN1bHRzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/api/documents/document.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/subject/subject.controller.ts":
/*!***********************************************!*\
  !*** ./src/api/subject/subject.controller.ts ***!
  \***********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SubjectController: () => (/* binding */ SubjectController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_subject_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/subject.service */ \"(rsc)/./src/services/subject.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_subject_service__WEBPACK_IMPORTED_MODULE_2__]);\n_services_subject_service__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nclass SubjectController {\n    constructor(subjectService){\n        this.subjectService = subjectService;\n    }\n    /**\n   * 获取学科分类树形结构\n   */ async getCategoryTree(req) {\n        try {\n            const tree = await this.subjectService.getCategoryTree();\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: tree\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get category tree\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取学科分类列表\n   */ async getCategories(req) {\n        try {\n            const { searchParams } = new URL(req.url);\n            const parentId = searchParams.get(\"parent_id\");\n            const current = parseInt(searchParams.get(\"current\") || \"1\", 10);\n            const pageSize = parseInt(searchParams.get(\"pageSize\") || \"20\", 10);\n            const keyword = searchParams.get(\"keyword\") || undefined;\n            let result;\n            // 如果 parentId 是 'null' 字符串或 null，查询顶级分类（支持分页和搜索）\n            if (parentId === \"null\" || parentId === null) {\n                result = await this.subjectService.getCategoriesByParentId(null, {\n                    current,\n                    pageSize,\n                    keyword\n                });\n            } else if (parentId) {\n                // 如果 parentId 有值，查询指定父分类的子分类（支持分页和搜索）\n                result = await this.subjectService.getCategoriesByParentId(parentId, {\n                    current,\n                    pageSize,\n                    keyword\n                });\n            } else {\n                // 如果没有传递 parentId，查询所有分类（不分页，用于下拉选择等场景）\n                const categories = await this.subjectService.getCategories();\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: true,\n                    data: categories,\n                    pagination: {\n                        current: 1,\n                        pageSize: categories.length,\n                        total: categories.length\n                    }\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result.categories,\n                pagination: {\n                    current,\n                    pageSize,\n                    total: result.total\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get categories\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取分类的直接子分类（用于树懒加载）\n   */ async getCategoryChildren(req) {\n        try {\n            const { searchParams } = new URL(req.url);\n            const parentId = searchParams.get(\"parent_id\");\n            const children = await this.subjectService.getCategoryChildren(parentId === \"null\" ? null : parentId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: children\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get category children\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取学科分类详情\n   */ async getCategoryById(req, categoryId) {\n        try {\n            const category = await this.subjectService.getCategoryById(categoryId);\n            if (!category) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Category not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: category\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get category\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 创建学科分类\n   */ async createCategory(req) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                parent_id: zod__WEBPACK_IMPORTED_MODULE_3__.string().nullable().optional(),\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                icon_url: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const category = await this.subjectService.createCategory(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: category\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create category\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 更新学科分类\n   */ async updateCategory(req, categoryId) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                parent_id: zod__WEBPACK_IMPORTED_MODULE_3__.string().nullable().optional(),\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                icon_url: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const category = await this.subjectService.updateCategory(categoryId, validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: category\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update category\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 删除学科分类\n   */ async deleteCategory(req, categoryId) {\n        try {\n            await this.subjectService.deleteCategory(categoryId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: \"Category deleted successfully\"\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete category\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 获取学科列表\n   */ async getSubjects(req) {\n        try {\n            const { searchParams } = new URL(req.url);\n            const categoryId = searchParams.get(\"category_id\");\n            const current = parseInt(searchParams.get(\"current\") || \"1\", 10);\n            const pageSize = parseInt(searchParams.get(\"pageSize\") || \"20\", 10);\n            const keyword = searchParams.get(\"keyword\") || undefined;\n            let result;\n            if (categoryId) {\n                result = await this.subjectService.getSubjectsByCategoryId(categoryId, {\n                    current,\n                    pageSize,\n                    keyword\n                });\n            } else {\n                // 如果没有 categoryId，查询所有学科（支持分页和搜索）\n                result = await this.subjectService.getSubjectsByCategoryId(null, {\n                    current,\n                    pageSize,\n                    keyword\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result.subjects,\n                pagination: {\n                    current,\n                    pageSize,\n                    total: result.total\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get subjects\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 获取学科详情\n   */ async getSubjectById(req, subjectId) {\n        try {\n            const subject = await this.subjectService.getSubjectById(subjectId);\n            if (!subject) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Subject not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: subject\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get subject\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 创建学科\n   */ async createSubject(req) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                category_id: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                short_name: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                icon_url: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                cover_image_url: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                is_published: zod__WEBPACK_IMPORTED_MODULE_3__.boolean().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const subject = await this.subjectService.createSubject(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: subject\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create subject\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 更新学科\n   */ async updateSubject(req, subjectId) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                category_id: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                code: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                short_name: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                icon_url: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                cover_image_url: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                sort_order: zod__WEBPACK_IMPORTED_MODULE_3__.number().optional(),\n                is_published: zod__WEBPACK_IMPORTED_MODULE_3__.boolean().optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const subject = await this.subjectService.updateSubject(subjectId, validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: subject\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update subject\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 删除学科\n   */ async deleteSubject(req, subjectId) {\n        try {\n            await this.subjectService.deleteSubject(subjectId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: \"Subject deleted successfully\"\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete subject\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 获取学科详情信息\n   */ async getSubjectDetail(req, subjectId) {\n        try {\n            const detail = await this.subjectService.getSubjectDetail(subjectId);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: detail\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get subject detail\"\n            }, {\n                status: 500\n            });\n        }\n    }\n    /**\n   * 创建或更新学科详情\n   */ async upsertSubjectDetail(req) {\n        try {\n            const body = await req.json();\n            const schema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                subject_id: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1),\n                definition: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                description: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                purpose: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                value: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                application_scenarios: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                learning_objectives: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                prerequisites: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n                related_subjects: zod__WEBPACK_IMPORTED_MODULE_3__.array(zod__WEBPACK_IMPORTED_MODULE_3__.string()).optional(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_3__.record(zod__WEBPACK_IMPORTED_MODULE_3__.any()).optional()\n            });\n            const validatedData = schema.parse(body);\n            const detail = await this.subjectService.upsertSubjectDetail(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: detail\n            });\n        } catch (error) {\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to upsert subject detail\"\n            }, {\n                status: 400\n            });\n        }\n    }\n}\nSubjectController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_subject_service__WEBPACK_IMPORTED_MODULE_2__.SubjectService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:paramtypes\", [\n        typeof _services_subject_service__WEBPACK_IMPORTED_MODULE_2__.SubjectService === \"undefined\" ? Object : _services_subject_service__WEBPACK_IMPORTED_MODULE_2__.SubjectService\n    ])\n], SubjectController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL3N1YmplY3Qvc3ViamVjdC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDaEM7QUFDc0I7QUFDYztBQU1yRCxNQUFNSztJQUNYQyxZQUFZLGNBQThELENBQUU7YUFBaENDLGlCQUFBQTtJQUFpQztJQUU3RTs7R0FFQyxHQUNELE1BQU1DLGdCQUFnQkMsR0FBZ0IsRUFBeUI7UUFDN0QsSUFBSTtZQUNGLE1BQU1DLE9BQU8sTUFBTSxJQUFJLENBQUNILGNBQWMsQ0FBQ0MsZUFBZTtZQUN0RCxPQUFPUixxREFBWUEsQ0FBQ1csSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztnQkFDVEMsTUFBTUg7WUFDUjtRQUNGLEVBQUUsT0FBT0ksT0FBWTtZQUNuQixPQUFPZCxxREFBWUEsQ0FBQ1csSUFBSSxDQUN0QjtnQkFDRUMsU0FBUztnQkFDVEcsU0FBU0QsTUFBTUMsT0FBTyxJQUFJO1lBQzVCLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFNQyxjQUFjUixHQUFnQixFQUF5QjtRQUMzRCxJQUFJO1lBQ0YsTUFBTSxFQUFFUyxZQUFZLEVBQUUsR0FBRyxJQUFJQyxJQUFJVixJQUFJVyxHQUFHO1lBQ3hDLE1BQU1DLFdBQVdILGFBQWFJLEdBQUcsQ0FBQztZQUNsQyxNQUFNQyxVQUFVQyxTQUFTTixhQUFhSSxHQUFHLENBQUMsY0FBYyxLQUFLO1lBQzdELE1BQU1HLFdBQVdELFNBQVNOLGFBQWFJLEdBQUcsQ0FBQyxlQUFlLE1BQU07WUFDaEUsTUFBTUksVUFBVVIsYUFBYUksR0FBRyxDQUFDLGNBQWNLO1lBRS9DLElBQUlDO1lBQ0osaURBQWlEO1lBQ2pELElBQUlQLGFBQWEsVUFBVUEsYUFBYSxNQUFNO2dCQUM1Q08sU0FBUyxNQUFNLElBQUksQ0FBQ3JCLGNBQWMsQ0FBQ3NCLHVCQUF1QixDQUFDLE1BQU07b0JBQUVOO29CQUFTRTtvQkFBVUM7Z0JBQVE7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Q1csSUFBSSxDQUN0QjtnQkFDRUMsU0FBUztnQkFDVEcsU0FBU0QsTUFBTUMsT0FBTyxJQUFJO1lBQzVCLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtJQUNGO0FBQ0Y7QUF2ZWFYLG9CQUFBQSxvRUFBQUE7SUFEWkgsb0RBQVVBO0lBRUlDLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQ0MscUVBQWNBOzs7ZUFBMEIscUVBQWMsNEJBQWQscUVBQWM7O0dBRC9EQyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9hcGkvc3ViamVjdC9zdWJqZWN0LmNvbnRyb2xsZXIudHM/YWFiYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgeyBTdWJqZWN0U2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvc3ViamVjdC5zZXJ2aWNlJztcblxuLyoqXG4gKiDlrabnp5HmjqfliLblmahcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFN1YmplY3RDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoQGluamVjdChTdWJqZWN0U2VydmljZSkgcHJpdmF0ZSBzdWJqZWN0U2VydmljZTogU3ViamVjdFNlcnZpY2UpIHt9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWtpuenkeWIhuexu+agkeW9oue7k+aehFxuICAgKi9cbiAgYXN5bmMgZ2V0Q2F0ZWdvcnlUcmVlKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0cmVlID0gYXdhaXQgdGhpcy5zdWJqZWN0U2VydmljZS5nZXRDYXRlZ29yeVRyZWUoKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHRyZWUsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGNhdGVnb3J5IHRyZWUnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWtpuenkeWIhuexu+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0Q2F0ZWdvcmllcyhyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxLnVybCk7XG4gICAgICBjb25zdCBwYXJlbnRJZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3BhcmVudF9pZCcpO1xuICAgICAgY29uc3QgY3VycmVudCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2N1cnJlbnQnKSB8fCAnMScsIDEwKTtcbiAgICAgIGNvbnN0IHBhZ2VTaXplID0gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgncGFnZVNpemUnKSB8fCAnMjAnLCAxMCk7XG4gICAgICBjb25zdCBrZXl3b3JkID0gc2VhcmNoUGFyYW1zLmdldCgna2V5d29yZCcpIHx8IHVuZGVmaW5lZDtcblxuICAgICAgbGV0IHJlc3VsdDtcbiAgICAgIC8vIOWmguaenCBwYXJlbnRJZCDmmK8gJ251bGwnIOWtl+espuS4suaIliBudWxs77yM5p+l6K+i6aG257qn5YiG57G777yI5pSv5oyB5YiG6aG15ZKM5pCc57Si77yJXG4gICAgICBpZiAocGFyZW50SWQgPT09ICdudWxsJyB8fCBwYXJlbnRJZCA9PT0gbnVsbCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLnN1YmplY3RTZXJ2aWNlLmdldENhdGVnb3JpZXNCeVBhcmVudElkKG51bGwsIHsgY3VycmVudCwgcGFnZVNpemUsIGtleXdvcmQgfSk7XG4gICAgICB9IGVsc2UgaWYgKHBhcmVudElkKSB7XG4gICAgICAgIC8vIOWmguaenCBwYXJlbnRJZCDmnInlgLzvvIzmn6Xor6LmjIflrprniLbliIbnsbvnmoTlrZDliIbnsbvvvIjmlK/mjIHliIbpobXlkozmkJzntKLvvIlcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5zdWJqZWN0U2VydmljZS5nZXRDYXRlZ29yaWVzQnlQYXJlbnRJZChwYXJlbnRJZCwgeyBjdXJyZW50LCBwYWdlU2l6ZSwga2V5d29yZCB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIOWmguaenOayoeacieS8oOmAkiBwYXJlbnRJZO+8jOafpeivouaJgOacieWIhuexu++8iOS4jeWIhumhte+8jOeUqOS6juS4i+aLiemAieaLqeetieWcuuaZr++8iVxuICAgICAgICBjb25zdCBjYXRlZ29yaWVzID0gYXdhaXQgdGhpcy5zdWJqZWN0U2VydmljZS5nZXRDYXRlZ29yaWVzKCk7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBkYXRhOiBjYXRlZ29yaWVzLFxuICAgICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICAgIGN1cnJlbnQ6IDEsXG4gICAgICAgICAgICBwYWdlU2l6ZTogY2F0ZWdvcmllcy5sZW5ndGgsXG4gICAgICAgICAgICB0b3RhbDogY2F0ZWdvcmllcy5sZW5ndGgsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdC5jYXRlZ29yaWVzLFxuICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgY3VycmVudCxcbiAgICAgICAgICBwYWdlU2l6ZSxcbiAgICAgICAgICB0b3RhbDogcmVzdWx0LnRvdGFsLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBjYXRlZ29yaWVzJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bliIbnsbvnmoTnm7TmjqXlrZDliIbnsbvvvIjnlKjkuo7moJHmh5LliqDovb3vvIlcbiAgICovXG4gIGFzeW5jIGdldENhdGVnb3J5Q2hpbGRyZW4ocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcS51cmwpO1xuICAgICAgY29uc3QgcGFyZW50SWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCdwYXJlbnRfaWQnKTtcbiAgICAgIGNvbnN0IGNoaWxkcmVuID0gYXdhaXQgdGhpcy5zdWJqZWN0U2VydmljZS5nZXRDYXRlZ29yeUNoaWxkcmVuKHBhcmVudElkID09PSAnbnVsbCcgPyBudWxsIDogcGFyZW50SWQpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogY2hpbGRyZW4sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGNhdGVnb3J5IGNoaWxkcmVuJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blrabnp5HliIbnsbvor6bmg4VcbiAgICovXG4gIGFzeW5jIGdldENhdGVnb3J5QnlJZChyZXE6IE5leHRSZXF1ZXN0LCBjYXRlZ29yeUlkOiBzdHJpbmcpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjYXRlZ29yeSA9IGF3YWl0IHRoaXMuc3ViamVjdFNlcnZpY2UuZ2V0Q2F0ZWdvcnlCeUlkKGNhdGVnb3J5SWQpO1xuICAgICAgaWYgKCFjYXRlZ29yeSkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnQ2F0ZWdvcnkgbm90IGZvdW5kJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogY2F0ZWdvcnksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGNhdGVnb3J5JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlrabnp5HliIbnsbtcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUNhdGVnb3J5KHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgcGFyZW50X2lkOiB6LnN0cmluZygpLm51bGxhYmxlKCkub3B0aW9uYWwoKSxcbiAgICAgICAgY29kZTogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBpY29uX3VybDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBzb3J0X29yZGVyOiB6Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gICAgICAgIG1ldGFkYXRhOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBzY2hlbWEucGFyc2UoYm9keSk7XG4gICAgICBjb25zdCBjYXRlZ29yeSA9IGF3YWl0IHRoaXMuc3ViamVjdFNlcnZpY2UuY3JlYXRlQ2F0ZWdvcnkodmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGNhdGVnb3J5LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGNyZWF0ZSBjYXRlZ29yeScsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5pu05paw5a2m56eR5YiG57G7XG4gICAqL1xuICBhc3luYyB1cGRhdGVDYXRlZ29yeShyZXE6IE5leHRSZXF1ZXN0LCBjYXRlZ29yeUlkOiBzdHJpbmcpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgcGFyZW50X2lkOiB6LnN0cmluZygpLm51bGxhYmxlKCkub3B0aW9uYWwoKSxcbiAgICAgICAgY29kZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBuYW1lOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGljb25fdXJsOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHNvcnRfb3JkZXI6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IGNhdGVnb3J5ID0gYXdhaXQgdGhpcy5zdWJqZWN0U2VydmljZS51cGRhdGVDYXRlZ29yeShjYXRlZ29yeUlkLCB2YWxpZGF0ZWREYXRhKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogY2F0ZWdvcnksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gdXBkYXRlIGNhdGVnb3J5JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTlrabnp5HliIbnsbtcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUNhdGVnb3J5KHJlcTogTmV4dFJlcXVlc3QsIGNhdGVnb3J5SWQ6IHN0cmluZyk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc3ViamVjdFNlcnZpY2UuZGVsZXRlQ2F0ZWdvcnkoY2F0ZWdvcnlJZCk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnQ2F0ZWdvcnkgZGVsZXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGRlbGV0ZSBjYXRlZ29yeScsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5a2m56eR5YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXRTdWJqZWN0cyhyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxLnVybCk7XG4gICAgICBjb25zdCBjYXRlZ29yeUlkID0gc2VhcmNoUGFyYW1zLmdldCgnY2F0ZWdvcnlfaWQnKTtcbiAgICAgIGNvbnN0IGN1cnJlbnQgPSBwYXJzZUludChzZWFyY2hQYXJhbXMuZ2V0KCdjdXJyZW50JykgfHwgJzEnLCAxMCk7XG4gICAgICBjb25zdCBwYWdlU2l6ZSA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ3BhZ2VTaXplJykgfHwgJzIwJywgMTApO1xuICAgICAgY29uc3Qga2V5d29yZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ2tleXdvcmQnKSB8fCB1bmRlZmluZWQ7XG5cbiAgICAgIGxldCByZXN1bHQ7XG4gICAgICBpZiAoY2F0ZWdvcnlJZCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLnN1YmplY3RTZXJ2aWNlLmdldFN1YmplY3RzQnlDYXRlZ29yeUlkKGNhdGVnb3J5SWQsIHsgY3VycmVudCwgcGFnZVNpemUsIGtleXdvcmQgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyDlpoLmnpzmsqHmnIkgY2F0ZWdvcnlJZO+8jOafpeivouaJgOacieWtpuenke+8iOaUr+aMgeWIhumhteWSjOaQnOe0ou+8iVxuICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLnN1YmplY3RTZXJ2aWNlLmdldFN1YmplY3RzQnlDYXRlZ29yeUlkKG51bGwsIHsgY3VycmVudCwgcGFnZVNpemUsIGtleXdvcmQgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdC5zdWJqZWN0cyxcbiAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgIGN1cnJlbnQsXG4gICAgICAgICAgcGFnZVNpemUsXG4gICAgICAgICAgdG90YWw6IHJlc3VsdC50b3RhbCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgc3ViamVjdHMnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWtpuenkeivpuaDhVxuICAgKi9cbiAgYXN5bmMgZ2V0U3ViamVjdEJ5SWQocmVxOiBOZXh0UmVxdWVzdCwgc3ViamVjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdWJqZWN0ID0gYXdhaXQgdGhpcy5zdWJqZWN0U2VydmljZS5nZXRTdWJqZWN0QnlJZChzdWJqZWN0SWQpO1xuICAgICAgaWYgKCFzdWJqZWN0KSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTdWJqZWN0IG5vdCBmb3VuZCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHN1YmplY3QsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IHN1YmplY3QnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuWtpuenkVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlU3ViamVjdChyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIGNhdGVnb3J5X2lkOiB6LnN0cmluZygpLm1pbigxKSxcbiAgICAgICAgY29kZTogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgICBzaG9ydF9uYW1lOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGljb25fdXJsOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGNvdmVyX2ltYWdlX3VybDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBzb3J0X29yZGVyOiB6Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gICAgICAgIGlzX3B1Ymxpc2hlZDogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IHN1YmplY3QgPSBhd2FpdCB0aGlzLnN1YmplY3RTZXJ2aWNlLmNyZWF0ZVN1YmplY3QodmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHN1YmplY3QsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gY3JlYXRlIHN1YmplY3QnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOWtpuenkVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlU3ViamVjdChyZXE6IE5leHRSZXF1ZXN0LCBzdWJqZWN0SWQ6IHN0cmluZyk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuICAgICAgY29uc3Qgc2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICBjYXRlZ29yeV9pZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBjb2RlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgc2hvcnRfbmFtZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBpY29uX3VybDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBjb3Zlcl9pbWFnZV91cmw6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgc29ydF9vcmRlcjogei5udW1iZXIoKS5vcHRpb25hbCgpLFxuICAgICAgICBpc19wdWJsaXNoZWQ6IHouYm9vbGVhbigpLm9wdGlvbmFsKCksXG4gICAgICAgIG1ldGFkYXRhOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBzY2hlbWEucGFyc2UoYm9keSk7XG4gICAgICBjb25zdCBzdWJqZWN0ID0gYXdhaXQgdGhpcy5zdWJqZWN0U2VydmljZS51cGRhdGVTdWJqZWN0KHN1YmplY3RJZCwgdmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHN1YmplY3QsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gdXBkYXRlIHN1YmplY3QnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOWtpuenkVxuICAgKi9cbiAgYXN5bmMgZGVsZXRlU3ViamVjdChyZXE6IE5leHRSZXF1ZXN0LCBzdWJqZWN0SWQ6IHN0cmluZyk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc3ViamVjdFNlcnZpY2UuZGVsZXRlU3ViamVjdChzdWJqZWN0SWQpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ1N1YmplY3QgZGVsZXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGRlbGV0ZSBzdWJqZWN0JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blrabnp5Hor6bmg4Xkv6Hmga9cbiAgICovXG4gIGFzeW5jIGdldFN1YmplY3REZXRhaWwocmVxOiBOZXh0UmVxdWVzdCwgc3ViamVjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkZXRhaWwgPSBhd2FpdCB0aGlzLnN1YmplY3RTZXJ2aWNlLmdldFN1YmplY3REZXRhaWwoc3ViamVjdElkKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGRldGFpbCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgc3ViamVjdCBkZXRhaWwnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuaIluabtOaWsOWtpuenkeivpuaDhVxuICAgKi9cbiAgYXN5bmMgdXBzZXJ0U3ViamVjdERldGFpbChyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIHN1YmplY3RfaWQ6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgICBkZWZpbml0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHB1cnBvc2U6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgdmFsdWU6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgYXBwbGljYXRpb25fc2NlbmFyaW9zOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGxlYXJuaW5nX29iamVjdGl2ZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgcHJlcmVxdWlzaXRlczogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICByZWxhdGVkX3N1YmplY3RzOiB6LmFycmF5KHouc3RyaW5nKCkpLm9wdGlvbmFsKCksXG4gICAgICAgIG1ldGFkYXRhOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBzY2hlbWEucGFyc2UoYm9keSk7XG4gICAgICBjb25zdCBkZXRhaWwgPSBhd2FpdCB0aGlzLnN1YmplY3RTZXJ2aWNlLnVwc2VydFN1YmplY3REZXRhaWwodmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGRldGFpbCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cHNlcnQgc3ViamVjdCBkZXRhaWwnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ6IiwiaW5qZWN0YWJsZSIsImluamVjdCIsIlN1YmplY3RTZXJ2aWNlIiwiU3ViamVjdENvbnRyb2xsZXIiLCJjb25zdHJ1Y3RvciIsInN1YmplY3RTZXJ2aWNlIiwiZ2V0Q2F0ZWdvcnlUcmVlIiwicmVxIiwidHJlZSIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImdldENhdGVnb3JpZXMiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJwYXJlbnRJZCIsImdldCIsImN1cnJlbnQiLCJwYXJzZUludCIsInBhZ2VTaXplIiwia2V5d29yZCIsInVuZGVmaW5lZCIsInJlc3VsdCIsImdldENhdGVnb3JpZXNCeVBhcmVudElkIiwiY2F0ZWdvcmllcyIsInBhZ2luYXRpb24iLCJsZW5ndGgiLCJ0b3RhbCIsImdldENhdGVnb3J5Q2hpbGRyZW4iLCJjaGlsZHJlbiIsImdldENhdGVnb3J5QnlJZCIsImNhdGVnb3J5SWQiLCJjYXRlZ29yeSIsImNyZWF0ZUNhdGVnb3J5IiwiYm9keSIsInNjaGVtYSIsIm9iamVjdCIsInBhcmVudF9pZCIsInN0cmluZyIsIm51bGxhYmxlIiwib3B0aW9uYWwiLCJjb2RlIiwibWluIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiaWNvbl91cmwiLCJzb3J0X29yZGVyIiwibnVtYmVyIiwibWV0YWRhdGEiLCJyZWNvcmQiLCJhbnkiLCJ2YWxpZGF0ZWREYXRhIiwicGFyc2UiLCJab2RFcnJvciIsImVycm9ycyIsInVwZGF0ZUNhdGVnb3J5IiwiZGVsZXRlQ2F0ZWdvcnkiLCJnZXRTdWJqZWN0cyIsImdldFN1YmplY3RzQnlDYXRlZ29yeUlkIiwic3ViamVjdHMiLCJnZXRTdWJqZWN0QnlJZCIsInN1YmplY3RJZCIsInN1YmplY3QiLCJjcmVhdGVTdWJqZWN0IiwiY2F0ZWdvcnlfaWQiLCJzaG9ydF9uYW1lIiwiY292ZXJfaW1hZ2VfdXJsIiwiaXNfcHVibGlzaGVkIiwiYm9vbGVhbiIsInVwZGF0ZVN1YmplY3QiLCJkZWxldGVTdWJqZWN0IiwiZ2V0U3ViamVjdERldGFpbCIsImRldGFpbCIsInVwc2VydFN1YmplY3REZXRhaWwiLCJzdWJqZWN0X2lkIiwiZGVmaW5pdGlvbiIsInB1cnBvc2UiLCJ2YWx1ZSIsImFwcGxpY2F0aW9uX3NjZW5hcmlvcyIsImxlYXJuaW5nX29iamVjdGl2ZXMiLCJwcmVyZXF1aXNpdGVzIiwicmVsYXRlZF9zdWJqZWN0cyIsImFycmF5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/api/subject/subject.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/workspace/workspace.controller.ts":
/*!***************************************************!*\
  !*** ./src/api/workspace/workspace.controller.ts ***!
  \***************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WorkspaceController: () => (/* binding */ WorkspaceController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\nclass WorkspaceController {\n    constructor(workspaceDAO, authService){\n        this.workspaceDAO = workspaceDAO;\n        this.authService = authService;\n    }\n    /**\n   * 获取当前用户（从 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.authService.verifyToken(token);\n    }\n    /**\n   * 获取用户的默认工作空间\n   */ async getDefaultWorkspace(req) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const workspace = await this.workspaceDAO.getOrCreateDefault(user.uid);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    workspace_id: workspace.workspace_id,\n                    name: workspace.name,\n                    owner_uid: workspace.owner_uid,\n                    icon: workspace.icon,\n                    metadata: workspace.metadata,\n                    created_at: workspace.created_at instanceof Date ? workspace.created_at.toISOString() : workspace.created_at,\n                    updated_at: workspace.updated_at instanceof Date ? workspace.updated_at.toISOString() : workspace.updated_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get default workspace\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取用户的所有工作空间\n   */ async getWorkspaces(req) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const workspaces = await this.workspaceDAO.findByOwnerUid(user.uid);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: workspaces.map((w)=>({\n                        workspace_id: w.workspace_id,\n                        name: w.name,\n                        owner_uid: w.owner_uid,\n                        icon: w.icon,\n                        metadata: w.metadata,\n                        created_at: w.created_at instanceof Date ? w.created_at.toISOString() : w.created_at,\n                        updated_at: w.updated_at instanceof Date ? w.updated_at.toISOString() : w.updated_at\n                    }))\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get workspaces\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n}\nWorkspaceController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(\"WorkspaceDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__.WorkspaceDAO === \"undefined\" ? Object : _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__.WorkspaceDAO,\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService\n    ])\n], WorkspaceController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL3dvcmtzcGFjZS93b3Jrc3BhY2UuY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDVjtBQUNLO0FBQ0c7QUFNL0MsTUFBTUs7SUFDWEMsWUFDRSxZQUEwRCxFQUMxRCxXQUFxRCxDQUNyRDthQUZnQ0MsZUFBQUE7YUFDSEMsY0FBQUE7SUFDNUI7SUFFSDs7R0FFQyxHQUNELE1BQWNDLGVBQWVDLEdBQWdCLEVBQTBDO1FBQ3JGLE1BQU1DLGFBQWFELElBQUlFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO1FBQ25DLElBQUksQ0FBQ0YsY0FBYyxDQUFDQSxXQUFXRyxVQUFVLENBQUMsWUFBWTtZQUNwRCxNQUFNLElBQUlDLE1BQU07UUFDbEI7UUFFQSxNQUFNQyxRQUFRTCxXQUFXTSxTQUFTLENBQUM7UUFDbkMsT0FBTyxNQUFNLElBQUksQ0FBQ1QsV0FBVyxDQUFDVSxXQUFXLENBQUNGO0lBQzVDO0lBRUE7O0dBRUMsR0FDRCxNQUFNRyxvQkFBb0JULEdBQWdCLEVBQXlCO1FBQ2pFLElBQUk7WUFDRixNQUFNVSxPQUFPLE1BQU0sSUFBSSxDQUFDWCxjQUFjLENBQUNDO1lBQ3ZDLE1BQU1XLFlBQVksTUFBTSxJQUFJLENBQUNkLFlBQVksQ0FBQ2Usa0JBQWtCLENBQUNGLEtBQUtHLEdBQUc7WUFFckUsT0FBT3ZCLHFEQUFZQSxDQUFDd0IsSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztnQkFDVEMsTUFBTTtvQkFDSkMsY0FBY04sVUFBVU0sWUFBWTtvQkFDcENDLE1BQU1QLFVBQVVPLElBQUk7b0JBQ3BCQyxXQUFXUixVQUFVUSxTQUFTO29CQUM5QkMsTUFBTVQsVUFBVVMsSUFBSTtvQkFDcEJDLFVBQVVWLFVBQVVVLFFBQVE7b0JBQzVCQyxZQUFZWCxVQUFVVyxVQUFVLFlBQVlDLE9BQU9aLFVBQVVXLFVBQVUsQ0FBQ0UsV0FBVyxLQUFLYixVQUFVVyxVQUFVO29CQUM1R0csWUFBWWQsVUFBVWMsVUFBVSxZQUFZRixPQUFPWixVQUFVYyxVQUFVLENBQUNELFdBQVcsS0FBS2IsVUFBVWMsVUFBVTtnQkFDOUc7WUFDRjtRQUNGLEVBQUUsT0FBT0MsT0FBWTtZQUNuQixPQUFPcEMscURBQVlBLENBQUN3QixJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNUWSxTQUFTRCxNQUFNQyxPQUFPLElBQUk7WUFDNUIsR0FDQTtnQkFBRUMsUUFBUUYsTUFBTUMsT0FBTyxLQUFLLGlCQUFpQixNQUFNO1lBQUk7UUFFM0Q7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTUUsY0FBYzdCLEdBQWdCLEVBQXlCO1FBQzNELElBQUk7WUFDRixNQUFNVSxPQUFPLE1BQU0sSUFBSSxDQUFDWCxjQUFjLENBQUNDO1lBQ3ZDLE1BQU04QixhQUFhLE1BQU0sSUFBSSxDQUFDakMsWUFBWSxDQUFDa0MsY0FBYyxDQUFDckIsS0FBS0csR0FBRztZQUVsRSxPQUFPdkIscURBQVlBLENBQUN3QixJQUFJLENBQUM7Z0JBQ3ZCQyxTQUFTO2dCQUNUQyxNQUFNYyxXQUFXRSxHQUFHLENBQUMsQ0FBQ0MsSUFBTzt3QkFDM0JoQixjQUFjZ0IsRUFBRWhCLFlBQVk7d0JBQzVCQyxNQUFNZSxFQUFFZixJQUFJO3dCQUNaQyxXQUFXYyxFQUFFZCxTQUFTO3dCQUN0QkMsTUFBTWEsRUFBRWIsSUFBSTt3QkFDWkMsVUFBVVksRUFBRVosUUFBUTt3QkFDcEJDLFlBQVlXLEVBQUVYLFVBQVUsWUFBWUMsT0FBT1UsRUFBRVgsVUFBVSxDQUFDRSxXQUFXLEtBQUtTLEVBQUVYLFVBQVU7d0JBQ3BGRyxZQUFZUSxFQUFFUixVQUFVLFlBQVlGLE9BQU9VLEVBQUVSLFVBQVUsQ0FBQ0QsV0FBVyxLQUFLUyxFQUFFUixVQUFVO29CQUN0RjtZQUNGO1FBQ0YsRUFBRSxPQUFPQyxPQUFZO1lBQ25CLE9BQU9wQyxxREFBWUEsQ0FBQ3dCLElBQUksQ0FDdEI7Z0JBQ0VDLFNBQVM7Z0JBQ1RZLFNBQVNELE1BQU1DLE9BQU8sSUFBSTtZQUM1QixHQUNBO2dCQUFFQyxRQUFRRixNQUFNQyxPQUFPLEtBQUssaUJBQWlCLE1BQU07WUFBSTtRQUUzRDtJQUNGO0FBQ0Y7QUFoRmFoQyxzQkFBQUEsb0VBQUFBO0lBRFpKLG9EQUFVQTtJQUdOQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7SUFDUEEsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDRSwrREFBV0E7OztlQUQyQiw0REFBWSw0QkFBWiw0REFBWTtlQUNoQiwrREFBVyw0QkFBWCwrREFBVzs7R0FINUNDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2FwaS93b3Jrc3BhY2Uvd29ya3NwYWNlLmNvbnRyb2xsZXIudHM/MDU0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgV29ya3NwYWNlREFPIH0gZnJvbSAnQC9kYW8vd29ya3NwYWNlLmRhbyc7XG5pbXBvcnQgeyBBdXRoU2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvYXV0aC5zZXJ2aWNlJztcblxuLyoqXG4gKiDlt6XkvZznqbrpl7TmjqfliLblmahcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFdvcmtzcGFjZUNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdXb3Jrc3BhY2VEQU8nKSBwcml2YXRlIHdvcmtzcGFjZURBTzogV29ya3NwYWNlREFPLFxuICAgIEBpbmplY3QoQXV0aFNlcnZpY2UpIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlXG4gICkge31cblxuICAvKipcbiAgICog6I635Y+W5b2T5YmN55So5oi377yI5LuOIHRva2Vu77yJXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEN1cnJlbnRVc2VyKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPHsgdWlkOiBudW1iZXI7IHV1aWQ6IHN0cmluZyB9PiB7XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpO1xuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnN1YnN0cmluZyg3KTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5hdXRoU2VydmljZS52ZXJpZnlUb2tlbih0b2tlbik7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE6buY6K6k5bel5L2c56m66Ze0XG4gICAqL1xuICBhc3luYyBnZXREZWZhdWx0V29ya3NwYWNlKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuICAgICAgY29uc3Qgd29ya3NwYWNlID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uZ2V0T3JDcmVhdGVEZWZhdWx0KHVzZXIudWlkKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHdvcmtzcGFjZV9pZDogd29ya3NwYWNlLndvcmtzcGFjZV9pZCxcbiAgICAgICAgICBuYW1lOiB3b3Jrc3BhY2UubmFtZSxcbiAgICAgICAgICBvd25lcl91aWQ6IHdvcmtzcGFjZS5vd25lcl91aWQsXG4gICAgICAgICAgaWNvbjogd29ya3NwYWNlLmljb24sXG4gICAgICAgICAgbWV0YWRhdGE6IHdvcmtzcGFjZS5tZXRhZGF0YSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiB3b3Jrc3BhY2UuY3JlYXRlZF9hdCBpbnN0YW5jZW9mIERhdGUgPyB3b3Jrc3BhY2UuY3JlYXRlZF9hdC50b0lTT1N0cmluZygpIDogd29ya3NwYWNlLmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogd29ya3NwYWNlLnVwZGF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gd29ya3NwYWNlLnVwZGF0ZWRfYXQudG9JU09TdHJpbmcoKSA6IHdvcmtzcGFjZS51cGRhdGVkX2F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkZWZhdWx0IHdvcmtzcGFjZScsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfnmoTmiYDmnInlt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGdldFdvcmtzcGFjZXMocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG4gICAgICBjb25zdCB3b3Jrc3BhY2VzID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uZmluZEJ5T3duZXJVaWQodXNlci51aWQpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB3b3Jrc3BhY2VzLm1hcCgodykgPT4gKHtcbiAgICAgICAgICB3b3Jrc3BhY2VfaWQ6IHcud29ya3NwYWNlX2lkLFxuICAgICAgICAgIG5hbWU6IHcubmFtZSxcbiAgICAgICAgICBvd25lcl91aWQ6IHcub3duZXJfdWlkLFxuICAgICAgICAgIGljb246IHcuaWNvbixcbiAgICAgICAgICBtZXRhZGF0YTogdy5tZXRhZGF0YSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiB3LmNyZWF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gdy5jcmVhdGVkX2F0LnRvSVNPU3RyaW5nKCkgOiB3LmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogdy51cGRhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZSA/IHcudXBkYXRlZF9hdC50b0lTT1N0cmluZygpIDogdy51cGRhdGVkX2F0LFxuICAgICAgICB9KSksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IHdvcmtzcGFjZXMnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImluamVjdGFibGUiLCJpbmplY3QiLCJXb3Jrc3BhY2VEQU8iLCJBdXRoU2VydmljZSIsIldvcmtzcGFjZUNvbnRyb2xsZXIiLCJjb25zdHJ1Y3RvciIsIndvcmtzcGFjZURBTyIsImF1dGhTZXJ2aWNlIiwiZ2V0Q3VycmVudFVzZXIiLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInN0YXJ0c1dpdGgiLCJFcnJvciIsInRva2VuIiwic3Vic3RyaW5nIiwidmVyaWZ5VG9rZW4iLCJnZXREZWZhdWx0V29ya3NwYWNlIiwidXNlciIsIndvcmtzcGFjZSIsImdldE9yQ3JlYXRlRGVmYXVsdCIsInVpZCIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsIndvcmtzcGFjZV9pZCIsIm5hbWUiLCJvd25lcl91aWQiLCJpY29uIiwibWV0YWRhdGEiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidXBkYXRlZF9hdCIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImdldFdvcmtzcGFjZXMiLCJ3b3Jrc3BhY2VzIiwiZmluZEJ5T3duZXJVaWQiLCJtYXAiLCJ3Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/api/workspace/workspace.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/ability/dimensions/route.ts":
/*!*************************************************!*\
  !*** ./src/app/api/ability/dimensions/route.ts ***!
  \*************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var _core_init__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/init */ \"(rsc)/./src/core/init.ts\");\n/* harmony import */ var _core_container__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/core/container */ \"(rsc)/./src/core/container.ts\");\n/* harmony import */ var _api_ability_ability_model_controller__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/api/ability/ability-model.controller */ \"(rsc)/./src/api/ability/ability-model.controller.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_init__WEBPACK_IMPORTED_MODULE_0__, _api_ability_ability_model_controller__WEBPACK_IMPORTED_MODULE_2__]);\n([_core_init__WEBPACK_IMPORTED_MODULE_0__, _api_ability_ability_model_controller__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n/**\n * GET /api/ability/dimensions - 获取能力维度列表（用户端）\n */ async function GET(req) {\n    const controller = _core_container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_api_ability_ability_model_controller__WEBPACK_IMPORTED_MODULE_2__.AbilityModelController);\n    return controller.getDimensions(req);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hYmlsaXR5L2RpbWVuc2lvbnMvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUNxQjtBQUN3QjtBQUNtQztBQUVoRjs7Q0FFQyxHQUNNLGVBQWVFLElBQUlDLEdBQWdCO0lBQ3hDLE1BQU1DLGFBQWFKLHNEQUFTQSxDQUFDSyxPQUFPLENBQXlCSix5RkFBc0JBO0lBQ25GLE9BQU9HLFdBQVdFLGFBQWEsQ0FBQ0g7QUFDbEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBwL2FwaS9hYmlsaXR5L2RpbWVuc2lvbnMvcm91dGUudHM/MWY3MyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCAnQC9jb3JlL2luaXQnO1xuaW1wb3J0IHsgQ29udGFpbmVyIH0gZnJvbSAnQC9jb3JlL2NvbnRhaW5lcic7XG5pbXBvcnQgeyBBYmlsaXR5TW9kZWxDb250cm9sbGVyIH0gZnJvbSAnQC9hcGkvYWJpbGl0eS9hYmlsaXR5LW1vZGVsLmNvbnRyb2xsZXInO1xuXG4vKipcbiAqIEdFVCAvYXBpL2FiaWxpdHkvZGltZW5zaW9ucyAtIOiOt+WPluiDveWKm+e7tOW6puWIl+ihqO+8iOeUqOaIt+err++8iVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgY29udHJvbGxlciA9IENvbnRhaW5lci5yZXNvbHZlPEFiaWxpdHlNb2RlbENvbnRyb2xsZXI+KEFiaWxpdHlNb2RlbENvbnRyb2xsZXIpO1xuICByZXR1cm4gY29udHJvbGxlci5nZXREaW1lbnNpb25zKHJlcSk7XG59XG5cbiJdLCJuYW1lcyI6WyJDb250YWluZXIiLCJBYmlsaXR5TW9kZWxDb250cm9sbGVyIiwiR0VUIiwicmVxIiwiY29udHJvbGxlciIsInJlc29sdmUiLCJnZXREaW1lbnNpb25zIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/ability/dimensions/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/container.ts":
/*!*******************************!*\
  !*** ./src/core/container.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Container: () => (/* binding */ Container)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n\n\n/**\n * 依赖注入容器单例\n */ class Container {\n    static getInstance() {\n        if (!Container.instance) {\n            Container.instance = tsyringe__WEBPACK_IMPORTED_MODULE_1__.container;\n        }\n        return Container.instance;\n    }\n    /**\n   * 注册服务\n   */ static register(token, factory) {\n        tsyringe__WEBPACK_IMPORTED_MODULE_1__.container.register(token, {\n            useFactory: factory\n        });\n    }\n    /**\n   * 解析服务\n   */ static resolve(token) {\n        return tsyringe__WEBPACK_IMPORTED_MODULE_1__.container.resolve(token);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9jb250YWluZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUEwQjtBQUNnQztBQUUxRDs7Q0FFQyxHQUNNLE1BQU1DO0lBR1gsT0FBY0MsY0FBbUM7UUFDL0MsSUFBSSxDQUFDRCxVQUFVRSxRQUFRLEVBQUU7WUFDdkJGLFVBQVVFLFFBQVEsR0FBR0gsK0NBQVNBO1FBQ2hDO1FBQ0EsT0FBT0MsVUFBVUUsUUFBUTtJQUMzQjtJQUVBOztHQUVDLEdBQ0QsT0FBY0MsU0FDWkMsS0FBaUMsRUFDakNDLE9BQWdCLEVBQ1Y7UUFDTk4sK0NBQVNBLENBQUNJLFFBQVEsQ0FBQ0MsT0FBTztZQUFFRSxZQUFZRDtRQUFRO0lBQ2xEO0lBRUE7O0dBRUMsR0FDRCxPQUFjRSxRQUFXSCxLQUFpQyxFQUFLO1FBQzdELE9BQU9MLCtDQUFTQSxDQUFDUSxPQUFPLENBQUlIO0lBQzlCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9jb250YWluZXIudHM/YjZhNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuaW1wb3J0IHsgY29udGFpbmVyLCBEZXBlbmRlbmN5Q29udGFpbmVyIH0gZnJvbSAndHN5cmluZ2UnO1xuXG4vKipcbiAqIOS+nei1luazqOWFpeWuueWZqOWNleS+i1xuICovXG5leHBvcnQgY2xhc3MgQ29udGFpbmVyIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IERlcGVuZGVuY3lDb250YWluZXI7XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBEZXBlbmRlbmN5Q29udGFpbmVyIHtcbiAgICBpZiAoIUNvbnRhaW5lci5pbnN0YW5jZSkge1xuICAgICAgQ29udGFpbmVyLmluc3RhbmNlID0gY29udGFpbmVyO1xuICAgIH1cbiAgICByZXR1cm4gQ29udGFpbmVyLmluc3RhbmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIOazqOWGjOacjeWKoVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyByZWdpc3RlcjxUPihcbiAgICB0b2tlbjogc3RyaW5nIHwgc3ltYm9sIHwgRnVuY3Rpb24sXG4gICAgZmFjdG9yeTogKCkgPT4gVFxuICApOiB2b2lkIHtcbiAgICBjb250YWluZXIucmVnaXN0ZXIodG9rZW4sIHsgdXNlRmFjdG9yeTogZmFjdG9yeSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDop6PmnpDmnI3liqFcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcmVzb2x2ZTxUPih0b2tlbjogc3RyaW5nIHwgc3ltYm9sIHwgRnVuY3Rpb24pOiBUIHtcbiAgICByZXR1cm4gY29udGFpbmVyLnJlc29sdmU8VD4odG9rZW4pO1xuICB9XG59XG5cblxuXG5cbiJdLCJuYW1lcyI6WyJjb250YWluZXIiLCJDb250YWluZXIiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwicmVnaXN0ZXIiLCJ0b2tlbiIsImZhY3RvcnkiLCJ1c2VGYWN0b3J5IiwicmVzb2x2ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/container.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/database.ts":
/*!******************************!*\
  !*** ./src/core/database.ts ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Database: () => (/* binding */ Database)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pg */ \"pg\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_1__]);\npg__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nclass Database {\n    constructor(){\n        const connectionString = \"postgresql://pikun@localhost:5432/postgres\";\n        console.log(\"connectionString\", connectionString);\n        if (!connectionString) {\n            throw new Error(\"DATABASE_URL environment variable is not set. \" + \"Please create a .env file in apps/server/ directory with DATABASE_URL=postgresql://pikun@localhost:5432/postgres\");\n        }\n        const config = {\n            connectionString,\n            min: parseInt(process.env.DATABASE_POOL_MIN || \"2\", 10),\n            max: parseInt(process.env.DATABASE_POOL_MAX || \"10\", 10),\n            idleTimeoutMillis: 30000,\n            connectionTimeoutMillis: 2000\n        };\n        this.pool = new pg__WEBPACK_IMPORTED_MODULE_1__.Pool(config);\n        // 处理连接错误\n        this.pool.on(\"error\", (err)=>{\n            console.error(\"Unexpected error on idle client\", err);\n        });\n    }\n    static getInstance() {\n        if (!Database.instance) {\n            Database.instance = new Database();\n        }\n        return Database.instance;\n    }\n    getPool() {\n        return this.pool;\n    }\n    /**\n   * 执行查询（使用参数化查询防止 SQL 注入）\n   */ async query(text, params) {\n        const start = Date.now();\n        try {\n            // 设置默认 schema\n            await this.pool.query(\"SET search_path TO pikun_db, public\");\n            const result = await this.pool.query(text, params);\n            const duration = Date.now() - start;\n            console.log(\"Executed query\", {\n                text,\n                duration,\n                rows: result.rowCount\n            });\n            return {\n                rows: result.rows,\n                rowCount: result.rowCount || 0\n            };\n        } catch (error) {\n            console.error(\"Database query error\", {\n                text,\n                error\n            });\n            throw error;\n        }\n    }\n    /**\n   * 执行事务\n   */ async transaction(callback) {\n        const client = await this.pool.connect();\n        try {\n            await client.query(\"SET search_path TO pikun_db, public\");\n            await client.query(\"BEGIN\");\n            const result = await callback(client);\n            await client.query(\"COMMIT\");\n            return result;\n        } catch (error) {\n            await client.query(\"ROLLBACK\");\n            throw error;\n        } finally{\n            client.release();\n        }\n    }\n    /**\n   * 关闭连接池\n   */ async close() {\n        await this.pool.end();\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9kYXRhYmFzZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQTBCO0FBQ1k7QUFFL0IsTUFBTUM7SUFJWCxhQUFzQjtRQUNwQixNQUFNQyxtQkFBbUJDLDRDQUF3QjtRQUNqREcsUUFBUUMsR0FBRyxDQUFDLG9CQUFvQkw7UUFFaEMsSUFBSSxDQUFDQSxrQkFBa0I7WUFDckIsTUFBTSxJQUFJTSxNQUNSLG1EQUNFO1FBRU47UUFFQSxNQUFNQyxTQUFxQjtZQUN6QlA7WUFDQVEsS0FBS0MsU0FBU1IsUUFBUUMsR0FBRyxDQUFDUSxpQkFBaUIsSUFBSSxLQUFLO1lBQ3BEQyxLQUFLRixTQUFTUixRQUFRQyxHQUFHLENBQUNVLGlCQUFpQixJQUFJLE1BQU07WUFDckRDLG1CQUFtQjtZQUNuQkMseUJBQXlCO1FBQzNCO1FBRUEsSUFBSSxDQUFDQyxJQUFJLEdBQUcsSUFBSWpCLG9DQUFJQSxDQUFDUztRQUVyQixTQUFTO1FBQ1QsSUFBSSxDQUFDUSxJQUFJLENBQUNDLEVBQUUsQ0FBQyxTQUFTLENBQUNDO1lBQ3JCYixRQUFRYyxLQUFLLENBQUMsbUNBQW1DRDtRQUNuRDtJQUNGO0lBRUEsT0FBY0UsY0FBd0I7UUFDcEMsSUFBSSxDQUFDcEIsU0FBU3FCLFFBQVEsRUFBRTtZQUN0QnJCLFNBQVNxQixRQUFRLEdBQUcsSUFBSXJCO1FBQzFCO1FBQ0EsT0FBT0EsU0FBU3FCLFFBQVE7SUFDMUI7SUFFT0MsVUFBZ0I7UUFDckIsT0FBTyxJQUFJLENBQUNOLElBQUk7SUFDbEI7SUFFQTs7R0FFQyxHQUNELE1BQWFPLE1BQ1hDLElBQVksRUFDWkMsTUFBYyxFQUM0QjtRQUMxQyxNQUFNQyxRQUFRQyxLQUFLQyxHQUFHO1FBQ3RCLElBQUk7WUFDRixjQUFjO1lBQ2QsTUFBTSxJQUFJLENBQUNaLElBQUksQ0FBQ08sS0FBSyxDQUFDO1lBQ3RCLE1BQU1NLFNBQVMsTUFBTSxJQUFJLENBQUNiLElBQUksQ0FBQ08sS0FBSyxDQUFDQyxNQUFNQztZQUMzQyxNQUFNSyxXQUFXSCxLQUFLQyxHQUFHLEtBQUtGO1lBQzlCckIsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQjtnQkFBRWtCO2dCQUFNTTtnQkFBVUMsTUFBTUYsT0FBT0csUUFBUTtZQUFDO1lBQ3RFLE9BQU87Z0JBQ0xELE1BQU1GLE9BQU9FLElBQUk7Z0JBQ2pCQyxVQUFVSCxPQUFPRyxRQUFRLElBQUk7WUFDL0I7UUFDRixFQUFFLE9BQU9iLE9BQU87WUFDZGQsUUFBUWMsS0FBSyxDQUFDLHdCQUF3QjtnQkFBRUs7Z0JBQU1MO1lBQU07WUFDcEQsTUFBTUE7UUFDUjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFhYyxZQUFlQyxRQUFxQyxFQUFjO1FBQzdFLE1BQU1DLFNBQVMsTUFBTSxJQUFJLENBQUNuQixJQUFJLENBQUNvQixPQUFPO1FBQ3RDLElBQUk7WUFDRixNQUFNRCxPQUFPWixLQUFLLENBQUM7WUFDbkIsTUFBTVksT0FBT1osS0FBSyxDQUFDO1lBQ25CLE1BQU1NLFNBQVMsTUFBTUssU0FBU0M7WUFDOUIsTUFBTUEsT0FBT1osS0FBSyxDQUFDO1lBQ25CLE9BQU9NO1FBQ1QsRUFBRSxPQUFPVixPQUFPO1lBQ2QsTUFBTWdCLE9BQU9aLEtBQUssQ0FBQztZQUNuQixNQUFNSjtRQUNSLFNBQVU7WUFDUmdCLE9BQU9FLE9BQU87UUFDaEI7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBYUMsUUFBdUI7UUFDbEMsTUFBTSxJQUFJLENBQUN0QixJQUFJLENBQUN1QixHQUFHO0lBQ3JCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9kYXRhYmFzZS50cz85ZTE2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5pbXBvcnQgeyBQb29sLCBQb29sQ29uZmlnIH0gZnJvbSAncGcnO1xuXG5leHBvcnQgY2xhc3MgRGF0YWJhc2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogRGF0YWJhc2U7XG4gIHByaXZhdGUgcG9vbDogUG9vbDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IGNvbm5lY3Rpb25TdHJpbmcgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkw7XG4gICAgY29uc29sZS5sb2coJ2Nvbm5lY3Rpb25TdHJpbmcnLCBjb25uZWN0aW9uU3RyaW5nKTtcblxuICAgIGlmICghY29ubmVjdGlvblN0cmluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnREFUQUJBU0VfVVJMIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIG5vdCBzZXQuICcgK1xuICAgICAgICAgICdQbGVhc2UgY3JlYXRlIGEgLmVudiBmaWxlIGluIGFwcHMvc2VydmVyLyBkaXJlY3Rvcnkgd2l0aCBEQVRBQkFTRV9VUkw9cG9zdGdyZXNxbDovL3Bpa3VuQGxvY2FsaG9zdDo1NDMyL3Bvc3RncmVzJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb25maWc6IFBvb2xDb25maWcgPSB7XG4gICAgICBjb25uZWN0aW9uU3RyaW5nLFxuICAgICAgbWluOiBwYXJzZUludChwcm9jZXNzLmVudi5EQVRBQkFTRV9QT09MX01JTiB8fCAnMicsIDEwKSxcbiAgICAgIG1heDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuREFUQUJBU0VfUE9PTF9NQVggfHwgJzEwJywgMTApLFxuICAgICAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxuICAgICAgY29ubmVjdGlvblRpbWVvdXRNaWxsaXM6IDIwMDAsXG4gICAgfTtcblxuICAgIHRoaXMucG9vbCA9IG5ldyBQb29sKGNvbmZpZyk7XG5cbiAgICAvLyDlpITnkIbov57mjqXplJnor69cbiAgICB0aGlzLnBvb2wub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignVW5leHBlY3RlZCBlcnJvciBvbiBpZGxlIGNsaWVudCcsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IERhdGFiYXNlIHtcbiAgICBpZiAoIURhdGFiYXNlLmluc3RhbmNlKSB7XG4gICAgICBEYXRhYmFzZS5pbnN0YW5jZSA9IG5ldyBEYXRhYmFzZSgpO1xuICAgIH1cbiAgICByZXR1cm4gRGF0YWJhc2UuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgZ2V0UG9vbCgpOiBQb29sIHtcbiAgICByZXR1cm4gdGhpcy5wb29sO1xuICB9XG5cbiAgLyoqXG4gICAqIOaJp+ihjOafpeivou+8iOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWl77yJXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgcXVlcnk8VCA9IGFueT4oXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIHBhcmFtcz86IGFueVtdXG4gICk6IFByb21pc2U8eyByb3dzOiBUW107IHJvd0NvdW50OiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICB0cnkge1xuICAgICAgLy8g6K6+572u6buY6K6kIHNjaGVtYVxuICAgICAgYXdhaXQgdGhpcy5wb29sLnF1ZXJ5KCdTRVQgc2VhcmNoX3BhdGggVE8gcGlrdW5fZGIsIHB1YmxpYycpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wb29sLnF1ZXJ5KHRleHQsIHBhcmFtcyk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydDtcbiAgICAgIGNvbnNvbGUubG9nKCdFeGVjdXRlZCBxdWVyeScsIHsgdGV4dCwgZHVyYXRpb24sIHJvd3M6IHJlc3VsdC5yb3dDb3VudCB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJvd3M6IHJlc3VsdC5yb3dzIGFzIFRbXSxcbiAgICAgICAgcm93Q291bnQ6IHJlc3VsdC5yb3dDb3VudCB8fCAwLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgcXVlcnkgZXJyb3InLCB7IHRleHQsIGVycm9yIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOaJp+ihjOS6i+WKoVxuICAgKi9cbiAgcHVibGljIGFzeW5jIHRyYW5zYWN0aW9uPFQ+KGNhbGxiYWNrOiAoY2xpZW50OiBhbnkpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+IHtcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCB0aGlzLnBvb2wuY29ubmVjdCgpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoJ1NFVCBzZWFyY2hfcGF0aCBUTyBwaWt1bl9kYiwgcHVibGljJyk7XG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0JFR0lOJyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxsYmFjayhjbGllbnQpO1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdDT01NSVQnKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnUk9MTEJBQ0snKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBjbGllbnQucmVsZWFzZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlhbPpl63ov57mjqXmsaBcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnBvb2wuZW5kKCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJQb29sIiwiRGF0YWJhc2UiLCJjb25uZWN0aW9uU3RyaW5nIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsImNvbnNvbGUiLCJsb2ciLCJFcnJvciIsImNvbmZpZyIsIm1pbiIsInBhcnNlSW50IiwiREFUQUJBU0VfUE9PTF9NSU4iLCJtYXgiLCJEQVRBQkFTRV9QT09MX01BWCIsImlkbGVUaW1lb3V0TWlsbGlzIiwiY29ubmVjdGlvblRpbWVvdXRNaWxsaXMiLCJwb29sIiwib24iLCJlcnIiLCJlcnJvciIsImdldEluc3RhbmNlIiwiaW5zdGFuY2UiLCJnZXRQb29sIiwicXVlcnkiLCJ0ZXh0IiwicGFyYW1zIiwic3RhcnQiLCJEYXRlIiwibm93IiwicmVzdWx0IiwiZHVyYXRpb24iLCJyb3dzIiwicm93Q291bnQiLCJ0cmFuc2FjdGlvbiIsImNhbGxiYWNrIiwiY2xpZW50IiwiY29ubmVjdCIsInJlbGVhc2UiLCJjbG9zZSIsImVuZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/database.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/init.ts":
/*!**************************!*\
  !*** ./src/core/init.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initializeContainer: () => (/* binding */ initializeContainer)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _container__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./container */ \"(rsc)/./src/core/container.ts\");\n/* harmony import */ var _dao_user_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/user.dao */ \"(rsc)/./src/dao/user.dao.ts\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/dao/document-change.dao */ \"(rsc)/./src/dao/document-change.dao.ts\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _dao_ability_category_dao__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/dao/ability-category.dao */ \"(rsc)/./src/dao/ability-category.dao.ts\");\n/* harmony import */ var _dao_ability_dimension_dao__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/dao/ability-dimension.dao */ \"(rsc)/./src/dao/ability-dimension.dao.ts\");\n/* harmony import */ var _dao_ability_item_dao__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @/dao/ability-item.dao */ \"(rsc)/./src/dao/ability-item.dao.ts\");\n/* harmony import */ var _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @/dao/ability-item-level-config.dao */ \"(rsc)/./src/dao/ability-item-level-config.dao.ts\");\n/* harmony import */ var _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @/dao/user-ability-level.dao */ \"(rsc)/./src/dao/user-ability-level.dao.ts\");\n/* harmony import */ var _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @/dao/user-ability-experience-log.dao */ \"(rsc)/./src/dao/user-ability-experience-log.dao.ts\");\n/* harmony import */ var _dao_subject_category_dao__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @/dao/subject-category.dao */ \"(rsc)/./src/dao/subject-category.dao.ts\");\n/* harmony import */ var _dao_subject_dao__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @/dao/subject.dao */ \"(rsc)/./src/dao/subject.dao.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\n/* harmony import */ var _services_document_service__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @/services/document.service */ \"(rsc)/./src/services/document.service.ts\");\n/* harmony import */ var _services_snapshot_service__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @/services/snapshot.service */ \"(rsc)/./src/services/snapshot.service.ts\");\n/* harmony import */ var _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @/services/snapshot-scheduler.service */ \"(rsc)/./src/services/snapshot-scheduler.service.ts\");\n/* harmony import */ var _services_ability_model_service__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @/services/ability-model.service */ \"(rsc)/./src/services/ability-model.service.ts\");\n/* harmony import */ var _services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @/services/ability-level-config.service */ \"(rsc)/./src/services/ability-level-config.service.ts\");\n/* harmony import */ var _services_user_ability_service__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @/services/user-ability.service */ \"(rsc)/./src/services/user-ability.service.ts\");\n/* harmony import */ var _services_experience_service__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @/services/experience.service */ \"(rsc)/./src/services/experience.service.ts\");\n/* harmony import */ var _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @/api/auth/auth.controller */ \"(rsc)/./src/api/auth/auth.controller.ts\");\n/* harmony import */ var _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @/api/documents/document.controller */ \"(rsc)/./src/api/documents/document.controller.ts\");\n/* harmony import */ var _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @/api/workspace/workspace.controller */ \"(rsc)/./src/api/workspace/workspace.controller.ts\");\n/* harmony import */ var _api_ability_ability_model_controller__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! @/api/ability/ability-model.controller */ \"(rsc)/./src/api/ability/ability-model.controller.ts\");\n/* harmony import */ var _api_ability_ability_level_config_controller__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! @/api/ability/ability-level-config.controller */ \"(rsc)/./src/api/ability/ability-level-config.controller.ts\");\n/* harmony import */ var _services_subject_service__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @/services/subject.service */ \"(rsc)/./src/services/subject.service.ts\");\n/* harmony import */ var _api_subject_subject_controller__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! @/api/subject/subject.controller */ \"(rsc)/./src/api/subject/subject.controller.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__, _dao_ability_category_dao__WEBPACK_IMPORTED_MODULE_6__, _dao_ability_dimension_dao__WEBPACK_IMPORTED_MODULE_7__, _dao_ability_item_dao__WEBPACK_IMPORTED_MODULE_8__, _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_9__, _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_10__, _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_11__, _dao_subject_category_dao__WEBPACK_IMPORTED_MODULE_12__, _dao_subject_dao__WEBPACK_IMPORTED_MODULE_13__, _services_auth_service__WEBPACK_IMPORTED_MODULE_14__, _services_document_service__WEBPACK_IMPORTED_MODULE_15__, _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_17__, _services_ability_model_service__WEBPACK_IMPORTED_MODULE_18__, _services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_19__, _services_user_ability_service__WEBPACK_IMPORTED_MODULE_20__, _services_experience_service__WEBPACK_IMPORTED_MODULE_21__, _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_22__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_23__, _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_24__, _api_ability_ability_model_controller__WEBPACK_IMPORTED_MODULE_25__, _api_ability_ability_level_config_controller__WEBPACK_IMPORTED_MODULE_26__, _services_subject_service__WEBPACK_IMPORTED_MODULE_27__, _api_subject_subject_controller__WEBPACK_IMPORTED_MODULE_28__]);\n([_dao_user_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__, _dao_ability_category_dao__WEBPACK_IMPORTED_MODULE_6__, _dao_ability_dimension_dao__WEBPACK_IMPORTED_MODULE_7__, _dao_ability_item_dao__WEBPACK_IMPORTED_MODULE_8__, _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_9__, _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_10__, _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_11__, _dao_subject_category_dao__WEBPACK_IMPORTED_MODULE_12__, _dao_subject_dao__WEBPACK_IMPORTED_MODULE_13__, _services_auth_service__WEBPACK_IMPORTED_MODULE_14__, _services_document_service__WEBPACK_IMPORTED_MODULE_15__, _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_17__, _services_ability_model_service__WEBPACK_IMPORTED_MODULE_18__, _services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_19__, _services_user_ability_service__WEBPACK_IMPORTED_MODULE_20__, _services_experience_service__WEBPACK_IMPORTED_MODULE_21__, _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_22__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_23__, _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_24__, _api_ability_ability_model_controller__WEBPACK_IMPORTED_MODULE_25__, _api_ability_ability_level_config_controller__WEBPACK_IMPORTED_MODULE_26__, _services_subject_service__WEBPACK_IMPORTED_MODULE_27__, _api_subject_subject_controller__WEBPACK_IMPORTED_MODULE_28__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * 初始化依赖注入容器\n * 注册所有服务和控制器\n */ function initializeContainer() {\n    // 注册 DAO\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"UserDAO\", ()=>new _dao_user_dao__WEBPACK_IMPORTED_MODULE_2__.UserDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"DocumentDAO\", ()=>new _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__.DocumentDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"WorkspaceDAO\", ()=>new _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__.WorkspaceDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"DocumentChangeDAO\", ()=>new _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__.DocumentChangeDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"AbilityCategoryDAO\", ()=>new _dao_ability_category_dao__WEBPACK_IMPORTED_MODULE_6__.AbilityCategoryDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"AbilityDimensionDAO\", ()=>new _dao_ability_dimension_dao__WEBPACK_IMPORTED_MODULE_7__.AbilityDimensionDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"AbilityItemDAO\", ()=>new _dao_ability_item_dao__WEBPACK_IMPORTED_MODULE_8__.AbilityItemDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"AbilityItemLevelConfigDAO\", ()=>new _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_9__.AbilityItemLevelConfigDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"UserAbilityLevelDAO\", ()=>new _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_10__.UserAbilityLevelDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"UserAbilityExperienceLogDAO\", ()=>new _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_11__.UserAbilityExperienceLogDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"SubjectCategoryDAO\", ()=>new _dao_subject_category_dao__WEBPACK_IMPORTED_MODULE_12__.SubjectCategoryDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"SubjectDAO\", ()=>new _dao_subject_dao__WEBPACK_IMPORTED_MODULE_13__.SubjectDAO());\n    // 注册 Service\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_auth_service__WEBPACK_IMPORTED_MODULE_14__.AuthService, ()=>{\n        const userDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"UserDAO\");\n        const workspaceDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"WorkspaceDAO\");\n        return new _services_auth_service__WEBPACK_IMPORTED_MODULE_14__.AuthService(userDAO, workspaceDAO, null);\n    });\n    // 注册 SnapshotService\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"SnapshotService\", ()=>new _services_snapshot_service__WEBPACK_IMPORTED_MODULE_16__.SnapshotService());\n    // 注册 SnapshotScheduler（需要在 DocumentService 之前注册）\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"SnapshotScheduler\", ()=>{\n        const documentDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentDAO\");\n        const snapshotService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"SnapshotService\");\n        return new _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_17__.SnapshotScheduler(documentDAO, snapshotService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_document_service__WEBPACK_IMPORTED_MODULE_15__.DocumentService, ()=>{\n        const documentDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentDAO\");\n        const snapshotScheduler = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"SnapshotScheduler\");\n        const changeDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentChangeDAO\");\n        return new _services_document_service__WEBPACK_IMPORTED_MODULE_15__.DocumentService(documentDAO, null, snapshotScheduler, changeDAO);\n    });\n    // 注册 Controller\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_22__.AuthController, ()=>{\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_14__.AuthService);\n        return new _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_22__.AuthController(authService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_23__.DocumentController, ()=>{\n        const documentService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_document_service__WEBPACK_IMPORTED_MODULE_15__.DocumentService);\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_14__.AuthService);\n        return new _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_23__.DocumentController(documentService, authService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_24__.WorkspaceController, ()=>{\n        const workspaceDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"WorkspaceDAO\");\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_14__.AuthService);\n        return new _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_24__.WorkspaceController(workspaceDAO, authService);\n    });\n    // 注册能力模型相关 Service\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_ability_model_service__WEBPACK_IMPORTED_MODULE_18__.AbilityModelService, ()=>{\n        const categoryDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"AbilityCategoryDAO\");\n        const dimensionDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"AbilityDimensionDAO\");\n        const itemDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"AbilityItemDAO\");\n        return new _services_ability_model_service__WEBPACK_IMPORTED_MODULE_18__.AbilityModelService(categoryDAO, dimensionDAO, itemDAO);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_19__.AbilityLevelConfigService, ()=>{\n        const levelConfigDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"AbilityItemLevelConfigDAO\");\n        return new _services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_19__.AbilityLevelConfigService(levelConfigDAO);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_user_ability_service__WEBPACK_IMPORTED_MODULE_20__.UserAbilityService, ()=>{\n        const userLevelDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"UserAbilityLevelDAO\");\n        const experienceLogDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"UserAbilityExperienceLogDAO\");\n        const levelConfigDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"AbilityItemLevelConfigDAO\");\n        return new _services_user_ability_service__WEBPACK_IMPORTED_MODULE_20__.UserAbilityService(userLevelDAO, experienceLogDAO, levelConfigDAO);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_experience_service__WEBPACK_IMPORTED_MODULE_21__.ExperienceService, ()=>{\n        const userLevelDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"UserAbilityLevelDAO\");\n        const experienceLogDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"UserAbilityExperienceLogDAO\");\n        const levelConfigDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"AbilityItemLevelConfigDAO\");\n        return new _services_experience_service__WEBPACK_IMPORTED_MODULE_21__.ExperienceService(userLevelDAO, experienceLogDAO, levelConfigDAO);\n    });\n    // 注册能力模型 Controller\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_ability_ability_model_controller__WEBPACK_IMPORTED_MODULE_25__.AbilityModelController, ()=>{\n        const abilityModelService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_ability_model_service__WEBPACK_IMPORTED_MODULE_18__.AbilityModelService);\n        return new _api_ability_ability_model_controller__WEBPACK_IMPORTED_MODULE_25__.AbilityModelController(abilityModelService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_ability_ability_level_config_controller__WEBPACK_IMPORTED_MODULE_26__.AbilityLevelConfigController, ()=>{\n        const levelConfigService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_ability_level_config_service__WEBPACK_IMPORTED_MODULE_19__.AbilityLevelConfigService);\n        return new _api_ability_ability_level_config_controller__WEBPACK_IMPORTED_MODULE_26__.AbilityLevelConfigController(levelConfigService);\n    });\n    // 注册学科相关 Service\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_subject_service__WEBPACK_IMPORTED_MODULE_27__.SubjectService, ()=>{\n        const categoryDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"SubjectCategoryDAO\");\n        const subjectDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"SubjectDAO\");\n        return new _services_subject_service__WEBPACK_IMPORTED_MODULE_27__.SubjectService(categoryDAO, subjectDAO);\n    });\n    // 注册学科 Controller\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_subject_subject_controller__WEBPACK_IMPORTED_MODULE_28__.SubjectController, ()=>{\n        const subjectService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_subject_service__WEBPACK_IMPORTED_MODULE_27__.SubjectService);\n        return new _api_subject_subject_controller__WEBPACK_IMPORTED_MODULE_28__.SubjectController(subjectService);\n    });\n}\n// 自动初始化\ninitializeContainer();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBY0E7UUFDdkUsT0FBTyxJQUFJQywrRUFBaUJBLENBQUNxQjtJQUMvQjtBQUNGO0FBRUEsUUFBUTtBQUNScEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9pbml0LnRzPzM1M2UiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcbmltcG9ydCB7IENvbnRhaW5lciB9IGZyb20gJy4vY29udGFpbmVyJztcbmltcG9ydCB7IFVzZXJEQU8gfSBmcm9tICdAL2Rhby91c2VyLmRhbyc7XG5pbXBvcnQgeyBEb2N1bWVudERBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LmRhbyc7XG5pbXBvcnQgeyBEb2N1bWVudENoYW5nZURBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LWNoYW5nZS5kYW8nO1xuaW1wb3J0IHsgV29ya3NwYWNlREFPIH0gZnJvbSAnQC9kYW8vd29ya3NwYWNlLmRhbyc7XG5pbXBvcnQgeyBBYmlsaXR5Q2F0ZWdvcnlEQU8gfSBmcm9tICdAL2Rhby9hYmlsaXR5LWNhdGVnb3J5LmRhbyc7XG5pbXBvcnQgeyBBYmlsaXR5RGltZW5zaW9uREFPIH0gZnJvbSAnQC9kYW8vYWJpbGl0eS1kaW1lbnNpb24uZGFvJztcbmltcG9ydCB7IEFiaWxpdHlJdGVtREFPIH0gZnJvbSAnQC9kYW8vYWJpbGl0eS1pdGVtLmRhbyc7XG5pbXBvcnQgeyBBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPIH0gZnJvbSAnQC9kYW8vYWJpbGl0eS1pdGVtLWxldmVsLWNvbmZpZy5kYW8nO1xuaW1wb3J0IHsgVXNlckFiaWxpdHlMZXZlbERBTyB9IGZyb20gJ0AvZGFvL3VzZXItYWJpbGl0eS1sZXZlbC5kYW8nO1xuaW1wb3J0IHsgVXNlckFiaWxpdHlFeHBlcmllbmNlTG9nREFPIH0gZnJvbSAnQC9kYW8vdXNlci1hYmlsaXR5LWV4cGVyaWVuY2UtbG9nLmRhbyc7XG5pbXBvcnQgeyBTdWJqZWN0Q2F0ZWdvcnlEQU8gfSBmcm9tICdAL2Rhby9zdWJqZWN0LWNhdGVnb3J5LmRhbyc7XG5pbXBvcnQgeyBTdWJqZWN0REFPIH0gZnJvbSAnQC9kYW8vc3ViamVjdC5kYW8nO1xuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XG5pbXBvcnQgeyBEb2N1bWVudFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2RvY3VtZW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgU25hcHNob3RTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9zbmFwc2hvdC5zZXJ2aWNlJztcbmltcG9ydCB7IFNuYXBzaG90U2NoZWR1bGVyIH0gZnJvbSAnQC9zZXJ2aWNlcy9zbmFwc2hvdC1zY2hlZHVsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBBYmlsaXR5TW9kZWxTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hYmlsaXR5LW1vZGVsLnNlcnZpY2UnO1xuaW1wb3J0IHsgQWJpbGl0eUxldmVsQ29uZmlnU2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvYWJpbGl0eS1sZXZlbC1jb25maWcuc2VydmljZSc7XG5pbXBvcnQgeyBVc2VyQWJpbGl0eVNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL3VzZXItYWJpbGl0eS5zZXJ2aWNlJztcbmltcG9ydCB7IEV4cGVyaWVuY2VTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9leHBlcmllbmNlLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXV0aENvbnRyb2xsZXIgfSBmcm9tICdAL2FwaS9hdXRoL2F1dGguY29udHJvbGxlcic7XG5pbXBvcnQgeyBEb2N1bWVudENvbnRyb2xsZXIgfSBmcm9tICdAL2FwaS9kb2N1bWVudHMvZG9jdW1lbnQuY29udHJvbGxlcic7XG5pbXBvcnQgeyBXb3Jrc3BhY2VDb250cm9sbGVyIH0gZnJvbSAnQC9hcGkvd29ya3NwYWNlL3dvcmtzcGFjZS5jb250cm9sbGVyJztcbmltcG9ydCB7IEFiaWxpdHlNb2RlbENvbnRyb2xsZXIgfSBmcm9tICdAL2FwaS9hYmlsaXR5L2FiaWxpdHktbW9kZWwuY29udHJvbGxlcic7XG5pbXBvcnQgeyBBYmlsaXR5TGV2ZWxDb25maWdDb250cm9sbGVyIH0gZnJvbSAnQC9hcGkvYWJpbGl0eS9hYmlsaXR5LWxldmVsLWNvbmZpZy5jb250cm9sbGVyJztcbmltcG9ydCB7IFN1YmplY3RTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9zdWJqZWN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgU3ViamVjdENvbnRyb2xsZXIgfSBmcm9tICdAL2FwaS9zdWJqZWN0L3N1YmplY3QuY29udHJvbGxlcic7XG5cbi8qKlxuICog5Yid5aeL5YyW5L6d6LWW5rOo5YWl5a655ZmoXG4gKiDms6jlhozmiYDmnInmnI3liqHlkozmjqfliLblmahcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVDb250YWluZXIoKSB7XG4gIC8vIOazqOWGjCBEQU9cbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdVc2VyREFPJywgKCkgPT4gbmV3IFVzZXJEQU8oKSk7XG4gIENvbnRhaW5lci5yZWdpc3RlcignRG9jdW1lbnREQU8nLCAoKSA9PiBuZXcgRG9jdW1lbnREQU8oKSk7XG4gIENvbnRhaW5lci5yZWdpc3RlcignV29ya3NwYWNlREFPJywgKCkgPT4gbmV3IFdvcmtzcGFjZURBTygpKTtcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdEb2N1bWVudENoYW5nZURBTycsICgpID0+IG5ldyBEb2N1bWVudENoYW5nZURBTygpKTtcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdBYmlsaXR5Q2F0ZWdvcnlEQU8nLCAoKSA9PiBuZXcgQWJpbGl0eUNhdGVnb3J5REFPKCkpO1xuICBDb250YWluZXIucmVnaXN0ZXIoJ0FiaWxpdHlEaW1lbnNpb25EQU8nLCAoKSA9PiBuZXcgQWJpbGl0eURpbWVuc2lvbkRBTygpKTtcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdBYmlsaXR5SXRlbURBTycsICgpID0+IG5ldyBBYmlsaXR5SXRlbURBTygpKTtcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPJywgKCkgPT4gbmV3IEFiaWxpdHlJdGVtTGV2ZWxDb25maWdEQU8oKSk7XG4gIENvbnRhaW5lci5yZWdpc3RlcignVXNlckFiaWxpdHlMZXZlbERBTycsICgpID0+IG5ldyBVc2VyQWJpbGl0eUxldmVsREFPKCkpO1xuICBDb250YWluZXIucmVnaXN0ZXIoJ1VzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ0RBTycsICgpID0+IG5ldyBVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2dEQU8oKSk7XG4gIENvbnRhaW5lci5yZWdpc3RlcignU3ViamVjdENhdGVnb3J5REFPJywgKCkgPT4gbmV3IFN1YmplY3RDYXRlZ29yeURBTygpKTtcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdTdWJqZWN0REFPJywgKCkgPT4gbmV3IFN1YmplY3REQU8oKSk7XG5cbiAgLy8g5rOo5YaMIFNlcnZpY2VcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKEF1dGhTZXJ2aWNlLCAoKSA9PiB7XG4gICAgY29uc3QgdXNlckRBTyA9IENvbnRhaW5lci5yZXNvbHZlPFVzZXJEQU8+KCdVc2VyREFPJyk7XG4gICAgY29uc3Qgd29ya3NwYWNlREFPID0gQ29udGFpbmVyLnJlc29sdmU8V29ya3NwYWNlREFPPignV29ya3NwYWNlREFPJyk7XG4gICAgcmV0dXJuIG5ldyBBdXRoU2VydmljZSh1c2VyREFPLCB3b3Jrc3BhY2VEQU8sIG51bGwgYXMgYW55KTtcbiAgfSk7XG5cbiAgLy8g5rOo5YaMIFNuYXBzaG90U2VydmljZVxuICBDb250YWluZXIucmVnaXN0ZXIoJ1NuYXBzaG90U2VydmljZScsICgpID0+IG5ldyBTbmFwc2hvdFNlcnZpY2UoKSk7XG5cbiAgLy8g5rOo5YaMIFNuYXBzaG90U2NoZWR1bGVy77yI6ZyA6KaB5ZyoIERvY3VtZW50U2VydmljZSDkuYvliY3ms6jlhozvvIlcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdTbmFwc2hvdFNjaGVkdWxlcicsICgpID0+IHtcbiAgICBjb25zdCBkb2N1bWVudERBTyA9IENvbnRhaW5lci5yZXNvbHZlPERvY3VtZW50REFPPignRG9jdW1lbnREQU8nKTtcbiAgICBjb25zdCBzbmFwc2hvdFNlcnZpY2UgPSBDb250YWluZXIucmVzb2x2ZTxTbmFwc2hvdFNlcnZpY2U+KCdTbmFwc2hvdFNlcnZpY2UnKTtcbiAgICByZXR1cm4gbmV3IFNuYXBzaG90U2NoZWR1bGVyKGRvY3VtZW50REFPLCBzbmFwc2hvdFNlcnZpY2UpO1xuICB9KTtcblxuICBDb250YWluZXIucmVnaXN0ZXIoRG9jdW1lbnRTZXJ2aWNlLCAoKSA9PiB7XG4gICAgY29uc3QgZG9jdW1lbnREQU8gPSBDb250YWluZXIucmVzb2x2ZTxEb2N1bWVudERBTz4oJ0RvY3VtZW50REFPJyk7XG4gICAgY29uc3Qgc25hcHNob3RTY2hlZHVsZXIgPSBDb250YWluZXIucmVzb2x2ZTxTbmFwc2hvdFNjaGVkdWxlcj4oJ1NuYXBzaG90U2NoZWR1bGVyJyk7XG4gICAgY29uc3QgY2hhbmdlREFPID0gQ29udGFpbmVyLnJlc29sdmU8RG9jdW1lbnRDaGFuZ2VEQU8+KCdEb2N1bWVudENoYW5nZURBTycpO1xuICAgIHJldHVybiBuZXcgRG9jdW1lbnRTZXJ2aWNlKGRvY3VtZW50REFPLCBudWxsIGFzIGFueSwgc25hcHNob3RTY2hlZHVsZXIsIGNoYW5nZURBTyk7XG4gIH0pO1xuXG4gIC8vIOazqOWGjCBDb250cm9sbGVyXG4gIENvbnRhaW5lci5yZWdpc3RlcihBdXRoQ29udHJvbGxlciwgKCkgPT4ge1xuICAgIGNvbnN0IGF1dGhTZXJ2aWNlID0gQ29udGFpbmVyLnJlc29sdmU8QXV0aFNlcnZpY2U+KEF1dGhTZXJ2aWNlKTtcbiAgICByZXR1cm4gbmV3IEF1dGhDb250cm9sbGVyKGF1dGhTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgQ29udGFpbmVyLnJlZ2lzdGVyKERvY3VtZW50Q29udHJvbGxlciwgKCkgPT4ge1xuICAgIGNvbnN0IGRvY3VtZW50U2VydmljZSA9IENvbnRhaW5lci5yZXNvbHZlPERvY3VtZW50U2VydmljZT4oRG9jdW1lbnRTZXJ2aWNlKTtcbiAgICBjb25zdCBhdXRoU2VydmljZSA9IENvbnRhaW5lci5yZXNvbHZlPEF1dGhTZXJ2aWNlPihBdXRoU2VydmljZSk7XG4gICAgcmV0dXJuIG5ldyBEb2N1bWVudENvbnRyb2xsZXIoZG9jdW1lbnRTZXJ2aWNlLCBhdXRoU2VydmljZSk7XG4gIH0pO1xuXG4gIENvbnRhaW5lci5yZWdpc3RlcihXb3Jrc3BhY2VDb250cm9sbGVyLCAoKSA9PiB7XG4gICAgY29uc3Qgd29ya3NwYWNlREFPID0gQ29udGFpbmVyLnJlc29sdmU8V29ya3NwYWNlREFPPignV29ya3NwYWNlREFPJyk7XG4gICAgY29uc3QgYXV0aFNlcnZpY2UgPSBDb250YWluZXIucmVzb2x2ZTxBdXRoU2VydmljZT4oQXV0aFNlcnZpY2UpO1xuICAgIHJldHVybiBuZXcgV29ya3NwYWNlQ29udHJvbGxlcih3b3Jrc3BhY2VEQU8sIGF1dGhTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgLy8g5rOo5YaM6IO95Yqb5qih5Z6L55u45YWzIFNlcnZpY2VcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKEFiaWxpdHlNb2RlbFNlcnZpY2UsICgpID0+IHtcbiAgICBjb25zdCBjYXRlZ29yeURBTyA9IENvbnRhaW5lci5yZXNvbHZlPEFiaWxpdHlDYXRlZ29yeURBTz4oJ0FiaWxpdHlDYXRlZ29yeURBTycpO1xuICAgIGNvbnN0IGRpbWVuc2lvbkRBTyA9IENvbnRhaW5lci5yZXNvbHZlPEFiaWxpdHlEaW1lbnNpb25EQU8+KCdBYmlsaXR5RGltZW5zaW9uREFPJyk7XG4gICAgY29uc3QgaXRlbURBTyA9IENvbnRhaW5lci5yZXNvbHZlPEFiaWxpdHlJdGVtREFPPignQWJpbGl0eUl0ZW1EQU8nKTtcbiAgICByZXR1cm4gbmV3IEFiaWxpdHlNb2RlbFNlcnZpY2UoY2F0ZWdvcnlEQU8sIGRpbWVuc2lvbkRBTywgaXRlbURBTyk7XG4gIH0pO1xuXG4gIENvbnRhaW5lci5yZWdpc3RlcihBYmlsaXR5TGV2ZWxDb25maWdTZXJ2aWNlLCAoKSA9PiB7XG4gICAgY29uc3QgbGV2ZWxDb25maWdEQU8gPSBDb250YWluZXIucmVzb2x2ZTxBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPPignQWJpbGl0eUl0ZW1MZXZlbENvbmZpZ0RBTycpO1xuICAgIHJldHVybiBuZXcgQWJpbGl0eUxldmVsQ29uZmlnU2VydmljZShsZXZlbENvbmZpZ0RBTyk7XG4gIH0pO1xuXG4gIENvbnRhaW5lci5yZWdpc3RlcihVc2VyQWJpbGl0eVNlcnZpY2UsICgpID0+IHtcbiAgICBjb25zdCB1c2VyTGV2ZWxEQU8gPSBDb250YWluZXIucmVzb2x2ZTxVc2VyQWJpbGl0eUxldmVsREFPPignVXNlckFiaWxpdHlMZXZlbERBTycpO1xuICAgIGNvbnN0IGV4cGVyaWVuY2VMb2dEQU8gPSBDb250YWluZXIucmVzb2x2ZTxVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2dEQU8+KCdVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2dEQU8nKTtcbiAgICBjb25zdCBsZXZlbENvbmZpZ0RBTyA9IENvbnRhaW5lci5yZXNvbHZlPEFiaWxpdHlJdGVtTGV2ZWxDb25maWdEQU8+KCdBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPJyk7XG4gICAgcmV0dXJuIG5ldyBVc2VyQWJpbGl0eVNlcnZpY2UodXNlckxldmVsREFPLCBleHBlcmllbmNlTG9nREFPLCBsZXZlbENvbmZpZ0RBTyk7XG4gIH0pO1xuXG4gIENvbnRhaW5lci5yZWdpc3RlcihFeHBlcmllbmNlU2VydmljZSwgKCkgPT4ge1xuICAgIGNvbnN0IHVzZXJMZXZlbERBTyA9IENvbnRhaW5lci5yZXNvbHZlPFVzZXJBYmlsaXR5TGV2ZWxEQU8+KCdVc2VyQWJpbGl0eUxldmVsREFPJyk7XG4gICAgY29uc3QgZXhwZXJpZW5jZUxvZ0RBTyA9IENvbnRhaW5lci5yZXNvbHZlPFVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ0RBTz4oJ1VzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ0RBTycpO1xuICAgIGNvbnN0IGxldmVsQ29uZmlnREFPID0gQ29udGFpbmVyLnJlc29sdmU8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZ0RBTz4oJ0FiaWxpdHlJdGVtTGV2ZWxDb25maWdEQU8nKTtcbiAgICByZXR1cm4gbmV3IEV4cGVyaWVuY2VTZXJ2aWNlKHVzZXJMZXZlbERBTywgZXhwZXJpZW5jZUxvZ0RBTywgbGV2ZWxDb25maWdEQU8pO1xuICB9KTtcblxuICAvLyDms6jlhozog73lipvmqKHlnosgQ29udHJvbGxlclxuICBDb250YWluZXIucmVnaXN0ZXIoQWJpbGl0eU1vZGVsQ29udHJvbGxlciwgKCkgPT4ge1xuICAgIGNvbnN0IGFiaWxpdHlNb2RlbFNlcnZpY2UgPSBDb250YWluZXIucmVzb2x2ZTxBYmlsaXR5TW9kZWxTZXJ2aWNlPihBYmlsaXR5TW9kZWxTZXJ2aWNlKTtcbiAgICByZXR1cm4gbmV3IEFiaWxpdHlNb2RlbENvbnRyb2xsZXIoYWJpbGl0eU1vZGVsU2VydmljZSk7XG4gIH0pO1xuXG4gIENvbnRhaW5lci5yZWdpc3RlcihBYmlsaXR5TGV2ZWxDb25maWdDb250cm9sbGVyLCAoKSA9PiB7XG4gICAgY29uc3QgbGV2ZWxDb25maWdTZXJ2aWNlID0gQ29udGFpbmVyLnJlc29sdmU8QWJpbGl0eUxldmVsQ29uZmlnU2VydmljZT4oXG4gICAgICBBYmlsaXR5TGV2ZWxDb25maWdTZXJ2aWNlXG4gICAgKTtcbiAgICByZXR1cm4gbmV3IEFiaWxpdHlMZXZlbENvbmZpZ0NvbnRyb2xsZXIobGV2ZWxDb25maWdTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgLy8g5rOo5YaM5a2m56eR55u45YWzIFNlcnZpY2VcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKFN1YmplY3RTZXJ2aWNlLCAoKSA9PiB7XG4gICAgY29uc3QgY2F0ZWdvcnlEQU8gPSBDb250YWluZXIucmVzb2x2ZTxTdWJqZWN0Q2F0ZWdvcnlEQU8+KCdTdWJqZWN0Q2F0ZWdvcnlEQU8nKTtcbiAgICBjb25zdCBzdWJqZWN0REFPID0gQ29udGFpbmVyLnJlc29sdmU8U3ViamVjdERBTz4oJ1N1YmplY3REQU8nKTtcbiAgICByZXR1cm4gbmV3IFN1YmplY3RTZXJ2aWNlKGNhdGVnb3J5REFPLCBzdWJqZWN0REFPKTtcbiAgfSk7XG5cbiAgLy8g5rOo5YaM5a2m56eRIENvbnRyb2xsZXJcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKFN1YmplY3RDb250cm9sbGVyLCAoKSA9PiB7XG4gICAgY29uc3Qgc3ViamVjdFNlcnZpY2UgPSBDb250YWluZXIucmVzb2x2ZTxTdWJqZWN0U2VydmljZT4oU3ViamVjdFNlcnZpY2UpO1xuICAgIHJldHVybiBuZXcgU3ViamVjdENvbnRyb2xsZXIoc3ViamVjdFNlcnZpY2UpO1xuICB9KTtcbn1cblxuLy8g6Ieq5Yqo5Yid5aeL5YyWXG5pbml0aWFsaXplQ29udGFpbmVyKCk7XG4iXSwibmFtZXMiOlsiQ29udGFpbmVyIiwiVXNlckRBTyIsIkRvY3VtZW50REFPIiwiRG9jdW1lbnRDaGFuZ2VEQU8iLCJXb3Jrc3BhY2VEQU8iLCJBYmlsaXR5Q2F0ZWdvcnlEQU8iLCJBYmlsaXR5RGltZW5zaW9uREFPIiwiQWJpbGl0eUl0ZW1EQU8iLCJBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPIiwiVXNlckFiaWxpdHlMZXZlbERBTyIsIlVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ0RBTyIsIlN1YmplY3RDYXRlZ29yeURBTyIsIlN1YmplY3REQU8iLCJBdXRoU2VydmljZSIsIkRvY3VtZW50U2VydmljZSIsIlNuYXBzaG90U2VydmljZSIsIlNuYXBzaG90U2NoZWR1bGVyIiwiQWJpbGl0eU1vZGVsU2VydmljZSIsIkFiaWxpdHlMZXZlbENvbmZpZ1NlcnZpY2UiLCJVc2VyQWJpbGl0eVNlcnZpY2UiLCJFeHBlcmllbmNlU2VydmljZSIsIkF1dGhDb250cm9sbGVyIiwiRG9jdW1lbnRDb250cm9sbGVyIiwiV29ya3NwYWNlQ29udHJvbGxlciIsIkFiaWxpdHlNb2RlbENvbnRyb2xsZXIiLCJBYmlsaXR5TGV2ZWxDb25maWdDb250cm9sbGVyIiwiU3ViamVjdFNlcnZpY2UiLCJTdWJqZWN0Q29udHJvbGxlciIsImluaXRpYWxpemVDb250YWluZXIiLCJyZWdpc3RlciIsInVzZXJEQU8iLCJyZXNvbHZlIiwid29ya3NwYWNlREFPIiwiZG9jdW1lbnREQU8iLCJzbmFwc2hvdFNlcnZpY2UiLCJzbmFwc2hvdFNjaGVkdWxlciIsImNoYW5nZURBTyIsImF1dGhTZXJ2aWNlIiwiZG9jdW1lbnRTZXJ2aWNlIiwiY2F0ZWdvcnlEQU8iLCJkaW1lbnNpb25EQU8iLCJpdGVtREFPIiwibGV2ZWxDb25maWdEQU8iLCJ1c2VyTGV2ZWxEQU8iLCJleHBlcmllbmNlTG9nREFPIiwiYWJpbGl0eU1vZGVsU2VydmljZSIsImxldmVsQ29uZmlnU2VydmljZSIsInN1YmplY3REQU8iLCJzdWJqZWN0U2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/init.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/redis.ts":
/*!***************************!*\
  !*** ./src/core/redis.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Redis: () => (/* binding */ Redis)\n/* harmony export */ });\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! redis */ \"(rsc)/../../node_modules/redis/dist/index.js\");\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(redis__WEBPACK_IMPORTED_MODULE_0__);\n\nclass Redis {\n    constructor(){\n        const url = process.env.REDIS_URL || \"redis://localhost:6379\";\n        this.client = (0,redis__WEBPACK_IMPORTED_MODULE_0__.createClient)({\n            url,\n            password: process.env.REDIS_PASSWORD || undefined\n        });\n        this.client.on(\"error\", (err)=>{\n            console.error(\"Redis Client Error\", err);\n        });\n    }\n    static getInstance() {\n        if (!Redis.instance) {\n            Redis.instance = new Redis();\n        }\n        return Redis.instance;\n    }\n    async connect() {\n        if (!this.client.isOpen) {\n            await this.client.connect();\n        }\n    }\n    getClient() {\n        return this.client;\n    }\n    /**\n   * 设置缓存\n   */ async set(key, value, ttl) {\n        await this.connect();\n        if (ttl) {\n            await this.client.setEx(key, ttl, value);\n        } else {\n            await this.client.set(key, value);\n        }\n    }\n    /**\n   * 获取缓存\n   */ async get(key) {\n        await this.connect();\n        return await this.client.get(key);\n    }\n    /**\n   * 删除缓存\n   */ async del(key) {\n        await this.connect();\n        await this.client.del(key);\n    }\n    /**\n   * 删除匹配模式的所有键（使用 SCAN 避免阻塞）\n   * @param pattern 匹配模式，例如 \"documents:workspace:*\"\n   */ async delByPattern(pattern) {\n        await this.connect();\n        let deletedCount = 0;\n        let cursor = 0;\n        do {\n            const result = await this.client.scan(cursor, {\n                MATCH: pattern,\n                COUNT: 100\n            });\n            cursor = result.cursor;\n            if (result.keys.length > 0) {\n                await this.client.del(result.keys);\n                deletedCount += result.keys.length;\n            }\n        }while (cursor !== 0);\n        return deletedCount;\n    }\n    /**\n   * 设置 JSON 缓存\n   */ async setJSON(key, value, ttl) {\n        await this.set(key, JSON.stringify(value), ttl);\n    }\n    /**\n   * 获取 JSON 缓存\n   */ async getJSON(key) {\n        const value = await this.get(key);\n        if (!value) return null;\n        try {\n            return JSON.parse(value);\n        } catch  {\n            return null;\n        }\n    }\n    /**\n   * 关闭连接\n   */ async close() {\n        if (this.client.isOpen) {\n            await this.client.quit();\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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OztHQUVDLEdBQ0QsTUFBYW9CLFFBQXVCO1FBQ2xDLElBQUksSUFBSSxDQUFDbkMsTUFBTSxDQUFDVyxNQUFNLEVBQUU7WUFDdEIsTUFBTSxJQUFJLENBQUNYLE1BQU0sQ0FBQ29DLElBQUk7UUFDeEI7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2NvcmUvcmVkaXMudHM/MWUyYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQsIFJlZGlzQ2xpZW50VHlwZSB9IGZyb20gJ3JlZGlzJztcblxuZXhwb3J0IGNsYXNzIFJlZGlzIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFJlZGlzO1xuICBwcml2YXRlIGNsaWVudDogUmVkaXNDbGllbnRUeXBlO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuUkVESVNfVVJMIHx8ICdyZWRpczovL2xvY2FsaG9zdDo2Mzc5JztcbiAgICB0aGlzLmNsaWVudCA9IGNyZWF0ZUNsaWVudCh7XG4gICAgICB1cmwsXG4gICAgICBwYXNzd29yZDogcHJvY2Vzcy5lbnYuUkVESVNfUEFTU1dPUkQgfHwgdW5kZWZpbmVkLFxuICAgIH0pIGFzIFJlZGlzQ2xpZW50VHlwZTtcblxuICAgIHRoaXMuY2xpZW50Lm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlZGlzIENsaWVudCBFcnJvcicsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IFJlZGlzIHtcbiAgICBpZiAoIVJlZGlzLmluc3RhbmNlKSB7XG4gICAgICBSZWRpcy5pbnN0YW5jZSA9IG5ldyBSZWRpcygpO1xuICAgIH1cbiAgICByZXR1cm4gUmVkaXMuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgY29ubmVjdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuY2xpZW50LmlzT3Blbikge1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuY29ubmVjdCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRDbGllbnQoKTogUmVkaXNDbGllbnRUeXBlIHtcbiAgICByZXR1cm4gdGhpcy5jbGllbnQ7XG4gIH1cblxuICAvKipcbiAgICog6K6+572u57yT5a2YXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc2V0KFxuICAgIGtleTogc3RyaW5nLFxuICAgIHZhbHVlOiBzdHJpbmcsXG4gICAgdHRsPzogbnVtYmVyXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpO1xuICAgIGlmICh0dGwpIHtcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnNldEV4KGtleSwgdHRsLCB2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnNldChrZXksIHZhbHVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W57yT5a2YXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0KGtleTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgYXdhaXQgdGhpcy5jb25uZWN0KCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2xpZW50LmdldChrZXkpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOe8k+WtmFxuICAgKi9cbiAgcHVibGljIGFzeW5jIGRlbChrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpO1xuICAgIGF3YWl0IHRoaXMuY2xpZW50LmRlbChrZXkpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOWMuemFjeaooeW8j+eahOaJgOaciemUru+8iOS9v+eUqCBTQ0FOIOmBv+WFjemYu+Whnu+8iVxuICAgKiBAcGFyYW0gcGF0dGVybiDljLnphY3mqKHlvI/vvIzkvovlpoIgXCJkb2N1bWVudHM6d29ya3NwYWNlOipcIlxuICAgKi9cbiAgcHVibGljIGFzeW5jIGRlbEJ5UGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpO1xuICAgIGxldCBkZWxldGVkQ291bnQgPSAwO1xuICAgIGxldCBjdXJzb3IgPSAwO1xuXG4gICAgZG8ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jbGllbnQuc2NhbihjdXJzb3IsIHtcbiAgICAgICAgTUFUQ0g6IHBhdHRlcm4sXG4gICAgICAgIENPVU5UOiAxMDAsXG4gICAgICB9KTtcbiAgICAgIGN1cnNvciA9IHJlc3VsdC5jdXJzb3I7XG5cbiAgICAgIGlmIChyZXN1bHQua2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LmRlbChyZXN1bHQua2V5cyk7XG4gICAgICAgIGRlbGV0ZWRDb3VudCArPSByZXN1bHQua2V5cy5sZW5ndGg7XG4gICAgICB9XG4gICAgfSB3aGlsZSAoY3Vyc29yICE9PSAwKTtcblxuICAgIHJldHVybiBkZWxldGVkQ291bnQ7XG4gIH1cblxuICAvKipcbiAgICog6K6+572uIEpTT04g57yT5a2YXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc2V0SlNPTjxUPihrZXk6IHN0cmluZywgdmFsdWU6IFQsIHR0bD86IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuc2V0KGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpLCB0dGwpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPliBKU09OIOe8k+WtmFxuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldEpTT048VD4oa2V5OiBzdHJpbmcpOiBQcm9taXNlPFQgfCBudWxsPiB7XG4gICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLmdldChrZXkpO1xuICAgIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSkgYXMgVDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlhbPpl63ov57mjqVcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5jbGllbnQuaXNPcGVuKSB7XG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5xdWl0KCk7XG4gICAgfVxuICB9XG59XG5cblxuXG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJSZWRpcyIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19VUkwiLCJjbGllbnQiLCJwYXNzd29yZCIsIlJFRElTX1BBU1NXT1JEIiwidW5kZWZpbmVkIiwib24iLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiY29ubmVjdCIsImlzT3BlbiIsImdldENsaWVudCIsInNldCIsImtleSIsInZhbHVlIiwidHRsIiwic2V0RXgiLCJnZXQiLCJkZWwiLCJkZWxCeVBhdHRlcm4iLCJwYXR0ZXJuIiwiZGVsZXRlZENvdW50IiwiY3Vyc29yIiwicmVzdWx0Iiwic2NhbiIsIk1BVENIIiwiQ09VTlQiLCJrZXlzIiwibGVuZ3RoIiwic2V0SlNPTiIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRKU09OIiwicGFyc2UiLCJjbG9zZSIsInF1aXQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/core/redis.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/storage/local-file-storage.ts":
/*!************************************************!*\
  !*** ./src/core/storage/local-file-storage.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LocalFileStorage: () => (/* binding */ LocalFileStorage)\n/* harmony export */ });\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n\n\n/**\n * 本地文件存储实现\n * 存储路径：{basePath}/{workspaceId}/{objectId}/snapshot_{timestamp}.gz\n */ class LocalFileStorage {\n    constructor(basePath = \"./storage/snapshots\"){\n        this.basePath = basePath;\n    }\n    /**\n   * 确保目录存在\n   */ async ensureDir(dirPath) {\n        try {\n            await fs_promises__WEBPACK_IMPORTED_MODULE_0__.mkdir(dirPath, {\n                recursive: true\n            });\n        } catch (error) {\n            if (error.code !== \"EEXIST\") {\n                throw error;\n            }\n        }\n    }\n    /**\n   * 获取完整文件路径\n   */ getFilePath(key) {\n        return path__WEBPACK_IMPORTED_MODULE_1__.join(this.basePath, key);\n    }\n    /**\n   * 存储快照数据\n   */ async put(key, data, metadata) {\n        const filePath = this.getFilePath(key);\n        const dirPath = path__WEBPACK_IMPORTED_MODULE_1__.dirname(filePath);\n        // 确保目录存在\n        await this.ensureDir(dirPath);\n        // 写入文件\n        await fs_promises__WEBPACK_IMPORTED_MODULE_0__.writeFile(filePath, data);\n        // 如果有元数据，写入元数据文件\n        if (metadata) {\n            const metaPath = filePath + \".meta.json\";\n            await fs_promises__WEBPACK_IMPORTED_MODULE_0__.writeFile(metaPath, JSON.stringify(metadata, null, 2));\n        }\n    }\n    /**\n   * 获取快照数据\n   */ async get(key) {\n        const filePath = this.getFilePath(key);\n        try {\n            const data = await fs_promises__WEBPACK_IMPORTED_MODULE_0__.readFile(filePath);\n            return data;\n        } catch (error) {\n            if (error.code === \"ENOENT\") {\n                return null;\n            }\n            throw error;\n        }\n    }\n    /**\n   * 删除快照数据\n   */ async delete(key) {\n        const filePath = this.getFilePath(key);\n        try {\n            await fs_promises__WEBPACK_IMPORTED_MODULE_0__.unlink(filePath);\n            // 同时删除元数据文件\n            const metaPath = filePath + \".meta.json\";\n            try {\n                await fs_promises__WEBPACK_IMPORTED_MODULE_0__.unlink(metaPath);\n            } catch  {\n            // 忽略元数据文件不存在的错误\n            }\n        } catch (error) {\n            if (error.code !== \"ENOENT\") {\n                throw error;\n            }\n        }\n    }\n    /**\n   * 列出指定前缀的所有键\n   */ async list(prefix, limit) {\n        const dirPath = this.getFilePath(prefix);\n        const keys = [];\n        try {\n            // 递归读取目录\n            const readDirRecursive = async (dir, baseDir)=>{\n                const entries = await fs_promises__WEBPACK_IMPORTED_MODULE_0__.readdir(dir, {\n                    withFileTypes: true\n                });\n                const files = [];\n                for (const entry of entries){\n                    const fullPath = path__WEBPACK_IMPORTED_MODULE_1__.join(dir, entry.name);\n                    const relativePath = path__WEBPACK_IMPORTED_MODULE_1__.relative(baseDir, fullPath);\n                    if (entry.isDirectory()) {\n                        const subFiles = await readDirRecursive(fullPath, baseDir);\n                        files.push(...subFiles);\n                    } else if (entry.isFile() && !entry.name.endsWith(\".meta.json\")) {\n                        files.push(relativePath);\n                    }\n                }\n                return files;\n            };\n            const allFiles = await readDirRecursive(dirPath, this.basePath);\n            // 按文件名排序（时间戳降序）\n            allFiles.sort((a, b)=>{\n                const aName = path__WEBPACK_IMPORTED_MODULE_1__.basename(a);\n                const bName = path__WEBPACK_IMPORTED_MODULE_1__.basename(b);\n                return bName.localeCompare(aName);\n            });\n            // 应用限制\n            if (limit) {\n                return allFiles.slice(0, limit);\n            }\n            return allFiles;\n        } catch (error) {\n            if (error.code === \"ENOENT\") {\n                return [];\n            }\n            throw error;\n        }\n    }\n    /**\n   * 批量删除\n   */ async deleteMany(keys) {\n        await Promise.all(keys.map((key)=>this.delete(key)));\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9zdG9yYWdlL2xvY2FsLWZpbGUtc3RvcmFnZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFrQztBQUNMO0FBRzdCOzs7Q0FHQyxHQUNNLE1BQU1FO0lBR1hDLFlBQVlDLFdBQW1CLHFCQUFxQixDQUFFO1FBQ3BELElBQUksQ0FBQ0EsUUFBUSxHQUFHQTtJQUNsQjtJQUVBOztHQUVDLEdBQ0QsTUFBY0MsVUFBVUMsT0FBZSxFQUFpQjtRQUN0RCxJQUFJO1lBQ0YsTUFBTU4sOENBQVEsQ0FBQ00sU0FBUztnQkFBRUUsV0FBVztZQUFLO1FBQzVDLEVBQUUsT0FBT0MsT0FBWTtZQUNuQixJQUFJQSxNQUFNQyxJQUFJLEtBQUssVUFBVTtnQkFDM0IsTUFBTUQ7WUFDUjtRQUNGO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELFlBQW9CRyxHQUFXLEVBQVU7UUFDdkMsT0FBT1gsc0NBQVMsQ0FBQyxJQUFJLENBQUNHLFFBQVEsRUFBRVE7SUFDbEM7SUFFQTs7R0FFQyxHQUNELE1BQU1FLElBQUlGLEdBQVcsRUFBRUcsSUFBWSxFQUFFQyxRQUE4QixFQUFpQjtRQUNsRixNQUFNQyxXQUFXLElBQUksQ0FBQ04sV0FBVyxDQUFDQztRQUNsQyxNQUFNTixVQUFVTCx5Q0FBWSxDQUFDZ0I7UUFFN0IsU0FBUztRQUNULE1BQU0sSUFBSSxDQUFDWixTQUFTLENBQUNDO1FBRXJCLE9BQU87UUFDUCxNQUFNTixrREFBWSxDQUFDaUIsVUFBVUY7UUFFN0IsaUJBQWlCO1FBQ2pCLElBQUlDLFVBQVU7WUFDWixNQUFNSSxXQUFXSCxXQUFXO1lBQzVCLE1BQU1qQixrREFBWSxDQUFDb0IsVUFBVUMsS0FBS0MsU0FBUyxDQUFDTixVQUFVLE1BQU07UUFDOUQ7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTU8sSUFBSVgsR0FBVyxFQUEwQjtRQUM3QyxNQUFNSyxXQUFXLElBQUksQ0FBQ04sV0FBVyxDQUFDQztRQUNsQyxJQUFJO1lBQ0YsTUFBTUcsT0FBTyxNQUFNZixpREFBVyxDQUFDaUI7WUFDL0IsT0FBT0Y7UUFDVCxFQUFFLE9BQU9OLE9BQVk7WUFDbkIsSUFBSUEsTUFBTUMsSUFBSSxLQUFLLFVBQVU7Z0JBQzNCLE9BQU87WUFDVDtZQUNBLE1BQU1EO1FBQ1I7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTWdCLE9BQU9iLEdBQVcsRUFBaUI7UUFDdkMsTUFBTUssV0FBVyxJQUFJLENBQUNOLFdBQVcsQ0FBQ0M7UUFDbEMsSUFBSTtZQUNGLE1BQU1aLCtDQUFTLENBQUNpQjtZQUNoQixZQUFZO1lBQ1osTUFBTUcsV0FBV0gsV0FBVztZQUM1QixJQUFJO2dCQUNGLE1BQU1qQiwrQ0FBUyxDQUFDb0I7WUFDbEIsRUFBRSxPQUFNO1lBQ04sZ0JBQWdCO1lBQ2xCO1FBQ0YsRUFBRSxPQUFPWCxPQUFZO1lBQ25CLElBQUlBLE1BQU1DLElBQUksS0FBSyxVQUFVO2dCQUMzQixNQUFNRDtZQUNSO1FBQ0Y7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTWtCLEtBQUtDLE1BQWMsRUFBRUMsS0FBYyxFQUFxQjtRQUM1RCxNQUFNdkIsVUFBVSxJQUFJLENBQUNLLFdBQVcsQ0FBQ2lCO1FBQ2pDLE1BQU1FLE9BQWlCLEVBQUU7UUFFekIsSUFBSTtZQUNGLFNBQVM7WUFDVCxNQUFNQyxtQkFBbUIsT0FBT0MsS0FBYUM7Z0JBQzNDLE1BQU1DLFVBQVUsTUFBTWxDLGdEQUFVLENBQUNnQyxLQUFLO29CQUFFSSxlQUFlO2dCQUFLO2dCQUM1RCxNQUFNQyxRQUFrQixFQUFFO2dCQUUxQixLQUFLLE1BQU1DLFNBQVNKLFFBQVM7b0JBQzNCLE1BQU1LLFdBQVd0QyxzQ0FBUyxDQUFDK0IsS0FBS00sTUFBTUUsSUFBSTtvQkFDMUMsTUFBTUMsZUFBZXhDLDBDQUFhLENBQUNnQyxTQUFTTTtvQkFFNUMsSUFBSUQsTUFBTUssV0FBVyxJQUFJO3dCQUN2QixNQUFNQyxXQUFXLE1BQU1iLGlCQUFpQlEsVUFBVU47d0JBQ2xESSxNQUFNUSxJQUFJLElBQUlEO29CQUNoQixPQUFPLElBQUlOLE1BQU1RLE1BQU0sTUFBTSxDQUFDUixNQUFNRSxJQUFJLENBQUNPLFFBQVEsQ0FBQyxlQUFlO3dCQUMvRFYsTUFBTVEsSUFBSSxDQUFDSjtvQkFDYjtnQkFDRjtnQkFFQSxPQUFPSjtZQUNUO1lBRUEsTUFBTVcsV0FBVyxNQUFNakIsaUJBQWlCekIsU0FBUyxJQUFJLENBQUNGLFFBQVE7WUFFOUQsZ0JBQWdCO1lBQ2hCNEMsU0FBU0MsSUFBSSxDQUFDLENBQUNDLEdBQUdDO2dCQUNoQixNQUFNQyxRQUFRbkQsMENBQWEsQ0FBQ2lEO2dCQUM1QixNQUFNSSxRQUFRckQsMENBQWEsQ0FBQ2tEO2dCQUM1QixPQUFPRyxNQUFNQyxhQUFhLENBQUNIO1lBQzdCO1lBRUEsT0FBTztZQUNQLElBQUl2QixPQUFPO2dCQUNULE9BQU9tQixTQUFTUSxLQUFLLENBQUMsR0FBRzNCO1lBQzNCO1lBRUEsT0FBT21CO1FBQ1QsRUFBRSxPQUFPdkMsT0FBWTtZQUNuQixJQUFJQSxNQUFNQyxJQUFJLEtBQUssVUFBVTtnQkFDM0IsT0FBTyxFQUFFO1lBQ1g7WUFDQSxNQUFNRDtRQUNSO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1nRCxXQUFXM0IsSUFBYyxFQUFpQjtRQUM5QyxNQUFNNEIsUUFBUUMsR0FBRyxDQUFDN0IsS0FBSzhCLEdBQUcsQ0FBQyxDQUFDaEQsTUFBUSxJQUFJLENBQUNhLE1BQU0sQ0FBQ2I7SUFDbEQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9jb3JlL3N0b3JhZ2UvbG9jYWwtZmlsZS1zdG9yYWdlLnRzPzYzMmMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFN0b3JhZ2VBZGFwdGVyIH0gZnJvbSAnLi9zdG9yYWdlLmludGVyZmFjZSc7XG5cbi8qKlxuICog5pys5Zyw5paH5Lu25a2Y5YKo5a6e546wXG4gKiDlrZjlgqjot6/lvoTvvJp7YmFzZVBhdGh9L3t3b3Jrc3BhY2VJZH0ve29iamVjdElkfS9zbmFwc2hvdF97dGltZXN0YW1wfS5nelxuICovXG5leHBvcnQgY2xhc3MgTG9jYWxGaWxlU3RvcmFnZSBpbXBsZW1lbnRzIFN0b3JhZ2VBZGFwdGVyIHtcbiAgcHJpdmF0ZSBiYXNlUGF0aDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGJhc2VQYXRoOiBzdHJpbmcgPSAnLi9zdG9yYWdlL3NuYXBzaG90cycpIHtcbiAgICB0aGlzLmJhc2VQYXRoID0gYmFzZVBhdGg7XG4gIH1cblxuICAvKipcbiAgICog56Gu5L+d55uu5b2V5a2Y5ZyoXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGVuc3VyZURpcihkaXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMubWtkaXIoZGlyUGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yLmNvZGUgIT09ICdFRVhJU1QnKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blrozmlbTmlofku7bot6/lvoRcbiAgICovXG4gIHByaXZhdGUgZ2V0RmlsZVBhdGgoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBwYXRoLmpvaW4odGhpcy5iYXNlUGF0aCwga2V5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlrZjlgqjlv6vnhafmlbDmja5cbiAgICovXG4gIGFzeW5jIHB1dChrZXk6IHN0cmluZywgZGF0YTogQnVmZmVyLCBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBmaWxlUGF0aCA9IHRoaXMuZ2V0RmlsZVBhdGgoa2V5KTtcbiAgICBjb25zdCBkaXJQYXRoID0gcGF0aC5kaXJuYW1lKGZpbGVQYXRoKTtcblxuICAgIC8vIOehruS/neebruW9leWtmOWcqFxuICAgIGF3YWl0IHRoaXMuZW5zdXJlRGlyKGRpclBhdGgpO1xuXG4gICAgLy8g5YaZ5YWl5paH5Lu2XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKGZpbGVQYXRoLCBkYXRhKTtcblxuICAgIC8vIOWmguaenOacieWFg+aVsOaNru+8jOWGmeWFpeWFg+aVsOaNruaWh+S7tlxuICAgIGlmIChtZXRhZGF0YSkge1xuICAgICAgY29uc3QgbWV0YVBhdGggPSBmaWxlUGF0aCArICcubWV0YS5qc29uJztcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZShtZXRhUGF0aCwgSlNPTi5zdHJpbmdpZnkobWV0YWRhdGEsIG51bGwsIDIpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5b+r54Wn5pWw5o2uXG4gICAqL1xuICBhc3luYyBnZXQoa2V5OiBzdHJpbmcpOiBQcm9taXNlPEJ1ZmZlciB8IG51bGw+IHtcbiAgICBjb25zdCBmaWxlUGF0aCA9IHRoaXMuZ2V0RmlsZVBhdGgoa2V5KTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKGZpbGVQYXRoKTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnRU5PRU5UJykge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTlv6vnhafmlbDmja5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZShrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGZpbGVQYXRoID0gdGhpcy5nZXRGaWxlUGF0aChrZXkpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsoZmlsZVBhdGgpO1xuICAgICAgLy8g5ZCM5pe25Yig6Zmk5YWD5pWw5o2u5paH5Lu2XG4gICAgICBjb25zdCBtZXRhUGF0aCA9IGZpbGVQYXRoICsgJy5tZXRhLmpzb24nO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZnMudW5saW5rKG1ldGFQYXRoKTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICAvLyDlv73nlaXlhYPmlbDmja7mlofku7bkuI3lrZjlnKjnmoTplJnor69cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSAhPT0gJ0VOT0VOVCcpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIl+WHuuaMh+WumuWJjee8gOeahOaJgOaciemUrlxuICAgKi9cbiAgYXN5bmMgbGlzdChwcmVmaXg6IHN0cmluZywgbGltaXQ/OiBudW1iZXIpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgZGlyUGF0aCA9IHRoaXMuZ2V0RmlsZVBhdGgocHJlZml4KTtcbiAgICBjb25zdCBrZXlzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIOmAkuW9kuivu+WPluebruW9lVxuICAgICAgY29uc3QgcmVhZERpclJlY3Vyc2l2ZSA9IGFzeW5jIChkaXI6IHN0cmluZywgYmFzZURpcjogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmdbXT4gPT4ge1xuICAgICAgICBjb25zdCBlbnRyaWVzID0gYXdhaXQgZnMucmVhZGRpcihkaXIsIHsgd2l0aEZpbGVUeXBlczogdHJ1ZSB9KTtcbiAgICAgICAgY29uc3QgZmlsZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgICAgY29uc3QgZnVsbFBhdGggPSBwYXRoLmpvaW4oZGlyLCBlbnRyeS5uYW1lKTtcbiAgICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBwYXRoLnJlbGF0aXZlKGJhc2VEaXIsIGZ1bGxQYXRoKTtcblxuICAgICAgICAgIGlmIChlbnRyeS5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICBjb25zdCBzdWJGaWxlcyA9IGF3YWl0IHJlYWREaXJSZWN1cnNpdmUoZnVsbFBhdGgsIGJhc2VEaXIpO1xuICAgICAgICAgICAgZmlsZXMucHVzaCguLi5zdWJGaWxlcyk7XG4gICAgICAgICAgfSBlbHNlIGlmIChlbnRyeS5pc0ZpbGUoKSAmJiAhZW50cnkubmFtZS5lbmRzV2l0aCgnLm1ldGEuanNvbicpKSB7XG4gICAgICAgICAgICBmaWxlcy5wdXNoKHJlbGF0aXZlUGF0aCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZpbGVzO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgYWxsRmlsZXMgPSBhd2FpdCByZWFkRGlyUmVjdXJzaXZlKGRpclBhdGgsIHRoaXMuYmFzZVBhdGgpO1xuXG4gICAgICAvLyDmjInmlofku7blkI3mjpLluo/vvIjml7bpl7TmiLPpmY3luo/vvIlcbiAgICAgIGFsbEZpbGVzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgY29uc3QgYU5hbWUgPSBwYXRoLmJhc2VuYW1lKGEpO1xuICAgICAgICBjb25zdCBiTmFtZSA9IHBhdGguYmFzZW5hbWUoYik7XG4gICAgICAgIHJldHVybiBiTmFtZS5sb2NhbGVDb21wYXJlKGFOYW1lKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyDlupTnlKjpmZDliLZcbiAgICAgIGlmIChsaW1pdCkge1xuICAgICAgICByZXR1cm4gYWxsRmlsZXMuc2xpY2UoMCwgbGltaXQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYWxsRmlsZXM7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdFTk9FTlQnKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmibnph4/liKDpmaRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZU1hbnkoa2V5czogc3RyaW5nW10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChrZXlzLm1hcCgoa2V5KSA9PiB0aGlzLmRlbGV0ZShrZXkpKSk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbImZzIiwicGF0aCIsIkxvY2FsRmlsZVN0b3JhZ2UiLCJjb25zdHJ1Y3RvciIsImJhc2VQYXRoIiwiZW5zdXJlRGlyIiwiZGlyUGF0aCIsIm1rZGlyIiwicmVjdXJzaXZlIiwiZXJyb3IiLCJjb2RlIiwiZ2V0RmlsZVBhdGgiLCJrZXkiLCJqb2luIiwicHV0IiwiZGF0YSIsIm1ldGFkYXRhIiwiZmlsZVBhdGgiLCJkaXJuYW1lIiwid3JpdGVGaWxlIiwibWV0YVBhdGgiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0IiwicmVhZEZpbGUiLCJkZWxldGUiLCJ1bmxpbmsiLCJsaXN0IiwicHJlZml4IiwibGltaXQiLCJrZXlzIiwicmVhZERpclJlY3Vyc2l2ZSIsImRpciIsImJhc2VEaXIiLCJlbnRyaWVzIiwicmVhZGRpciIsIndpdGhGaWxlVHlwZXMiLCJmaWxlcyIsImVudHJ5IiwiZnVsbFBhdGgiLCJuYW1lIiwicmVsYXRpdmVQYXRoIiwicmVsYXRpdmUiLCJpc0RpcmVjdG9yeSIsInN1YkZpbGVzIiwicHVzaCIsImlzRmlsZSIsImVuZHNXaXRoIiwiYWxsRmlsZXMiLCJzb3J0IiwiYSIsImIiLCJhTmFtZSIsImJhc2VuYW1lIiwiYk5hbWUiLCJsb2NhbGVDb21wYXJlIiwic2xpY2UiLCJkZWxldGVNYW55IiwiUHJvbWlzZSIsImFsbCIsIm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/storage/local-file-storage.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/storage/storage.factory.ts":
/*!*********************************************!*\
  !*** ./src/core/storage/storage.factory.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   StorageFactory: () => (/* binding */ StorageFactory),\n/* harmony export */   extractTimestampFromKey: () => (/* binding */ extractTimestampFromKey),\n/* harmony export */   getSnapshotKey: () => (/* binding */ getSnapshotKey),\n/* harmony export */   getSnapshotPrefix: () => (/* binding */ getSnapshotPrefix)\n/* harmony export */ });\n/* harmony import */ var _local_file_storage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./local-file-storage */ \"(rsc)/./src/core/storage/local-file-storage.ts\");\n\n/**\n * 存储工厂\n * 根据配置创建不同的存储实现\n */ class StorageFactory {\n    static{\n        this.instance = null;\n    }\n    /**\n   * 获取存储实例（单例）\n   */ static getInstance() {\n        if (!StorageFactory.instance) {\n            const storageType = process.env.STORAGE_TYPE || \"local\";\n            const basePath = process.env.STORAGE_BASE_PATH || \"./storage/snapshots\";\n            switch(storageType){\n                case \"local\":\n                    StorageFactory.instance = new _local_file_storage__WEBPACK_IMPORTED_MODULE_0__.LocalFileStorage(basePath);\n                    break;\n                case \"s3\":\n                    // TODO: 实现 S3 存储\n                    // StorageFactory.instance = new S3Storage(...);\n                    throw new Error(\"S3 storage not implemented yet\");\n                default:\n                    throw new Error(`Unknown storage type: ${storageType}`);\n            }\n        }\n        return StorageFactory.instance;\n    }\n    /**\n   * 重置实例（用于测试）\n   */ static reset() {\n        StorageFactory.instance = null;\n    }\n}\n/**\n * 生成快照存储键\n * 格式：{workspaceId}/{objectId}/snapshot_{timestamp}.gz\n */ function getSnapshotKey(workspaceId, objectId, timestamp) {\n    // 使用倒序时间戳作为文件名的一部分，便于排序\n    const reversedTimestamp = Number.MAX_SAFE_INTEGER - timestamp;\n    return `${workspaceId}/${objectId}/snapshot_${reversedTimestamp.toString(16).padStart(16, \"0\")}.gz`;\n}\n/**\n * 生成快照前缀（用于列出某个文档的所有快照）\n */ function getSnapshotPrefix(workspaceId, objectId) {\n    return `${workspaceId}/${objectId}/snapshot_`;\n}\n/**\n * 从键中提取时间戳\n */ function extractTimestampFromKey(key) {\n    const match = key.match(/snapshot_([0-9a-f]+)\\.gz$/);\n    if (!match) return null;\n    const reversedTimestamp = parseInt(match[1], 16);\n    return Number.MAX_SAFE_INTEGER - reversedTimestamp;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9zdG9yYWdlL3N0b3JhZ2UuZmFjdG9yeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUN3RDtBQUV4RDs7O0NBR0MsR0FDTSxNQUFNQzs7YUFDSUMsV0FBa0M7O0lBRWpEOztHQUVDLEdBQ0QsT0FBT0MsY0FBOEI7UUFDbkMsSUFBSSxDQUFDRixlQUFlQyxRQUFRLEVBQUU7WUFDNUIsTUFBTUUsY0FBY0MsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLElBQUk7WUFDaEQsTUFBTUMsV0FBV0gsUUFBUUMsR0FBRyxDQUFDRyxpQkFBaUIsSUFBSTtZQUVsRCxPQUFRTDtnQkFDTixLQUFLO29CQUNISCxlQUFlQyxRQUFRLEdBQUcsSUFBSUYsaUVBQWdCQSxDQUFDUTtvQkFDL0M7Z0JBQ0YsS0FBSztvQkFDSCxpQkFBaUI7b0JBQ2pCLGdEQUFnRDtvQkFDaEQsTUFBTSxJQUFJRSxNQUFNO2dCQUNsQjtvQkFDRSxNQUFNLElBQUlBLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRU4sWUFBWSxDQUFDO1lBQzFEO1FBQ0Y7UUFFQSxPQUFPSCxlQUFlQyxRQUFRO0lBQ2hDO0lBRUE7O0dBRUMsR0FDRCxPQUFPUyxRQUFjO1FBQ25CVixlQUFlQyxRQUFRLEdBQUc7SUFDNUI7QUFDRjtBQUVBOzs7Q0FHQyxHQUNNLFNBQVNVLGVBQ2RDLFdBQW1CLEVBQ25CQyxRQUFnQixFQUNoQkMsU0FBaUI7SUFFakIsd0JBQXdCO0lBQ3hCLE1BQU1DLG9CQUFvQkMsT0FBT0MsZ0JBQWdCLEdBQUdIO0lBQ3BELE9BQU8sQ0FBQyxFQUFFRixZQUFZLENBQUMsRUFBRUMsU0FBUyxVQUFVLEVBQUVFLGtCQUFrQkcsUUFBUSxDQUFDLElBQUlDLFFBQVEsQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDO0FBQ3JHO0FBRUE7O0NBRUMsR0FDTSxTQUFTQyxrQkFBa0JSLFdBQW1CLEVBQUVDLFFBQWdCO0lBQ3JFLE9BQU8sQ0FBQyxFQUFFRCxZQUFZLENBQUMsRUFBRUMsU0FBUyxVQUFVLENBQUM7QUFDL0M7QUFFQTs7Q0FFQyxHQUNNLFNBQVNRLHdCQUF3QkMsR0FBVztJQUNqRCxNQUFNQyxRQUFRRCxJQUFJQyxLQUFLLENBQUM7SUFDeEIsSUFBSSxDQUFDQSxPQUFPLE9BQU87SUFFbkIsTUFBTVIsb0JBQW9CUyxTQUFTRCxLQUFLLENBQUMsRUFBRSxFQUFFO0lBQzdDLE9BQU9QLE9BQU9DLGdCQUFnQixHQUFHRjtBQUNuQyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9jb3JlL3N0b3JhZ2Uvc3RvcmFnZS5mYWN0b3J5LnRzPzM5ZjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RvcmFnZUFkYXB0ZXIgfSBmcm9tICcuL3N0b3JhZ2UuaW50ZXJmYWNlJztcbmltcG9ydCB7IExvY2FsRmlsZVN0b3JhZ2UgfSBmcm9tICcuL2xvY2FsLWZpbGUtc3RvcmFnZSc7XG5cbi8qKlxuICog5a2Y5YKo5bel5Y6CXG4gKiDmoLnmja7phY3nva7liJvlu7rkuI3lkIznmoTlrZjlgqjlrp7njrBcbiAqL1xuZXhwb3J0IGNsYXNzIFN0b3JhZ2VGYWN0b3J5IHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFN0b3JhZ2VBZGFwdGVyIHwgbnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIOiOt+WPluWtmOWCqOWunuS+i++8iOWNleS+i++8iVxuICAgKi9cbiAgc3RhdGljIGdldEluc3RhbmNlKCk6IFN0b3JhZ2VBZGFwdGVyIHtcbiAgICBpZiAoIVN0b3JhZ2VGYWN0b3J5Lmluc3RhbmNlKSB7XG4gICAgICBjb25zdCBzdG9yYWdlVHlwZSA9IHByb2Nlc3MuZW52LlNUT1JBR0VfVFlQRSB8fCAnbG9jYWwnO1xuICAgICAgY29uc3QgYmFzZVBhdGggPSBwcm9jZXNzLmVudi5TVE9SQUdFX0JBU0VfUEFUSCB8fCAnLi9zdG9yYWdlL3NuYXBzaG90cyc7XG5cbiAgICAgIHN3aXRjaCAoc3RvcmFnZVR5cGUpIHtcbiAgICAgICAgY2FzZSAnbG9jYWwnOlxuICAgICAgICAgIFN0b3JhZ2VGYWN0b3J5Lmluc3RhbmNlID0gbmV3IExvY2FsRmlsZVN0b3JhZ2UoYmFzZVBhdGgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdzMyc6XG4gICAgICAgICAgLy8gVE9ETzog5a6e546wIFMzIOWtmOWCqFxuICAgICAgICAgIC8vIFN0b3JhZ2VGYWN0b3J5Lmluc3RhbmNlID0gbmV3IFMzU3RvcmFnZSguLi4pO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUzMgc3RvcmFnZSBub3QgaW1wbGVtZW50ZWQgeWV0Jyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHN0b3JhZ2UgdHlwZTogJHtzdG9yYWdlVHlwZX1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gU3RvcmFnZUZhY3RvcnkuaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICog6YeN572u5a6e5L6L77yI55So5LqO5rWL6K+V77yJXG4gICAqL1xuICBzdGF0aWMgcmVzZXQoKTogdm9pZCB7XG4gICAgU3RvcmFnZUZhY3RvcnkuaW5zdGFuY2UgPSBudWxsO1xuICB9XG59XG5cbi8qKlxuICog55Sf5oiQ5b+r54Wn5a2Y5YKo6ZSuXG4gKiDmoLzlvI/vvJp7d29ya3NwYWNlSWR9L3tvYmplY3RJZH0vc25hcHNob3Rfe3RpbWVzdGFtcH0uZ3pcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNuYXBzaG90S2V5KFxuICB3b3Jrc3BhY2VJZDogc3RyaW5nLFxuICBvYmplY3RJZDogc3RyaW5nLFxuICB0aW1lc3RhbXA6IG51bWJlclxuKTogc3RyaW5nIHtcbiAgLy8g5L2/55So5YCS5bqP5pe26Ze05oiz5L2c5Li65paH5Lu25ZCN55qE5LiA6YOo5YiG77yM5L6/5LqO5o6S5bqPXG4gIGNvbnN0IHJldmVyc2VkVGltZXN0YW1wID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgLSB0aW1lc3RhbXA7XG4gIHJldHVybiBgJHt3b3Jrc3BhY2VJZH0vJHtvYmplY3RJZH0vc25hcHNob3RfJHtyZXZlcnNlZFRpbWVzdGFtcC50b1N0cmluZygxNikucGFkU3RhcnQoMTYsICcwJyl9Lmd6YDtcbn1cblxuLyoqXG4gKiDnlJ/miJDlv6vnhafliY3nvIDvvIjnlKjkuo7liJflh7rmn5DkuKrmlofmoaPnmoTmiYDmnInlv6vnhafvvIlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNuYXBzaG90UHJlZml4KHdvcmtzcGFjZUlkOiBzdHJpbmcsIG9iamVjdElkOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gYCR7d29ya3NwYWNlSWR9LyR7b2JqZWN0SWR9L3NuYXBzaG90X2A7XG59XG5cbi8qKlxuICog5LuO6ZSu5Lit5o+Q5Y+W5pe26Ze05oizXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0VGltZXN0YW1wRnJvbUtleShrZXk6IHN0cmluZyk6IG51bWJlciB8IG51bGwge1xuICBjb25zdCBtYXRjaCA9IGtleS5tYXRjaCgvc25hcHNob3RfKFswLTlhLWZdKylcXC5neiQvKTtcbiAgaWYgKCFtYXRjaCkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgcmV2ZXJzZWRUaW1lc3RhbXAgPSBwYXJzZUludChtYXRjaFsxXSwgMTYpO1xuICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgLSByZXZlcnNlZFRpbWVzdGFtcDtcbn1cblxuIl0sIm5hbWVzIjpbIkxvY2FsRmlsZVN0b3JhZ2UiLCJTdG9yYWdlRmFjdG9yeSIsImluc3RhbmNlIiwiZ2V0SW5zdGFuY2UiLCJzdG9yYWdlVHlwZSIsInByb2Nlc3MiLCJlbnYiLCJTVE9SQUdFX1RZUEUiLCJiYXNlUGF0aCIsIlNUT1JBR0VfQkFTRV9QQVRIIiwiRXJyb3IiLCJyZXNldCIsImdldFNuYXBzaG90S2V5Iiwid29ya3NwYWNlSWQiLCJvYmplY3RJZCIsInRpbWVzdGFtcCIsInJldmVyc2VkVGltZXN0YW1wIiwiTnVtYmVyIiwiTUFYX1NBRkVfSU5URUdFUiIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJnZXRTbmFwc2hvdFByZWZpeCIsImV4dHJhY3RUaW1lc3RhbXBGcm9tS2V5Iiwia2V5IiwibWF0Y2giLCJwYXJzZUludCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/storage/storage.factory.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/ability-category.dao.ts":
/*!*****************************************!*\
  !*** ./src/dao/ability-category.dao.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AbilityCategoryDAO: () => (/* binding */ AbilityCategoryDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass AbilityCategoryDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 获取所有能力类别（未删除）\n   */ async findAll() {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_categories WHERE deleted_at IS NULL ORDER BY sort_order ASC, created_at ASC\", []);\n        return result.rows;\n    }\n    /**\n   * 根据 ID 查找能力类别\n   */ async findById(categoryId) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_categories WHERE category_id = $1 AND deleted_at IS NULL\", [\n            categoryId\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据代码查找能力类别\n   */ async findByCode(code) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_categories WHERE code = $1 AND deleted_at IS NULL\", [\n            code\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 创建能力类别\n   */ async create(data) {\n        const result = await this.db.query(`INSERT INTO pikun_db.ability_categories (code, name, description, sort_order, metadata)\n       VALUES ($1, $2, $3, $4, $5)\n       RETURNING *`, [\n            data.code,\n            data.name,\n            data.description || null,\n            data.sort_order || 0,\n            JSON.stringify(data.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 更新能力类别\n   */ async update(categoryId, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.code !== undefined) {\n            fields.push(`code = $${paramIndex++}`);\n            values.push(updates.code);\n        }\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.description !== undefined) {\n            fields.push(`description = $${paramIndex++}`);\n            values.push(updates.description);\n        }\n        if (updates.sort_order !== undefined) {\n            fields.push(`sort_order = $${paramIndex++}`);\n            values.push(updates.sort_order);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(categoryId);\n        }\n        values.push(categoryId);\n        const result = await this.db.query(`UPDATE pikun_db.ability_categories SET ${fields.join(\", \")} WHERE category_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING *`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除能力类别（软删除）\n   */ async delete(categoryId) {\n        await this.db.query(\"UPDATE pikun_db.ability_categories SET deleted_at = CURRENT_TIMESTAMP WHERE category_id = $1\", [\n            categoryId\n        ]);\n    }\n}\nAbilityCategoryDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"AbilityCategoryDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], AbilityCategoryDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGFvL2FiaWxpdHktY2F0ZWdvcnkuZGFvLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUEyQztBQUNvQjtBQVF4RCxNQUFNRTtJQUdYQyxhQUFjO1FBQ1osSUFBSSxDQUFDQyxFQUFFLEdBQUdKLG9EQUFRQSxDQUFDSyxXQUFXO0lBQ2hDO0lBRUE7O0dBRUMsR0FDRCxNQUFNQyxVQUFzQztRQUMxQyxNQUFNQyxTQUFTLE1BQU0sSUFBSSxDQUFDSCxFQUFFLENBQUNJLEtBQUssQ0FDaEMsOEdBQ0EsRUFBRTtRQUVKLE9BQU9ELE9BQU9FLElBQUk7SUFDcEI7SUFFQTs7R0FFQyxHQUNELE1BQU1DLFNBQVNDLFVBQWtCLEVBQW1DO1FBQ2xFLE1BQU1KLFNBQVMsTUFBTSxJQUFJLENBQUNILEVBQUUsQ0FBQ0ksS0FBSyxDQUNoQywyRkFDQTtZQUFDRztTQUFXO1FBRWQsT0FBT0osT0FBT0UsSUFBSSxDQUFDLEVBQUUsSUFBSTtJQUMzQjtJQUVBOztHQUVDLEdBQ0QsTUFBTUcsV0FBV0MsSUFBWSxFQUFtQztRQUM5RCxNQUFNTixTQUFTLE1BQU0sSUFBSSxDQUFDSCxFQUFFLENBQUNJLEtBQUssQ0FDaEMsb0ZBQ0E7WUFBQ0s7U0FBSztRQUVSLE9BQU9OLE9BQU9FLElBQUksQ0FBQyxFQUFFLElBQUk7SUFDM0I7SUFFQTs7R0FFQyxHQUNELE1BQU1LLE9BQU9DLElBTVosRUFBNEI7UUFDM0IsTUFBTVIsU0FBUyxNQUFNLElBQUksQ0FBQ0gsRUFBRSxDQUFDSSxLQUFLLENBQ2hDLENBQUM7O2tCQUVXLENBQUMsRUFDYjtZQUNFTyxLQUFLRixJQUFJO1lBQ1RFLEtBQUtDLElBQUk7WUFDVEQsS0FBS0UsV0FBVyxJQUFJO1lBQ3BCRixLQUFLRyxVQUFVLElBQUk7WUFDbkJDLEtBQUtDLFNBQVMsQ0FBQ0wsS0FBS00sUUFBUSxJQUFJLENBQUM7U0FDbEM7UUFFSCxPQUFPZCxPQUFPRSxJQUFJLENBQUMsRUFBRTtJQUN2QjtJQUVBOztHQUVDLEdBQ0QsTUFBTWEsT0FDSlgsVUFBa0IsRUFDbEJZLE9BTUMsRUFDeUI7UUFDMUIsTUFBTUMsU0FBbUIsRUFBRTtRQUMzQixNQUFNQyxTQUFnQixFQUFFO1FBQ3hCLElBQUlDLGFBQWE7UUFFakIsSUFBSUgsUUFBUVYsSUFBSSxLQUFLYyxXQUFXO1lBQzlCSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUVGLGFBQWEsQ0FBQztZQUNyQ0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRVixJQUFJO1FBQzFCO1FBQ0EsSUFBSVUsUUFBUVAsSUFBSSxLQUFLVyxXQUFXO1lBQzlCSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUVGLGFBQWEsQ0FBQztZQUNyQ0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRUCxJQUFJO1FBQzFCO1FBQ0EsSUFBSU8sUUFBUU4sV0FBVyxLQUFLVSxXQUFXO1lBQ3JDSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxlQUFlLEVBQUVGLGFBQWEsQ0FBQztZQUM1Q0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRTixXQUFXO1FBQ2pDO1FBQ0EsSUFBSU0sUUFBUUwsVUFBVSxLQUFLUyxXQUFXO1lBQ3BDSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxjQUFjLEVBQUVGLGFBQWEsQ0FBQztZQUMzQ0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRTCxVQUFVO1FBQ2hDO1FBQ0EsSUFBSUssUUFBUUYsUUFBUSxLQUFLTSxXQUFXO1lBQ2xDSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxZQUFZLEVBQUVGLGFBQWEsQ0FBQztZQUN6Q0QsT0FBT0csSUFBSSxDQUFDVCxLQUFLQyxTQUFTLENBQUNHLFFBQVFGLFFBQVE7UUFDN0M7UUFFQSxJQUFJRyxPQUFPSyxNQUFNLEtBQUssR0FBRztZQUN2QixPQUFPLElBQUksQ0FBQ25CLFFBQVEsQ0FBQ0M7UUFDdkI7UUFFQWMsT0FBT0csSUFBSSxDQUFDakI7UUFDWixNQUFNSixTQUFTLE1BQU0sSUFBSSxDQUFDSCxFQUFFLENBQUNJLEtBQUssQ0FDaEMsQ0FBQyx1Q0FBdUMsRUFBRWdCLE9BQU9NLElBQUksQ0FBQyxNQUFNLHNCQUFzQixFQUFFSixXQUFXO2tCQUNuRixDQUFDLEVBQ2JEO1FBRUYsT0FBT2xCLE9BQU9FLElBQUksQ0FBQyxFQUFFO0lBQ3ZCO0lBRUE7O0dBRUMsR0FDRCxNQUFNc0IsT0FBT3BCLFVBQWtCLEVBQWlCO1FBQzlDLE1BQU0sSUFBSSxDQUFDUCxFQUFFLENBQUNJLEtBQUssQ0FDakIsZ0dBQ0E7WUFBQ0c7U0FBVztJQUVoQjtBQUNGO0FBN0hhVCxxQkFBQUEsb0VBQUFBO0lBRFpELDRFQUFVQSxDQUFDOzs7R0FDQ0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvZGFvL2FiaWxpdHktY2F0ZWdvcnkuZGFvLnRzP2RkNjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IEFiaWxpdHlDYXRlZ29yeSB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOiDveWKm+exu+WIqyBEQU9cbiAqIOi0n+i0o+iDveWKm+exu+WIq+ebuOWFs+eahOaVsOaNruW6k+aTjeS9nO+8jOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWlXG4gKi9cbkBJbmplY3RhYmxlKCdBYmlsaXR5Q2F0ZWdvcnlEQU8nKVxuZXhwb3J0IGNsYXNzIEFiaWxpdHlDYXRlZ29yeURBTyB7XG4gIHByaXZhdGUgZGI6IERhdGFiYXNlO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZGIgPSBEYXRhYmFzZS5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaJgOacieiDveWKm+exu+WIq++8iOacquWIoOmZpO+8iVxuICAgKi9cbiAgYXN5bmMgZmluZEFsbCgpOiBQcm9taXNlPEFiaWxpdHlDYXRlZ29yeVtdPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5Q2F0ZWdvcnk+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuYWJpbGl0eV9jYXRlZ29yaWVzIFdIRVJFIGRlbGV0ZWRfYXQgSVMgTlVMTCBPUkRFUiBCWSBzb3J0X29yZGVyIEFTQywgY3JlYXRlZF9hdCBBU0MnLFxuICAgICAgW11cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93cztcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja4gSUQg5p+l5om+6IO95Yqb57G75YirXG4gICAqL1xuICBhc3luYyBmaW5kQnlJZChjYXRlZ29yeUlkOiBzdHJpbmcpOiBQcm9taXNlPEFiaWxpdHlDYXRlZ29yeSB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PEFiaWxpdHlDYXRlZ29yeT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5hYmlsaXR5X2NhdGVnb3JpZXMgV0hFUkUgY2F0ZWdvcnlfaWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFtjYXRlZ29yeUlkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u5Luj56CB5p+l5om+6IO95Yqb57G75YirXG4gICAqL1xuICBhc3luYyBmaW5kQnlDb2RlKGNvZGU6IHN0cmluZyk6IFByb21pc2U8QWJpbGl0eUNhdGVnb3J5IHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8QWJpbGl0eUNhdGVnb3J5PihcbiAgICAgICdTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmFiaWxpdHlfY2F0ZWdvcmllcyBXSEVSRSBjb2RlID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbY29kZV1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuiDveWKm+exu+WIq1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlKGRhdGE6IHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIHNvcnRfb3JkZXI/OiBudW1iZXI7XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxBYmlsaXR5Q2F0ZWdvcnk+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PEFiaWxpdHlDYXRlZ29yeT4oXG4gICAgICBgSU5TRVJUIElOVE8gcGlrdW5fZGIuYWJpbGl0eV9jYXRlZ29yaWVzIChjb2RlLCBuYW1lLCBkZXNjcmlwdGlvbiwgc29ydF9vcmRlciwgbWV0YWRhdGEpXG4gICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUpXG4gICAgICAgUkVUVVJOSU5HICpgLFxuICAgICAgW1xuICAgICAgICBkYXRhLmNvZGUsXG4gICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbiB8fCBudWxsLFxuICAgICAgICBkYXRhLnNvcnRfb3JkZXIgfHwgMCxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoZGF0YS5tZXRhZGF0YSB8fCB7fSksXG4gICAgICBdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5pu05paw6IO95Yqb57G75YirXG4gICAqL1xuICBhc3luYyB1cGRhdGUoXG4gICAgY2F0ZWdvcnlJZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IHtcbiAgICAgIGNvZGU/OiBzdHJpbmc7XG4gICAgICBuYW1lPzogc3RyaW5nO1xuICAgICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIH1cbiAgKTogUHJvbWlzZTxBYmlsaXR5Q2F0ZWdvcnk+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLmNvZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGNvZGUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmNvZGUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBuYW1lID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5uYW1lKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGRlc2NyaXB0aW9uID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5kZXNjcmlwdGlvbik7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLnNvcnRfb3JkZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYHNvcnRfb3JkZXIgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnNvcnRfb3JkZXIpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5tZXRhZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgbWV0YWRhdGEgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaChKU09OLnN0cmluZ2lmeSh1cGRhdGVzLm1ldGFkYXRhKSk7XG4gICAgfVxuXG4gICAgaWYgKGZpZWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbmRCeUlkKGNhdGVnb3J5SWQpIGFzIFByb21pc2U8QWJpbGl0eUNhdGVnb3J5PjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaChjYXRlZ29yeUlkKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PEFiaWxpdHlDYXRlZ29yeT4oXG4gICAgICBgVVBEQVRFIHBpa3VuX2RiLmFiaWxpdHlfY2F0ZWdvcmllcyBTRVQgJHtmaWVsZHMuam9pbignLCAnKX0gV0hFUkUgY2F0ZWdvcnlfaWQgPSAkJHtwYXJhbUluZGV4fSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMXG4gICAgICAgUkVUVVJOSU5HICpgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk6IO95Yqb57G75Yir77yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUoY2F0ZWdvcnlJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5kYi5xdWVyeShcbiAgICAgICdVUERBVEUgcGlrdW5fZGIuYWJpbGl0eV9jYXRlZ29yaWVzIFNFVCBkZWxldGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgY2F0ZWdvcnlfaWQgPSAkMScsXG4gICAgICBbY2F0ZWdvcnlJZF1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJEYXRhYmFzZSIsIkluamVjdGFibGUiLCJBYmlsaXR5Q2F0ZWdvcnlEQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJmaW5kQWxsIiwicmVzdWx0IiwicXVlcnkiLCJyb3dzIiwiZmluZEJ5SWQiLCJjYXRlZ29yeUlkIiwiZmluZEJ5Q29kZSIsImNvZGUiLCJjcmVhdGUiLCJkYXRhIiwibmFtZSIsImRlc2NyaXB0aW9uIiwic29ydF9vcmRlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXRhZGF0YSIsInVwZGF0ZSIsInVwZGF0ZXMiLCJmaWVsZHMiLCJ2YWx1ZXMiLCJwYXJhbUluZGV4IiwidW5kZWZpbmVkIiwicHVzaCIsImxlbmd0aCIsImpvaW4iLCJkZWxldGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/ability-category.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/ability-dimension.dao.ts":
/*!******************************************!*\
  !*** ./src/dao/ability-dimension.dao.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AbilityDimensionDAO: () => (/* binding */ AbilityDimensionDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass AbilityDimensionDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 获取所有能力维度（未删除）\n   */ async findAll(categoryId) {\n        if (categoryId) {\n            const result = await this.db.query(\"SELECT * FROM pikun_db.ability_dimensions WHERE category_id = $1 AND deleted_at IS NULL ORDER BY sort_order ASC, created_at ASC\", [\n                categoryId\n            ]);\n            return result.rows;\n        }\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_dimensions WHERE deleted_at IS NULL ORDER BY sort_order ASC, created_at ASC\", []);\n        return result.rows;\n    }\n    /**\n   * 根据 ID 查找能力维度\n   */ async findById(dimensionId) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_dimensions WHERE dimension_id = $1 AND deleted_at IS NULL\", [\n            dimensionId\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据类别ID和代码查找能力维度\n   */ async findByCategoryAndCode(categoryId, code) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_dimensions WHERE category_id = $1 AND code = $2 AND deleted_at IS NULL\", [\n            categoryId,\n            code\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 创建能力维度\n   */ async create(data) {\n        const result = await this.db.query(`INSERT INTO pikun_db.ability_dimensions (category_id, code, name, description, sort_order, metadata)\n       VALUES ($1, $2, $3, $4, $5, $6)\n       RETURNING *`, [\n            data.category_id,\n            data.code,\n            data.name,\n            data.description || null,\n            data.sort_order || 0,\n            JSON.stringify(data.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 更新能力维度\n   */ async update(dimensionId, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.code !== undefined) {\n            fields.push(`code = $${paramIndex++}`);\n            values.push(updates.code);\n        }\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.description !== undefined) {\n            fields.push(`description = $${paramIndex++}`);\n            values.push(updates.description);\n        }\n        if (updates.sort_order !== undefined) {\n            fields.push(`sort_order = $${paramIndex++}`);\n            values.push(updates.sort_order);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(dimensionId);\n        }\n        values.push(dimensionId);\n        const result = await this.db.query(`UPDATE pikun_db.ability_dimensions SET ${fields.join(\", \")} WHERE dimension_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING *`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除能力维度（软删除）\n   */ async delete(dimensionId) {\n        await this.db.query(\"UPDATE pikun_db.ability_dimensions SET deleted_at = CURRENT_TIMESTAMP WHERE dimension_id = $1\", [\n            dimensionId\n        ]);\n    }\n}\nAbilityDimensionDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"AbilityDimensionDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], AbilityDimensionDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGFvL2FiaWxpdHktZGltZW5zaW9uLmRhby50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBMkM7QUFDb0I7QUFReEQsTUFBTUU7SUFHWEMsYUFBYztRQUNaLElBQUksQ0FBQ0MsRUFBRSxHQUFHSixvREFBUUEsQ0FBQ0ssV0FBVztJQUNoQztJQUVBOztHQUVDLEdBQ0QsTUFBTUMsUUFBUUMsVUFBbUIsRUFBK0I7UUFDOUQsSUFBSUEsWUFBWTtZQUNkLE1BQU1DLFNBQVMsTUFBTSxJQUFJLENBQUNKLEVBQUUsQ0FBQ0ssS0FBSyxDQUNoQyxtSUFDQTtnQkFBQ0Y7YUFBVztZQUVkLE9BQU9DLE9BQU9FLElBQUk7UUFDcEI7UUFDQSxNQUFNRixTQUFTLE1BQU0sSUFBSSxDQUFDSixFQUFFLENBQUNLLEtBQUssQ0FDaEMsOEdBQ0EsRUFBRTtRQUVKLE9BQU9ELE9BQU9FLElBQUk7SUFDcEI7SUFFQTs7R0FFQyxHQUNELE1BQU1DLFNBQVNDLFdBQW1CLEVBQW9DO1FBQ3BFLE1BQU1KLFNBQVMsTUFBTSxJQUFJLENBQUNKLEVBQUUsQ0FBQ0ssS0FBSyxDQUNoQyw0RkFDQTtZQUFDRztTQUFZO1FBRWYsT0FBT0osT0FBT0UsSUFBSSxDQUFDLEVBQUUsSUFBSTtJQUMzQjtJQUVBOztHQUVDLEdBQ0QsTUFBTUcsc0JBQXNCTixVQUFrQixFQUFFTyxJQUFZLEVBQW9DO1FBQzlGLE1BQU1OLFNBQVMsTUFBTSxJQUFJLENBQUNKLEVBQUUsQ0FBQ0ssS0FBSyxDQUNoQyx5R0FDQTtZQUFDRjtZQUFZTztTQUFLO1FBRXBCLE9BQU9OLE9BQU9FLElBQUksQ0FBQyxFQUFFLElBQUk7SUFDM0I7SUFFQTs7R0FFQyxHQUNELE1BQU1LLE9BQU9DLElBT1osRUFBNkI7UUFDNUIsTUFBTVIsU0FBUyxNQUFNLElBQUksQ0FBQ0osRUFBRSxDQUFDSyxLQUFLLENBQ2hDLENBQUM7O2tCQUVXLENBQUMsRUFDYjtZQUNFTyxLQUFLQyxXQUFXO1lBQ2hCRCxLQUFLRixJQUFJO1lBQ1RFLEtBQUtFLElBQUk7WUFDVEYsS0FBS0csV0FBVyxJQUFJO1lBQ3BCSCxLQUFLSSxVQUFVLElBQUk7WUFDbkJDLEtBQUtDLFNBQVMsQ0FBQ04sS0FBS08sUUFBUSxJQUFJLENBQUM7U0FDbEM7UUFFSCxPQUFPZixPQUFPRSxJQUFJLENBQUMsRUFBRTtJQUN2QjtJQUVBOztHQUVDLEdBQ0QsTUFBTWMsT0FDSlosV0FBbUIsRUFDbkJhLE9BTUMsRUFDMEI7UUFDM0IsTUFBTUMsU0FBbUIsRUFBRTtRQUMzQixNQUFNQyxTQUFnQixFQUFFO1FBQ3hCLElBQUlDLGFBQWE7UUFFakIsSUFBSUgsUUFBUVgsSUFBSSxLQUFLZSxXQUFXO1lBQzlCSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUVGLGFBQWEsQ0FBQztZQUNyQ0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRWCxJQUFJO1FBQzFCO1FBQ0EsSUFBSVcsUUFBUVAsSUFBSSxLQUFLVyxXQUFXO1lBQzlCSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUVGLGFBQWEsQ0FBQztZQUNyQ0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRUCxJQUFJO1FBQzFCO1FBQ0EsSUFBSU8sUUFBUU4sV0FBVyxLQUFLVSxXQUFXO1lBQ3JDSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxlQUFlLEVBQUVGLGFBQWEsQ0FBQztZQUM1Q0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRTixXQUFXO1FBQ2pDO1FBQ0EsSUFBSU0sUUFBUUwsVUFBVSxLQUFLUyxXQUFXO1lBQ3BDSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxjQUFjLEVBQUVGLGFBQWEsQ0FBQztZQUMzQ0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRTCxVQUFVO1FBQ2hDO1FBQ0EsSUFBSUssUUFBUUYsUUFBUSxLQUFLTSxXQUFXO1lBQ2xDSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxZQUFZLEVBQUVGLGFBQWEsQ0FBQztZQUN6Q0QsT0FBT0csSUFBSSxDQUFDVCxLQUFLQyxTQUFTLENBQUNHLFFBQVFGLFFBQVE7UUFDN0M7UUFFQSxJQUFJRyxPQUFPSyxNQUFNLEtBQUssR0FBRztZQUN2QixPQUFPLElBQUksQ0FBQ3BCLFFBQVEsQ0FBQ0M7UUFDdkI7UUFFQWUsT0FBT0csSUFBSSxDQUFDbEI7UUFDWixNQUFNSixTQUFTLE1BQU0sSUFBSSxDQUFDSixFQUFFLENBQUNLLEtBQUssQ0FDaEMsQ0FBQyx1Q0FBdUMsRUFBRWlCLE9BQU9NLElBQUksQ0FBQyxNQUFNLHVCQUF1QixFQUFFSixXQUFXO2tCQUNwRixDQUFDLEVBQ2JEO1FBRUYsT0FBT25CLE9BQU9FLElBQUksQ0FBQyxFQUFFO0lBQ3ZCO0lBRUE7O0dBRUMsR0FDRCxNQUFNdUIsT0FBT3JCLFdBQW1CLEVBQWlCO1FBQy9DLE1BQU0sSUFBSSxDQUFDUixFQUFFLENBQUNLLEtBQUssQ0FDakIsaUdBQ0E7WUFBQ0c7U0FBWTtJQUVqQjtBQUNGO0FBdElhVixzQkFBQUEsb0VBQUFBO0lBRFpELDRFQUFVQSxDQUFDOzs7R0FDQ0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvZGFvL2FiaWxpdHktZGltZW5zaW9uLmRhby50cz84OGY0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSAnQC9jb3JlL2RhdGFiYXNlJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAL2RlY29yYXRvcnMvaW5qZWN0YWJsZS5kZWNvcmF0b3InO1xuaW1wb3J0IHR5cGUgeyBBYmlsaXR5RGltZW5zaW9uIH0gZnJvbSAnQC9lbnRpdGllcyc7XG5cbi8qKlxuICog6IO95Yqb57u05bqmIERBT1xuICog6LSf6LSj6IO95Yqb57u05bqm55u45YWz55qE5pWw5o2u5bqT5pON5L2c77yM5L2/55So5Y+C5pWw5YyW5p+l6K+i6Ziy5q2iIFNRTCDms6jlhaVcbiAqL1xuQEluamVjdGFibGUoJ0FiaWxpdHlEaW1lbnNpb25EQU8nKVxuZXhwb3J0IGNsYXNzIEFiaWxpdHlEaW1lbnNpb25EQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmiYDmnInog73lipvnu7TluqbvvIjmnKrliKDpmaTvvIlcbiAgICovXG4gIGFzeW5jIGZpbmRBbGwoY2F0ZWdvcnlJZD86IHN0cmluZyk6IFByb21pc2U8QWJpbGl0eURpbWVuc2lvbltdPiB7XG4gICAgaWYgKGNhdGVnb3J5SWQpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8QWJpbGl0eURpbWVuc2lvbj4oXG4gICAgICAgICdTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmFiaWxpdHlfZGltZW5zaW9ucyBXSEVSRSBjYXRlZ29yeV9pZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwgT1JERVIgQlkgc29ydF9vcmRlciBBU0MsIGNyZWF0ZWRfYXQgQVNDJyxcbiAgICAgICAgW2NhdGVnb3J5SWRdXG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PEFiaWxpdHlEaW1lbnNpb24+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuYWJpbGl0eV9kaW1lbnNpb25zIFdIRVJFIGRlbGV0ZWRfYXQgSVMgTlVMTCBPUkRFUiBCWSBzb3J0X29yZGVyIEFTQywgY3JlYXRlZF9hdCBBU0MnLFxuICAgICAgW11cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93cztcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja4gSUQg5p+l5om+6IO95Yqb57u05bqmXG4gICAqL1xuICBhc3luYyBmaW5kQnlJZChkaW1lbnNpb25JZDogc3RyaW5nKTogUHJvbWlzZTxBYmlsaXR5RGltZW5zaW9uIHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8QWJpbGl0eURpbWVuc2lvbj4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5hYmlsaXR5X2RpbWVuc2lvbnMgV0hFUkUgZGltZW5zaW9uX2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbZGltZW5zaW9uSWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7nsbvliKtJROWSjOS7o+eggeafpeaJvuiDveWKm+e7tOW6plxuICAgKi9cbiAgYXN5bmMgZmluZEJ5Q2F0ZWdvcnlBbmRDb2RlKGNhdGVnb3J5SWQ6IHN0cmluZywgY29kZTogc3RyaW5nKTogUHJvbWlzZTxBYmlsaXR5RGltZW5zaW9uIHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8QWJpbGl0eURpbWVuc2lvbj4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5hYmlsaXR5X2RpbWVuc2lvbnMgV0hFUkUgY2F0ZWdvcnlfaWQgPSAkMSBBTkQgY29kZSA9ICQyIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW2NhdGVnb3J5SWQsIGNvZGVdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rog73lipvnu7TluqZcbiAgICovXG4gIGFzeW5jIGNyZWF0ZShkYXRhOiB7XG4gICAgY2F0ZWdvcnlfaWQ6IHN0cmluZztcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIHNvcnRfb3JkZXI/OiBudW1iZXI7XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxBYmlsaXR5RGltZW5zaW9uPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5RGltZW5zaW9uPihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi5hYmlsaXR5X2RpbWVuc2lvbnMgKGNhdGVnb3J5X2lkLCBjb2RlLCBuYW1lLCBkZXNjcmlwdGlvbiwgc29ydF9vcmRlciwgbWV0YWRhdGEpXG4gICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2KVxuICAgICAgIFJFVFVSTklORyAqYCxcbiAgICAgIFtcbiAgICAgICAgZGF0YS5jYXRlZ29yeV9pZCxcbiAgICAgICAgZGF0YS5jb2RlLFxuICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24gfHwgbnVsbCxcbiAgICAgICAgZGF0YS5zb3J0X29yZGVyIHx8IDAsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGRhdGEubWV0YWRhdGEgfHwge30pLFxuICAgICAgXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOiDveWKm+e7tOW6plxuICAgKi9cbiAgYXN5bmMgdXBkYXRlKFxuICAgIGRpbWVuc2lvbklkOiBzdHJpbmcsXG4gICAgdXBkYXRlczoge1xuICAgICAgY29kZT86IHN0cmluZztcbiAgICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICAgIHNvcnRfb3JkZXI/OiBudW1iZXI7XG4gICAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gICAgfVxuICApOiBQcm9taXNlPEFiaWxpdHlEaW1lbnNpb24+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLmNvZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGNvZGUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmNvZGUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBuYW1lID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5uYW1lKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGRlc2NyaXB0aW9uID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5kZXNjcmlwdGlvbik7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLnNvcnRfb3JkZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYHNvcnRfb3JkZXIgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnNvcnRfb3JkZXIpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5tZXRhZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgbWV0YWRhdGEgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaChKU09OLnN0cmluZ2lmeSh1cGRhdGVzLm1ldGFkYXRhKSk7XG4gICAgfVxuXG4gICAgaWYgKGZpZWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbmRCeUlkKGRpbWVuc2lvbklkKSBhcyBQcm9taXNlPEFiaWxpdHlEaW1lbnNpb24+O1xuICAgIH1cblxuICAgIHZhbHVlcy5wdXNoKGRpbWVuc2lvbklkKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PEFiaWxpdHlEaW1lbnNpb24+KFxuICAgICAgYFVQREFURSBwaWt1bl9kYi5hYmlsaXR5X2RpbWVuc2lvbnMgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIGRpbWVuc2lvbl9pZCA9ICQke3BhcmFtSW5kZXh9IEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICB2YWx1ZXNcbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTog73lipvnu7TluqbvvIjova/liKDpmaTvvIlcbiAgICovXG4gIGFzeW5jIGRlbGV0ZShkaW1lbnNpb25JZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5kYi5xdWVyeShcbiAgICAgICdVUERBVEUgcGlrdW5fZGIuYWJpbGl0eV9kaW1lbnNpb25zIFNFVCBkZWxldGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgZGltZW5zaW9uX2lkID0gJDEnLFxuICAgICAgW2RpbWVuc2lvbklkXVxuICAgICk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIkRhdGFiYXNlIiwiSW5qZWN0YWJsZSIsIkFiaWxpdHlEaW1lbnNpb25EQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJmaW5kQWxsIiwiY2F0ZWdvcnlJZCIsInJlc3VsdCIsInF1ZXJ5Iiwicm93cyIsImZpbmRCeUlkIiwiZGltZW5zaW9uSWQiLCJmaW5kQnlDYXRlZ29yeUFuZENvZGUiLCJjb2RlIiwiY3JlYXRlIiwiZGF0YSIsImNhdGVnb3J5X2lkIiwibmFtZSIsImRlc2NyaXB0aW9uIiwic29ydF9vcmRlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXRhZGF0YSIsInVwZGF0ZSIsInVwZGF0ZXMiLCJmaWVsZHMiLCJ2YWx1ZXMiLCJwYXJhbUluZGV4IiwidW5kZWZpbmVkIiwicHVzaCIsImxlbmd0aCIsImpvaW4iLCJkZWxldGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/ability-dimension.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/ability-item-level-config.dao.ts":
/*!**************************************************!*\
  !*** ./src/dao/ability-item-level-config.dao.ts ***!
  \**************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AbilityItemLevelConfigDAO: () => (/* binding */ AbilityItemLevelConfigDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass AbilityItemLevelConfigDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 规范化数字字段（PostgreSQL BIGINT 可能返回为字符串）\n   */ normalizeLevelConfig(config) {\n        return {\n            ...config,\n            level: Number(config.level),\n            required_exp: Number(config.required_exp)\n        };\n    }\n    /**\n   * 获取所有等级配置\n   */ async findAll(itemId) {\n        if (itemId) {\n            const result = await this.db.query(\"SELECT * FROM pikun_db.ability_item_level_configs WHERE item_id = $1 ORDER BY level ASC\", [\n                itemId\n            ]);\n            return result.rows.map((row)=>this.normalizeLevelConfig(row));\n        }\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_item_level_configs ORDER BY level ASC\", []);\n        return result.rows.map((row)=>this.normalizeLevelConfig(row));\n    }\n    /**\n   * 获取全局模板配置\n   */ async findTemplate() {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_item_level_configs WHERE is_template = true ORDER BY level ASC\", []);\n        return result.rows.map((row)=>this.normalizeLevelConfig(row));\n    }\n    /**\n   * 根据 ID 查找等级配置\n   */ async findById(configId) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_item_level_configs WHERE config_id = $1\", [\n            configId\n        ]);\n        return result.rows[0] ? this.normalizeLevelConfig(result.rows[0]) : null;\n    }\n    /**\n   * 根据能力项ID和等级查找配置\n   */ async findByItemAndLevel(itemId, level) {\n        if (itemId === null) {\n            const result = await this.db.query(\"SELECT * FROM pikun_db.ability_item_level_configs WHERE item_id IS NULL AND level = $1 AND is_template = true\", [\n                level\n            ]);\n            return result.rows[0] ? this.normalizeLevelConfig(result.rows[0]) : null;\n        }\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_item_level_configs WHERE item_id = $1 AND level = $2\", [\n            itemId,\n            level\n        ]);\n        return result.rows[0] ? this.normalizeLevelConfig(result.rows[0]) : null;\n    }\n    /**\n   * 获取能力项的等级配置（优先返回独立配置，否则返回模板）\n   */ async getConfigForItem(itemId, level) {\n        // 先查找独立配置\n        const itemConfig = await this.findByItemAndLevel(itemId, level);\n        if (itemConfig) {\n            return itemConfig;\n        }\n        // 如果没有独立配置，返回模板\n        return this.findByItemAndLevel(null, level);\n    }\n    /**\n   * 创建等级配置\n   * 数据库约束：如果 item_id IS NULL，则 is_template 必须是 true\n   *           如果 item_id IS NOT NULL，则 is_template 必须是 false\n   */ async create(data) {\n        // 确定 item_id 的值（null 或具体值）\n        const itemId = data.item_id || null;\n        // 根据 item_id 确定 is_template 的值\n        // 如果 item_id 为 null，则必须是模板（is_template = true）\n        // 如果 item_id 有值，则不是模板（is_template = false）\n        const isTemplate = itemId === null;\n        const result = await this.db.query(`INSERT INTO pikun_db.ability_item_level_configs (\n        item_id, level, required_exp, requires_assessment, level_name, level_description,\n        is_template, sort_order, metadata\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)\n       RETURNING *`, [\n            itemId,\n            data.level,\n            data.required_exp,\n            data.requires_assessment || false,\n            data.level_name || null,\n            data.level_description || null,\n            isTemplate,\n            data.sort_order || data.level,\n            JSON.stringify(data.metadata || {})\n        ]);\n        return this.normalizeLevelConfig(result.rows[0]);\n    }\n    /**\n   * 批量创建等级配置\n   */ async createBatch(configs) {\n        const results = [];\n        for (const config of configs){\n            const result = await this.create(config);\n            results.push(result);\n        }\n        return results;\n    }\n    /**\n   * 更新等级配置\n   */ async update(configId, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.level !== undefined) {\n            fields.push(`level = $${paramIndex++}`);\n            values.push(updates.level);\n        }\n        if (updates.required_exp !== undefined) {\n            fields.push(`required_exp = $${paramIndex++}`);\n            values.push(updates.required_exp);\n        }\n        if (updates.requires_assessment !== undefined) {\n            fields.push(`requires_assessment = $${paramIndex++}`);\n            values.push(updates.requires_assessment);\n        }\n        if (updates.level_name !== undefined) {\n            fields.push(`level_name = $${paramIndex++}`);\n            values.push(updates.level_name);\n        }\n        if (updates.level_description !== undefined) {\n            fields.push(`level_description = $${paramIndex++}`);\n            values.push(updates.level_description);\n        }\n        if (updates.sort_order !== undefined) {\n            fields.push(`sort_order = $${paramIndex++}`);\n            values.push(updates.sort_order);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(configId);\n        }\n        values.push(configId);\n        const result = await this.db.query(`UPDATE pikun_db.ability_item_level_configs SET ${fields.join(\", \")} WHERE config_id = $${paramIndex}\n       RETURNING *`, values);\n        return this.normalizeLevelConfig(result.rows[0]);\n    }\n    /**\n   * 删除等级配置\n   */ async delete(configId) {\n        await this.db.query(\"DELETE FROM pikun_db.ability_item_level_configs WHERE config_id = $1\", [\n            configId\n        ]);\n    }\n    /**\n   * 将模板配置复制到指定能力项\n   * 如果能力项已有该等级的配置，则跳过（不覆盖）\n   * @returns 返回创建的配置数组，如果所有配置都已存在则返回空数组\n   */ async copyTemplateToItem(itemId) {\n        const templateConfigs = await this.findTemplate();\n        if (templateConfigs.length === 0) {\n            throw new Error(\"全局模板不存在，请先创建全局模板\");\n        }\n        const results = [];\n        for (const template of templateConfigs){\n            // 检查是否已存在该等级的配置\n            const existing = await this.findByItemAndLevel(itemId, template.level);\n            if (existing) {\n                continue;\n            }\n            // 创建新配置\n            const result = await this.create({\n                item_id: itemId,\n                level: template.level,\n                required_exp: template.required_exp,\n                requires_assessment: template.requires_assessment,\n                level_name: template.level_name,\n                level_description: template.level_description,\n                is_template: false,\n                sort_order: template.sort_order,\n                metadata: template.metadata\n            });\n            results.push(result);\n        }\n        return results;\n    }\n}\nAbilityItemLevelConfigDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"AbilityItemLevelConfigDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], AbilityItemLevelConfigDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGFvL2FiaWxpdHktaXRlbS1sZXZlbC1jb25maWcuZGFvLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUEyQztBQUNvQjtBQVF4RCxNQUFNRTtJQUdYQyxhQUFjO1FBQ1osSUFBSSxDQUFDQyxFQUFFLEdBQUdKLG9EQUFRQSxDQUFDSyxXQUFXO0lBQ2hDO0lBRUE7O0dBRUMsR0FDRCxxQkFBNkJFLE1BQThCLEVBQTBCO1FBQ25GLE9BQU87WUFDTCxHQUFHQSxNQUFNO1lBQ1RDLE9BQU9DLE9BQU9GLE9BQU9DLEtBQUs7WUFDMUJFLGNBQWNELE9BQU9GLE9BQU9HLFlBQVk7UUFDMUM7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTUMsUUFBUUMsTUFBZSxFQUFxQztRQUNoRSxJQUFJQSxRQUFRO1lBQ1YsTUFBTUMsU0FBUyxNQUFNLElBQUksQ0FBQ1QsRUFBRSxDQUFDVSxLQUFLLENBQ2hDLDJGQUNBO2dCQUFDRjthQUFPO1lBRVYsT0FBT0MsT0FBT0UsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQ0MsTUFBUSxJQUFJLENBQUNYLG9CQUFvQixDQUFDVztRQUM1RDtRQUNBLE1BQU1KLFNBQVMsTUFBTSxJQUFJLENBQUNULEVBQUUsQ0FBQ1UsS0FBSyxDQUNoQyx3RUFDQSxFQUFFO1FBRUosT0FBT0QsT0FBT0UsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQ0MsTUFBUSxJQUFJLENBQUNYLG9CQUFvQixDQUFDVztJQUM1RDtJQUVBOztHQUVDLEdBQ0QsTUFBTUMsZUFBa0Q7UUFDdEQsTUFBTUwsU0FBUyxNQUFNLElBQUksQ0FBQ1QsRUFBRSxDQUFDVSxLQUFLLENBQ2hDLGlHQUNBLEVBQUU7UUFFSixPQUFPRCxPQUFPRSxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDQyxNQUFRLElBQUksQ0FBQ1gsb0JBQW9CLENBQUNXO0lBQzVEO0lBRUE7O0dBRUMsR0FDRCxNQUFNRSxTQUFTQyxRQUFnQixFQUEwQztRQUN2RSxNQUFNUCxTQUFTLE1BQU0s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ci8uL3NyYy9kYW8vYWJpbGl0eS1pdGVtLWxldmVsLWNvbmZpZy5kYW8udHM/ZTczYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gJ0AvY29yZS9kYXRhYmFzZSc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQC9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yJztcbmltcG9ydCB0eXBlIHsgQWJpbGl0eUl0ZW1MZXZlbENvbmZpZyB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOiDveWKm+mhueetiee6p+mFjee9riBEQU9cbiAqIOi0n+i0o+iDveWKm+mhueetiee6p+mFjee9ruebuOWFs+eahOaVsOaNruW6k+aTjeS9nO+8jOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWlXG4gKi9cbkBJbmplY3RhYmxlKCdBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPJylcbmV4cG9ydCBjbGFzcyBBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPIHtcbiAgcHJpdmF0ZSBkYjogRGF0YWJhc2U7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5kYiA9IERhdGFiYXNlLmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog6KeE6IyD5YyW5pWw5a2X5a2X5q6177yIUG9zdGdyZVNRTCBCSUdJTlQg5Y+v6IO96L+U5Zue5Li65a2X56ym5Liy77yJXG4gICAqL1xuICBwcml2YXRlIG5vcm1hbGl6ZUxldmVsQ29uZmlnKGNvbmZpZzogQWJpbGl0eUl0ZW1MZXZlbENvbmZpZyk6IEFiaWxpdHlJdGVtTGV2ZWxDb25maWcge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBsZXZlbDogTnVtYmVyKGNvbmZpZy5sZXZlbCksXG4gICAgICByZXF1aXJlZF9leHA6IE51bWJlcihjb25maWcucmVxdWlyZWRfZXhwKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaJgOacieetiee6p+mFjee9rlxuICAgKi9cbiAgYXN5bmMgZmluZEFsbChpdGVtSWQ/OiBzdHJpbmcpOiBQcm9taXNlPEFiaWxpdHlJdGVtTGV2ZWxDb25maWdbXT4ge1xuICAgIGlmIChpdGVtSWQpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZz4oXG4gICAgICAgICdTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmFiaWxpdHlfaXRlbV9sZXZlbF9jb25maWdzIFdIRVJFIGl0ZW1faWQgPSAkMSBPUkRFUiBCWSBsZXZlbCBBU0MnLFxuICAgICAgICBbaXRlbUlkXVxuICAgICAgKTtcbiAgICAgIHJldHVybiByZXN1bHQucm93cy5tYXAoKHJvdykgPT4gdGhpcy5ub3JtYWxpemVMZXZlbENvbmZpZyhyb3cpKTtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5SXRlbUxldmVsQ29uZmlnPihcbiAgICAgICdTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmFiaWxpdHlfaXRlbV9sZXZlbF9jb25maWdzIE9SREVSIEJZIGxldmVsIEFTQycsXG4gICAgICBbXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzLm1hcCgocm93KSA9PiB0aGlzLm5vcm1hbGl6ZUxldmVsQ29uZmlnKHJvdykpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWFqOWxgOaooeadv+mFjee9rlxuICAgKi9cbiAgYXN5bmMgZmluZFRlbXBsYXRlKCk6IFByb21pc2U8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZ1tdPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5SXRlbUxldmVsQ29uZmlnPihcbiAgICAgICdTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmFiaWxpdHlfaXRlbV9sZXZlbF9jb25maWdzIFdIRVJFIGlzX3RlbXBsYXRlID0gdHJ1ZSBPUkRFUiBCWSBsZXZlbCBBU0MnLFxuICAgICAgW11cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93cy5tYXAoKHJvdykgPT4gdGhpcy5ub3JtYWxpemVMZXZlbENvbmZpZyhyb3cpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja4gSUQg5p+l5om+562J57qn6YWN572uXG4gICAqL1xuICBhc3luYyBmaW5kQnlJZChjb25maWdJZDogc3RyaW5nKTogUHJvbWlzZTxBYmlsaXR5SXRlbUxldmVsQ29uZmlnIHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZz4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5hYmlsaXR5X2l0ZW1fbGV2ZWxfY29uZmlncyBXSEVSRSBjb25maWdfaWQgPSAkMScsXG4gICAgICBbY29uZmlnSWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gPyB0aGlzLm5vcm1hbGl6ZUxldmVsQ29uZmlnKHJlc3VsdC5yb3dzWzBdKSA6IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u6IO95Yqb6aG5SUTlkoznrYnnuqfmn6Xmib7phY3nva5cbiAgICovXG4gIGFzeW5jIGZpbmRCeUl0ZW1BbmRMZXZlbChpdGVtSWQ6IHN0cmluZyB8IG51bGwsIGxldmVsOiBudW1iZXIpOiBQcm9taXNlPEFiaWxpdHlJdGVtTGV2ZWxDb25maWcgfCBudWxsPiB7XG4gICAgaWYgKGl0ZW1JZCA9PT0gbnVsbCkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5SXRlbUxldmVsQ29uZmlnPihcbiAgICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuYWJpbGl0eV9pdGVtX2xldmVsX2NvbmZpZ3MgV0hFUkUgaXRlbV9pZCBJUyBOVUxMIEFORCBsZXZlbCA9ICQxIEFORCBpc190ZW1wbGF0ZSA9IHRydWUnLFxuICAgICAgICBbbGV2ZWxdXG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdID8gdGhpcy5ub3JtYWxpemVMZXZlbENvbmZpZyhyZXN1bHQucm93c1swXSkgOiBudWxsO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PEFiaWxpdHlJdGVtTGV2ZWxDb25maWc+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuYWJpbGl0eV9pdGVtX2xldmVsX2NvbmZpZ3MgV0hFUkUgaXRlbV9pZCA9ICQxIEFORCBsZXZlbCA9ICQyJyxcbiAgICAgIFtpdGVtSWQsIGxldmVsXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdID8gdGhpcy5ub3JtYWxpemVMZXZlbENvbmZpZyhyZXN1bHQucm93c1swXSkgOiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluiDveWKm+mhueeahOetiee6p+mFjee9ru+8iOS8mOWFiOi/lOWbnueLrOeri+mFjee9ru+8jOWQpuWImei/lOWbnuaooeadv++8iVxuICAgKi9cbiAgYXN5bmMgZ2V0Q29uZmlnRm9ySXRlbShpdGVtSWQ6IHN0cmluZywgbGV2ZWw6IG51bWJlcik6IFByb21pc2U8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZyB8IG51bGw+IHtcbiAgICAvLyDlhYjmn6Xmib7ni6znq4vphY3nva5cbiAgICBjb25zdCBpdGVtQ29uZmlnID0gYXdhaXQgdGhpcy5maW5kQnlJdGVtQW5kTGV2ZWwoaXRlbUlkLCBsZXZlbCk7XG4gICAgaWYgKGl0ZW1Db25maWcpIHtcbiAgICAgIHJldHVybiBpdGVtQ29uZmlnO1xuICAgIH1cbiAgICAvLyDlpoLmnpzmsqHmnInni6znq4vphY3nva7vvIzov5Tlm57mqKHmnb9cbiAgICByZXR1cm4gdGhpcy5maW5kQnlJdGVtQW5kTGV2ZWwobnVsbCwgbGV2ZWwpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuetiee6p+mFjee9rlxuICAgKiDmlbDmja7lupPnuqbmnZ/vvJrlpoLmnpwgaXRlbV9pZCBJUyBOVUxM77yM5YiZIGlzX3RlbXBsYXRlIOW/hemhu+aYryB0cnVlXG4gICAqICAgICAgICAgICDlpoLmnpwgaXRlbV9pZCBJUyBOT1QgTlVMTO+8jOWImSBpc190ZW1wbGF0ZSDlv4XpobvmmK8gZmFsc2VcbiAgICovXG4gIGFzeW5jIGNyZWF0ZShkYXRhOiB7XG4gICAgaXRlbV9pZD86IHN0cmluZyB8IG51bGw7XG4gICAgbGV2ZWw6IG51bWJlcjtcbiAgICByZXF1aXJlZF9leHA6IG51bWJlcjtcbiAgICByZXF1aXJlc19hc3Nlc3NtZW50PzogYm9vbGVhbjtcbiAgICBsZXZlbF9uYW1lPzogc3RyaW5nO1xuICAgIGxldmVsX2Rlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIGlzX3RlbXBsYXRlPzogYm9vbGVhbjtcbiAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZz4ge1xuICAgIC8vIOehruWumiBpdGVtX2lkIOeahOWAvO+8iG51bGwg5oiW5YW35L2T5YC877yJXG4gICAgY29uc3QgaXRlbUlkID0gZGF0YS5pdGVtX2lkIHx8IG51bGw7XG4gICAgXG4gICAgLy8g5qC55o2uIGl0ZW1faWQg56Gu5a6aIGlzX3RlbXBsYXRlIOeahOWAvFxuICAgIC8vIOWmguaenCBpdGVtX2lkIOS4uiBudWxs77yM5YiZ5b+F6aG75piv5qih5p2/77yIaXNfdGVtcGxhdGUgPSB0cnVl77yJXG4gICAgLy8g5aaC5p6cIGl0ZW1faWQg5pyJ5YC877yM5YiZ5LiN5piv5qih5p2/77yIaXNfdGVtcGxhdGUgPSBmYWxzZe+8iVxuICAgIGNvbnN0IGlzVGVtcGxhdGUgPSBpdGVtSWQgPT09IG51bGw7XG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5SXRlbUxldmVsQ29uZmlnPihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi5hYmlsaXR5X2l0ZW1fbGV2ZWxfY29uZmlncyAoXG4gICAgICAgIGl0ZW1faWQsIGxldmVsLCByZXF1aXJlZF9leHAsIHJlcXVpcmVzX2Fzc2Vzc21lbnQsIGxldmVsX25hbWUsIGxldmVsX2Rlc2NyaXB0aW9uLFxuICAgICAgICBpc190ZW1wbGF0ZSwgc29ydF9vcmRlciwgbWV0YWRhdGFcbiAgICAgICkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgsICQ5KVxuICAgICAgIFJFVFVSTklORyAqYCxcbiAgICAgIFtcbiAgICAgICAgaXRlbUlkLFxuICAgICAgICBkYXRhLmxldmVsLFxuICAgICAgICBkYXRhLnJlcXVpcmVkX2V4cCxcbiAgICAgICAgZGF0YS5yZXF1aXJlc19hc3Nlc3NtZW50IHx8IGZhbHNlLFxuICAgICAgICBkYXRhLmxldmVsX25hbWUgfHwgbnVsbCxcbiAgICAgICAgZGF0YS5sZXZlbF9kZXNjcmlwdGlvbiB8fCBudWxsLFxuICAgICAgICBpc1RlbXBsYXRlLFxuICAgICAgICBkYXRhLnNvcnRfb3JkZXIgfHwgZGF0YS5sZXZlbCxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoZGF0YS5tZXRhZGF0YSB8fCB7fSksXG4gICAgICBdXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5ub3JtYWxpemVMZXZlbENvbmZpZyhyZXN1bHQucm93c1swXSk7XG4gIH1cblxuICAvKipcbiAgICog5om56YeP5Yib5bu6562J57qn6YWN572uXG4gICAqL1xuICBhc3luYyBjcmVhdGVCYXRjaChjb25maWdzOiBBcnJheTx7XG4gICAgaXRlbV9pZD86IHN0cmluZyB8IG51bGw7XG4gICAgbGV2ZWw6IG51bWJlcjtcbiAgICByZXF1aXJlZF9leHA6IG51bWJlcjtcbiAgICByZXF1aXJlc19hc3Nlc3NtZW50PzogYm9vbGVhbjtcbiAgICBsZXZlbF9uYW1lPzogc3RyaW5nO1xuICAgIGxldmVsX2Rlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIGlzX3RlbXBsYXRlPzogYm9vbGVhbjtcbiAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfT4pOiBQcm9taXNlPEFiaWxpdHlJdGVtTGV2ZWxDb25maWdbXT4ge1xuICAgIGNvbnN0IHJlc3VsdHM6IEFiaWxpdHlJdGVtTGV2ZWxDb25maWdbXSA9IFtdO1xuICAgIGZvciAoY29uc3QgY29uZmlnIG9mIGNvbmZpZ3MpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY3JlYXRlKGNvbmZpZyk7XG4gICAgICByZXN1bHRzLnB1c2gocmVzdWx0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICAvKipcbiAgICog5pu05paw562J57qn6YWN572uXG4gICAqL1xuICBhc3luYyB1cGRhdGUoXG4gICAgY29uZmlnSWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICBsZXZlbD86IG51bWJlcjtcbiAgICAgIHJlcXVpcmVkX2V4cD86IG51bWJlcjtcbiAgICAgIHJlcXVpcmVzX2Fzc2Vzc21lbnQ/OiBib29sZWFuO1xuICAgICAgbGV2ZWxfbmFtZT86IHN0cmluZztcbiAgICAgIGxldmVsX2Rlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgICAgc29ydF9vcmRlcj86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZz4ge1xuICAgIGNvbnN0IGZpZWxkczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCB2YWx1ZXM6IGFueVtdID0gW107XG4gICAgbGV0IHBhcmFtSW5kZXggPSAxO1xuXG4gICAgaWYgKHVwZGF0ZXMubGV2ZWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGxldmVsID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5sZXZlbCk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLnJlcXVpcmVkX2V4cCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgcmVxdWlyZWRfZXhwID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5yZXF1aXJlZF9leHApO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5yZXF1aXJlc19hc3Nlc3NtZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGByZXF1aXJlc19hc3Nlc3NtZW50ID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5yZXF1aXJlc19hc3Nlc3NtZW50KTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubGV2ZWxfbmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgbGV2ZWxfbmFtZSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMubGV2ZWxfbmFtZSk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLmxldmVsX2Rlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBsZXZlbF9kZXNjcmlwdGlvbiA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMubGV2ZWxfZGVzY3JpcHRpb24pO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5zb3J0X29yZGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBzb3J0X29yZGVyID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5zb3J0X29yZGVyKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlJZChjb25maWdJZCkgYXMgUHJvbWlzZTxBYmlsaXR5SXRlbUxldmVsQ29uZmlnPjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaChjb25maWdJZCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5SXRlbUxldmVsQ29uZmlnPihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIuYWJpbGl0eV9pdGVtX2xldmVsX2NvbmZpZ3MgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIGNvbmZpZ19pZCA9ICQke3BhcmFtSW5kZXh9XG4gICAgICAgUkVUVVJOSU5HICpgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5ub3JtYWxpemVMZXZlbENvbmZpZyhyZXN1bHQucm93c1swXSk7XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk562J57qn6YWN572uXG4gICAqL1xuICBhc3luYyBkZWxldGUoY29uZmlnSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuZGIucXVlcnkoXG4gICAgICAnREVMRVRFIEZST00gcGlrdW5fZGIuYWJpbGl0eV9pdGVtX2xldmVsX2NvbmZpZ3MgV0hFUkUgY29uZmlnX2lkID0gJDEnLFxuICAgICAgW2NvbmZpZ0lkXVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICog5bCG5qih5p2/6YWN572u5aSN5Yi25Yiw5oyH5a6a6IO95Yqb6aG5XG4gICAqIOWmguaenOiDveWKm+mhueW3suacieivpeetiee6p+eahOmFjee9ru+8jOWImei3s+i/h++8iOS4jeimhueblu+8iVxuICAgKiBAcmV0dXJucyDov5Tlm57liJvlu7rnmoTphY3nva7mlbDnu4TvvIzlpoLmnpzmiYDmnInphY3nva7pg73lt7LlrZjlnKjliJnov5Tlm57nqbrmlbDnu4RcbiAgICovXG4gIGFzeW5jIGNvcHlUZW1wbGF0ZVRvSXRlbShpdGVtSWQ6IHN0cmluZyk6IFByb21pc2U8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZ1tdPiB7XG4gICAgY29uc3QgdGVtcGxhdGVDb25maWdzID0gYXdhaXQgdGhpcy5maW5kVGVtcGxhdGUoKTtcbiAgICBpZiAodGVtcGxhdGVDb25maWdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCflhajlsYDmqKHmnb/kuI3lrZjlnKjvvIzor7flhYjliJvlu7rlhajlsYDmqKHmnb8nKTtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0czogQWJpbGl0eUl0ZW1MZXZlbENvbmZpZ1tdID0gW107XG4gICAgZm9yIChjb25zdCB0ZW1wbGF0ZSBvZiB0ZW1wbGF0ZUNvbmZpZ3MpIHtcbiAgICAgIC8vIOajgOafpeaYr+WQpuW3suWtmOWcqOivpeetiee6p+eahOmFjee9rlxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0aGlzLmZpbmRCeUl0ZW1BbmRMZXZlbChpdGVtSWQsIHRlbXBsYXRlLmxldmVsKTtcbiAgICAgIGlmIChleGlzdGluZykge1xuICAgICAgICAvLyDlpoLmnpzlt7LlrZjlnKjvvIzot7Pov4fvvIjkuI3opobnm5bvvIlcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICAvLyDliJvlu7rmlrDphY3nva5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY3JlYXRlKHtcbiAgICAgICAgaXRlbV9pZDogaXRlbUlkLFxuICAgICAgICBsZXZlbDogdGVtcGxhdGUubGV2ZWwsXG4gICAgICAgIHJlcXVpcmVkX2V4cDogdGVtcGxhdGUucmVxdWlyZWRfZXhwLFxuICAgICAgICByZXF1aXJlc19hc3Nlc3NtZW50OiB0ZW1wbGF0ZS5yZXF1aXJlc19hc3Nlc3NtZW50LFxuICAgICAgICBsZXZlbF9uYW1lOiB0ZW1wbGF0ZS5sZXZlbF9uYW1lLFxuICAgICAgICBsZXZlbF9kZXNjcmlwdGlvbjogdGVtcGxhdGUubGV2ZWxfZGVzY3JpcHRpb24sXG4gICAgICAgIGlzX3RlbXBsYXRlOiBmYWxzZSxcbiAgICAgICAgc29ydF9vcmRlcjogdGVtcGxhdGUuc29ydF9vcmRlcixcbiAgICAgICAgbWV0YWRhdGE6IHRlbXBsYXRlLm1ldGFkYXRhLFxuICAgICAgfSk7XG4gICAgICByZXN1bHRzLnB1c2gocmVzdWx0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIkRhdGFiYXNlIiwiSW5qZWN0YWJsZSIsIkFiaWxpdHlJdGVtTGV2ZWxDb25maWdEQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJub3JtYWxpemVMZXZlbENvbmZpZyIsImNvbmZpZyIsImxldmVsIiwiTnVtYmVyIiwicmVxdWlyZWRfZXhwIiwiZmluZEFsbCIsIml0ZW1JZCIsInJlc3VsdCIsInF1ZXJ5Iiwicm93cyIsIm1hcCIsInJvdyIsImZpbmRUZW1wbGF0ZSIsImZpbmRCeUlkIiwiY29uZmlnSWQiLCJmaW5kQnlJdGVtQW5kTGV2ZWwiLCJnZXRDb25maWdGb3JJdGVtIiwiaXRlbUNvbmZpZyIsImNyZWF0ZSIsImRhdGEiLCJpdGVtX2lkIiwiaXNUZW1wbGF0ZSIsInJlcXVpcmVzX2Fzc2Vzc21lbnQiLCJsZXZlbF9uYW1lIiwibGV2ZWxfZGVzY3JpcHRpb24iLCJzb3J0X29yZGVyIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwiY3JlYXRlQmF0Y2giLCJjb25maWdzIiwicmVzdWx0cyIsInB1c2giLCJ1cGRhdGUiLCJ1cGRhdGVzIiwiZmllbGRzIiwidmFsdWVzIiwicGFyYW1JbmRleCIsInVuZGVmaW5lZCIsImxlbmd0aCIsImpvaW4iLCJkZWxldGUiLCJjb3B5VGVtcGxhdGVUb0l0ZW0iLCJ0ZW1wbGF0ZUNvbmZpZ3MiLCJFcnJvciIsInRlbXBsYXRlIiwiZXhpc3RpbmciLCJpc190ZW1wbGF0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/ability-item-level-config.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/ability-item.dao.ts":
/*!*************************************!*\
  !*** ./src/dao/ability-item.dao.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AbilityItemDAO: () => (/* binding */ AbilityItemDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass AbilityItemDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 获取所有能力项（未删除）\n   */ async findAll(dimensionId) {\n        if (dimensionId) {\n            const result = await this.db.query(\"SELECT * FROM pikun_db.ability_items WHERE dimension_id = $1 AND deleted_at IS NULL ORDER BY sort_order ASC, created_at ASC\", [\n                dimensionId\n            ]);\n            return result.rows;\n        }\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_items WHERE deleted_at IS NULL ORDER BY sort_order ASC, created_at ASC\", []);\n        return result.rows;\n    }\n    /**\n   * 根据 ID 查找能力项\n   */ async findById(itemId) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_items WHERE item_id = $1 AND deleted_at IS NULL\", [\n            itemId\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据维度ID和代码查找能力项\n   */ async findByDimensionAndCode(dimensionId, code) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.ability_items WHERE dimension_id = $1 AND code = $2 AND deleted_at IS NULL\", [\n            dimensionId,\n            code\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 创建能力项\n   */ async create(data) {\n        // 如果没有提供占比，默认各 50%\n        const talentRatio = data.talent_ratio ?? 50.00;\n        const acquiredTrainingRatio = data.acquired_training_ratio ?? 50.00;\n        const result = await this.db.query(`INSERT INTO pikun_db.ability_items (\n        dimension_id, code, name, description, definition, performance_description,\n        evaluation_points, training_strategies, theoretical_basis, talent_ratio, acquired_training_ratio, sort_order, metadata\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13)\n       RETURNING *`, [\n            data.dimension_id,\n            data.code,\n            data.name,\n            data.description || null,\n            data.definition || null,\n            data.performance_description || null,\n            data.evaluation_points || null,\n            data.training_strategies || null,\n            data.theoretical_basis || null,\n            talentRatio,\n            acquiredTrainingRatio,\n            data.sort_order || 0,\n            JSON.stringify(data.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 更新能力项\n   */ async update(itemId, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.code !== undefined) {\n            fields.push(`code = $${paramIndex++}`);\n            values.push(updates.code);\n        }\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.description !== undefined) {\n            fields.push(`description = $${paramIndex++}`);\n            values.push(updates.description);\n        }\n        if (updates.definition !== undefined) {\n            fields.push(`definition = $${paramIndex++}`);\n            values.push(updates.definition);\n        }\n        if (updates.performance_description !== undefined) {\n            fields.push(`performance_description = $${paramIndex++}`);\n            values.push(updates.performance_description);\n        }\n        if (updates.evaluation_points !== undefined) {\n            fields.push(`evaluation_points = $${paramIndex++}`);\n            values.push(updates.evaluation_points);\n        }\n        if (updates.training_strategies !== undefined) {\n            fields.push(`training_strategies = $${paramIndex++}`);\n            values.push(updates.training_strategies);\n        }\n        if (updates.theoretical_basis !== undefined) {\n            fields.push(`theoretical_basis = $${paramIndex++}`);\n            values.push(updates.theoretical_basis);\n        }\n        if (updates.talent_ratio !== undefined) {\n            fields.push(`talent_ratio = $${paramIndex++}`);\n            values.push(updates.talent_ratio);\n        }\n        if (updates.acquired_training_ratio !== undefined) {\n            fields.push(`acquired_training_ratio = $${paramIndex++}`);\n            values.push(updates.acquired_training_ratio);\n        }\n        if (updates.sort_order !== undefined) {\n            fields.push(`sort_order = $${paramIndex++}`);\n            values.push(updates.sort_order);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(itemId);\n        }\n        values.push(itemId);\n        const result = await this.db.query(`UPDATE pikun_db.ability_items SET ${fields.join(\", \")} WHERE item_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING *`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除能力项（软删除）\n   */ async delete(itemId) {\n        await this.db.query(\"UPDATE pikun_db.ability_items SET deleted_at = CURRENT_TIMESTAMP WHERE item_id = $1\", [\n            itemId\n        ]);\n    }\n}\nAbilityItemDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"AbilityItemDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], AbilityItemDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxjQUFjLEVBQUVGLGFBQWEsQ0FBQztZQUMzQ0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRTCxVQUFVO1FBQ2hDO1FBQ0EsSUFBSUssUUFBUUYsUUFBUSxLQUFLTSxXQUFXO1lBQ2xDSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxZQUFZLEVBQUVGLGFBQWEsQ0FBQztZQUN6Q0QsT0FBT0csSUFBSSxDQUFDVCxLQUFLQyxTQUFTLENBQUNHLFFBQVFGLFFBQVE7UUFDN0M7UUFFQSxJQUFJRyxPQUFPSyxNQUFNLEtBQUssR0FBRztZQUN2QixPQUFPLElBQUksQ0FBQzdCLFFBQVEsQ0FBQ0M7UUFDdkI7UUFFQXdCLE9BQU9HLElBQUksQ0FBQzNCO1FBQ1osTUFBTUosU0FBUyxNQUFNLElBQUksQ0FBQ0osRUFBRSxDQUFDSyxLQUFLLENBQ2hDLENBQUMsa0NBQWtDLEVBQUUwQixPQUFPTSxJQUFJLENBQUMsTUFBTSxrQkFBa0IsRUFBRUosV0FBVztrQkFDMUUsQ0FBQyxFQUNiRDtRQUVGLE9BQU81QixPQUFPRSxJQUFJLENBQUMsRUFBRTtJQUN2QjtJQUVBOztHQUVDLEdBQ0QsTUFBTWdDLE9BQU85QixNQUFjLEVBQWlCO1FBQzFDLE1BQU0sSUFBSSxDQUFDUixFQUFFLENBQUNLLEtBQUssQ0FDakIsdUZBQ0E7WUFBQ0c7U0FBTztJQUVaO0FBQ0Y7QUE3TGFWLGlCQUFBQSxvRUFBQUE7SUFEWkQsNEVBQVVBLENBQUM7OztHQUNDQyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9kYW8vYWJpbGl0eS1pdGVtLmRhby50cz84NzhjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSAnQC9jb3JlL2RhdGFiYXNlJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAL2RlY29yYXRvcnMvaW5qZWN0YWJsZS5kZWNvcmF0b3InO1xuaW1wb3J0IHR5cGUgeyBBYmlsaXR5SXRlbSB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOiDveWKm+mhuSBEQU9cbiAqIOi0n+i0o+iDveWKm+mhueebuOWFs+eahOaVsOaNruW6k+aTjeS9nO+8jOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWlXG4gKi9cbkBJbmplY3RhYmxlKCdBYmlsaXR5SXRlbURBTycpXG5leHBvcnQgY2xhc3MgQWJpbGl0eUl0ZW1EQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmiYDmnInog73lipvpobnvvIjmnKrliKDpmaTvvIlcbiAgICovXG4gIGFzeW5jIGZpbmRBbGwoZGltZW5zaW9uSWQ/OiBzdHJpbmcpOiBQcm9taXNlPEFiaWxpdHlJdGVtW10+IHtcbiAgICBpZiAoZGltZW5zaW9uSWQpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8QWJpbGl0eUl0ZW0+KFxuICAgICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5hYmlsaXR5X2l0ZW1zIFdIRVJFIGRpbWVuc2lvbl9pZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwgT1JERVIgQlkgc29ydF9vcmRlciBBU0MsIGNyZWF0ZWRfYXQgQVNDJyxcbiAgICAgICAgW2RpbWVuc2lvbklkXVxuICAgICAgKTtcbiAgICAgIHJldHVybiByZXN1bHQucm93cztcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5SXRlbT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5hYmlsaXR5X2l0ZW1zIFdIRVJFIGRlbGV0ZWRfYXQgSVMgTlVMTCBPUkRFUiBCWSBzb3J0X29yZGVyIEFTQywgY3JlYXRlZF9hdCBBU0MnLFxuICAgICAgW11cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93cztcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja4gSUQg5p+l5om+6IO95Yqb6aG5XG4gICAqL1xuICBhc3luYyBmaW5kQnlJZChpdGVtSWQ6IHN0cmluZyk6IFByb21pc2U8QWJpbGl0eUl0ZW0gfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5SXRlbT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5hYmlsaXR5X2l0ZW1zIFdIRVJFIGl0ZW1faWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFtpdGVtSWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7nu7TluqZJROWSjOS7o+eggeafpeaJvuiDveWKm+mhuVxuICAgKi9cbiAgYXN5bmMgZmluZEJ5RGltZW5zaW9uQW5kQ29kZShkaW1lbnNpb25JZDogc3RyaW5nLCBjb2RlOiBzdHJpbmcpOiBQcm9taXNlPEFiaWxpdHlJdGVtIHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8QWJpbGl0eUl0ZW0+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuYWJpbGl0eV9pdGVtcyBXSEVSRSBkaW1lbnNpb25faWQgPSAkMSBBTkQgY29kZSA9ICQyIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW2RpbWVuc2lvbklkLCBjb2RlXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu66IO95Yqb6aG5XG4gICAqL1xuICBhc3luYyBjcmVhdGUoZGF0YToge1xuICAgIGRpbWVuc2lvbl9pZDogc3RyaW5nO1xuICAgIGNvZGU6IHN0cmluZztcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgZGVmaW5pdGlvbj86IHN0cmluZztcbiAgICBwZXJmb3JtYW5jZV9kZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICBldmFsdWF0aW9uX3BvaW50cz86IHN0cmluZztcbiAgICB0cmFpbmluZ19zdHJhdGVnaWVzPzogc3RyaW5nO1xuICAgIHRoZW9yZXRpY2FsX2Jhc2lzPzogc3RyaW5nO1xuICAgIHRhbGVudF9yYXRpbz86IG51bWJlcjtcbiAgICBhY3F1aXJlZF90cmFpbmluZ19yYXRpbz86IG51bWJlcjtcbiAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8QWJpbGl0eUl0ZW0+IHtcbiAgICAvLyDlpoLmnpzmsqHmnInmj5DkvpvljaDmr5TvvIzpu5jorqTlkIQgNTAlXG4gICAgY29uc3QgdGFsZW50UmF0aW8gPSBkYXRhLnRhbGVudF9yYXRpbyA/PyA1MC4wMDtcbiAgICBjb25zdCBhY3F1aXJlZFRyYWluaW5nUmF0aW8gPSBkYXRhLmFjcXVpcmVkX3RyYWluaW5nX3JhdGlvID8/IDUwLjAwO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5SXRlbT4oXG4gICAgICBgSU5TRVJUIElOVE8gcGlrdW5fZGIuYWJpbGl0eV9pdGVtcyAoXG4gICAgICAgIGRpbWVuc2lvbl9pZCwgY29kZSwgbmFtZSwgZGVzY3JpcHRpb24sIGRlZmluaXRpb24sIHBlcmZvcm1hbmNlX2Rlc2NyaXB0aW9uLFxuICAgICAgICBldmFsdWF0aW9uX3BvaW50cywgdHJhaW5pbmdfc3RyYXRlZ2llcywgdGhlb3JldGljYWxfYmFzaXMsIHRhbGVudF9yYXRpbywgYWNxdWlyZWRfdHJhaW5pbmdfcmF0aW8sIHNvcnRfb3JkZXIsIG1ldGFkYXRhXG4gICAgICApIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4LCAkOSwgJDEwLCAkMTEsICQxMiwgJDEzKVxuICAgICAgIFJFVFVSTklORyAqYCxcbiAgICAgIFtcbiAgICAgICAgZGF0YS5kaW1lbnNpb25faWQsXG4gICAgICAgIGRhdGEuY29kZSxcbiAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uIHx8IG51bGwsXG4gICAgICAgIGRhdGEuZGVmaW5pdGlvbiB8fCBudWxsLFxuICAgICAgICBkYXRhLnBlcmZvcm1hbmNlX2Rlc2NyaXB0aW9uIHx8IG51bGwsXG4gICAgICAgIGRhdGEuZXZhbHVhdGlvbl9wb2ludHMgfHwgbnVsbCxcbiAgICAgICAgZGF0YS50cmFpbmluZ19zdHJhdGVnaWVzIHx8IG51bGwsXG4gICAgICAgIGRhdGEudGhlb3JldGljYWxfYmFzaXMgfHwgbnVsbCxcbiAgICAgICAgdGFsZW50UmF0aW8sXG4gICAgICAgIGFjcXVpcmVkVHJhaW5pbmdSYXRpbyxcbiAgICAgICAgZGF0YS5zb3J0X29yZGVyIHx8IDAsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGRhdGEubWV0YWRhdGEgfHwge30pLFxuICAgICAgXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOiDveWKm+mhuVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlKFxuICAgIGl0ZW1JZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IHtcbiAgICAgIGNvZGU/OiBzdHJpbmc7XG4gICAgICBuYW1lPzogc3RyaW5nO1xuICAgICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgICBkZWZpbml0aW9uPzogc3RyaW5nO1xuICAgICAgcGVyZm9ybWFuY2VfZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgICBldmFsdWF0aW9uX3BvaW50cz86IHN0cmluZztcbiAgICAgIHRyYWluaW5nX3N0cmF0ZWdpZXM/OiBzdHJpbmc7XG4gICAgICB0aGVvcmV0aWNhbF9iYXNpcz86IHN0cmluZztcbiAgICAgIHRhbGVudF9yYXRpbz86IG51bWJlcjtcbiAgICAgIGFjcXVpcmVkX3RyYWluaW5nX3JhdGlvPzogbnVtYmVyO1xuICAgICAgc29ydF9vcmRlcj86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8QWJpbGl0eUl0ZW0+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLmNvZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGNvZGUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmNvZGUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBuYW1lID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5uYW1lKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGRlc2NyaXB0aW9uID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5kZXNjcmlwdGlvbik7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLmRlZmluaXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGRlZmluaXRpb24gPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmRlZmluaXRpb24pO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5wZXJmb3JtYW5jZV9kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgcGVyZm9ybWFuY2VfZGVzY3JpcHRpb24gPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnBlcmZvcm1hbmNlX2Rlc2NyaXB0aW9uKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuZXZhbHVhdGlvbl9wb2ludHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGV2YWx1YXRpb25fcG9pbnRzID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5ldmFsdWF0aW9uX3BvaW50cyk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLnRyYWluaW5nX3N0cmF0ZWdpZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYHRyYWluaW5nX3N0cmF0ZWdpZXMgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnRyYWluaW5nX3N0cmF0ZWdpZXMpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy50aGVvcmV0aWNhbF9iYXNpcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgdGhlb3JldGljYWxfYmFzaXMgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnRoZW9yZXRpY2FsX2Jhc2lzKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMudGFsZW50X3JhdGlvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGB0YWxlbnRfcmF0aW8gPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnRhbGVudF9yYXRpbyk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLmFjcXVpcmVkX3RyYWluaW5nX3JhdGlvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBhY3F1aXJlZF90cmFpbmluZ19yYXRpbyA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMuYWNxdWlyZWRfdHJhaW5pbmdfcmF0aW8pO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5zb3J0X29yZGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBzb3J0X29yZGVyID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5zb3J0X29yZGVyKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlJZChpdGVtSWQpIGFzIFByb21pc2U8QWJpbGl0eUl0ZW0+O1xuICAgIH1cblxuICAgIHZhbHVlcy5wdXNoKGl0ZW1JZCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxBYmlsaXR5SXRlbT4oXG4gICAgICBgVVBEQVRFIHBpa3VuX2RiLmFiaWxpdHlfaXRlbXMgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIGl0ZW1faWQgPSAkJHtwYXJhbUluZGV4fSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMXG4gICAgICAgUkVUVVJOSU5HICpgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk6IO95Yqb6aG577yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUoaXRlbUlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi5hYmlsaXR5X2l0ZW1zIFNFVCBkZWxldGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgaXRlbV9pZCA9ICQxJyxcbiAgICAgIFtpdGVtSWRdXG4gICAgKTtcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiRGF0YWJhc2UiLCJJbmplY3RhYmxlIiwiQWJpbGl0eUl0ZW1EQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJmaW5kQWxsIiwiZGltZW5zaW9uSWQiLCJyZXN1bHQiLCJxdWVyeSIsInJvd3MiLCJmaW5kQnlJZCIsIml0ZW1JZCIsImZpbmRCeURpbWVuc2lvbkFuZENvZGUiLCJjb2RlIiwiY3JlYXRlIiwiZGF0YSIsInRhbGVudFJhdGlvIiwidGFsZW50X3JhdGlvIiwiYWNxdWlyZWRUcmFpbmluZ1JhdGlvIiwiYWNxdWlyZWRfdHJhaW5pbmdfcmF0aW8iLCJkaW1lbnNpb25faWQiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJkZWZpbml0aW9uIiwicGVyZm9ybWFuY2VfZGVzY3JpcHRpb24iLCJldmFsdWF0aW9uX3BvaW50cyIsInRyYWluaW5nX3N0cmF0ZWdpZXMiLCJ0aGVvcmV0aWNhbF9iYXNpcyIsInNvcnRfb3JkZXIiLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YWRhdGEiLCJ1cGRhdGUiLCJ1cGRhdGVzIiwiZmllbGRzIiwidmFsdWVzIiwicGFyYW1JbmRleCIsInVuZGVmaW5lZCIsInB1c2giLCJsZW5ndGgiLCJqb2luIiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/ability-item.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/document-change.dao.ts":
/*!****************************************!*\
  !*** ./src/dao/document-change.dao.ts ***!
  \****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentChangeDAO: () => (/* binding */ DocumentChangeDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! uuid */ \"(rsc)/../../node_modules/uuid/dist/esm-node/v4.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_1__]);\n_core_database__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nclass DocumentChangeDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_1__.Database.getInstance();\n    }\n    /**\n   * 创建变更记录\n   */ async create(change) {\n        const created_at = Date.now();\n        const result = await this.db.query(`INSERT INTO pikun_db.document_changes (\n        change_id, object_id, workspace_id, snapshot_id, change_type, \n        change_data, before_state_vector, after_state_vector, change_size, metadata, created_at\n      )\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\n      RETURNING *`, [\n            (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(),\n            change.object_id,\n            change.workspace_id,\n            change.snapshot_id || null,\n            change.change_type,\n            change.change_data,\n            change.before_state_vector || null,\n            change.after_state_vector || null,\n            change.change_data.length,\n            JSON.stringify(change.metadata || {}),\n            created_at\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 获取文档的变更列表\n   */ async findByObjectId(object_id, options = {}) {\n        const { limit = 100, offset = 0, after_snapshot_id } = options;\n        let query = `\n      SELECT COUNT(*) as count \n      FROM pikun_db.document_changes \n      WHERE object_id = $1\n    `;\n        const countParams = [\n            object_id\n        ];\n        if (after_snapshot_id) {\n            query += ` AND created_at > (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $2)`;\n            countParams.push(after_snapshot_id);\n        }\n        const countResult = await this.db.query(query, countParams);\n        const total = parseInt(countResult.rows[0].count, 10);\n        let listQuery = `\n      SELECT * FROM pikun_db.document_changes\n      WHERE object_id = $1\n    `;\n        const listParams = [\n            object_id\n        ];\n        if (after_snapshot_id) {\n            listQuery += ` AND created_at > (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $2)`;\n            listParams.push(after_snapshot_id);\n        }\n        listQuery += ` ORDER BY created_at ASC LIMIT $${listParams.length + 1} OFFSET $${listParams.length + 2}`;\n        listParams.push(limit, offset);\n        const result = await this.db.query(listQuery, listParams);\n        return {\n            changes: result.rows,\n            total\n        };\n    }\n    /**\n   * 获取两个快照之间的变更\n   */ async getChangesBetweenSnapshots(object_id, from_snapshot_id, to_snapshot_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_changes\n       WHERE object_id = $1\n         AND created_at > (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $2)\n         AND created_at <= (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $3)\n       ORDER BY created_at ASC`, [\n            object_id,\n            from_snapshot_id,\n            to_snapshot_id\n        ]);\n        return result.rows;\n    }\n    /**\n   * 删除文档的所有变更记录\n   */ async deleteByObjectId(object_id) {\n        await this.db.query(\"DELETE FROM pikun_db.document_changes WHERE object_id = $1\", [\n            object_id\n        ]);\n    }\n}\nDocumentChangeDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_0__.Injectable)(\"DocumentChangeDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [])\n], DocumentChangeDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cmMvZGFvL2RvY3VtZW50LWNoYW5nZS5kYW8udHM/ZjVlNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQC9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yJztcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSAnQC9jb3JlL2RhdGFiYXNlJztcbmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gJ3V1aWQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIERvY3VtZW50Q2hhbmdlIHtcbiAgY2hhbmdlX2lkOiBzdHJpbmc7XG4gIG9iamVjdF9pZDogc3RyaW5nO1xuICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgc25hcHNob3RfaWQ6IHN0cmluZyB8IG51bGw7XG4gIGNoYW5nZV90eXBlOiAnYXV0b19zYXZlJyB8ICdtYW51YWxfc2F2ZSc7XG4gIGNoYW5nZV9kYXRhOiBCdWZmZXI7XG4gIGJlZm9yZV9zdGF0ZV92ZWN0b3I6IEJ1ZmZlciB8IG51bGw7XG4gIGFmdGVyX3N0YXRlX3ZlY3RvcjogQnVmZmVyIHwgbnVsbDtcbiAgY2hhbmdlX3NpemU6IG51bWJlcjtcbiAgbWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIGNyZWF0ZWRfYXQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiDmlofmoaPlj5jmm7Tml6Xlv5cgREFPXG4gKi9cbkBJbmplY3RhYmxlKCdEb2N1bWVudENoYW5nZURBTycpXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRDaGFuZ2VEQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlj5jmm7TorrDlvZVcbiAgICovXG4gIGFzeW5jIGNyZWF0ZShjaGFuZ2U6IHtcbiAgICBvYmplY3RfaWQ6IHN0cmluZztcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgICBzbmFwc2hvdF9pZD86IHN0cmluZyB8IG51bGw7XG4gICAgY2hhbmdlX3R5cGU6ICdhdXRvX3NhdmUnIHwgJ21hbnVhbF9zYXZlJztcbiAgICBjaGFuZ2VfZGF0YTogQnVmZmVyO1xuICAgIGJlZm9yZV9zdGF0ZV92ZWN0b3I/OiBCdWZmZXIgfCBudWxsO1xuICAgIGFmdGVyX3N0YXRlX3ZlY3Rvcj86IEJ1ZmZlciB8IG51bGw7XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxEb2N1bWVudENoYW5nZT4ge1xuICAgIGNvbnN0IGNyZWF0ZWRfYXQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRDaGFuZ2U+KFxuICAgICAgYElOU0VSVCBJTlRPIHBpa3VuX2RiLmRvY3VtZW50X2NoYW5nZXMgKFxuICAgICAgICBjaGFuZ2VfaWQsIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCBzbmFwc2hvdF9pZCwgY2hhbmdlX3R5cGUsIFxuICAgICAgICBjaGFuZ2VfZGF0YSwgYmVmb3JlX3N0YXRlX3ZlY3RvciwgYWZ0ZXJfc3RhdGVfdmVjdG9yLCBjaGFuZ2Vfc2l6ZSwgbWV0YWRhdGEsIGNyZWF0ZWRfYXRcbiAgICAgIClcbiAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4LCAkOSwgJDEwLCAkMTEpXG4gICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICBbXG4gICAgICAgIHV1aWR2NCgpLFxuICAgICAgICBjaGFuZ2Uub2JqZWN0X2lkLFxuICAgICAgICBjaGFuZ2Uud29ya3NwYWNlX2lkLFxuICAgICAgICBjaGFuZ2Uuc25hcHNob3RfaWQgfHwgbnVsbCxcbiAgICAgICAgY2hhbmdlLmNoYW5nZV90eXBlLFxuICAgICAgICBjaGFuZ2UuY2hhbmdlX2RhdGEsXG4gICAgICAgIGNoYW5nZS5iZWZvcmVfc3RhdGVfdmVjdG9yIHx8IG51bGwsXG4gICAgICAgIGNoYW5nZS5hZnRlcl9zdGF0ZV92ZWN0b3IgfHwgbnVsbCxcbiAgICAgICAgY2hhbmdlLmNoYW5nZV9kYXRhLmxlbmd0aCxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoY2hhbmdlLm1ldGFkYXRhIHx8IHt9KSxcbiAgICAgICAgY3JlYXRlZF9hdCxcbiAgICAgIF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPnmoTlj5jmm7TliJfooahcbiAgICovXG4gIGFzeW5jIGZpbmRCeU9iamVjdElkKFxuICAgIG9iamVjdF9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIGxpbWl0PzogbnVtYmVyO1xuICAgICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgICAgYWZ0ZXJfc25hcHNob3RfaWQ/OiBzdHJpbmcgfCBudWxsOyAvLyDojrflj5bmn5DkuKrlv6vnhafkuYvlkI7nmoTlj5jmm7RcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTx7IGNoYW5nZXM6IERvY3VtZW50Q2hhbmdlW107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IHsgbGltaXQgPSAxMDAsIG9mZnNldCA9IDAsIGFmdGVyX3NuYXBzaG90X2lkIH0gPSBvcHRpb25zO1xuXG4gICAgbGV0IHF1ZXJ5ID0gYFxuICAgICAgU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IFxuICAgICAgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9jaGFuZ2VzIFxuICAgICAgV0hFUkUgb2JqZWN0X2lkID0gJDFcbiAgICBgO1xuICAgIGNvbnN0IGNvdW50UGFyYW1zOiBhbnlbXSA9IFtvYmplY3RfaWRdO1xuXG4gICAgaWYgKGFmdGVyX3NuYXBzaG90X2lkKSB7XG4gICAgICBxdWVyeSArPSBgIEFORCBjcmVhdGVkX2F0ID4gKFNFTEVDVCBjcmVhdGVkX2F0IEZST00gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIFdIRVJFIHNuYXBzaG90X2lkID0gJDIpYDtcbiAgICAgIGNvdW50UGFyYW1zLnB1c2goYWZ0ZXJfc25hcHNob3RfaWQpO1xuICAgIH1cblxuICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTx7IGNvdW50OiBzdHJpbmcgfT4ocXVlcnksIGNvdW50UGFyYW1zKTtcbiAgICBjb25zdCB0b3RhbCA9IHBhcnNlSW50KGNvdW50UmVzdWx0LnJvd3NbMF0uY291bnQsIDEwKTtcblxuICAgIGxldCBsaXN0UXVlcnkgPSBgXG4gICAgICBTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X2NoYW5nZXNcbiAgICAgIFdIRVJFIG9iamVjdF9pZCA9ICQxXG4gICAgYDtcbiAgICBjb25zdCBsaXN0UGFyYW1zOiBhbnlbXSA9IFtvYmplY3RfaWRdO1xuXG4gICAgaWYgKGFmdGVyX3NuYXBzaG90X2lkKSB7XG4gICAgICBsaXN0UXVlcnkgKz0gYCBBTkQgY3JlYXRlZF9hdCA+IChTRUxFQ1QgY3JlYXRlZF9hdCBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X3NuYXBzaG90cyBXSEVSRSBzbmFwc2hvdF9pZCA9ICQyKWA7XG4gICAgICBsaXN0UGFyYW1zLnB1c2goYWZ0ZXJfc25hcHNob3RfaWQpO1xuICAgIH1cblxuICAgIGxpc3RRdWVyeSArPSBgIE9SREVSIEJZIGNyZWF0ZWRfYXQgQVNDIExJTUlUICQke2xpc3RQYXJhbXMubGVuZ3RoICsgMX0gT0ZGU0VUICQke2xpc3RQYXJhbXMubGVuZ3RoICsgMn1gO1xuICAgIGxpc3RQYXJhbXMucHVzaChsaW1pdCwgb2Zmc2V0KTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRDaGFuZ2U+KGxpc3RRdWVyeSwgbGlzdFBhcmFtcyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY2hhbmdlczogcmVzdWx0LnJvd3MsXG4gICAgICB0b3RhbCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluS4pOS4quW/q+eFp+S5i+mXtOeahOWPmOabtFxuICAgKi9cbiAgYXN5bmMgZ2V0Q2hhbmdlc0JldHdlZW5TbmFwc2hvdHMoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgZnJvbV9zbmFwc2hvdF9pZDogc3RyaW5nLFxuICAgIHRvX3NuYXBzaG90X2lkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxEb2N1bWVudENoYW5nZVtdPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudENoYW5nZT4oXG4gICAgICBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9jaGFuZ2VzXG4gICAgICAgV0hFUkUgb2JqZWN0X2lkID0gJDFcbiAgICAgICAgIEFORCBjcmVhdGVkX2F0ID4gKFNFTEVDVCBjcmVhdGVkX2F0IEZST00gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIFdIRVJFIHNuYXBzaG90X2lkID0gJDIpXG4gICAgICAgICBBTkQgY3JlYXRlZF9hdCA8PSAoU0VMRUNUIGNyZWF0ZWRfYXQgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHMgV0hFUkUgc25hcHNob3RfaWQgPSAkMylcbiAgICAgICBPUkRFUiBCWSBjcmVhdGVkX2F0IEFTQ2AsXG4gICAgICBbb2JqZWN0X2lkLCBmcm9tX3NuYXBzaG90X2lkLCB0b19zbmFwc2hvdF9pZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93cztcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTmlofmoaPnmoTmiYDmnInlj5jmm7TorrDlvZVcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUJ5T2JqZWN0SWQob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ0RFTEVURSBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X2NoYW5nZXMgV0hFUkUgb2JqZWN0X2lkID0gJDEnLFxuICAgICAgW29iamVjdF9pZF1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJJbmplY3RhYmxlIiwiRGF0YWJhc2UiLCJ2NCIsInV1aWR2NCIsIkRvY3VtZW50Q2hhbmdlREFPIiwiY29uc3RydWN0b3IiLCJkYiIsImdldEluc3RhbmNlIiwiY3JlYXRlIiwiY2hhbmdlIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJub3ciLCJyZXN1bHQiLCJxdWVyeSIsIm9iamVjdF9pZCIsIndvcmtzcGFjZV9pZCIsInNuYXBzaG90X2lkIiwiY2hhbmdlX3R5cGUiLCJjaGFuZ2VfZGF0YSIsImJlZm9yZV9zdGF0ZV92ZWN0b3IiLCJhZnRlcl9zdGF0ZV92ZWN0b3IiLCJsZW5ndGgiLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YWRhdGEiLCJyb3dzIiwiZmluZEJ5T2JqZWN0SWQiLCJvcHRpb25zIiwibGltaXQiLCJvZmZzZXQiLCJhZnRlcl9zbmFwc2hvdF9pZCIsImNvdW50UGFyYW1zIiwicHVzaCIsImNvdW50UmVzdWx0IiwidG90YWwiLCJwYXJzZUludCIsImNvdW50IiwibGlzdFF1ZXJ5IiwibGlzdFBhcmFtcyIsImNoYW5nZXMiLCJnZXRDaGFuZ2VzQmV0d2VlblNuYXBzaG90cyIsImZyb21fc25hcHNob3RfaWQiLCJ0b19zbmFwc2hvdF9pZCIsImRlbGV0ZUJ5T2JqZWN0SWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/document-change.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/document.dao.ts":
/*!*********************************!*\
  !*** ./src/dao/document.dao.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentDAO: () => (/* binding */ DocumentDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! uuid */ \"(rsc)/../../node_modules/uuid/dist/esm-node/v4.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nclass DocumentDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 创建文档\n   */ async create(document) {\n        const result = await this.db.query(`INSERT INTO pikun_db.documents (workspace_id, title, content, content_length, owner_uid, metadata)\n       VALUES ($1, $2, $3, $4, $5, $6)\n       RETURNING object_id, workspace_id, title, content, content_length, owner_uid, metadata, deleted_at, created_at, updated_at`, [\n            document.workspace_id,\n            document.title,\n            document.content,\n            document.content_length,\n            document.owner_uid,\n            JSON.stringify(document.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 根据 ID 查找文档\n   */ async findById(object_id) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.documents WHERE object_id = $1 AND deleted_at IS NULL\", [\n            object_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据工作空间 ID 查找文档列表\n   */ async findByWorkspaceId(workspace_id, options = {}) {\n        const page = options.page || 1;\n        const page_size = options.page_size || 20;\n        const sort_by = options.sort_by || \"updated_at\";\n        const order = options.order || \"desc\";\n        const offset = (page - 1) * page_size;\n        // 获取总数\n        const countResult = await this.db.query(\"SELECT COUNT(*) as count FROM pikun_db.documents WHERE workspace_id = $1 AND deleted_at IS NULL\", [\n            workspace_id\n        ]);\n        const total = parseInt(countResult.rows[0].count, 10);\n        // 获取文档列表（不包含 content，减少数据传输）\n        const result = await this.db.query(`SELECT object_id, workspace_id, title, content_length, owner_uid, metadata, deleted_at, created_at, updated_at\n       FROM pikun_db.documents\n       WHERE workspace_id = $1 AND deleted_at IS NULL\n       ORDER BY ${sort_by} ${order}\n       LIMIT $2 OFFSET $3`, [\n            workspace_id,\n            page_size,\n            offset\n        ]);\n        return {\n            documents: result.rows,\n            total\n        };\n    }\n    /**\n   * 更新文档\n   */ async update(object_id, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.title !== undefined) {\n            fields.push(`title = $${paramIndex++}`);\n            values.push(updates.title);\n        }\n        if (updates.content !== undefined) {\n            fields.push(`content = $${paramIndex++}`);\n            values.push(updates.content);\n        }\n        if (updates.content_length !== undefined) {\n            fields.push(`content_length = $${paramIndex++}`);\n            values.push(updates.content_length);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(object_id);\n        }\n        values.push(object_id);\n        const result = await this.db.query(`UPDATE pikun_db.documents SET ${fields.join(\", \")} WHERE object_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING object_id, workspace_id, title, content, content_length, owner_uid, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除文档（软删除）\n   */ async delete(object_id) {\n        await this.db.query(\"UPDATE pikun_db.documents SET deleted_at = CURRENT_TIMESTAMP WHERE object_id = $1\", [\n            object_id\n        ]);\n    }\n    /**\n   * 创建文档快照\n   */ async createSnapshot(snapshot) {\n        const created_at = Date.now();\n        const result = await this.db.query(`INSERT INTO pikun_db.document_snapshots (\n        snapshot_id, object_id, workspace_id, snapshot_data, snapshot_version, \n        doc_state, doc_state_version, version_type, metadata, created_at\n      )\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)\n      RETURNING *`, [\n            (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(),\n            snapshot.object_id,\n            snapshot.workspace_id,\n            snapshot.snapshot_data,\n            snapshot.snapshot_version,\n            snapshot.doc_state || null,\n            snapshot.doc_state_version || 1,\n            snapshot.version_type || \"major\",\n            JSON.stringify(snapshot.metadata || {}),\n            created_at\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(object_id, options = {}) {\n        const limit = options.limit || 20;\n        const offset = options.offset || 0;\n        console.log(`[DocumentDAO] getSnapshots for object_id: ${object_id}, limit: ${limit}, offset: ${offset}`);\n        const countResult = await this.db.query(\"SELECT COUNT(*) as count FROM pikun_db.document_snapshots WHERE object_id = $1\", [\n            object_id\n        ]);\n        const total = parseInt(countResult.rows[0].count, 10);\n        console.log(`[DocumentDAO] Total snapshots count: ${total}`);\n        // 只返回必要的字段，不返回 snapshot_data 和 doc_state（这些是大字段）\n        // 注意：返回的数据结构需要匹配 DocumentSnapshot，但 snapshot_data 和 doc_state 可以为空\n        const result = await this.db.query(`SELECT snapshot_id, object_id, workspace_id, snapshot_version, doc_state_version, version_type, metadata, created_at\n       FROM pikun_db.document_snapshots\n       WHERE object_id = $1\n       ORDER BY created_at DESC\n       LIMIT $2 OFFSET $3`, [\n            object_id,\n            limit,\n            offset\n        ]);\n        console.log(`[DocumentDAO] Query returned ${result.rows.length} snapshots`);\n        // 转换为 DocumentSnapshot 格式，将缺失的字段设为空 Buffer\n        const snapshots = result.rows.map((row)=>({\n                ...row,\n                snapshot_data: Buffer.alloc(0),\n                doc_state: null\n            }));\n        return {\n            snapshots,\n            total\n        };\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(object_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_snapshots\n       WHERE object_id = $1\n       ORDER BY created_at DESC\n       LIMIT 1`, [\n            object_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 snapshot_id 获取快照\n   */ async getSnapshotById(snapshot_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_snapshots\n       WHERE snapshot_id = $1`, [\n            snapshot_id\n        ]);\n        return result.rows[0] || null;\n    }\n}\nDocumentDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"DocumentDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [])\n], DocumentDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFDM0I7SUFFQTs7R0FFQyxHQUNELE1BQU02QyxnQkFBZ0JDLFdBQW1CLEVBQW9DO1FBQzNFLE1BQU14RCxTQUFTLE1BQU0sSUFBSSxDQUFDSixFQUFFLENBQUNLLEtBQUssQ0FDaEMsQ0FBQzs2QkFDc0IsQ0FBQyxFQUN4QjtZQUFDdUQ7U0FBWTtRQUVmLE9BQU94RCxPQUFPVSxJQUFJLENBQUMsRUFBRSxJQUFJO0lBQzNCO0FBQ0Y7QUF6UGFoQixjQUFBQSxvRUFBQUE7SUFEWkgsNEVBQVVBLENBQUM7OztHQUNDRyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9kYW8vZG9jdW1lbnQuZGFvLnRzPzQ2OTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IERvY3VtZW50LCBEb2N1bWVudFNuYXBzaG90IH0gZnJvbSAnQC9lbnRpdGllcyc7XG5pbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJztcblxuLyoqXG4gKiDmlofmoaMgREFPXG4gKiDotJ/otKPmlofmoaPnm7jlhbPnmoTmlbDmja7lupPmk43kvZzvvIzkvb/nlKjlj4LmlbDljJbmn6Xor6LpmLLmraIgU1FMIOazqOWFpVxuICovXG5ASW5qZWN0YWJsZSgnRG9jdW1lbnREQU8nKVxuZXhwb3J0IGNsYXNzIERvY3VtZW50REFPIHtcbiAgcHJpdmF0ZSBkYjogRGF0YWJhc2U7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5kYiA9IERhdGFiYXNlLmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65paH5qGjXG4gICAqL1xuICBhc3luYyBjcmVhdGUoZG9jdW1lbnQ6IHtcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IEJ1ZmZlcjtcbiAgICBjb250ZW50X2xlbmd0aDogbnVtYmVyO1xuICAgIG93bmVyX3VpZDogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8RG9jdW1lbnQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PERvY3VtZW50PihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi5kb2N1bWVudHMgKHdvcmtzcGFjZV9pZCwgdGl0bGUsIGNvbnRlbnQsIGNvbnRlbnRfbGVuZ3RoLCBvd25lcl91aWQsIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNilcbiAgICAgICBSRVRVUk5JTkcgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50LCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICBbXG4gICAgICAgIGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgZG9jdW1lbnQudGl0bGUsXG4gICAgICAgIGRvY3VtZW50LmNvbnRlbnQsXG4gICAgICAgIGRvY3VtZW50LmNvbnRlbnRfbGVuZ3RoLFxuICAgICAgICBkb2N1bWVudC5vd25lcl91aWQsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGRvY3VtZW50Lm1ldGFkYXRhIHx8IHt9KSxcbiAgICAgIF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja4gSUQg5p+l5om+5paH5qGjXG4gICAqL1xuICBhc3luYyBmaW5kQnlJZChvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8RG9jdW1lbnQgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudD4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudHMgV0hFUkUgb2JqZWN0X2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbb2JqZWN0X2lkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u5bel5L2c56m66Ze0IElEIOafpeaJvuaWh+aho+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZmluZEJ5V29ya3NwYWNlSWQoXG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmcsXG4gICAgb3B0aW9uczoge1xuICAgICAgcGFnZT86IG51bWJlcjtcbiAgICAgIHBhZ2Vfc2l6ZT86IG51bWJlcjtcbiAgICAgIHNvcnRfYnk/OiAnY3JlYXRlZF9hdCcgfCAndXBkYXRlZF9hdCcgfCAndGl0bGUnO1xuICAgICAgb3JkZXI/OiAnYXNjJyB8ICdkZXNjJztcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTx7IGRvY3VtZW50czogRG9jdW1lbnRbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgY29uc3QgcGFnZSA9IG9wdGlvbnMucGFnZSB8fCAxO1xuICAgIGNvbnN0IHBhZ2Vfc2l6ZSA9IG9wdGlvbnMucGFnZV9zaXplIHx8IDIwO1xuICAgIGNvbnN0IHNvcnRfYnkgPSBvcHRpb25zLnNvcnRfYnkgfHwgJ3VwZGF0ZWRfYXQnO1xuICAgIGNvbnN0IG9yZGVyID0gb3B0aW9ucy5vcmRlciB8fCAnZGVzYyc7XG4gICAgY29uc3Qgb2Zmc2V0ID0gKHBhZ2UgLSAxKSAqIHBhZ2Vfc2l6ZTtcblxuICAgIC8vIOiOt+WPluaAu+aVsFxuICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTx7IGNvdW50OiBzdHJpbmcgfT4oXG4gICAgICAnU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gcGlrdW5fZGIuZG9jdW1lbnRzIFdIRVJFIHdvcmtzcGFjZV9pZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW3dvcmtzcGFjZV9pZF1cbiAgICApO1xuICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY291bnRSZXN1bHQucm93c1swXS5jb3VudCwgMTApO1xuXG4gICAgLy8g6I635Y+W5paH5qGj5YiX6KGo77yI5LiN5YyF5ZCrIGNvbnRlbnTvvIzlh4/lsJHmlbDmja7kvKDovpPvvIlcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PERvY3VtZW50PihcbiAgICAgIGBTRUxFQ1Qgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdFxuICAgICAgIEZST00gcGlrdW5fZGIuZG9jdW1lbnRzXG4gICAgICAgV0hFUkUgd29ya3NwYWNlX2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTFxuICAgICAgIE9SREVSIEJZICR7c29ydF9ieX0gJHtvcmRlcn1cbiAgICAgICBMSU1JVCAkMiBPRkZTRVQgJDNgLFxuICAgICAgW3dvcmtzcGFjZV9pZCwgcGFnZV9zaXplLCBvZmZzZXRdXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBkb2N1bWVudHM6IHJlc3VsdC5yb3dzLFxuICAgICAgdG90YWwsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrDmlofmoaNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZShcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICB0aXRsZT86IHN0cmluZztcbiAgICAgIGNvbnRlbnQ/OiBCdWZmZXI7XG4gICAgICBjb250ZW50X2xlbmd0aD86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8RG9jdW1lbnQ+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGB0aXRsZSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMudGl0bGUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5jb250ZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBjb250ZW50ID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jb250ZW50KTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuY29udGVudF9sZW5ndGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGNvbnRlbnRfbGVuZ3RoID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jb250ZW50X2xlbmd0aCk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLm1ldGFkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBtZXRhZGF0YSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKEpTT04uc3RyaW5naWZ5KHVwZGF0ZXMubWV0YWRhdGEpKTtcbiAgICB9XG5cbiAgICBpZiAoZmllbGRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuZmluZEJ5SWQob2JqZWN0X2lkKSBhcyBQcm9taXNlPERvY3VtZW50PjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaChvYmplY3RfaWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnQ+KFxuICAgICAgYFVQREFURSBwaWt1bl9kYi5kb2N1bWVudHMgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIG9iamVjdF9pZCA9ICQke3BhcmFtSW5kZXh9IEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBSRVRVUk5JTkcgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50LCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICB2YWx1ZXNcbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTmlofmoaPvvIjova/liKDpmaTvvIlcbiAgICovXG4gIGFzeW5jIGRlbGV0ZShvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuZGIucXVlcnkoXG4gICAgICAnVVBEQVRFIHBpa3VuX2RiLmRvY3VtZW50cyBTRVQgZGVsZXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QIFdIRVJFIG9iamVjdF9pZCA9ICQxJyxcbiAgICAgIFtvYmplY3RfaWRdXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlofmoaPlv6vnhadcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVNuYXBzaG90KHNuYXBzaG90OiB7XG4gICAgb2JqZWN0X2lkOiBzdHJpbmc7XG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmc7XG4gICAgc25hcHNob3RfZGF0YTogQnVmZmVyO1xuICAgIHNuYXBzaG90X3ZlcnNpb246IG51bWJlcjtcbiAgICBkb2Nfc3RhdGU/OiBCdWZmZXI7XG4gICAgZG9jX3N0YXRlX3ZlcnNpb24/OiBudW1iZXI7XG4gICAgdmVyc2lvbl90eXBlPzogJ21ham9yJyB8ICdtaW5vcic7IC8vIOeJiOacrOexu+Wei1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8RG9jdW1lbnRTbmFwc2hvdD4ge1xuICAgIGNvbnN0IGNyZWF0ZWRfYXQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRTbmFwc2hvdD4oXG4gICAgICBgSU5TRVJUIElOVE8gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIChcbiAgICAgICAgc25hcHNob3RfaWQsIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCBzbmFwc2hvdF9kYXRhLCBzbmFwc2hvdF92ZXJzaW9uLCBcbiAgICAgICAgZG9jX3N0YXRlLCBkb2Nfc3RhdGVfdmVyc2lvbiwgdmVyc2lvbl90eXBlLCBtZXRhZGF0YSwgY3JlYXRlZF9hdFxuICAgICAgKVxuICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgsICQ5LCAkMTApXG4gICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICBbXG4gICAgICAgIHV1aWR2NCgpLFxuICAgICAgICBzbmFwc2hvdC5vYmplY3RfaWQsXG4gICAgICAgIHNuYXBzaG90LndvcmtzcGFjZV9pZCxcbiAgICAgICAgc25hcHNob3Quc25hcHNob3RfZGF0YSxcbiAgICAgICAgc25hcHNob3Quc25hcHNob3RfdmVyc2lvbixcbiAgICAgICAgc25hcHNob3QuZG9jX3N0YXRlIHx8IG51bGwsXG4gICAgICAgIHNuYXBzaG90LmRvY19zdGF0ZV92ZXJzaW9uIHx8IDEsXG4gICAgICAgIHNuYXBzaG90LnZlcnNpb25fdHlwZSB8fCAnbWFqb3InLFxuICAgICAgICBKU09OLnN0cmluZ2lmeShzbmFwc2hvdC5tZXRhZGF0YSB8fCB7fSksXG4gICAgICAgIGNyZWF0ZWRfYXQsXG4gICAgICBdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGj5b+r54Wn5YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXRTbmFwc2hvdHMoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgb3B0aW9uczogeyBsaW1pdD86IG51bWJlcjsgb2Zmc2V0PzogbnVtYmVyIH0gPSB7fVxuICApOiBQcm9taXNlPHsgc25hcHNob3RzOiBEb2N1bWVudFNuYXBzaG90W107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IGxpbWl0ID0gb3B0aW9ucy5saW1pdCB8fCAyMDtcbiAgICBjb25zdCBvZmZzZXQgPSBvcHRpb25zLm9mZnNldCB8fCAwO1xuXG4gICAgY29uc29sZS5sb2coYFtEb2N1bWVudERBT10gZ2V0U25hcHNob3RzIGZvciBvYmplY3RfaWQ6ICR7b2JqZWN0X2lkfSwgbGltaXQ6ICR7bGltaXR9LCBvZmZzZXQ6ICR7b2Zmc2V0fWApO1xuXG4gICAgY29uc3QgY291bnRSZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PHsgY291bnQ6IHN0cmluZyB9PihcbiAgICAgICdTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHMgV0hFUkUgb2JqZWN0X2lkID0gJDEnLFxuICAgICAgW29iamVjdF9pZF1cbiAgICApO1xuICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY291bnRSZXN1bHQucm93c1swXS5jb3VudCwgMTApO1xuICAgIGNvbnNvbGUubG9nKGBbRG9jdW1lbnREQU9dIFRvdGFsIHNuYXBzaG90cyBjb3VudDogJHt0b3RhbH1gKTtcblxuICAgIC8vIOWPqui/lOWbnuW/heimgeeahOWtl+aute+8jOS4jei/lOWbniBzbmFwc2hvdF9kYXRhIOWSjCBkb2Nfc3RhdGXvvIjov5nkupvmmK/lpKflrZfmrrXvvIlcbiAgICAvLyDms6jmhI/vvJrov5Tlm57nmoTmlbDmja7nu5PmnoTpnIDopoHljLnphY0gRG9jdW1lbnRTbmFwc2hvdO+8jOS9hiBzbmFwc2hvdF9kYXRhIOWSjCBkb2Nfc3RhdGUg5Y+v5Lul5Li656m6XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxPbWl0PERvY3VtZW50U25hcHNob3QsICdzbmFwc2hvdF9kYXRhJyB8ICdkb2Nfc3RhdGUnPiAmIHsgc25hcHNob3RfZGF0YT86IEJ1ZmZlcjsgZG9jX3N0YXRlPzogQnVmZmVyIHwgbnVsbCB9PihcbiAgICAgIGBTRUxFQ1Qgc25hcHNob3RfaWQsIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCBzbmFwc2hvdF92ZXJzaW9uLCBkb2Nfc3RhdGVfdmVyc2lvbiwgdmVyc2lvbl90eXBlLCBtZXRhZGF0YSwgY3JlYXRlZF9hdFxuICAgICAgIEZST00gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzXG4gICAgICAgV0hFUkUgb2JqZWN0X2lkID0gJDFcbiAgICAgICBPUkRFUiBCWSBjcmVhdGVkX2F0IERFU0NcbiAgICAgICBMSU1JVCAkMiBPRkZTRVQgJDNgLFxuICAgICAgW29iamVjdF9pZCwgbGltaXQsIG9mZnNldF1cbiAgICApO1xuXG4gICAgY29uc29sZS5sb2coYFtEb2N1bWVudERBT10gUXVlcnkgcmV0dXJuZWQgJHtyZXN1bHQucm93cy5sZW5ndGh9IHNuYXBzaG90c2ApO1xuXG4gICAgLy8g6L2s5o2i5Li6IERvY3VtZW50U25hcHNob3Qg5qC85byP77yM5bCG57y65aSx55qE5a2X5q616K6+5Li656m6IEJ1ZmZlclxuICAgIGNvbnN0IHNuYXBzaG90czogRG9jdW1lbnRTbmFwc2hvdFtdID0gcmVzdWx0LnJvd3MubWFwKHJvdyA9PiAoe1xuICAgICAgLi4ucm93LFxuICAgICAgc25hcHNob3RfZGF0YTogQnVmZmVyLmFsbG9jKDApLCAvLyDliJfooajmn6Xor6LkuI3pnIDopoHlrp7pmYXmlbDmja5cbiAgICAgIGRvY19zdGF0ZTogbnVsbCxcbiAgICB9KSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc25hcHNob3RzLFxuICAgICAgdG90YWwsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmnIDmlrDlv6vnhadcbiAgICovXG4gIGFzeW5jIGdldExhdGVzdFNuYXBzaG90KG9iamVjdF9pZDogc3RyaW5nKTogUHJvbWlzZTxEb2N1bWVudFNuYXBzaG90IHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRTbmFwc2hvdD4oXG4gICAgICBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHNcbiAgICAgICBXSEVSRSBvYmplY3RfaWQgPSAkMVxuICAgICAgIE9SREVSIEJZIGNyZWF0ZWRfYXQgREVTQ1xuICAgICAgIExJTUlUIDFgLFxuICAgICAgW29iamVjdF9pZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBzbmFwc2hvdF9pZCDojrflj5blv6vnhadcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90QnlJZChzbmFwc2hvdF9pZDogc3RyaW5nKTogUHJvbWlzZTxEb2N1bWVudFNuYXBzaG90IHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRTbmFwc2hvdD4oXG4gICAgICBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHNcbiAgICAgICBXSEVSRSBzbmFwc2hvdF9pZCA9ICQxYCxcbiAgICAgIFtzbmFwc2hvdF9pZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJEYXRhYmFzZSIsIkluamVjdGFibGUiLCJ2NCIsInV1aWR2NCIsIkRvY3VtZW50REFPIiwiY29uc3RydWN0b3IiLCJkYiIsImdldEluc3RhbmNlIiwiY3JlYXRlIiwiZG9jdW1lbnQiLCJyZXN1bHQiLCJxdWVyeSIsIndvcmtzcGFjZV9pZCIsInRpdGxlIiwiY29udGVudCIsImNvbnRlbnRfbGVuZ3RoIiwib3duZXJfdWlkIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwicm93cyIsImZpbmRCeUlkIiwib2JqZWN0X2lkIiwiZmluZEJ5V29ya3NwYWNlSWQiLCJvcHRpb25zIiwicGFnZSIsInBhZ2Vfc2l6ZSIsInNvcnRfYnkiLCJvcmRlciIsIm9mZnNldCIsImNvdW50UmVzdWx0IiwidG90YWwiLCJwYXJzZUludCIsImNvdW50IiwiZG9jdW1lbnRzIiwidXBkYXRlIiwidXBkYXRlcyIsImZpZWxkcyIsInZhbHVlcyIsInBhcmFtSW5kZXgiLCJ1bmRlZmluZWQiLCJwdXNoIiwibGVuZ3RoIiwiam9pbiIsImRlbGV0ZSIsImNyZWF0ZVNuYXBzaG90Iiwic25hcHNob3QiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsIm5vdyIsInNuYXBzaG90X2RhdGEiLCJzbmFwc2hvdF92ZXJzaW9uIiwiZG9jX3N0YXRlIiwiZG9jX3N0YXRlX3ZlcnNpb24iLCJ2ZXJzaW9uX3R5cGUiLCJnZXRTbmFwc2hvdHMiLCJsaW1pdCIsImNvbnNvbGUiLCJsb2ciLCJzbmFwc2hvdHMiLCJtYXAiLCJyb3ciLCJCdWZmZXIiLCJhbGxvYyIsImdldExhdGVzdFNuYXBzaG90IiwiZ2V0U25hcHNob3RCeUlkIiwic25hcHNob3RfaWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/document.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/subject-category.dao.ts":
/*!*****************************************!*\
  !*** ./src/dao/subject-category.dao.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SubjectCategoryDAO: () => (/* binding */ SubjectCategoryDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass SubjectCategoryDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 获取所有学科分类（未删除）\n   */ async findAll() {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.subject_categories WHERE deleted_at IS NULL ORDER BY level ASC, sort_order ASC, code ASC\", []);\n        return result.rows;\n    }\n    /**\n   * 获取树形结构的学科分类\n   */ async findTree() {\n        const all = await this.findAll();\n        return this.buildTree(all);\n    }\n    /**\n   * 构建树形结构\n   */ buildTree(categories) {\n        const map = new Map();\n        const roots = [];\n        // 创建映射\n        categories.forEach((cat)=>{\n            map.set(cat.category_id, {\n                ...cat,\n                children: []\n            });\n        });\n        // 构建树\n        categories.forEach((cat)=>{\n            const node = map.get(cat.category_id);\n            if (cat.parent_id) {\n                const parent = map.get(cat.parent_id);\n                if (parent) {\n                    if (!parent.children) {\n                        parent.children = [];\n                    }\n                    parent.children.push(node);\n                }\n            } else {\n                roots.push(node);\n            }\n        });\n        return roots;\n    }\n    /**\n   * 根据 ID 查找学科分类\n   */ async findById(categoryId) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.subject_categories WHERE category_id = $1 AND deleted_at IS NULL\", [\n            categoryId\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据代码查找学科分类\n   */ async findByCode(code) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.subject_categories WHERE code = $1 AND deleted_at IS NULL\", [\n            code\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据父分类 ID 查找子分类（支持分页和搜索）\n   */ async findByParentId(parentId, options) {\n        const current = options?.current || 1;\n        const pageSize = options?.pageSize || 20;\n        const offset = (current - 1) * pageSize;\n        const keyword = options?.keyword?.trim();\n        let countQuery;\n        let listQuery;\n        const params = [];\n        let paramIndex = 1;\n        const keywordCondition = keyword ? ` AND (name ILIKE $${paramIndex} OR code ILIKE $${paramIndex})` : \"\";\n        const keywordParam = keyword ? `%${keyword}%` : null;\n        if (parentId === null) {\n            const baseCondition = \"parent_id IS NULL AND deleted_at IS NULL\";\n            countQuery = `SELECT COUNT(*) as count FROM pikun_db.subject_categories WHERE ${baseCondition}${keywordCondition}`;\n            listQuery = `SELECT * FROM pikun_db.subject_categories WHERE ${baseCondition}${keywordCondition} ORDER BY sort_order ASC, code ASC LIMIT $${paramIndex + (keyword ? 1 : 0)} OFFSET $${paramIndex + (keyword ? 2 : 1)}`;\n            if (keyword) {\n                params.push(keywordParam, pageSize, offset);\n            } else {\n                params.push(pageSize, offset);\n            }\n        } else {\n            const baseCondition = \"parent_id = $1 AND deleted_at IS NULL\";\n            countQuery = `SELECT COUNT(*) as count FROM pikun_db.subject_categories WHERE ${baseCondition}${keywordCondition.replace(/\\$\\d+/, `$${paramIndex + 1}`)}`;\n            listQuery = `SELECT * FROM pikun_db.subject_categories WHERE ${baseCondition}${keywordCondition.replace(/\\$\\d+/, `$${paramIndex + 1}`)} ORDER BY sort_order ASC, code ASC LIMIT $${paramIndex + (keyword ? 2 : 1)} OFFSET $${paramIndex + (keyword ? 3 : 2)}`;\n            params.push(parentId);\n            if (keyword) {\n                params.push(keywordParam, pageSize, offset);\n            } else {\n                params.push(pageSize, offset);\n            }\n        }\n        const countParams = parentId === null ? keyword ? [\n            keywordParam\n        ] : [] : keyword ? [\n            parentId,\n            keywordParam\n        ] : [\n            parentId\n        ];\n        const countResult = await this.db.query(countQuery, countParams);\n        const total = parseInt(countResult.rows[0].count, 10);\n        const result = await this.db.query(listQuery, params);\n        return {\n            categories: result.rows,\n            total\n        };\n    }\n    /**\n   * 根据父分类 ID 查找直接子分类（不分页，用于树懒加载）\n   */ async findChildrenByParentId(parentId) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.subject_categories WHERE parent_id = $1 AND deleted_at IS NULL ORDER BY sort_order ASC, code ASC\", [\n            parentId\n        ]);\n        return result.rows;\n    }\n    /**\n   * 创建学科分类\n   */ async create(data) {\n        // 如果 parent_id 为空字符串，转换为 NULL\n        const parentId = data.parent_id === \"\" || data.parent_id === undefined ? null : data.parent_id;\n        const result = await this.db.query(`INSERT INTO pikun_db.subject_categories (parent_id, code, name, description, icon_url, sort_order, metadata)\n       VALUES ($1, $2, $3, $4, $5, $6, $7)\n       RETURNING *`, [\n            parentId,\n            data.code,\n            data.name,\n            data.description || null,\n            data.icon_url || null,\n            data.sort_order || 0,\n            JSON.stringify(data.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 更新学科分类\n   */ async update(categoryId, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.parent_id !== undefined) {\n            // 如果 parent_id 为空字符串，转换为 NULL\n            const parentId = updates.parent_id === \"\" ? null : updates.parent_id;\n            fields.push(`parent_id = $${paramIndex++}`);\n            values.push(parentId);\n        }\n        if (updates.code !== undefined) {\n            fields.push(`code = $${paramIndex++}`);\n            values.push(updates.code);\n        }\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.description !== undefined) {\n            fields.push(`description = $${paramIndex++}`);\n            values.push(updates.description);\n        }\n        if (updates.icon_url !== undefined) {\n            fields.push(`icon_url = $${paramIndex++}`);\n            values.push(updates.icon_url);\n        }\n        if (updates.sort_order !== undefined) {\n            fields.push(`sort_order = $${paramIndex++}`);\n            values.push(updates.sort_order);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(categoryId);\n        }\n        values.push(categoryId);\n        const result = await this.db.query(`UPDATE pikun_db.subject_categories SET ${fields.join(\", \")} WHERE category_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING *`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除学科分类（软删除）\n   */ async delete(categoryId) {\n        await this.db.query(\"UPDATE pikun_db.subject_categories SET deleted_at = CURRENT_TIMESTAMP WHERE category_id = $1\", [\n            categoryId\n        ]);\n    }\n}\nSubjectCategoryDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"SubjectCategoryDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], SubjectCategoryDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGFvL3N1YmplY3QtY2F0ZWdvcnkuZGFvLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUEyQztBQUNvQjtBQVF4RCxNQUFNRTtJQUdYQyxhQUFjO1FBQ1osSUFBSSxDQUFDQyxFQUFFLEdBQUdKLG9EQUFRQSxDQUFDSyxXQUFXO0lBQ2hDO0lBRUE7O0dBRUMsR0FDRCxNQUFNQyxVQUFzQztRQUMxQyxNQUFNQyxTQUFTLE1BQU0sSUFBSSxDQUFDSCxFQUFFLENBQUNJLEtBQUssQ0FDaEMsbUhBQ0EsRUFBRTtRQUVKLE9BQU9ELE9BQU9FLElBQUk7SUFDcEI7SUFFQTs7R0FFQyxHQUNELE1BQU1DLFdBQStFO1FBQ25GLE1BQU1DLE1BQU0sTUFBTSxJQUFJLENBQUNMLE9BQU87UUFDOUIsT0FBTyxJQUFJLENBQUNNLFNBQVMsQ0FBQ0Q7SUFDeEI7SUFFQTs7R0FFQyxHQUNELFVBQWtCRSxVQUE2QixFQUE2RDtRQUMxRyxNQUFNQyxNQUFNLElBQUlDO1FBQ2hCLE1BQU1DLFFBQW1FLEVBQUU7UUFFM0UsT0FBTztRQUNQSCxXQUFXSSxPQUFPLENBQUMsQ0FBQ0M7WUFDbEJKLElBQUlLLEdBQUcsQ0FBQ0QsSUFBSUUsV0FBVyxFQUFFO2dCQUFFLEdBQUdGLEdBQUc7Z0JBQUVHLFVBQVUsRUFBRTtZQUFDO1FBQ2xEO1FBRUEsTUFBTTtRQUNOUixXQUFXSSxPQUFPLENBQUMsQ0FBQ0M7WUFDbEIsTUFBTUksT0FBT1IsSUFBSVMsR0FBRyxDQUFDTCxJQUFJRSxXQUFXO1lBQ3BDLElBQUlGLElBQUlNLFNBQVMsRUFBRTtnQkFDakIsTUFBTUMsU0FBU1gsSUFBSVMsR0FBRyxDQUFDTCxJQUFJTSxTQUFTO2dCQUNwQyxJQUFJQyxRQUFRO29CQUNWLElBQUksQ0FBQ0EsT0FBT0osUUFBUSxFQUFFO3dCQUNwQkksT0FBT0osUUFBUSxHQUFHLEVBQUU7b0JBQ3RCO29CQUNBSSxPQUFPSixRQUFRLENBQUNLLElBQUksQ0FBQ0o7Z0JBQ3ZCO1lBQ0YsT0FB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QUVBc0MsT0FBT3hDLElBQUksQ0FBQ0U7UUFDWixNQUFNckIsU0FBUyxNQUFNLElBQUksQ0FBQ0gsRUFBRSxDQUFDSSxLQUFLLENBQ2hDLENBQUMsdUNBQXVDLEVBQUV5RCxPQUFPRyxJQUFJLENBQUMsTUFBTSxzQkFBc0IsRUFBRTFCLFdBQVc7a0JBQ25GLENBQUMsRUFDYndCO1FBRUYsT0FBTzNELE9BQU9FLElBQUksQ0FBQyxFQUFFO0lBQ3ZCO0lBRUE7O0dBRUMsR0FDRCxNQUFNNEQsT0FBT3pDLFVBQWtCLEVBQWlCO1FBQzlDLE1BQU0sSUFBSSxDQUFDeEIsRUFBRSxDQUFDSSxLQUFLLENBQ2pCLGdHQUNBO1lBQUNvQjtTQUFXO0lBRWhCO0FBQ0Y7QUF0UGExQixxQkFBQUEsb0VBQUFBO0lBRFpELDRFQUFVQSxDQUFDOzs7R0FDQ0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvZGFvL3N1YmplY3QtY2F0ZWdvcnkuZGFvLnRzP2UyYzYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IFN1YmplY3RDYXRlZ29yeSB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOWtpuenkeWIhuexuyBEQU9cbiAqIOi0n+i0o+WtpuenkeWIhuexu+ebuOWFs+eahOaVsOaNruW6k+aTjeS9nO+8jOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWlXG4gKi9cbkBJbmplY3RhYmxlKCdTdWJqZWN0Q2F0ZWdvcnlEQU8nKVxuZXhwb3J0IGNsYXNzIFN1YmplY3RDYXRlZ29yeURBTyB7XG4gIHByaXZhdGUgZGI6IERhdGFiYXNlO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZGIgPSBEYXRhYmFzZS5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaJgOacieWtpuenkeWIhuexu++8iOacquWIoOmZpO+8iVxuICAgKi9cbiAgYXN5bmMgZmluZEFsbCgpOiBQcm9taXNlPFN1YmplY3RDYXRlZ29yeVtdPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxTdWJqZWN0Q2F0ZWdvcnk+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuc3ViamVjdF9jYXRlZ29yaWVzIFdIRVJFIGRlbGV0ZWRfYXQgSVMgTlVMTCBPUkRFUiBCWSBsZXZlbCBBU0MsIHNvcnRfb3JkZXIgQVNDLCBjb2RlIEFTQycsXG4gICAgICBbXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluagkeW9oue7k+aehOeahOWtpuenkeWIhuexu1xuICAgKi9cbiAgYXN5bmMgZmluZFRyZWUoKTogUHJvbWlzZTxBcnJheTxTdWJqZWN0Q2F0ZWdvcnkgJiB7IGNoaWxkcmVuPzogU3ViamVjdENhdGVnb3J5W10gfT4+IHtcbiAgICBjb25zdCBhbGwgPSBhd2FpdCB0aGlzLmZpbmRBbGwoKTtcbiAgICByZXR1cm4gdGhpcy5idWlsZFRyZWUoYWxsKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmnoTlu7rmoJHlvaLnu5PmnoRcbiAgICovXG4gIHByaXZhdGUgYnVpbGRUcmVlKGNhdGVnb3JpZXM6IFN1YmplY3RDYXRlZ29yeVtdKTogQXJyYXk8U3ViamVjdENhdGVnb3J5ICYgeyBjaGlsZHJlbj86IFN1YmplY3RDYXRlZ29yeVtdIH0+IHtcbiAgICBjb25zdCBtYXAgPSBuZXcgTWFwPHN0cmluZywgU3ViamVjdENhdGVnb3J5ICYgeyBjaGlsZHJlbj86IFN1YmplY3RDYXRlZ29yeVtdIH0+KCk7XG4gICAgY29uc3Qgcm9vdHM6IEFycmF5PFN1YmplY3RDYXRlZ29yeSAmIHsgY2hpbGRyZW4/OiBTdWJqZWN0Q2F0ZWdvcnlbXSB9PiA9IFtdO1xuXG4gICAgLy8g5Yib5bu65pig5bCEXG4gICAgY2F0ZWdvcmllcy5mb3JFYWNoKChjYXQpID0+IHtcbiAgICAgIG1hcC5zZXQoY2F0LmNhdGVnb3J5X2lkLCB7IC4uLmNhdCwgY2hpbGRyZW46IFtdIH0pO1xuICAgIH0pO1xuXG4gICAgLy8g5p6E5bu65qCRXG4gICAgY2F0ZWdvcmllcy5mb3JFYWNoKChjYXQpID0+IHtcbiAgICAgIGNvbnN0IG5vZGUgPSBtYXAuZ2V0KGNhdC5jYXRlZ29yeV9pZCkhO1xuICAgICAgaWYgKGNhdC5wYXJlbnRfaWQpIHtcbiAgICAgICAgY29uc3QgcGFyZW50ID0gbWFwLmdldChjYXQucGFyZW50X2lkKTtcbiAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgIGlmICghcGFyZW50LmNoaWxkcmVuKSB7XG4gICAgICAgICAgICBwYXJlbnQuY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGFyZW50LmNoaWxkcmVuLnB1c2gobm9kZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJvb3RzLnB1c2gobm9kZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcm9vdHM7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2uIElEIOafpeaJvuWtpuenkeWIhuexu1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5SWQoY2F0ZWdvcnlJZDogc3RyaW5nKTogUHJvbWlzZTxTdWJqZWN0Q2F0ZWdvcnkgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxTdWJqZWN0Q2F0ZWdvcnk+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuc3ViamVjdF9jYXRlZ29yaWVzIFdIRVJFIGNhdGVnb3J5X2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbY2F0ZWdvcnlJZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNruS7o+eggeafpeaJvuWtpuenkeWIhuexu1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5Q29kZShjb2RlOiBzdHJpbmcpOiBQcm9taXNlPFN1YmplY3RDYXRlZ29yeSB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFN1YmplY3RDYXRlZ29yeT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5zdWJqZWN0X2NhdGVnb3JpZXMgV0hFUkUgY29kZSA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW2NvZGVdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7niLbliIbnsbsgSUQg5p+l5om+5a2Q5YiG57G777yI5pSv5oyB5YiG6aG15ZKM5pCc57Si77yJXG4gICAqL1xuICBhc3luYyBmaW5kQnlQYXJlbnRJZChcbiAgICBwYXJlbnRJZDogc3RyaW5nIHwgbnVsbCxcbiAgICBvcHRpb25zPzogeyBjdXJyZW50PzogbnVtYmVyOyBwYWdlU2l6ZT86IG51bWJlcjsga2V5d29yZD86IHN0cmluZyB9XG4gICk6IFByb21pc2U8eyBjYXRlZ29yaWVzOiBTdWJqZWN0Q2F0ZWdvcnlbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgY29uc3QgY3VycmVudCA9IG9wdGlvbnM/LmN1cnJlbnQgfHwgMTtcbiAgICBjb25zdCBwYWdlU2l6ZSA9IG9wdGlvbnM/LnBhZ2VTaXplIHx8IDIwO1xuICAgIGNvbnN0IG9mZnNldCA9IChjdXJyZW50IC0gMSkgKiBwYWdlU2l6ZTtcbiAgICBjb25zdCBrZXl3b3JkID0gb3B0aW9ucz8ua2V5d29yZD8udHJpbSgpO1xuXG4gICAgbGV0IGNvdW50UXVlcnk6IHN0cmluZztcbiAgICBsZXQgbGlzdFF1ZXJ5OiBzdHJpbmc7XG4gICAgY29uc3QgcGFyYW1zOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcbiAgICBjb25zdCBrZXl3b3JkQ29uZGl0aW9uID0ga2V5d29yZCA/IGAgQU5EIChuYW1lIElMSUtFICQke3BhcmFtSW5kZXh9IE9SIGNvZGUgSUxJS0UgJCR7cGFyYW1JbmRleH0pYCA6ICcnO1xuICAgIGNvbnN0IGtleXdvcmRQYXJhbSA9IGtleXdvcmQgPyBgJSR7a2V5d29yZH0lYCA6IG51bGw7XG5cbiAgICBpZiAocGFyZW50SWQgPT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGJhc2VDb25kaXRpb24gPSAncGFyZW50X2lkIElTIE5VTEwgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCc7XG4gICAgICBjb3VudFF1ZXJ5ID0gYFNFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NIHBpa3VuX2RiLnN1YmplY3RfY2F0ZWdvcmllcyBXSEVSRSAke2Jhc2VDb25kaXRpb259JHtrZXl3b3JkQ29uZGl0aW9ufWA7XG4gICAgICBsaXN0UXVlcnkgPSBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5zdWJqZWN0X2NhdGVnb3JpZXMgV0hFUkUgJHtiYXNlQ29uZGl0aW9ufSR7a2V5d29yZENvbmRpdGlvbn0gT1JERVIgQlkgc29ydF9vcmRlciBBU0MsIGNvZGUgQVNDIExJTUlUICQke3BhcmFtSW5kZXggKyAoa2V5d29yZCA/IDEgOiAwKX0gT0ZGU0VUICQke3BhcmFtSW5kZXggKyAoa2V5d29yZCA/IDIgOiAxKX1gO1xuICAgICAgaWYgKGtleXdvcmQpIHtcbiAgICAgICAgcGFyYW1zLnB1c2goa2V5d29yZFBhcmFtLCBwYWdlU2l6ZSwgb2Zmc2V0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhcmFtcy5wdXNoKHBhZ2VTaXplLCBvZmZzZXQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBiYXNlQ29uZGl0aW9uID0gJ3BhcmVudF9pZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwnO1xuICAgICAgY291bnRRdWVyeSA9IGBTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBwaWt1bl9kYi5zdWJqZWN0X2NhdGVnb3JpZXMgV0hFUkUgJHtiYXNlQ29uZGl0aW9ufSR7a2V5d29yZENvbmRpdGlvbi5yZXBsYWNlKC9cXCRcXGQrLywgYCQke3BhcmFtSW5kZXggKyAxfWApfWA7XG4gICAgICBsaXN0UXVlcnkgPSBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5zdWJqZWN0X2NhdGVnb3JpZXMgV0hFUkUgJHtiYXNlQ29uZGl0aW9ufSR7a2V5d29yZENvbmRpdGlvbi5yZXBsYWNlKC9cXCRcXGQrLywgYCQke3BhcmFtSW5kZXggKyAxfWApfSBPUkRFUiBCWSBzb3J0X29yZGVyIEFTQywgY29kZSBBU0MgTElNSVQgJCR7cGFyYW1JbmRleCArIChrZXl3b3JkID8gMiA6IDEpfSBPRkZTRVQgJCR7cGFyYW1JbmRleCArIChrZXl3b3JkID8gMyA6IDIpfWA7XG4gICAgICBwYXJhbXMucHVzaChwYXJlbnRJZCk7XG4gICAgICBpZiAoa2V5d29yZCkge1xuICAgICAgICBwYXJhbXMucHVzaChrZXl3b3JkUGFyYW0sIHBhZ2VTaXplLCBvZmZzZXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFyYW1zLnB1c2gocGFnZVNpemUsIG9mZnNldCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgY291bnRQYXJhbXMgPSBwYXJlbnRJZCA9PT0gbnVsbCA/IChrZXl3b3JkID8gW2tleXdvcmRQYXJhbV0gOiBbXSkgOiAoa2V5d29yZCA/IFtwYXJlbnRJZCwga2V5d29yZFBhcmFtXSA6IFtwYXJlbnRJZF0pO1xuICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTx7IGNvdW50OiBzdHJpbmcgfT4oY291bnRRdWVyeSwgY291bnRQYXJhbXMpO1xuICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY291bnRSZXN1bHQucm93c1swXS5jb3VudCwgMTApO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxTdWJqZWN0Q2F0ZWdvcnk+KGxpc3RRdWVyeSwgcGFyYW1zKTtcblxuICAgIHJldHVybiB7XG4gICAgICBjYXRlZ29yaWVzOiByZXN1bHQucm93cyxcbiAgICAgIHRvdGFsLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u54i25YiG57G7IElEIOafpeaJvuebtOaOpeWtkOWIhuexu++8iOS4jeWIhumhte+8jOeUqOS6juagkeaHkuWKoOi9ve+8iVxuICAgKi9cbiAgYXN5bmMgZmluZENoaWxkcmVuQnlQYXJlbnRJZChwYXJlbnRJZDogc3RyaW5nIHwgbnVsbCk6IFByb21pc2U8U3ViamVjdENhdGVnb3J5W10+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFN1YmplY3RDYXRlZ29yeT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5zdWJqZWN0X2NhdGVnb3JpZXMgV0hFUkUgcGFyZW50X2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCBPUkRFUiBCWSBzb3J0X29yZGVyIEFTQywgY29kZSBBU0MnLFxuICAgICAgW3BhcmVudElkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuWtpuenkeWIhuexu1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlKGRhdGE6IHtcbiAgICBwYXJlbnRfaWQ/OiBzdHJpbmcgfCBudWxsO1xuICAgIGNvZGU6IHN0cmluZztcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgaWNvbl91cmw/OiBzdHJpbmc7XG4gICAgc29ydF9vcmRlcj86IG51bWJlcjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFN1YmplY3RDYXRlZ29yeT4ge1xuICAgIC8vIOWmguaenCBwYXJlbnRfaWQg5Li656m65a2X56ym5Liy77yM6L2s5o2i5Li6IE5VTExcbiAgICBjb25zdCBwYXJlbnRJZCA9IGRhdGEucGFyZW50X2lkID09PSAnJyB8fCBkYXRhLnBhcmVudF9pZCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IGRhdGEucGFyZW50X2lkO1xuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8U3ViamVjdENhdGVnb3J5PihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi5zdWJqZWN0X2NhdGVnb3JpZXMgKHBhcmVudF9pZCwgY29kZSwgbmFtZSwgZGVzY3JpcHRpb24sIGljb25fdXJsLCBzb3J0X29yZGVyLCBtZXRhZGF0YSlcbiAgICAgICBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYsICQ3KVxuICAgICAgIFJFVFVSTklORyAqYCxcbiAgICAgIFtcbiAgICAgICAgcGFyZW50SWQsXG4gICAgICAgIGRhdGEuY29kZSxcbiAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uIHx8IG51bGwsXG4gICAgICAgIGRhdGEuaWNvbl91cmwgfHwgbnVsbCxcbiAgICAgICAgZGF0YS5zb3J0X29yZGVyIHx8IDAsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGRhdGEubWV0YWRhdGEgfHwge30pLFxuICAgICAgXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOWtpuenkeWIhuexu1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlKFxuICAgIGNhdGVnb3J5SWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICBwYXJlbnRfaWQ/OiBzdHJpbmcgfCBudWxsO1xuICAgICAgY29kZT86IHN0cmluZztcbiAgICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICAgIGljb25fdXJsPzogc3RyaW5nO1xuICAgICAgc29ydF9vcmRlcj86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8U3ViamVjdENhdGVnb3J5PiB7XG4gICAgY29uc3QgZmllbGRzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHZhbHVlczogYW55W10gPSBbXTtcbiAgICBsZXQgcGFyYW1JbmRleCA9IDE7XG5cbiAgICBpZiAodXBkYXRlcy5wYXJlbnRfaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8g5aaC5p6cIHBhcmVudF9pZCDkuLrnqbrlrZfnrKbkuLLvvIzovazmjaLkuLogTlVMTFxuICAgICAgY29uc3QgcGFyZW50SWQgPSB1cGRhdGVzLnBhcmVudF9pZCA9PT0gJycgPyBudWxsIDogdXBkYXRlcy5wYXJlbnRfaWQ7XG4gICAgICBmaWVsZHMucHVzaChgcGFyZW50X2lkID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2gocGFyZW50SWQpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5jb2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBjb2RlID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jb2RlKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgbmFtZSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMubmFtZSk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBkZXNjcmlwdGlvbiA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMuZGVzY3JpcHRpb24pO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5pY29uX3VybCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgaWNvbl91cmwgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmljb25fdXJsKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuc29ydF9vcmRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgc29ydF9vcmRlciA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMuc29ydF9vcmRlcik7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLm1ldGFkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBtZXRhZGF0YSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKEpTT04uc3RyaW5naWZ5KHVwZGF0ZXMubWV0YWRhdGEpKTtcbiAgICB9XG5cbiAgICBpZiAoZmllbGRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuZmluZEJ5SWQoY2F0ZWdvcnlJZCkgYXMgUHJvbWlzZTxTdWJqZWN0Q2F0ZWdvcnk+O1xuICAgIH1cblxuICAgIHZhbHVlcy5wdXNoKGNhdGVnb3J5SWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8U3ViamVjdENhdGVnb3J5PihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIuc3ViamVjdF9jYXRlZ29yaWVzIFNFVCAke2ZpZWxkcy5qb2luKCcsICcpfSBXSEVSRSBjYXRlZ29yeV9pZCA9ICQke3BhcmFtSW5kZXh9IEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICB2YWx1ZXNcbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTlrabnp5HliIbnsbvvvIjova/liKDpmaTvvIlcbiAgICovXG4gIGFzeW5jIGRlbGV0ZShjYXRlZ29yeUlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi5zdWJqZWN0X2NhdGVnb3JpZXMgU0VUIGRlbGV0ZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUCBXSEVSRSBjYXRlZ29yeV9pZCA9ICQxJyxcbiAgICAgIFtjYXRlZ29yeUlkXVxuICAgICk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIkRhdGFiYXNlIiwiSW5qZWN0YWJsZSIsIlN1YmplY3RDYXRlZ29yeURBTyIsImNvbnN0cnVjdG9yIiwiZGIiLCJnZXRJbnN0YW5jZSIsImZpbmRBbGwiLCJyZXN1bHQiLCJxdWVyeSIsInJvd3MiLCJmaW5kVHJlZSIsImFsbCIsImJ1aWxkVHJlZSIsImNhdGVnb3JpZXMiLCJtYXAiLCJNYXAiLCJyb290cyIsImZvckVhY2giLCJjYXQiLCJzZXQiLCJjYXRlZ29yeV9pZCIsImNoaWxkcmVuIiwibm9kZSIsImdldCIsInBhcmVudF9pZCIsInBhcmVudCIsInB1c2giLCJmaW5kQnlJZCIsImNhdGVnb3J5SWQiLCJmaW5kQnlDb2RlIiwiY29kZSIsImZpbmRCeVBhcmVudElkIiwicGFyZW50SWQiLCJvcHRpb25zIiwiY3VycmVudCIsInBhZ2VTaXplIiwib2Zmc2V0Iiwia2V5d29yZCIsInRyaW0iLCJjb3VudFF1ZXJ5IiwibGlzdFF1ZXJ5IiwicGFyYW1zIiwicGFyYW1JbmRleCIsImtleXdvcmRDb25kaXRpb24iLCJrZXl3b3JkUGFyYW0iLCJiYXNlQ29uZGl0aW9uIiwicmVwbGFjZSIsImNvdW50UGFyYW1zIiwiY291bnRSZXN1bHQiLCJ0b3RhbCIsInBhcnNlSW50IiwiY291bnQiLCJmaW5kQ2hpbGRyZW5CeVBhcmVudElkIiwiY3JlYXRlIiwiZGF0YSIsInVuZGVmaW5lZCIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsImljb25fdXJsIiwic29ydF9vcmRlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXRhZGF0YSIsInVwZGF0ZSIsInVwZGF0ZXMiLCJmaWVsZHMiLCJ2YWx1ZXMiLCJsZW5ndGgiLCJqb2luIiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/subject-category.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/subject.dao.ts":
/*!********************************!*\
  !*** ./src/dao/subject.dao.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SubjectDAO: () => (/* binding */ SubjectDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass SubjectDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 获取所有学科（未删除）\n   */ async findAll() {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.subjects WHERE deleted_at IS NULL ORDER BY sort_order ASC, created_at ASC\", []);\n        return result.rows;\n    }\n    /**\n   * 根据分类 ID 查找学科（支持分页和搜索）\n   */ async findByCategoryId(categoryId, options) {\n        const current = options?.current || 1;\n        const pageSize = options?.pageSize || 20;\n        const offset = (current - 1) * pageSize;\n        const keyword = options?.keyword?.trim();\n        let countQuery;\n        let listQuery;\n        const params = [];\n        let paramIndex = 1;\n        if (categoryId) {\n            const keywordCondition = keyword ? ` AND (name ILIKE $${paramIndex + 1} OR code ILIKE $${paramIndex + 1})` : \"\";\n            const keywordParam1 = keyword ? `%${keyword}%` : null;\n            countQuery = `SELECT COUNT(*) as count FROM pikun_db.subjects WHERE category_id = $1 AND deleted_at IS NULL${keywordCondition}`;\n            listQuery = `SELECT * FROM pikun_db.subjects WHERE category_id = $1 AND deleted_at IS NULL${keywordCondition} ORDER BY sort_order ASC, created_at ASC LIMIT $${paramIndex + (keyword ? 2 : 1)} OFFSET $${paramIndex + (keyword ? 3 : 2)}`;\n            params.push(categoryId);\n            if (keyword) {\n                params.push(keywordParam1, pageSize, offset);\n            } else {\n                params.push(pageSize, offset);\n            }\n        } else {\n            // 查询所有学科（不分分类）\n            const keywordCondition = keyword ? ` AND (name ILIKE $${paramIndex} OR code ILIKE $${paramIndex})` : \"\";\n            const keywordParam1 = keyword ? `%${keyword}%` : null;\n            countQuery = `SELECT COUNT(*) as count FROM pikun_db.subjects WHERE deleted_at IS NULL${keywordCondition}`;\n            listQuery = `SELECT * FROM pikun_db.subjects WHERE deleted_at IS NULL${keywordCondition} ORDER BY sort_order ASC, created_at ASC LIMIT $${paramIndex + (keyword ? 1 : 0)} OFFSET $${paramIndex + (keyword ? 2 : 1)}`;\n            if (keyword) {\n                params.push(keywordParam1, pageSize, offset);\n            } else {\n                params.push(pageSize, offset);\n            }\n        }\n        const countParams = categoryId ? keyword ? [\n            categoryId,\n            keywordParam\n        ] : [\n            categoryId\n        ] : keyword ? [\n            keywordParam\n        ] : [];\n        const countResult = await this.db.query(countQuery, countParams);\n        const total = parseInt(countResult.rows[0].count, 10);\n        const result = await this.db.query(listQuery, params);\n        return {\n            subjects: result.rows,\n            total\n        };\n    }\n    /**\n   * 根据 ID 查找学科\n   */ async findById(subjectId) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.subjects WHERE subject_id = $1 AND deleted_at IS NULL\", [\n            subjectId\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据代码查找学科\n   */ async findByCode(code) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.subjects WHERE code = $1 AND deleted_at IS NULL\", [\n            code\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 创建学科\n   */ async create(data) {\n        const result = await this.db.query(`INSERT INTO pikun_db.subjects (category_id, code, name, short_name, icon_url, cover_image_url, sort_order, is_published, metadata)\n       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)\n       RETURNING *`, [\n            data.category_id,\n            data.code,\n            data.name,\n            data.short_name || null,\n            data.icon_url || null,\n            data.cover_image_url || null,\n            data.sort_order || 0,\n            data.is_published !== undefined ? data.is_published : false,\n            JSON.stringify(data.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 更新学科\n   */ async update(subjectId, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.category_id !== undefined) {\n            fields.push(`category_id = $${paramIndex++}`);\n            values.push(updates.category_id);\n        }\n        if (updates.code !== undefined) {\n            fields.push(`code = $${paramIndex++}`);\n            values.push(updates.code);\n        }\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.short_name !== undefined) {\n            fields.push(`short_name = $${paramIndex++}`);\n            values.push(updates.short_name);\n        }\n        if (updates.icon_url !== undefined) {\n            fields.push(`icon_url = $${paramIndex++}`);\n            values.push(updates.icon_url);\n        }\n        if (updates.cover_image_url !== undefined) {\n            fields.push(`cover_image_url = $${paramIndex++}`);\n            values.push(updates.cover_image_url);\n        }\n        if (updates.sort_order !== undefined) {\n            fields.push(`sort_order = $${paramIndex++}`);\n            values.push(updates.sort_order);\n        }\n        if (updates.is_published !== undefined) {\n            fields.push(`is_published = $${paramIndex++}`);\n            values.push(updates.is_published);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(subjectId);\n        }\n        values.push(subjectId);\n        const result = await this.db.query(`UPDATE pikun_db.subjects SET ${fields.join(\", \")} WHERE subject_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING *`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除学科（软删除）\n   */ async delete(subjectId) {\n        await this.db.query(\"UPDATE pikun_db.subjects SET deleted_at = CURRENT_TIMESTAMP WHERE subject_id = $1\", [\n            subjectId\n        ]);\n    }\n    /**\n   * 获取学科详情\n   */ async findDetailBySubjectId(subjectId) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.subject_details WHERE subject_id = $1\", [\n            subjectId\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 创建或更新学科详情\n   */ async upsertDetail(data) {\n        const result = await this.db.query(`INSERT INTO pikun_db.subject_details (\n        subject_id, definition, description, purpose, value, application_scenarios,\n        learning_objectives, prerequisites, related_subjects, metadata\n      )\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)\n      ON CONFLICT (subject_id) DO UPDATE SET\n        definition = EXCLUDED.definition,\n        description = EXCLUDED.description,\n        purpose = EXCLUDED.purpose,\n        value = EXCLUDED.value,\n        application_scenarios = EXCLUDED.application_scenarios,\n        learning_objectives = EXCLUDED.learning_objectives,\n        prerequisites = EXCLUDED.prerequisites,\n        related_subjects = EXCLUDED.related_subjects,\n        metadata = EXCLUDED.metadata,\n        updated_at = CURRENT_TIMESTAMP\n      RETURNING *`, [\n            data.subject_id,\n            data.definition || null,\n            data.description || null,\n            data.purpose || null,\n            data.value || null,\n            data.application_scenarios || null,\n            data.learning_objectives || null,\n            data.prerequisites || null,\n            JSON.stringify(data.related_subjects || []),\n            JSON.stringify(data.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n}\nSubjectDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"SubjectDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], SubjectDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJO1lBQ2hCeEIsS0FBS3lCLEtBQUssSUFBSTtZQUNkekIsS0FBSzBCLHFCQUFxQixJQUFJO1lBQzlCMUIsS0FBSzJCLG1CQUFtQixJQUFJO1lBQzVCM0IsS0FBSzRCLGFBQWEsSUFBSTtZQUN0Qm5CLEtBQUtDLFNBQVMsQ0FBQ1YsS0FBSzZCLGdCQUFnQixJQUFJLEVBQUU7WUFDMUNwQixLQUFLQyxTQUFTLENBQUNWLEtBQUtXLFFBQVEsSUFBSSxDQUFDO1NBQ2xDO1FBRUgsT0FBT3hDLE9BQU9FLElBQUksQ0FBQyxFQUFFO0lBQ3ZCO0FBQ0Y7QUExUWFQLGFBQUFBLG9FQUFBQTtJQURaRCw0RUFBVUEsQ0FBQzs7O0dBQ0NDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2Rhby9zdWJqZWN0LmRhby50cz83ZTRlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSAnQC9jb3JlL2RhdGFiYXNlJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAL2RlY29yYXRvcnMvaW5qZWN0YWJsZS5kZWNvcmF0b3InO1xuaW1wb3J0IHR5cGUgeyBTdWJqZWN0LCBTdWJqZWN0RGV0YWlsIH0gZnJvbSAnQC9lbnRpdGllcyc7XG5cbi8qKlxuICog5a2m56eRIERBT1xuICog6LSf6LSj5a2m56eR55u45YWz55qE5pWw5o2u5bqT5pON5L2c77yM5L2/55So5Y+C5pWw5YyW5p+l6K+i6Ziy5q2iIFNRTCDms6jlhaVcbiAqL1xuQEluamVjdGFibGUoJ1N1YmplY3REQU8nKVxuZXhwb3J0IGNsYXNzIFN1YmplY3REQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmiYDmnInlrabnp5HvvIjmnKrliKDpmaTvvIlcbiAgICovXG4gIGFzeW5jIGZpbmRBbGwoKTogUHJvbWlzZTxTdWJqZWN0W10+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFN1YmplY3Q+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuc3ViamVjdHMgV0hFUkUgZGVsZXRlZF9hdCBJUyBOVUxMIE9SREVSIEJZIHNvcnRfb3JkZXIgQVNDLCBjcmVhdGVkX2F0IEFTQycsXG4gICAgICBbXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNruWIhuexuyBJRCDmn6Xmib7lrabnp5HvvIjmlK/mjIHliIbpobXlkozmkJzntKLvvIlcbiAgICovXG4gIGFzeW5jIGZpbmRCeUNhdGVnb3J5SWQoXG4gICAgY2F0ZWdvcnlJZDogc3RyaW5nIHwgbnVsbCxcbiAgICBvcHRpb25zPzogeyBjdXJyZW50PzogbnVtYmVyOyBwYWdlU2l6ZT86IG51bWJlcjsga2V5d29yZD86IHN0cmluZyB9XG4gICk6IFByb21pc2U8eyBzdWJqZWN0czogU3ViamVjdFtdOyB0b3RhbDogbnVtYmVyIH0+IHtcbiAgICBjb25zdCBjdXJyZW50ID0gb3B0aW9ucz8uY3VycmVudCB8fCAxO1xuICAgIGNvbnN0IHBhZ2VTaXplID0gb3B0aW9ucz8ucGFnZVNpemUgfHwgMjA7XG4gICAgY29uc3Qgb2Zmc2V0ID0gKGN1cnJlbnQgLSAxKSAqIHBhZ2VTaXplO1xuICAgIGNvbnN0IGtleXdvcmQgPSBvcHRpb25zPy5rZXl3b3JkPy50cmltKCk7XG5cbiAgICBsZXQgY291bnRRdWVyeTogc3RyaW5nO1xuICAgIGxldCBsaXN0UXVlcnk6IHN0cmluZztcbiAgICBjb25zdCBwYXJhbXM6IGFueVtdID0gW107XG4gICAgbGV0IHBhcmFtSW5kZXggPSAxO1xuXG4gICAgaWYgKGNhdGVnb3J5SWQpIHtcbiAgICAgIGNvbnN0IGtleXdvcmRDb25kaXRpb24gPSBrZXl3b3JkID8gYCBBTkQgKG5hbWUgSUxJS0UgJCR7cGFyYW1JbmRleCArIDF9IE9SIGNvZGUgSUxJS0UgJCR7cGFyYW1JbmRleCArIDF9KWAgOiAnJztcbiAgICAgIGNvbnN0IGtleXdvcmRQYXJhbSA9IGtleXdvcmQgPyBgJSR7a2V5d29yZH0lYCA6IG51bGw7XG4gICAgICBjb3VudFF1ZXJ5ID0gYFNFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NIHBpa3VuX2RiLnN1YmplY3RzIFdIRVJFIGNhdGVnb3J5X2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCR7a2V5d29yZENvbmRpdGlvbn1gO1xuICAgICAgbGlzdFF1ZXJ5ID0gYFNFTEVDVCAqIEZST00gcGlrdW5fZGIuc3ViamVjdHMgV0hFUkUgY2F0ZWdvcnlfaWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJHtrZXl3b3JkQ29uZGl0aW9ufSBPUkRFUiBCWSBzb3J0X29yZGVyIEFTQywgY3JlYXRlZF9hdCBBU0MgTElNSVQgJCR7cGFyYW1JbmRleCArIChrZXl3b3JkID8gMiA6IDEpfSBPRkZTRVQgJCR7cGFyYW1JbmRleCArIChrZXl3b3JkID8gMyA6IDIpfWA7XG4gICAgICBwYXJhbXMucHVzaChjYXRlZ29yeUlkKTtcbiAgICAgIGlmIChrZXl3b3JkKSB7XG4gICAgICAgIHBhcmFtcy5wdXNoKGtleXdvcmRQYXJhbSwgcGFnZVNpemUsIG9mZnNldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXJhbXMucHVzaChwYWdlU2l6ZSwgb2Zmc2V0KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8g5p+l6K+i5omA5pyJ5a2m56eR77yI5LiN5YiG5YiG57G777yJXG4gICAgICBjb25zdCBrZXl3b3JkQ29uZGl0aW9uID0ga2V5d29yZCA/IGAgQU5EIChuYW1lIElMSUtFICQke3BhcmFtSW5kZXh9IE9SIGNvZGUgSUxJS0UgJCR7cGFyYW1JbmRleH0pYCA6ICcnO1xuICAgICAgY29uc3Qga2V5d29yZFBhcmFtID0ga2V5d29yZCA/IGAlJHtrZXl3b3JkfSVgIDogbnVsbDtcbiAgICAgIGNvdW50UXVlcnkgPSBgU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gcGlrdW5fZGIuc3ViamVjdHMgV0hFUkUgZGVsZXRlZF9hdCBJUyBOVUxMJHtrZXl3b3JkQ29uZGl0aW9ufWA7XG4gICAgICBsaXN0UXVlcnkgPSBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5zdWJqZWN0cyBXSEVSRSBkZWxldGVkX2F0IElTIE5VTEwke2tleXdvcmRDb25kaXRpb259IE9SREVSIEJZIHNvcnRfb3JkZXIgQVNDLCBjcmVhdGVkX2F0IEFTQyBMSU1JVCAkJHtwYXJhbUluZGV4ICsgKGtleXdvcmQgPyAxIDogMCl9IE9GRlNFVCAkJHtwYXJhbUluZGV4ICsgKGtleXdvcmQgPyAyIDogMSl9YDtcbiAgICAgIGlmIChrZXl3b3JkKSB7XG4gICAgICAgIHBhcmFtcy5wdXNoKGtleXdvcmRQYXJhbSwgcGFnZVNpemUsIG9mZnNldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXJhbXMucHVzaChwYWdlU2l6ZSwgb2Zmc2V0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBjb3VudFBhcmFtcyA9IGNhdGVnb3J5SWQgPyAoa2V5d29yZCA/IFtjYXRlZ29yeUlkLCBrZXl3b3JkUGFyYW1dIDogW2NhdGVnb3J5SWRdKSA6IChrZXl3b3JkID8gW2tleXdvcmRQYXJhbV0gOiBbXSk7XG4gICAgY29uc3QgY291bnRSZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PHsgY291bnQ6IHN0cmluZyB9Pihjb3VudFF1ZXJ5LCBjb3VudFBhcmFtcyk7XG4gICAgY29uc3QgdG90YWwgPSBwYXJzZUludChjb3VudFJlc3VsdC5yb3dzWzBdLmNvdW50LCAxMCk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFN1YmplY3Q+KGxpc3RRdWVyeSwgcGFyYW1zKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWJqZWN0czogcmVzdWx0LnJvd3MsXG4gICAgICB0b3RhbCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBJRCDmn6Xmib7lrabnp5FcbiAgICovXG4gIGFzeW5jIGZpbmRCeUlkKHN1YmplY3RJZDogc3RyaW5nKTogUHJvbWlzZTxTdWJqZWN0IHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8U3ViamVjdD4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5zdWJqZWN0cyBXSEVSRSBzdWJqZWN0X2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbc3ViamVjdElkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u5Luj56CB5p+l5om+5a2m56eRXG4gICAqL1xuICBhc3luYyBmaW5kQnlDb2RlKGNvZGU6IHN0cmluZyk6IFByb21pc2U8U3ViamVjdCB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFN1YmplY3Q+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuc3ViamVjdHMgV0hFUkUgY29kZSA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW2NvZGVdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlrabnp5FcbiAgICovXG4gIGFzeW5jIGNyZWF0ZShkYXRhOiB7XG4gICAgY2F0ZWdvcnlfaWQ6IHN0cmluZztcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHNob3J0X25hbWU/OiBzdHJpbmc7XG4gICAgaWNvbl91cmw/OiBzdHJpbmc7XG4gICAgY292ZXJfaW1hZ2VfdXJsPzogc3RyaW5nO1xuICAgIHNvcnRfb3JkZXI/OiBudW1iZXI7XG4gICAgaXNfcHVibGlzaGVkPzogYm9vbGVhbjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFN1YmplY3Q+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFN1YmplY3Q+KFxuICAgICAgYElOU0VSVCBJTlRPIHBpa3VuX2RiLnN1YmplY3RzIChjYXRlZ29yeV9pZCwgY29kZSwgbmFtZSwgc2hvcnRfbmFtZSwgaWNvbl91cmwsIGNvdmVyX2ltYWdlX3VybCwgc29ydF9vcmRlciwgaXNfcHVibGlzaGVkLCBtZXRhZGF0YSlcbiAgICAgICBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYsICQ3LCAkOCwgJDkpXG4gICAgICAgUkVUVVJOSU5HICpgLFxuICAgICAgW1xuICAgICAgICBkYXRhLmNhdGVnb3J5X2lkLFxuICAgICAgICBkYXRhLmNvZGUsXG4gICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgZGF0YS5zaG9ydF9uYW1lIHx8IG51bGwsXG4gICAgICAgIGRhdGEuaWNvbl91cmwgfHwgbnVsbCxcbiAgICAgICAgZGF0YS5jb3Zlcl9pbWFnZV91cmwgfHwgbnVsbCxcbiAgICAgICAgZGF0YS5zb3J0X29yZGVyIHx8IDAsXG4gICAgICAgIGRhdGEuaXNfcHVibGlzaGVkICE9PSB1bmRlZmluZWQgPyBkYXRhLmlzX3B1Ymxpc2hlZCA6IGZhbHNlLFxuICAgICAgICBKU09OLnN0cmluZ2lmeShkYXRhLm1ldGFkYXRhIHx8IHt9KSxcbiAgICAgIF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrDlrabnp5FcbiAgICovXG4gIGFzeW5jIHVwZGF0ZShcbiAgICBzdWJqZWN0SWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICBjYXRlZ29yeV9pZD86IHN0cmluZztcbiAgICAgIGNvZGU/OiBzdHJpbmc7XG4gICAgICBuYW1lPzogc3RyaW5nO1xuICAgICAgc2hvcnRfbmFtZT86IHN0cmluZztcbiAgICAgIGljb25fdXJsPzogc3RyaW5nO1xuICAgICAgY292ZXJfaW1hZ2VfdXJsPzogc3RyaW5nO1xuICAgICAgc29ydF9vcmRlcj86IG51bWJlcjtcbiAgICAgIGlzX3B1Ymxpc2hlZD86IGJvb2xlYW47XG4gICAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gICAgfVxuICApOiBQcm9taXNlPFN1YmplY3Q+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLmNhdGVnb3J5X2lkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBjYXRlZ29yeV9pZCA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMuY2F0ZWdvcnlfaWQpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5jb2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBjb2RlID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jb2RlKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgbmFtZSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMubmFtZSk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLnNob3J0X25hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYHNob3J0X25hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnNob3J0X25hbWUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5pY29uX3VybCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgaWNvbl91cmwgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmljb25fdXJsKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuY292ZXJfaW1hZ2VfdXJsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBjb3Zlcl9pbWFnZV91cmwgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmNvdmVyX2ltYWdlX3VybCk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLnNvcnRfb3JkZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYHNvcnRfb3JkZXIgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnNvcnRfb3JkZXIpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5pc19wdWJsaXNoZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGlzX3B1Ymxpc2hlZCA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMuaXNfcHVibGlzaGVkKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlJZChzdWJqZWN0SWQpIGFzIFByb21pc2U8U3ViamVjdD47XG4gICAgfVxuXG4gICAgdmFsdWVzLnB1c2goc3ViamVjdElkKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFN1YmplY3Q+KFxuICAgICAgYFVQREFURSBwaWt1bl9kYi5zdWJqZWN0cyBTRVQgJHtmaWVsZHMuam9pbignLCAnKX0gV0hFUkUgc3ViamVjdF9pZCA9ICQke3BhcmFtSW5kZXh9IEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICB2YWx1ZXNcbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTlrabnp5HvvIjova/liKDpmaTvvIlcbiAgICovXG4gIGFzeW5jIGRlbGV0ZShzdWJqZWN0SWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuZGIucXVlcnkoXG4gICAgICAnVVBEQVRFIHBpa3VuX2RiLnN1YmplY3RzIFNFVCBkZWxldGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgc3ViamVjdF9pZCA9ICQxJyxcbiAgICAgIFtzdWJqZWN0SWRdXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blrabnp5Hor6bmg4VcbiAgICovXG4gIGFzeW5jIGZpbmREZXRhaWxCeVN1YmplY3RJZChzdWJqZWN0SWQ6IHN0cmluZyk6IFByb21pc2U8U3ViamVjdERldGFpbCB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFN1YmplY3REZXRhaWw+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuc3ViamVjdF9kZXRhaWxzIFdIRVJFIHN1YmplY3RfaWQgPSAkMScsXG4gICAgICBbc3ViamVjdElkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65oiW5pu05paw5a2m56eR6K+m5oOFXG4gICAqL1xuICBhc3luYyB1cHNlcnREZXRhaWwoZGF0YToge1xuICAgIHN1YmplY3RfaWQ6IHN0cmluZztcbiAgICBkZWZpbml0aW9uPzogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIHB1cnBvc2U/OiBzdHJpbmc7XG4gICAgdmFsdWU/OiBzdHJpbmc7XG4gICAgYXBwbGljYXRpb25fc2NlbmFyaW9zPzogc3RyaW5nO1xuICAgIGxlYXJuaW5nX29iamVjdGl2ZXM/OiBzdHJpbmc7XG4gICAgcHJlcmVxdWlzaXRlcz86IHN0cmluZztcbiAgICByZWxhdGVkX3N1YmplY3RzPzogc3RyaW5nW107XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxTdWJqZWN0RGV0YWlsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxTdWJqZWN0RGV0YWlsPihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi5zdWJqZWN0X2RldGFpbHMgKFxuICAgICAgICBzdWJqZWN0X2lkLCBkZWZpbml0aW9uLCBkZXNjcmlwdGlvbiwgcHVycG9zZSwgdmFsdWUsIGFwcGxpY2F0aW9uX3NjZW5hcmlvcyxcbiAgICAgICAgbGVhcm5pbmdfb2JqZWN0aXZlcywgcHJlcmVxdWlzaXRlcywgcmVsYXRlZF9zdWJqZWN0cywgbWV0YWRhdGFcbiAgICAgIClcbiAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4LCAkOSwgJDEwKVxuICAgICAgT04gQ09ORkxJQ1QgKHN1YmplY3RfaWQpIERPIFVQREFURSBTRVRcbiAgICAgICAgZGVmaW5pdGlvbiA9IEVYQ0xVREVELmRlZmluaXRpb24sXG4gICAgICAgIGRlc2NyaXB0aW9uID0gRVhDTFVERUQuZGVzY3JpcHRpb24sXG4gICAgICAgIHB1cnBvc2UgPSBFWENMVURFRC5wdXJwb3NlLFxuICAgICAgICB2YWx1ZSA9IEVYQ0xVREVELnZhbHVlLFxuICAgICAgICBhcHBsaWNhdGlvbl9zY2VuYXJpb3MgPSBFWENMVURFRC5hcHBsaWNhdGlvbl9zY2VuYXJpb3MsXG4gICAgICAgIGxlYXJuaW5nX29iamVjdGl2ZXMgPSBFWENMVURFRC5sZWFybmluZ19vYmplY3RpdmVzLFxuICAgICAgICBwcmVyZXF1aXNpdGVzID0gRVhDTFVERUQucHJlcmVxdWlzaXRlcyxcbiAgICAgICAgcmVsYXRlZF9zdWJqZWN0cyA9IEVYQ0xVREVELnJlbGF0ZWRfc3ViamVjdHMsXG4gICAgICAgIG1ldGFkYXRhID0gRVhDTFVERUQubWV0YWRhdGEsXG4gICAgICAgIHVwZGF0ZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgUkVUVVJOSU5HICpgLFxuICAgICAgW1xuICAgICAgICBkYXRhLnN1YmplY3RfaWQsXG4gICAgICAgIGRhdGEuZGVmaW5pdGlvbiB8fCBudWxsLFxuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uIHx8IG51bGwsXG4gICAgICAgIGRhdGEucHVycG9zZSB8fCBudWxsLFxuICAgICAgICBkYXRhLnZhbHVlIHx8IG51bGwsXG4gICAgICAgIGRhdGEuYXBwbGljYXRpb25fc2NlbmFyaW9zIHx8IG51bGwsXG4gICAgICAgIGRhdGEubGVhcm5pbmdfb2JqZWN0aXZlcyB8fCBudWxsLFxuICAgICAgICBkYXRhLnByZXJlcXVpc2l0ZXMgfHwgbnVsbCxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoZGF0YS5yZWxhdGVkX3N1YmplY3RzIHx8IFtdKSxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoZGF0YS5tZXRhZGF0YSB8fCB7fSksXG4gICAgICBdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIkRhdGFiYXNlIiwiSW5qZWN0YWJsZSIsIlN1YmplY3REQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJmaW5kQWxsIiwicmVzdWx0IiwicXVlcnkiLCJyb3dzIiwiZmluZEJ5Q2F0ZWdvcnlJZCIsImNhdGVnb3J5SWQiLCJvcHRpb25zIiwiY3VycmVudCIsInBhZ2VTaXplIiwib2Zmc2V0Iiwia2V5d29yZCIsInRyaW0iLCJjb3VudFF1ZXJ5IiwibGlzdFF1ZXJ5IiwicGFyYW1zIiwicGFyYW1JbmRleCIsImtleXdvcmRDb25kaXRpb24iLCJrZXl3b3JkUGFyYW0iLCJwdXNoIiwiY291bnRQYXJhbXMiLCJjb3VudFJlc3VsdCIsInRvdGFsIiwicGFyc2VJbnQiLCJjb3VudCIsInN1YmplY3RzIiwiZmluZEJ5SWQiLCJzdWJqZWN0SWQiLCJmaW5kQnlDb2RlIiwiY29kZSIsImNyZWF0ZSIsImRhdGEiLCJjYXRlZ29yeV9pZCIsIm5hbWUiLCJzaG9ydF9uYW1lIiwiaWNvbl91cmwiLCJjb3Zlcl9pbWFnZV91cmwiLCJzb3J0X29yZGVyIiwiaXNfcHVibGlzaGVkIiwidW5kZWZpbmVkIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwidXBkYXRlIiwidXBkYXRlcyIsImZpZWxkcyIsInZhbHVlcyIsImxlbmd0aCIsImpvaW4iLCJkZWxldGUiLCJmaW5kRGV0YWlsQnlTdWJqZWN0SWQiLCJ1cHNlcnREZXRhaWwiLCJzdWJqZWN0X2lkIiwiZGVmaW5pdGlvbiIsImRlc2NyaXB0aW9uIiwicHVycG9zZSIsInZhbHVlIiwiYXBwbGljYXRpb25fc2NlbmFyaW9zIiwibGVhcm5pbmdfb2JqZWN0aXZlcyIsInByZXJlcXVpc2l0ZXMiLCJyZWxhdGVkX3N1YmplY3RzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/subject.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/user-ability-experience-log.dao.ts":
/*!****************************************************!*\
  !*** ./src/dao/user-ability-experience-log.dao.ts ***!
  \****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserAbilityExperienceLogDAO: () => (/* binding */ UserAbilityExperienceLogDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass UserAbilityExperienceLogDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 获取用户的经验记录\n   */ async findByUserId(uid, options) {\n        let query = \"SELECT * FROM pikun_db.user_ability_experience_logs WHERE uid = $1\";\n        const params = [\n            uid\n        ];\n        let paramIndex = 2;\n        if (options?.itemId) {\n            query += ` AND item_id = $${paramIndex++}`;\n            params.push(options.itemId);\n        }\n        if (options?.expType) {\n            query += ` AND exp_type = $${paramIndex++}`;\n            params.push(options.expType);\n        }\n        query += \" ORDER BY created_at DESC\";\n        if (options?.limit) {\n            query += ` LIMIT $${paramIndex++}`;\n            params.push(options.limit);\n            if (options?.offset) {\n                query += ` OFFSET $${paramIndex++}`;\n                params.push(options.offset);\n            }\n        }\n        const result = await this.db.query(query, params);\n        return result.rows;\n    }\n    /**\n   * 创建经验记录\n   */ async create(data) {\n        const result = await this.db.query(`INSERT INTO pikun_db.user_ability_experience_logs (\n        uid, item_id, exp_amount, exp_type, source_id, source_type,\n        before_level, after_level, before_exp, after_exp, is_level_up, notes, metadata\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13)\n       RETURNING *`, [\n            data.uid,\n            data.item_id,\n            data.exp_amount,\n            data.exp_type,\n            data.source_id || null,\n            data.source_type || null,\n            data.before_level,\n            data.after_level,\n            data.before_exp,\n            data.after_exp,\n            data.is_level_up,\n            data.notes || null,\n            JSON.stringify(data.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n}\nUserAbilityExperienceLogDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"UserAbilityExperienceLogDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], UserAbilityExperienceLogDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGFvL3VzZXItYWJpbGl0eS1leHBlcmllbmNlLWxvZy5kYW8udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQTJDO0FBQ29CO0FBUXhELE1BQU1FO0lBR1hDLGFBQWM7UUFDWixJQUFJLENBQUNDLEVBQUUsR0FBR0osb0RBQVFBLENBQUNLLFdBQVc7SUFDaEM7SUFFQTs7R0FFQyxHQUNELE1BQU1DLGFBQ0pDLEdBQVcsRUFDWEMsT0FLQyxFQUNvQztRQUNyQyxJQUFJQyxRQUFRO1FBQ1osTUFBTUMsU0FBZ0I7WUFBQ0g7U0FBSTtRQUMzQixJQUFJSSxhQUFhO1FBRWpCLElBQUlILFNBQVNJLFFBQVE7WUFDbkJILFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRUUsYUFBYSxDQUFDO1lBQzFDRCxPQUFPRyxJQUFJLENBQUNMLFFBQVFJLE1BQU07UUFDNUI7UUFDQSxJQUFJSixTQUFTTSxTQUFTO1lBQ3BCTCxTQUFTLENBQUMsaUJBQWlCLEVBQUVFLGFBQWEsQ0FBQztZQUMzQ0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRTSxPQUFPO1FBQzdCO1FBRUFMLFNBQVM7UUFFVCxJQUFJRCxTQUFTTyxPQUFPO1lBQ2xCTixTQUFTLENBQUMsUUFBUSxFQUFFRSxhQUFhLENBQUM7WUFDbENELE9BQU9HLElBQUksQ0FBQ0wsUUFBUU8sS0FBSztZQUN6QixJQUFJUCxTQUFTUSxRQUFRO2dCQUNuQlAsU0FBUyxDQUFDLFNBQVMsRUFBRUUsYUFBYSxDQUFDO2dCQUNuQ0QsT0FBT0csSUFBSSxDQUFDTCxRQUFRUSxNQUFNO1lBQzVCO1FBQ0Y7UUFFQSxNQUFNQyxTQUFTLE1BQU0sSUFBSSxDQUFDYixFQUFFLENBQUNLLEtBQUssQ0FBMkJBLE9BQU9DO1FBQ3BFLE9BQU9PLE9BQU9DLElBQUk7SUFDcEI7SUFFQTs7R0FFQyxHQUNELE1BQU1DLE9BQU9DLElBY1osRUFBcUM7UUFDcEMsTUFBTUgsU0FBUyxNQUFNLElBQUksQ0FBQ2IsRUFBRSxDQUFDSyxLQUFLLENBQ2hDLENBQUM7Ozs7a0JBSVcsQ0FBQyxFQUNiO1lBQ0VXLEtBQUtiLEdBQUc7WUFDUmEsS0FBS0MsT0FBTztZQUNaRCxLQUFLRSxVQUFVO1lBQ2ZGLEtBQUtHLFFBQVE7WUFDYkgsS0FBS0ksU0FBUyxJQUFJO1lBQ2xCSixLQUFLSyxXQUFXLElBQUk7WUFDcEJMLEtBQUtNLFlBQVk7WUFDakJOLEtBQUtPLFdBQVc7WUFDaEJQLEtBQUtRLFVBQVU7WUFDZlIsS0FBS1MsU0FBUztZQUNkVCxLQUFLVSxXQUFXO1lBQ2hCVixLQUFLVyxLQUFLLElBQUk7WUFDZEMsS0FBS0MsU0FBUyxDQUFDYixLQUFLYyxRQUFRLElBQUksQ0FBQztTQUNsQztRQUVILE9BQU9qQixPQUFPQyxJQUFJLENBQUMsRUFBRTtJQUN2QjtBQUNGO0FBekZhaEIsOEJBQUFBLG9FQUFBQTtJQURaRCw0RUFBVUEsQ0FBQzs7O0dBQ0NDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2Rhby91c2VyLWFiaWxpdHktZXhwZXJpZW5jZS1sb2cuZGFvLnRzPzQ3ZDciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IFVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZyB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOeUqOaIt+e7j+mqjOiOt+W+l+iusOW9lSBEQU9cbiAqIOi0n+i0o+eUqOaIt+e7j+mqjOiOt+W+l+iusOW9leebuOWFs+eahOaVsOaNruW6k+aTjeS9nO+8jOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWlXG4gKi9cbkBJbmplY3RhYmxlKCdVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2dEQU8nKVxuZXhwb3J0IGNsYXNzIFVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ0RBTyB7XG4gIHByaXZhdGUgZGI6IERhdGFiYXNlO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZGIgPSBEYXRhYmFzZS5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlueUqOaIt+eahOe7j+mqjOiusOW9lVxuICAgKi9cbiAgYXN5bmMgZmluZEJ5VXNlcklkKFxuICAgIHVpZDogbnVtYmVyLFxuICAgIG9wdGlvbnM/OiB7XG4gICAgICBpdGVtSWQ/OiBzdHJpbmc7XG4gICAgICBleHBUeXBlPzogc3RyaW5nO1xuICAgICAgbGltaXQ/OiBudW1iZXI7XG4gICAgICBvZmZzZXQ/OiBudW1iZXI7XG4gICAgfVxuICApOiBQcm9taXNlPFVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ1tdPiB7XG4gICAgbGV0IHF1ZXJ5ID0gJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIudXNlcl9hYmlsaXR5X2V4cGVyaWVuY2VfbG9ncyBXSEVSRSB1aWQgPSAkMSc7XG4gICAgY29uc3QgcGFyYW1zOiBhbnlbXSA9IFt1aWRdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMjtcblxuICAgIGlmIChvcHRpb25zPy5pdGVtSWQpIHtcbiAgICAgIHF1ZXJ5ICs9IGAgQU5EIGl0ZW1faWQgPSAkJHtwYXJhbUluZGV4Kyt9YDtcbiAgICAgIHBhcmFtcy5wdXNoKG9wdGlvbnMuaXRlbUlkKTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnM/LmV4cFR5cGUpIHtcbiAgICAgIHF1ZXJ5ICs9IGAgQU5EIGV4cF90eXBlID0gJCR7cGFyYW1JbmRleCsrfWA7XG4gICAgICBwYXJhbXMucHVzaChvcHRpb25zLmV4cFR5cGUpO1xuICAgIH1cblxuICAgIHF1ZXJ5ICs9ICcgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDJztcblxuICAgIGlmIChvcHRpb25zPy5saW1pdCkge1xuICAgICAgcXVlcnkgKz0gYCBMSU1JVCAkJHtwYXJhbUluZGV4Kyt9YDtcbiAgICAgIHBhcmFtcy5wdXNoKG9wdGlvbnMubGltaXQpO1xuICAgICAgaWYgKG9wdGlvbnM/Lm9mZnNldCkge1xuICAgICAgICBxdWVyeSArPSBgIE9GRlNFVCAkJHtwYXJhbUluZGV4Kyt9YDtcbiAgICAgICAgcGFyYW1zLnB1c2gob3B0aW9ucy5vZmZzZXQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8VXNlckFiaWxpdHlFeHBlcmllbmNlTG9nPihxdWVyeSwgcGFyYW1zKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3M7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu657uP6aqM6K6w5b2VXG4gICAqL1xuICBhc3luYyBjcmVhdGUoZGF0YToge1xuICAgIHVpZDogbnVtYmVyO1xuICAgIGl0ZW1faWQ6IHN0cmluZztcbiAgICBleHBfYW1vdW50OiBudW1iZXI7XG4gICAgZXhwX3R5cGU6IHN0cmluZztcbiAgICBzb3VyY2VfaWQ/OiBzdHJpbmc7XG4gICAgc291cmNlX3R5cGU/OiBzdHJpbmc7XG4gICAgYmVmb3JlX2xldmVsOiBudW1iZXI7XG4gICAgYWZ0ZXJfbGV2ZWw6IG51bWJlcjtcbiAgICBiZWZvcmVfZXhwOiBudW1iZXI7XG4gICAgYWZ0ZXJfZXhwOiBudW1iZXI7XG4gICAgaXNfbGV2ZWxfdXA6IGJvb2xlYW47XG4gICAgbm90ZXM/OiBzdHJpbmc7XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2c+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZz4oXG4gICAgICBgSU5TRVJUIElOVE8gcGlrdW5fZGIudXNlcl9hYmlsaXR5X2V4cGVyaWVuY2VfbG9ncyAoXG4gICAgICAgIHVpZCwgaXRlbV9pZCwgZXhwX2Ftb3VudCwgZXhwX3R5cGUsIHNvdXJjZV9pZCwgc291cmNlX3R5cGUsXG4gICAgICAgIGJlZm9yZV9sZXZlbCwgYWZ0ZXJfbGV2ZWwsIGJlZm9yZV9leHAsIGFmdGVyX2V4cCwgaXNfbGV2ZWxfdXAsIG5vdGVzLCBtZXRhZGF0YVxuICAgICAgKSBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYsICQ3LCAkOCwgJDksICQxMCwgJDExLCAkMTIsICQxMylcbiAgICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICBbXG4gICAgICAgIGRhdGEudWlkLFxuICAgICAgICBkYXRhLml0ZW1faWQsXG4gICAgICAgIGRhdGEuZXhwX2Ftb3VudCxcbiAgICAgICAgZGF0YS5leHBfdHlwZSxcbiAgICAgICAgZGF0YS5zb3VyY2VfaWQgfHwgbnVsbCxcbiAgICAgICAgZGF0YS5zb3VyY2VfdHlwZSB8fCBudWxsLFxuICAgICAgICBkYXRhLmJlZm9yZV9sZXZlbCxcbiAgICAgICAgZGF0YS5hZnRlcl9sZXZlbCxcbiAgICAgICAgZGF0YS5iZWZvcmVfZXhwLFxuICAgICAgICBkYXRhLmFmdGVyX2V4cCxcbiAgICAgICAgZGF0YS5pc19sZXZlbF91cCxcbiAgICAgICAgZGF0YS5ub3RlcyB8fCBudWxsLFxuICAgICAgICBKU09OLnN0cmluZ2lmeShkYXRhLm1ldGFkYXRhIHx8IHt9KSxcbiAgICAgIF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiRGF0YWJhc2UiLCJJbmplY3RhYmxlIiwiVXNlckFiaWxpdHlFeHBlcmllbmNlTG9nREFPIiwiY29uc3RydWN0b3IiLCJkYiIsImdldEluc3RhbmNlIiwiZmluZEJ5VXNlcklkIiwidWlkIiwib3B0aW9ucyIsInF1ZXJ5IiwicGFyYW1zIiwicGFyYW1JbmRleCIsIml0ZW1JZCIsInB1c2giLCJleHBUeXBlIiwibGltaXQiLCJvZmZzZXQiLCJyZXN1bHQiLCJyb3dzIiwiY3JlYXRlIiwiZGF0YSIsIml0ZW1faWQiLCJleHBfYW1vdW50IiwiZXhwX3R5cGUiLCJzb3VyY2VfaWQiLCJzb3VyY2VfdHlwZSIsImJlZm9yZV9sZXZlbCIsImFmdGVyX2xldmVsIiwiYmVmb3JlX2V4cCIsImFmdGVyX2V4cCIsImlzX2xldmVsX3VwIiwibm90ZXMiLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YWRhdGEiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/user-ability-experience-log.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/user-ability-level.dao.ts":
/*!*******************************************!*\
  !*** ./src/dao/user-ability-level.dao.ts ***!
  \*******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserAbilityLevelDAO: () => (/* binding */ UserAbilityLevelDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass UserAbilityLevelDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 规范化数字字段（PostgreSQL BIGINT 可能返回为字符串）\n   */ normalizeUserLevel(level) {\n        return {\n            ...level,\n            current_level: Number(level.current_level),\n            current_exp: Number(level.current_exp),\n            total_exp: Number(level.total_exp),\n            level_up_count: Number(level.level_up_count)\n        };\n    }\n    /**\n   * 获取用户的所有能力等级\n   */ async findByUserId(uid) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.user_ability_levels WHERE uid = $1 ORDER BY created_at ASC\", [\n            uid\n        ]);\n        return result.rows.map((row)=>this.normalizeUserLevel(row));\n    }\n    /**\n   * 根据用户ID和能力项ID查找\n   */ async findByUserAndItem(uid, itemId) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.user_ability_levels WHERE uid = $1 AND item_id = $2\", [\n            uid,\n            itemId\n        ]);\n        return result.rows[0] ? this.normalizeUserLevel(result.rows[0]) : null;\n    }\n    /**\n   * 创建或更新用户能力等级\n   */ async upsert(data) {\n        const existing = await this.findByUserAndItem(data.uid, data.item_id);\n        if (existing) {\n            return this.update(data.uid, data.item_id, {\n                current_level: data.current_level,\n                current_exp: data.current_exp,\n                total_exp: data.total_exp,\n                level_up_count: data.level_up_count,\n                last_level_up_at: data.last_level_up_at,\n                metadata: data.metadata\n            });\n        }\n        return this.create(data);\n    }\n    /**\n   * 创建用户能力等级\n   */ async create(data) {\n        const result = await this.db.query(`INSERT INTO pikun_db.user_ability_levels (\n        uid, item_id, current_level, current_exp, total_exp, level_up_count, last_level_up_at, metadata\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)\n       RETURNING *`, [\n            data.uid,\n            data.item_id,\n            data.current_level || 1,\n            data.current_exp || 0,\n            data.total_exp || 0,\n            data.level_up_count || 0,\n            data.last_level_up_at || null,\n            JSON.stringify(data.metadata || {})\n        ]);\n        return this.normalizeUserLevel(result.rows[0]);\n    }\n    /**\n   * 更新用户能力等级\n   */ async update(uid, itemId, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.current_level !== undefined) {\n            fields.push(`current_level = $${paramIndex++}`);\n            values.push(updates.current_level);\n        }\n        if (updates.current_exp !== undefined) {\n            fields.push(`current_exp = $${paramIndex++}`);\n            values.push(updates.current_exp);\n        }\n        if (updates.total_exp !== undefined) {\n            fields.push(`total_exp = $${paramIndex++}`);\n            values.push(updates.total_exp);\n        }\n        if (updates.level_up_count !== undefined) {\n            fields.push(`level_up_count = $${paramIndex++}`);\n            values.push(updates.level_up_count);\n        }\n        if (updates.last_level_up_at !== undefined) {\n            fields.push(`last_level_up_at = $${paramIndex++}`);\n            values.push(updates.last_level_up_at);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findByUserAndItem(uid, itemId);\n        }\n        values.push(uid, itemId);\n        const result = await this.db.query(`UPDATE pikun_db.user_ability_levels SET ${fields.join(\", \")} WHERE uid = $${paramIndex} AND item_id = $${paramIndex + 1}\n       RETURNING *`, values);\n        return this.normalizeUserLevel(result.rows[0]);\n    }\n    /**\n   * 增加经验值\n   */ async addExperience(uid, itemId, expAmount) {\n        const existing = await this.findByUserAndItem(uid, itemId);\n        if (!existing) {\n            return this.create({\n                uid,\n                item_id: itemId,\n                current_level: 1,\n                current_exp: expAmount,\n                total_exp: expAmount\n            });\n        }\n        // 确保 existing 的数字字段是数字类型（防止字符串拼接）\n        const currentExp = Number(existing.current_exp);\n        const totalExp = Number(existing.total_exp);\n        return this.update(uid, itemId, {\n            current_exp: currentExp + expAmount,\n            total_exp: totalExp + expAmount\n        });\n    }\n}\nUserAbilityLevelDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"UserAbilityLevelDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], UserAbilityLevelDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGFvL3VzZXItYWJpbGl0eS1sZXZlbC5kYW8udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQTJDO0FBQ29CO0FBUXhELE1BQU1FO0lBR1hDLGFBQWM7UUFDWixJQUFJLENBQUNDLEVBQUUsR0FBR0osb0RBQVFBLENBQUNLLFdBQVc7SUFDaEM7SUFFQTs7R0FFQyxHQUNELG1CQUEyQkUsS0FBdUIsRUFBb0I7UUFDcEUsT0FBTztZQUNMLEdBQUdBLEtBQUs7WUFDUkMsZUFBZUMsT0FBT0YsTUFBTUMsYUFBYTtZQUN6Q0UsYUFBYUQsT0FBT0YsTUFBTUcsV0FBVztZQUNyQ0MsV0FBV0YsT0FBT0YsTUFBTUksU0FBUztZQUNqQ0MsZ0JBQWdCSCxPQUFPRixNQUFNSyxjQUFjO1FBQzdDO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1DLGFBQWFDLEdBQVcsRUFBK0I7UUFDM0QsTUFBTUMsU0FBUyxNQUFNLElBQUksQ0FBQ1gsRUFBRSxDQUFDWSxLQUFLLENBQ2hDLHFGQUNBO1lBQUNGO1NBQUk7UUFFUCxPQUFPQyxPQUFPRSxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDQyxNQUFRLElBQUksQ0FBQ2Isa0JBQWtCLENBQUNhO0lBQzFEO0lBRUE7O0dBRUMsR0FDRCxNQUFNQyxrQkFBa0JOLEdBQVcsRUFBRU8sTUFBYyxFQUFvQztRQUNyRixNQUFNTixTQUFTLE1BQU0sSUFBSSxDQUFDWCxFQUFFLENBQUNZLEtBQUssQ0FDaEMsOEVBQ0E7WUFBQ0Y7WUFBS087U0FBTztRQUVmLE9BQU9OLE9BQU9FLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDWCxrQkFBa0IsQ0FBQ1MsT0FBT0UsSUFBSSxDQUFDLEVBQUUsSUFBSTtJQUNwRTtJQUVBOztHQUVDLEdBQ0QsTUFBTUssT0FBT0MsSUFTWixFQUE2QjtRQUM1QixNQUFNQyxXQUFXLE1BQU0sSUFBSSxDQUFDSixpQkFBaUIsQ0FBQ0csS0FBS1QsR0FBRyxFQUFFUyxLQUFLRSxPQUFPO1FBQ3BF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RUEsYUFBYSxFQUFFO2tCQUM3RyxDQUFDLEVBQ2JEO1FBRUYsT0FBTyxJQUFJLENBQUM1QixrQkFBa0IsQ0FBQ1MsT0FBT0UsSUFBSSxDQUFDLEVBQUU7SUFDL0M7SUFFQTs7R0FFQyxHQUNELE1BQU11QixjQUFjMUIsR0FBVyxFQUFFTyxNQUFjLEVBQUVvQixTQUFpQixFQUE2QjtRQUM3RixNQUFNakIsV0FBVyxNQUFNLElBQUksQ0FBQ0osaUJBQWlCLENBQUNOLEtBQUtPO1FBQ25ELElBQUksQ0FBQ0csVUFBVTtZQUNiLE9BQU8sSUFBSSxDQUFDSyxNQUFNLENBQUM7Z0JBQ2pCZjtnQkFDQVcsU0FBU0o7Z0JBQ1RiLGVBQWU7Z0JBQ2ZFLGFBQWErQjtnQkFDYjlCLFdBQVc4QjtZQUNiO1FBQ0Y7UUFDQSxrQ0FBa0M7UUFDbEMsTUFBTUMsYUFBYWpDLE9BQU9lLFNBQVNkLFdBQVc7UUFDOUMsTUFBTWlDLFdBQVdsQyxPQUFPZSxTQUFTYixTQUFTO1FBQzFDLE9BQU8sSUFBSSxDQUFDZSxNQUFNLENBQUNaLEtBQUtPLFFBQVE7WUFDOUJYLGFBQWFnQyxhQUFhRDtZQUMxQjlCLFdBQVdnQyxXQUFXRjtRQUN4QjtJQUNGO0FBQ0Y7QUFwTGF2QyxzQkFBQUEsb0VBQUFBO0lBRFpELDRFQUFVQSxDQUFDOzs7R0FDQ0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvZGFvL3VzZXItYWJpbGl0eS1sZXZlbC5kYW8udHM/MWI0YiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gJ0AvY29yZS9kYXRhYmFzZSc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQC9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yJztcbmltcG9ydCB0eXBlIHsgVXNlckFiaWxpdHlMZXZlbCB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOeUqOaIt+iDveWKm+etiee6pyBEQU9cbiAqIOi0n+i0o+eUqOaIt+iDveWKm+etiee6p+ebuOWFs+eahOaVsOaNruW6k+aTjeS9nO+8jOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWlXG4gKi9cbkBJbmplY3RhYmxlKCdVc2VyQWJpbGl0eUxldmVsREFPJylcbmV4cG9ydCBjbGFzcyBVc2VyQWJpbGl0eUxldmVsREFPIHtcbiAgcHJpdmF0ZSBkYjogRGF0YWJhc2U7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5kYiA9IERhdGFiYXNlLmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog6KeE6IyD5YyW5pWw5a2X5a2X5q6177yIUG9zdGdyZVNRTCBCSUdJTlQg5Y+v6IO96L+U5Zue5Li65a2X56ym5Liy77yJXG4gICAqL1xuICBwcml2YXRlIG5vcm1hbGl6ZVVzZXJMZXZlbChsZXZlbDogVXNlckFiaWxpdHlMZXZlbCk6IFVzZXJBYmlsaXR5TGV2ZWwge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5sZXZlbCxcbiAgICAgIGN1cnJlbnRfbGV2ZWw6IE51bWJlcihsZXZlbC5jdXJyZW50X2xldmVsKSxcbiAgICAgIGN1cnJlbnRfZXhwOiBOdW1iZXIobGV2ZWwuY3VycmVudF9leHApLFxuICAgICAgdG90YWxfZXhwOiBOdW1iZXIobGV2ZWwudG90YWxfZXhwKSxcbiAgICAgIGxldmVsX3VwX2NvdW50OiBOdW1iZXIobGV2ZWwubGV2ZWxfdXBfY291bnQpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE5omA5pyJ6IO95Yqb562J57qnXG4gICAqL1xuICBhc3luYyBmaW5kQnlVc2VySWQodWlkOiBudW1iZXIpOiBQcm9taXNlPFVzZXJBYmlsaXR5TGV2ZWxbXT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8VXNlckFiaWxpdHlMZXZlbD4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi51c2VyX2FiaWxpdHlfbGV2ZWxzIFdIRVJFIHVpZCA9ICQxIE9SREVSIEJZIGNyZWF0ZWRfYXQgQVNDJyxcbiAgICAgIFt1aWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3MubWFwKChyb3cpID0+IHRoaXMubm9ybWFsaXplVXNlckxldmVsKHJvdykpO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNrueUqOaIt0lE5ZKM6IO95Yqb6aG5SUTmn6Xmib5cbiAgICovXG4gIGFzeW5jIGZpbmRCeVVzZXJBbmRJdGVtKHVpZDogbnVtYmVyLCBpdGVtSWQ6IHN0cmluZyk6IFByb21pc2U8VXNlckFiaWxpdHlMZXZlbCB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXJBYmlsaXR5TGV2ZWw+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIudXNlcl9hYmlsaXR5X2xldmVscyBXSEVSRSB1aWQgPSAkMSBBTkQgaXRlbV9pZCA9ICQyJyxcbiAgICAgIFt1aWQsIGl0ZW1JZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSA/IHRoaXMubm9ybWFsaXplVXNlckxldmVsKHJlc3VsdC5yb3dzWzBdKSA6IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65oiW5pu05paw55So5oi36IO95Yqb562J57qnXG4gICAqL1xuICBhc3luYyB1cHNlcnQoZGF0YToge1xuICAgIHVpZDogbnVtYmVyO1xuICAgIGl0ZW1faWQ6IHN0cmluZztcbiAgICBjdXJyZW50X2xldmVsPzogbnVtYmVyO1xuICAgIGN1cnJlbnRfZXhwPzogbnVtYmVyO1xuICAgIHRvdGFsX2V4cD86IG51bWJlcjtcbiAgICBsZXZlbF91cF9jb3VudD86IG51bWJlcjtcbiAgICBsYXN0X2xldmVsX3VwX2F0PzogRGF0ZTtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFVzZXJBYmlsaXR5TGV2ZWw+IHtcbiAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHRoaXMuZmluZEJ5VXNlckFuZEl0ZW0oZGF0YS51aWQsIGRhdGEuaXRlbV9pZCk7XG4gICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy51cGRhdGUoZGF0YS51aWQsIGRhdGEuaXRlbV9pZCwge1xuICAgICAgICBjdXJyZW50X2xldmVsOiBkYXRhLmN1cnJlbnRfbGV2ZWwsXG4gICAgICAgIGN1cnJlbnRfZXhwOiBkYXRhLmN1cnJlbnRfZXhwLFxuICAgICAgICB0b3RhbF9leHA6IGRhdGEudG90YWxfZXhwLFxuICAgICAgICBsZXZlbF91cF9jb3VudDogZGF0YS5sZXZlbF91cF9jb3VudCxcbiAgICAgICAgbGFzdF9sZXZlbF91cF9hdDogZGF0YS5sYXN0X2xldmVsX3VwX2F0LFxuICAgICAgICBtZXRhZGF0YTogZGF0YS5tZXRhZGF0YSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jcmVhdGUoZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu655So5oi36IO95Yqb562J57qnXG4gICAqL1xuICBhc3luYyBjcmVhdGUoZGF0YToge1xuICAgIHVpZDogbnVtYmVyO1xuICAgIGl0ZW1faWQ6IHN0cmluZztcbiAgICBjdXJyZW50X2xldmVsPzogbnVtYmVyO1xuICAgIGN1cnJlbnRfZXhwPzogbnVtYmVyO1xuICAgIHRvdGFsX2V4cD86IG51bWJlcjtcbiAgICBsZXZlbF91cF9jb3VudD86IG51bWJlcjtcbiAgICBsYXN0X2xldmVsX3VwX2F0PzogRGF0ZTtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFVzZXJBYmlsaXR5TGV2ZWw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXJBYmlsaXR5TGV2ZWw+KFxuICAgICAgYElOU0VSVCBJTlRPIHBpa3VuX2RiLnVzZXJfYWJpbGl0eV9sZXZlbHMgKFxuICAgICAgICB1aWQsIGl0ZW1faWQsIGN1cnJlbnRfbGV2ZWwsIGN1cnJlbnRfZXhwLCB0b3RhbF9leHAsIGxldmVsX3VwX2NvdW50LCBsYXN0X2xldmVsX3VwX2F0LCBtZXRhZGF0YVxuICAgICAgKSBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYsICQ3LCAkOClcbiAgICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICBbXG4gICAgICAgIGRhdGEudWlkLFxuICAgICAgICBkYXRhLml0ZW1faWQsXG4gICAgICAgIGRhdGEuY3VycmVudF9sZXZlbCB8fCAxLFxuICAgICAgICBkYXRhLmN1cnJlbnRfZXhwIHx8IDAsXG4gICAgICAgIGRhdGEudG90YWxfZXhwIHx8IDAsXG4gICAgICAgIGRhdGEubGV2ZWxfdXBfY291bnQgfHwgMCxcbiAgICAgICAgZGF0YS5sYXN0X2xldmVsX3VwX2F0IHx8IG51bGwsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGRhdGEubWV0YWRhdGEgfHwge30pLFxuICAgICAgXVxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMubm9ybWFsaXplVXNlckxldmVsKHJlc3VsdC5yb3dzWzBdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrDnlKjmiLfog73lipvnrYnnuqdcbiAgICovXG4gIGFzeW5jIHVwZGF0ZShcbiAgICB1aWQ6IG51bWJlcixcbiAgICBpdGVtSWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICBjdXJyZW50X2xldmVsPzogbnVtYmVyO1xuICAgICAgY3VycmVudF9leHA/OiBudW1iZXI7XG4gICAgICB0b3RhbF9leHA/OiBudW1iZXI7XG4gICAgICBsZXZlbF91cF9jb3VudD86IG51bWJlcjtcbiAgICAgIGxhc3RfbGV2ZWxfdXBfYXQ/OiBEYXRlO1xuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIH1cbiAgKTogUHJvbWlzZTxVc2VyQWJpbGl0eUxldmVsPiB7XG4gICAgY29uc3QgZmllbGRzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHZhbHVlczogYW55W10gPSBbXTtcbiAgICBsZXQgcGFyYW1JbmRleCA9IDE7XG5cbiAgICBpZiAodXBkYXRlcy5jdXJyZW50X2xldmVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBjdXJyZW50X2xldmVsID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jdXJyZW50X2xldmVsKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuY3VycmVudF9leHAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGN1cnJlbnRfZXhwID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jdXJyZW50X2V4cCk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLnRvdGFsX2V4cCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgdG90YWxfZXhwID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy50b3RhbF9leHApO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5sZXZlbF91cF9jb3VudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgbGV2ZWxfdXBfY291bnQgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmxldmVsX3VwX2NvdW50KTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubGFzdF9sZXZlbF91cF9hdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgbGFzdF9sZXZlbF91cF9hdCA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMubGFzdF9sZXZlbF91cF9hdCk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLm1ldGFkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBtZXRhZGF0YSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKEpTT04uc3RyaW5naWZ5KHVwZGF0ZXMubWV0YWRhdGEpKTtcbiAgICB9XG5cbiAgICBpZiAoZmllbGRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuZmluZEJ5VXNlckFuZEl0ZW0odWlkLCBpdGVtSWQpIGFzIFByb21pc2U8VXNlckFiaWxpdHlMZXZlbD47XG4gICAgfVxuXG4gICAgdmFsdWVzLnB1c2godWlkLCBpdGVtSWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8VXNlckFiaWxpdHlMZXZlbD4oXG4gICAgICBgVVBEQVRFIHBpa3VuX2RiLnVzZXJfYWJpbGl0eV9sZXZlbHMgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIHVpZCA9ICQke3BhcmFtSW5kZXh9IEFORCBpdGVtX2lkID0gJCR7cGFyYW1JbmRleCArIDF9XG4gICAgICAgUkVUVVJOSU5HICpgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5ub3JtYWxpemVVc2VyTGV2ZWwocmVzdWx0LnJvd3NbMF0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOWinuWKoOe7j+mqjOWAvFxuICAgKi9cbiAgYXN5bmMgYWRkRXhwZXJpZW5jZSh1aWQ6IG51bWJlciwgaXRlbUlkOiBzdHJpbmcsIGV4cEFtb3VudDogbnVtYmVyKTogUHJvbWlzZTxVc2VyQWJpbGl0eUxldmVsPiB7XG4gICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0aGlzLmZpbmRCeVVzZXJBbmRJdGVtKHVpZCwgaXRlbUlkKTtcbiAgICBpZiAoIWV4aXN0aW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGUoe1xuICAgICAgICB1aWQsXG4gICAgICAgIGl0ZW1faWQ6IGl0ZW1JZCxcbiAgICAgICAgY3VycmVudF9sZXZlbDogMSxcbiAgICAgICAgY3VycmVudF9leHA6IGV4cEFtb3VudCxcbiAgICAgICAgdG90YWxfZXhwOiBleHBBbW91bnQsXG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8g56Gu5L+dIGV4aXN0aW5nIOeahOaVsOWtl+Wtl+auteaYr+aVsOWtl+exu+Wei++8iOmYsuatouWtl+espuS4suaLvOaOpe+8iVxuICAgIGNvbnN0IGN1cnJlbnRFeHAgPSBOdW1iZXIoZXhpc3RpbmcuY3VycmVudF9leHApO1xuICAgIGNvbnN0IHRvdGFsRXhwID0gTnVtYmVyKGV4aXN0aW5nLnRvdGFsX2V4cCk7XG4gICAgcmV0dXJuIHRoaXMudXBkYXRlKHVpZCwgaXRlbUlkLCB7XG4gICAgICBjdXJyZW50X2V4cDogY3VycmVudEV4cCArIGV4cEFtb3VudCxcbiAgICAgIHRvdGFsX2V4cDogdG90YWxFeHAgKyBleHBBbW91bnQsXG4gICAgfSk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIkRhdGFiYXNlIiwiSW5qZWN0YWJsZSIsIlVzZXJBYmlsaXR5TGV2ZWxEQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJub3JtYWxpemVVc2VyTGV2ZWwiLCJsZXZlbCIsImN1cnJlbnRfbGV2ZWwiLCJOdW1iZXIiLCJjdXJyZW50X2V4cCIsInRvdGFsX2V4cCIsImxldmVsX3VwX2NvdW50IiwiZmluZEJ5VXNlcklkIiwidWlkIiwicmVzdWx0IiwicXVlcnkiLCJyb3dzIiwibWFwIiwicm93IiwiZmluZEJ5VXNlckFuZEl0ZW0iLCJpdGVtSWQiLCJ1cHNlcnQiLCJkYXRhIiwiZXhpc3RpbmciLCJpdGVtX2lkIiwidXBkYXRlIiwibGFzdF9sZXZlbF91cF9hdCIsIm1ldGFkYXRhIiwiY3JlYXRlIiwiSlNPTiIsInN0cmluZ2lmeSIsInVwZGF0ZXMiLCJmaWVsZHMiLCJ2YWx1ZXMiLCJwYXJhbUluZGV4IiwidW5kZWZpbmVkIiwicHVzaCIsImxlbmd0aCIsImpvaW4iLCJhZGRFeHBlcmllbmNlIiwiZXhwQW1vdW50IiwiY3VycmVudEV4cCIsInRvdGFsRXhwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/user-ability-level.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/user.dao.ts":
/*!*****************************!*\
  !*** ./src/dao/user.dao.ts ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserDAO: () => (/* binding */ UserDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass UserDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 根据邮箱查找用户\n   */ async findByEmail(email) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.users WHERE email = $1 AND deleted_at IS NULL\", [\n            email\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 UUID 查找用户\n   */ async findByUuid(uuid) {\n        const result = await this.db.query(\"SELECT uid, uuid, email, name, type, metadata, deleted_at, created_at, updated_at FROM pikun_db.users WHERE uuid = $1 AND deleted_at IS NULL\", [\n            uuid\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 UID 查找用户\n   */ async findByUid(uid) {\n        const result = await this.db.query(\"SELECT uid, uuid, email, name, type, metadata, deleted_at, created_at, updated_at FROM pikun_db.users WHERE uid = $1 AND deleted_at IS NULL\", [\n            uid\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据用户类型查找用户\n   */ async findByType(type) {\n        const result = await this.db.query(\"SELECT uid, uuid, email, name, type, metadata, deleted_at, created_at, updated_at FROM pikun_db.users WHERE type = $1 AND deleted_at IS NULL\", [\n            type\n        ]);\n        return result.rows;\n    }\n    /**\n   * 创建用户\n   */ async create(user) {\n        const type = user.type || \"user\";\n        const result = await this.db.query(`INSERT INTO pikun_db.users (email, password, name, type, metadata)\n       VALUES ($1, $2, $3, $4, $5)\n       RETURNING uid, uuid, email, name, type, metadata, deleted_at, created_at, updated_at`, [\n            user.email,\n            user.password,\n            user.name,\n            type,\n            JSON.stringify(user.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 更新用户信息\n   */ async update(uid, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.email !== undefined) {\n            fields.push(`email = $${paramIndex++}`);\n            values.push(updates.email);\n        }\n        if (updates.type !== undefined) {\n            fields.push(`type = $${paramIndex++}`);\n            values.push(updates.type);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findByUid(uid);\n        }\n        values.push(uid);\n        const result = await this.db.query(`UPDATE pikun_db.users SET ${fields.join(\", \")} WHERE uid = $${paramIndex} AND deleted_at IS NULL\n       RETURNING uid, uuid, email, name, type, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除用户（软删除）\n   */ async delete(uid) {\n        await this.db.query(\"UPDATE pikun_db.users SET deleted_at = CURRENT_TIMESTAMP WHERE uid = $1\", [\n            uid\n        ]);\n    }\n}\nUserDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"UserDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], UserDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNLElBQUksQ0FBQ0osRUFBRSxDQUFDSyxLQUFLLENBQ2hDLENBQUMsMEJBQTBCLEVBQUVpQixPQUFPTSxJQUFJLENBQUMsTUFBTSxjQUFjLEVBQUVKLFdBQVc7MkZBQ1csQ0FBQyxFQUN0RkQ7UUFFRixPQUFPbkIsT0FBT0UsSUFBSSxDQUFDLEVBQUU7SUFDdkI7SUFFQTs7R0FFQyxHQUNELE1BQU11QixPQUFPbkIsR0FBVyxFQUFpQjtRQUN2QyxNQUFNLElBQUksQ0FBQ1YsRUFBRSxDQUFDSyxLQUFLLENBQ2pCLDJFQUNBO1lBQUNLO1NBQUk7SUFFVDtBQUNGO0FBM0hhWixVQUFBQSxvRUFBQUE7SUFEWkQsNEVBQVVBLENBQUM7OztHQUNDQyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9kYW8vdXNlci5kYW8udHM/NjI4NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gJ0AvY29yZS9kYXRhYmFzZSc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQC9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yJztcbmltcG9ydCB0eXBlIHsgVXNlciwgRG9jdW1lbnQsIERvY3VtZW50U25hcHNob3QsIFdvcmtzcGFjZSB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOeUqOaItyBEQU9cbiAqIOi0n+i0o+eUqOaIt+ebuOWFs+eahOaVsOaNruW6k+aTjeS9nO+8jOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWlXG4gKi9cbkBJbmplY3RhYmxlKCdVc2VyREFPJylcbmV4cG9ydCBjbGFzcyBVc2VyREFPIHtcbiAgcHJpdmF0ZSBkYjogRGF0YWJhc2U7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5kYiA9IERhdGFiYXNlLmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u6YKu566x5p+l5om+55So5oi3XG4gICAqL1xuICBhc3luYyBmaW5kQnlFbWFpbChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxVc2VyIHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8VXNlcj4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi51c2VycyBXSEVSRSBlbWFpbCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW2VtYWlsXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2uIFVVSUQg5p+l5om+55So5oi3XG4gICAqL1xuICBhc3luYyBmaW5kQnlVdWlkKHV1aWQ6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXI+KFxuICAgICAgJ1NFTEVDVCB1aWQsIHV1aWQsIGVtYWlsLCBuYW1lLCB0eXBlLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCBGUk9NIHBpa3VuX2RiLnVzZXJzIFdIRVJFIHV1aWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt1dWlkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2uIFVJRCDmn6Xmib7nlKjmiLdcbiAgICovXG4gIGFzeW5jIGZpbmRCeVVpZCh1aWQ6IG51bWJlcik6IFByb21pc2U8VXNlciB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXI+KFxuICAgICAgJ1NFTEVDVCB1aWQsIHV1aWQsIGVtYWlsLCBuYW1lLCB0eXBlLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCBGUk9NIHBpa3VuX2RiLnVzZXJzIFdIRVJFIHVpZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW3VpZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNrueUqOaIt+exu+Wei+afpeaJvueUqOaIt1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5VHlwZSh0eXBlOiAnYWRtaW4nIHwgJ3VzZXInKTogUHJvbWlzZTxVc2VyW10+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXI+KFxuICAgICAgJ1NFTEVDVCB1aWQsIHV1aWQsIGVtYWlsLCBuYW1lLCB0eXBlLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCBGUk9NIHBpa3VuX2RiLnVzZXJzIFdIRVJFIHR5cGUgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt0eXBlXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uueUqOaIt1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlKHVzZXI6IHtcbiAgICBlbWFpbDogc3RyaW5nO1xuICAgIHBhc3N3b3JkOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHR5cGU/OiAnYWRtaW4nIHwgJ3VzZXInO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8VXNlcj4ge1xuICAgIGNvbnN0IHR5cGUgPSB1c2VyLnR5cGUgfHwgJ3VzZXInO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8VXNlcj4oXG4gICAgICBgSU5TRVJUIElOVE8gcGlrdW5fZGIudXNlcnMgKGVtYWlsLCBwYXNzd29yZCwgbmFtZSwgdHlwZSwgbWV0YWRhdGEpXG4gICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUpXG4gICAgICAgUkVUVVJOSU5HIHVpZCwgdXVpZCwgZW1haWwsIG5hbWUsIHR5cGUsIG1ldGFkYXRhLCBkZWxldGVkX2F0LCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0YCxcbiAgICAgIFt1c2VyLmVtYWlsLCB1c2VyLnBhc3N3b3JkLCB1c2VyLm5hbWUsIHR5cGUsIEpTT04uc3RyaW5naWZ5KHVzZXIubWV0YWRhdGEgfHwge30pXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOeUqOaIt+S/oeaBr1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlKHVpZDogbnVtYmVyLCB1cGRhdGVzOiB7XG4gICAgbmFtZT86IHN0cmluZztcbiAgICBlbWFpbD86IHN0cmluZztcbiAgICB0eXBlPzogJ2FkbWluJyB8ICd1c2VyJztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFVzZXI+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLm5hbWUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5lbWFpbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgZW1haWwgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmVtYWlsKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMudHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgdHlwZSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMudHlwZSk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLm1ldGFkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBtZXRhZGF0YSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKEpTT04uc3RyaW5naWZ5KHVwZGF0ZXMubWV0YWRhdGEpKTtcbiAgICB9XG5cbiAgICBpZiAoZmllbGRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuZmluZEJ5VWlkKHVpZCkgYXMgUHJvbWlzZTxVc2VyPjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaCh1aWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8VXNlcj4oXG4gICAgICBgVVBEQVRFIHBpa3VuX2RiLnVzZXJzIFNFVCAke2ZpZWxkcy5qb2luKCcsICcpfSBXSEVSRSB1aWQgPSAkJHtwYXJhbUluZGV4fSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMXG4gICAgICAgUkVUVVJOSU5HIHVpZCwgdXVpZCwgZW1haWwsIG5hbWUsIHR5cGUsIG1ldGFkYXRhLCBkZWxldGVkX2F0LCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0YCxcbiAgICAgIHZhbHVlc1xuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOeUqOaIt++8iOi9r+WIoOmZpO+8iVxuICAgKi9cbiAgYXN5bmMgZGVsZXRlKHVpZDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5kYi5xdWVyeShcbiAgICAgICdVUERBVEUgcGlrdW5fZGIudXNlcnMgU0VUIGRlbGV0ZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUCBXSEVSRSB1aWQgPSAkMScsXG4gICAgICBbdWlkXVxuICAgICk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIkRhdGFiYXNlIiwiSW5qZWN0YWJsZSIsIlVzZXJEQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJmaW5kQnlFbWFpbCIsImVtYWlsIiwicmVzdWx0IiwicXVlcnkiLCJyb3dzIiwiZmluZEJ5VXVpZCIsInV1aWQiLCJmaW5kQnlVaWQiLCJ1aWQiLCJmaW5kQnlUeXBlIiwidHlwZSIsImNyZWF0ZSIsInVzZXIiLCJwYXNzd29yZCIsIm5hbWUiLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YWRhdGEiLCJ1cGRhdGUiLCJ1cGRhdGVzIiwiZmllbGRzIiwidmFsdWVzIiwicGFyYW1JbmRleCIsInVuZGVmaW5lZCIsInB1c2giLCJsZW5ndGgiLCJqb2luIiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/user.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/workspace.dao.ts":
/*!**********************************!*\
  !*** ./src/dao/workspace.dao.ts ***!
  \**********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WorkspaceDAO: () => (/* binding */ WorkspaceDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass WorkspaceDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 创建工作空间\n   */ async create(workspace) {\n        const result = await this.db.query(`INSERT INTO pikun_db.workspaces (name, owner_uid, icon, metadata)\n       VALUES ($1, $2, $3, $4)\n       RETURNING workspace_id, name, owner_uid, icon, metadata, deleted_at, created_at, updated_at`, [\n            workspace.name,\n            workspace.owner_uid,\n            workspace.icon || null,\n            JSON.stringify(workspace.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 根据 ID 查找工作空间\n   */ async findById(workspace_id) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.workspaces WHERE workspace_id = $1 AND deleted_at IS NULL\", [\n            workspace_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据用户 ID 查找用户的所有工作空间\n   */ async findByOwnerUid(owner_uid) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.workspaces WHERE owner_uid = $1 AND deleted_at IS NULL ORDER BY created_at DESC\", [\n            owner_uid\n        ]);\n        return result.rows;\n    }\n    /**\n   * 获取用户的默认工作空间（第一个工作空间或创建新的）\n   */ async getOrCreateDefault(owner_uid) {\n        // 先查找用户的工作空间\n        const workspaces = await this.findByOwnerUid(owner_uid);\n        if (workspaces.length > 0) {\n            return workspaces[0];\n        }\n        // 如果没有，创建默认工作空间\n        return await this.create({\n            name: \"我的工作空间\",\n            owner_uid\n        });\n    }\n    /**\n   * 更新工作空间\n   */ async update(workspace_id, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.icon !== undefined) {\n            fields.push(`icon = $${paramIndex++}`);\n            values.push(updates.icon);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(workspace_id);\n        }\n        values.push(workspace_id);\n        const result = await this.db.query(`UPDATE pikun_db.workspaces SET ${fields.join(\", \")} WHERE workspace_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING workspace_id, name, owner_uid, icon, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除工作空间（软删除）\n   */ async delete(workspace_id) {\n        await this.db.query(\"UPDATE pikun_db.workspaces SET deleted_at = CURRENT_TIMESTAMP WHERE workspace_id = $1\", [\n            workspace_id\n        ]);\n    }\n}\nWorkspaceDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"WorkspaceDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], WorkspaceDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDSyxLQUFLLENBQ2pCLHlGQUNBO1lBQUNTO1NBQWE7SUFFbEI7QUFDRjtBQXZIYWhCLGVBQUFBLG9FQUFBQTtJQURaRCw0RUFBVUEsQ0FBQzs7O0dBQ0NDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2Rhby93b3Jrc3BhY2UuZGFvLnRzP2VlOGMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IFdvcmtzcGFjZSB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOW3peS9nOepuumXtCBEQU9cbiAqIOi0n+i0o+W3peS9nOepuumXtOebuOWFs+eahOaVsOaNruW6k+aTjeS9nFxuICovXG5ASW5qZWN0YWJsZSgnV29ya3NwYWNlREFPJylcbmV4cG9ydCBjbGFzcyBXb3Jrc3BhY2VEQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGNyZWF0ZSh3b3Jrc3BhY2U6IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgb3duZXJfdWlkOiBudW1iZXI7XG4gICAgaWNvbj86IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFdvcmtzcGFjZT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8V29ya3NwYWNlPihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi53b3Jrc3BhY2VzIChuYW1lLCBvd25lcl91aWQsIGljb24sIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQpXG4gICAgICAgUkVUVVJOSU5HIHdvcmtzcGFjZV9pZCwgbmFtZSwgb3duZXJfdWlkLCBpY29uLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICBbXG4gICAgICAgIHdvcmtzcGFjZS5uYW1lLFxuICAgICAgICB3b3Jrc3BhY2Uub3duZXJfdWlkLFxuICAgICAgICB3b3Jrc3BhY2UuaWNvbiB8fCBudWxsLFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh3b3Jrc3BhY2UubWV0YWRhdGEgfHwge30pLFxuICAgICAgXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBJRCDmn6Xmib7lt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGZpbmRCeUlkKHdvcmtzcGFjZV9pZDogc3RyaW5nKTogUHJvbWlzZTxXb3Jrc3BhY2UgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxXb3Jrc3BhY2U+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIud29ya3NwYWNlcyBXSEVSRSB3b3Jrc3BhY2VfaWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt3b3Jrc3BhY2VfaWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7nlKjmiLcgSUQg5p+l5om+55So5oi355qE5omA5pyJ5bel5L2c56m66Ze0XG4gICAqL1xuICBhc3luYyBmaW5kQnlPd25lclVpZChvd25lcl91aWQ6IG51bWJlcik6IFByb21pc2U8V29ya3NwYWNlW10+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFdvcmtzcGFjZT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi53b3Jrc3BhY2VzIFdIRVJFIG93bmVyX3VpZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDJyxcbiAgICAgIFtvd25lcl91aWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3M7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE6buY6K6k5bel5L2c56m66Ze077yI56ys5LiA5Liq5bel5L2c56m66Ze05oiW5Yib5bu65paw55qE77yJXG4gICAqL1xuICBhc3luYyBnZXRPckNyZWF0ZURlZmF1bHQob3duZXJfdWlkOiBudW1iZXIpOiBQcm9taXNlPFdvcmtzcGFjZT4ge1xuICAgIC8vIOWFiOafpeaJvueUqOaIt+eahOW3peS9nOepuumXtFxuICAgIGNvbnN0IHdvcmtzcGFjZXMgPSBhd2FpdCB0aGlzLmZpbmRCeU93bmVyVWlkKG93bmVyX3VpZCk7XG4gICAgaWYgKHdvcmtzcGFjZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHdvcmtzcGFjZXNbMF07XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5rKh5pyJ77yM5Yib5bu66buY6K6k5bel5L2c56m66Ze0XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY3JlYXRlKHtcbiAgICAgIG5hbWU6ICfmiJHnmoTlt6XkvZznqbrpl7QnLFxuICAgICAgb3duZXJfdWlkLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOW3peS9nOepuumXtFxuICAgKi9cbiAgYXN5bmMgdXBkYXRlKFxuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IHtcbiAgICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgICBpY29uPzogc3RyaW5nO1xuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIH1cbiAgKTogUHJvbWlzZTxXb3Jrc3BhY2U+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLm5hbWUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5pY29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBpY29uID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5pY29uKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlJZCh3b3Jrc3BhY2VfaWQpIGFzIFByb21pc2U8V29ya3NwYWNlPjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaCh3b3Jrc3BhY2VfaWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8V29ya3NwYWNlPihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIud29ya3NwYWNlcyBTRVQgJHtmaWVsZHMuam9pbignLCAnKX0gV0hFUkUgd29ya3NwYWNlX2lkID0gJCR7cGFyYW1JbmRleH0gQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTFxuICAgICAgIFJFVFVSTklORyB3b3Jrc3BhY2VfaWQsIG5hbWUsIG93bmVyX3VpZCwgaWNvbiwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5bel5L2c56m66Ze077yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUod29ya3NwYWNlX2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi53b3Jrc3BhY2VzIFNFVCBkZWxldGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgd29ya3NwYWNlX2lkID0gJDEnLFxuICAgICAgW3dvcmtzcGFjZV9pZF1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJEYXRhYmFzZSIsIkluamVjdGFibGUiLCJXb3Jrc3BhY2VEQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJjcmVhdGUiLCJ3b3Jrc3BhY2UiLCJyZXN1bHQiLCJxdWVyeSIsIm5hbWUiLCJvd25lcl91aWQiLCJpY29uIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwicm93cyIsImZpbmRCeUlkIiwid29ya3NwYWNlX2lkIiwiZmluZEJ5T3duZXJVaWQiLCJnZXRPckNyZWF0ZURlZmF1bHQiLCJ3b3Jrc3BhY2VzIiwibGVuZ3RoIiwidXBkYXRlIiwidXBkYXRlcyIsImZpZWxkcyIsInZhbHVlcyIsInBhcmFtSW5kZXgiLCJ1bmRlZmluZWQiLCJwdXNoIiwiam9pbiIsImRlbGV0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/workspace.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/decorators/injectable.decorator.ts":
/*!************************************************!*\
  !*** ./src/decorators/injectable.decorator.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Inject: () => (/* binding */ Inject),\n/* harmony export */   Injectable: () => (/* binding */ Injectable)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\n * 可注入装饰器\n * 标记类可以被依赖注入容器管理\n */ function Injectable(token) {\n    return function(target) {\n        Reflect.defineMetadata(\"injectable\", true, target);\n        if (token) {\n            Reflect.defineMetadata(\"injectionToken\", token, target);\n        }\n    };\n}\n/**\n * 注入依赖装饰器\n */ function Inject(token) {\n    return function(target, propertyKey, parameterIndex) {\n        const existingTokens = Reflect.getMetadata(\"injections\", target) || [];\n        existingTokens.push({\n            index: parameterIndex,\n            token\n        });\n        Reflect.defineMetadata(\"injections\", existingTokens, target);\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTBCO0FBRTFCOzs7Q0FHQyxHQUNNLFNBQVNBLFdBQVdDLEtBQXVCO0lBQ2hELE9BQU8sU0FBVUMsTUFBVztRQUMxQkMsUUFBUUMsY0FBYyxDQUFDLGNBQWMsTUFBTUY7UUFDM0MsSUFBSUQsT0FBTztZQUNURSxRQUFRQyxjQUFjLENBQUMsa0JBQWtCSCxPQUFPQztRQUNsRDtJQUNGO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLFNBQVNHLE9BQU9KLEtBQXNCO0lBQzNDLE9BQU8sU0FBVUMsTUFBVyxFQUFFSSxXQUF3QyxFQUFFQyxjQUFzQjtRQUM1RixNQUFNQyxpQkFBaUJMLFFBQVFNLFdBQVcsQ0FBQyxjQUFjUCxXQUFXLEVBQUU7UUFDdEVNLGVBQWVFLElBQUksQ0FBQztZQUFFQyxPQUFPSjtZQUFnQk47UUFBTTtRQUNuREUsUUFBUUMsY0FBYyxDQUFDLGNBQWNJLGdCQUFnQk47SUFDdkQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yLnRzPzZhMzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcblxuLyoqXG4gKiDlj6/ms6jlhaXoo4XppbDlmahcbiAqIOagh+iusOexu+WPr+S7peiiq+S+nei1luazqOWFpeWuueWZqOeuoeeQhlxuICovXG5leHBvcnQgZnVuY3Rpb24gSW5qZWN0YWJsZSh0b2tlbj86IHN0cmluZyB8IHN5bWJvbCk6IENsYXNzRGVjb3JhdG9yIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQ6IGFueSkge1xuICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoJ2luamVjdGFibGUnLCB0cnVlLCB0YXJnZXQpO1xuICAgIGlmICh0b2tlbikge1xuICAgICAgUmVmbGVjdC5kZWZpbmVNZXRhZGF0YSgnaW5qZWN0aW9uVG9rZW4nLCB0b2tlbiwgdGFyZ2V0KTtcbiAgICB9XG4gIH07XG59XG5cbi8qKlxuICog5rOo5YWl5L6d6LWW6KOF6aWw5ZmoXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBJbmplY3QodG9rZW46IHN0cmluZyB8IHN5bWJvbCk6IFBhcmFtZXRlckRlY29yYXRvciB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcgfCBzeW1ib2wgfCB1bmRlZmluZWQsIHBhcmFtZXRlckluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBleGlzdGluZ1Rva2VucyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ2luamVjdGlvbnMnLCB0YXJnZXQpIHx8IFtdO1xuICAgIGV4aXN0aW5nVG9rZW5zLnB1c2goeyBpbmRleDogcGFyYW1ldGVySW5kZXgsIHRva2VuIH0pO1xuICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoJ2luamVjdGlvbnMnLCBleGlzdGluZ1Rva2VucywgdGFyZ2V0KTtcbiAgfTtcbn1cblxuXG5cblxuIl0sIm5hbWVzIjpbIkluamVjdGFibGUiLCJ0b2tlbiIsInRhcmdldCIsIlJlZmxlY3QiLCJkZWZpbmVNZXRhZGF0YSIsIkluamVjdCIsInByb3BlcnR5S2V5IiwicGFyYW1ldGVySW5kZXgiLCJleGlzdGluZ1Rva2VucyIsImdldE1ldGFkYXRhIiwicHVzaCIsImluZGV4Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/decorators/injectable.decorator.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/ability-level-config.service.ts":
/*!******************************************************!*\
  !*** ./src/services/ability-level-config.service.ts ***!
  \******************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AbilityLevelConfigService: () => (/* binding */ AbilityLevelConfigService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/ability-item-level-config.dao */ \"(rsc)/./src/dao/ability-item-level-config.dao.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_1__]);\n_dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nclass AbilityLevelConfigService {\n    constructor(levelConfigDAO){\n        this.levelConfigDAO = levelConfigDAO;\n    }\n    /**\n   * 获取等级配置列表\n   */ async getConfigs(itemId) {\n        return this.levelConfigDAO.findAll(itemId);\n    }\n    /**\n   * 获取全局模板配置\n   */ async getTemplate() {\n        return this.levelConfigDAO.findTemplate();\n    }\n    /**\n   * 获取等级配置详情\n   */ async getConfigById(configId) {\n        return this.levelConfigDAO.findById(configId);\n    }\n    /**\n   * 创建等级配置\n   */ async createConfig(data) {\n        return this.levelConfigDAO.create(data);\n    }\n    /**\n   * 批量创建等级配置\n   */ async createConfigsBatch(configs) {\n        return this.levelConfigDAO.createBatch(configs);\n    }\n    /**\n   * 更新等级配置\n   */ async updateConfig(configId, updates) {\n        return this.levelConfigDAO.update(configId, updates);\n    }\n    /**\n   * 删除等级配置\n   */ async deleteConfig(configId) {\n        return this.levelConfigDAO.delete(configId);\n    }\n    /**\n   * 将模板复制到指定能力项\n   */ async copyTemplateToItem(itemId) {\n        return this.levelConfigDAO.copyTemplateToItem(itemId);\n    }\n}\nAbilityLevelConfigService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"AbilityItemLevelConfigDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_1__.AbilityItemLevelConfigDAO === \"undefined\" ? Object : _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_1__.AbilityItemLevelConfigDAO\n    ])\n], AbilityLevelConfigService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvYWJpbGl0eS1sZXZlbC1jb25maWcuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQThDO0FBQ2tDO0FBT3pFLE1BQU1HO0lBQ1hDLFlBQ0UsY0FBc0YsQ0FDdEY7YUFENkNDLGlCQUFBQTtJQUM1QztJQUVIOztHQUVDLEdBQ0QsTUFBTUMsV0FBV0MsTUFBZSxFQUFxQztRQUNuRSxPQUFPLElBQUksQ0FBQ0YsY0FBYyxDQUFDRyxPQUFPLENBQUNEO0lBQ3JDO0lBRUE7O0dBRUMsR0FDRCxNQUFNRSxjQUFpRDtRQUNyRCxPQUFPLElBQUksQ0FBQ0osY0FBYyxDQUFDSyxZQUFZO0lBQ3pDO0lBRUE7O0dBRUMsR0FDRCxNQUFNQyxjQUFjQyxRQUFnQixFQUEwQztRQUM1RSxPQUFPLElBQUksQ0FBQ1AsY0FBYyxDQUFDUSxRQUFRLENBQUNEO0lBQ3RDO0lBRUE7O0dBRUMsR0FDRCxNQUFNRSxhQUFhQyxJQVVsQixFQUFtQztRQUNsQyxPQUFPLElBQUksQ0FBQ1YsY0FBYyxDQUFDVyxNQUFNLENBQUNEO0lBQ3BDO0lBRUE7O0dBRUMsR0FDRCxNQUFNRSxtQkFDSkMsT0FVRSxFQUNpQztRQUNuQyxPQUFPLElBQUksQ0FBQ2IsY0FBYyxDQUFDYyxXQUFXLENBQUNEO0lBQ3pDO0lBRUE7O0dBRUMsR0FDRCxNQUFNRSxhQUNKUixRQUFnQixFQUNoQlMsT0FRQyxFQUNnQztRQUNqQyxPQUFPLElBQUksQ0FBQ2hCLGNBQWMsQ0FBQ2lCLE1BQU0sQ0FBQ1YsVUFBVVM7SUFDOUM7SUFFQTs7R0FFQyxHQUNELE1BQU1FLGFBQWFYLFFBQWdCLEVBQWlCO1FBQ2xELE9BQU8sSUFBSSxDQUFDUCxjQUFjLENBQUNtQixNQUFNLENBQUNaO0lBQ3BDO0lBRUE7O0dBRUMsR0FDRCxNQUFNYSxtQkFBbUJsQixNQUFjLEVBQXFDO1FBQzFFLE9BQU8sSUFBSSxDQUFDRixjQUFjLENBQUNvQixrQkFBa0IsQ0FBQ2xCO0lBQ2hEO0FBQ0Y7QUE3RmFKLDRCQUFBQSxvRUFBQUE7SUFEWkgsb0RBQVVBO0lBR05DLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQzs7O2VBQXFELHlGQUF5Qiw0QkFBekIseUZBQXlCOztHQUY3RUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvc2VydmljZXMvYWJpbGl0eS1sZXZlbC1jb25maWcuc2VydmljZS50cz9hNTFhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ3RzeXJpbmdlJztcbmltcG9ydCB7IEFiaWxpdHlJdGVtTGV2ZWxDb25maWdEQU8gfSBmcm9tICdAL2Rhby9hYmlsaXR5LWl0ZW0tbGV2ZWwtY29uZmlnLmRhbyc7XG5pbXBvcnQgdHlwZSB7IEFiaWxpdHlJdGVtTGV2ZWxDb25maWcgfSBmcm9tICdAL2VudGl0aWVzJztcblxuLyoqXG4gKiDog73lipvpobnnrYnnuqfphY3nva7mnI3liqFcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEFiaWxpdHlMZXZlbENvbmZpZ1NlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPJykgcHJpdmF0ZSBsZXZlbENvbmZpZ0RBTzogQWJpbGl0eUl0ZW1MZXZlbENvbmZpZ0RBT1xuICApIHt9XG5cbiAgLyoqXG4gICAqIOiOt+WPluetiee6p+mFjee9ruWIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0Q29uZmlncyhpdGVtSWQ/OiBzdHJpbmcpOiBQcm9taXNlPEFiaWxpdHlJdGVtTGV2ZWxDb25maWdbXT4ge1xuICAgIHJldHVybiB0aGlzLmxldmVsQ29uZmlnREFPLmZpbmRBbGwoaXRlbUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blhajlsYDmqKHmnb/phY3nva5cbiAgICovXG4gIGFzeW5jIGdldFRlbXBsYXRlKCk6IFByb21pc2U8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMubGV2ZWxDb25maWdEQU8uZmluZFRlbXBsYXRlKCk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W562J57qn6YWN572u6K+m5oOFXG4gICAqL1xuICBhc3luYyBnZXRDb25maWdCeUlkKGNvbmZpZ0lkOiBzdHJpbmcpOiBQcm9taXNlPEFiaWxpdHlJdGVtTGV2ZWxDb25maWcgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMubGV2ZWxDb25maWdEQU8uZmluZEJ5SWQoY29uZmlnSWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuetiee6p+mFjee9rlxuICAgKi9cbiAgYXN5bmMgY3JlYXRlQ29uZmlnKGRhdGE6IHtcbiAgICBpdGVtX2lkPzogc3RyaW5nIHwgbnVsbDtcbiAgICBsZXZlbDogbnVtYmVyO1xuICAgIHJlcXVpcmVkX2V4cDogbnVtYmVyO1xuICAgIHJlcXVpcmVzX2Fzc2Vzc21lbnQ/OiBib29sZWFuO1xuICAgIGxldmVsX25hbWU/OiBzdHJpbmc7XG4gICAgbGV2ZWxfZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgaXNfdGVtcGxhdGU/OiBib29sZWFuO1xuICAgIHNvcnRfb3JkZXI/OiBudW1iZXI7XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxBYmlsaXR5SXRlbUxldmVsQ29uZmlnPiB7XG4gICAgcmV0dXJuIHRoaXMubGV2ZWxDb25maWdEQU8uY3JlYXRlKGRhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIOaJuemHj+WIm+W7uuetiee6p+mFjee9rlxuICAgKi9cbiAgYXN5bmMgY3JlYXRlQ29uZmlnc0JhdGNoKFxuICAgIGNvbmZpZ3M6IEFycmF5PHtcbiAgICAgIGl0ZW1faWQ/OiBzdHJpbmcgfCBudWxsO1xuICAgICAgbGV2ZWw6IG51bWJlcjtcbiAgICAgIHJlcXVpcmVkX2V4cDogbnVtYmVyO1xuICAgICAgcmVxdWlyZXNfYXNzZXNzbWVudD86IGJvb2xlYW47XG4gICAgICBsZXZlbF9uYW1lPzogc3RyaW5nO1xuICAgICAgbGV2ZWxfZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgICBpc190ZW1wbGF0ZT86IGJvb2xlYW47XG4gICAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIH0+XG4gICk6IFByb21pc2U8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMubGV2ZWxDb25maWdEQU8uY3JlYXRlQmF0Y2goY29uZmlncyk7XG4gIH1cblxuICAvKipcbiAgICog5pu05paw562J57qn6YWN572uXG4gICAqL1xuICBhc3luYyB1cGRhdGVDb25maWcoXG4gICAgY29uZmlnSWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICBsZXZlbD86IG51bWJlcjtcbiAgICAgIHJlcXVpcmVkX2V4cD86IG51bWJlcjtcbiAgICAgIHJlcXVpcmVzX2Fzc2Vzc21lbnQ/OiBib29sZWFuO1xuICAgICAgbGV2ZWxfbmFtZT86IHN0cmluZztcbiAgICAgIGxldmVsX2Rlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgICAgc29ydF9vcmRlcj86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8QWJpbGl0eUl0ZW1MZXZlbENvbmZpZz4ge1xuICAgIHJldHVybiB0aGlzLmxldmVsQ29uZmlnREFPLnVwZGF0ZShjb25maWdJZCwgdXBkYXRlcyk7XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk562J57qn6YWN572uXG4gICAqL1xuICBhc3luYyBkZWxldGVDb25maWcoY29uZmlnSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmxldmVsQ29uZmlnREFPLmRlbGV0ZShjb25maWdJZCk7XG4gIH1cblxuICAvKipcbiAgICog5bCG5qih5p2/5aSN5Yi25Yiw5oyH5a6a6IO95Yqb6aG5XG4gICAqL1xuICBhc3luYyBjb3B5VGVtcGxhdGVUb0l0ZW0oaXRlbUlkOiBzdHJpbmcpOiBQcm9taXNlPEFiaWxpdHlJdGVtTGV2ZWxDb25maWdbXT4ge1xuICAgIHJldHVybiB0aGlzLmxldmVsQ29uZmlnREFPLmNvcHlUZW1wbGF0ZVRvSXRlbShpdGVtSWQpO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJpbmplY3RhYmxlIiwiaW5qZWN0IiwiQWJpbGl0eUl0ZW1MZXZlbENvbmZpZ0RBTyIsIkFiaWxpdHlMZXZlbENvbmZpZ1NlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImxldmVsQ29uZmlnREFPIiwiZ2V0Q29uZmlncyIsIml0ZW1JZCIsImZpbmRBbGwiLCJnZXRUZW1wbGF0ZSIsImZpbmRUZW1wbGF0ZSIsImdldENvbmZpZ0J5SWQiLCJjb25maWdJZCIsImZpbmRCeUlkIiwiY3JlYXRlQ29uZmlnIiwiZGF0YSIsImNyZWF0ZSIsImNyZWF0ZUNvbmZpZ3NCYXRjaCIsImNvbmZpZ3MiLCJjcmVhdGVCYXRjaCIsInVwZGF0ZUNvbmZpZyIsInVwZGF0ZXMiLCJ1cGRhdGUiLCJkZWxldGVDb25maWciLCJkZWxldGUiLCJjb3B5VGVtcGxhdGVUb0l0ZW0iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/ability-level-config.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/ability-model.service.ts":
/*!***********************************************!*\
  !*** ./src/services/ability-model.service.ts ***!
  \***********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AbilityModelService: () => (/* binding */ AbilityModelService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_ability_category_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/ability-category.dao */ \"(rsc)/./src/dao/ability-category.dao.ts\");\n/* harmony import */ var _dao_ability_dimension_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/ability-dimension.dao */ \"(rsc)/./src/dao/ability-dimension.dao.ts\");\n/* harmony import */ var _dao_ability_item_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/ability-item.dao */ \"(rsc)/./src/dao/ability-item.dao.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_ability_category_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_ability_dimension_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_ability_item_dao__WEBPACK_IMPORTED_MODULE_3__]);\n([_dao_ability_category_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_ability_dimension_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_ability_item_dao__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\nclass AbilityModelService {\n    constructor(categoryDAO, dimensionDAO, itemDAO){\n        this.categoryDAO = categoryDAO;\n        this.dimensionDAO = dimensionDAO;\n        this.itemDAO = itemDAO;\n    }\n    /**\n   * 获取能力模型树形结构\n   */ async getModelTree() {\n        const categories = await this.categoryDAO.findAll();\n        const result = [];\n        for (const category of categories){\n            const dimensions = await this.dimensionDAO.findAll(category.category_id);\n            const dimensionItems = [];\n            for (const dimension of dimensions){\n                const items = await this.itemDAO.findAll(dimension.dimension_id);\n                dimensionItems.push({\n                    dimension,\n                    items\n                });\n            }\n            result.push({\n                category,\n                dimensions: dimensionItems\n            });\n        }\n        return result;\n    }\n    /**\n   * 获取能力类别列表\n   */ async getCategories() {\n        return this.categoryDAO.findAll();\n    }\n    /**\n   * 获取能力类别详情\n   */ async getCategoryById(categoryId) {\n        return this.categoryDAO.findById(categoryId);\n    }\n    /**\n   * 创建能力类别\n   */ async createCategory(data) {\n        return this.categoryDAO.create(data);\n    }\n    /**\n   * 更新能力类别\n   */ async updateCategory(categoryId, updates) {\n        return this.categoryDAO.update(categoryId, updates);\n    }\n    /**\n   * 删除能力类别\n   */ async deleteCategory(categoryId) {\n        return this.categoryDAO.delete(categoryId);\n    }\n    /**\n   * 获取能力维度列表\n   */ async getDimensions(categoryId) {\n        return this.dimensionDAO.findAll(categoryId);\n    }\n    /**\n   * 获取能力维度详情\n   */ async getDimensionById(dimensionId) {\n        return this.dimensionDAO.findById(dimensionId);\n    }\n    /**\n   * 创建能力维度\n   */ async createDimension(data) {\n        return this.dimensionDAO.create(data);\n    }\n    /**\n   * 更新能力维度\n   */ async updateDimension(dimensionId, updates) {\n        return this.dimensionDAO.update(dimensionId, updates);\n    }\n    /**\n   * 删除能力维度\n   */ async deleteDimension(dimensionId) {\n        return this.dimensionDAO.delete(dimensionId);\n    }\n    /**\n   * 获取能力项列表\n   */ async getItems(dimensionId) {\n        return this.itemDAO.findAll(dimensionId);\n    }\n    /**\n   * 获取能力项详情\n   */ async getItemById(itemId) {\n        return this.itemDAO.findById(itemId);\n    }\n    /**\n   * 创建能力项\n   */ async createItem(data) {\n        return this.itemDAO.create(data);\n    }\n    /**\n   * 更新能力项\n   */ async updateItem(itemId, updates) {\n        return this.itemDAO.update(itemId, updates);\n    }\n    /**\n   * 删除能力项\n   */ async deleteItem(itemId) {\n        return this.itemDAO.delete(itemId);\n    }\n}\nAbilityModelService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"AbilityCategoryDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"AbilityDimensionDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(2, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"AbilityItemDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_ability_category_dao__WEBPACK_IMPORTED_MODULE_1__.AbilityCategoryDAO === \"undefined\" ? Object : _dao_ability_category_dao__WEBPACK_IMPORTED_MODULE_1__.AbilityCategoryDAO,\n        typeof _dao_ability_dimension_dao__WEBPACK_IMPORTED_MODULE_2__.AbilityDimensionDAO === \"undefined\" ? Object : _dao_ability_dimension_dao__WEBPACK_IMPORTED_MODULE_2__.AbilityDimensionDAO,\n        typeof _dao_ability_item_dao__WEBPACK_IMPORTED_MODULE_3__.AbilityItemDAO === \"undefined\" ? Object : _dao_ability_item_dao__WEBPACK_IMPORTED_MODULE_3__.AbilityItemDAO\n    ])\n], AbilityModelService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvYWJpbGl0eS1tb2RlbC5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUE4QztBQUNrQjtBQUNFO0FBQ1Y7QUFXakQsTUFBTUs7SUFDWEMsWUFDRSxXQUFxRSxFQUNyRSxZQUF3RSxFQUN4RSxPQUF5RCxDQUN6RDthQUhzQ0MsY0FBQUE7YUFDQ0MsZUFBQUE7YUFDTEMsVUFBQUE7SUFDakM7SUFFSDs7R0FFQyxHQUNELE1BQU1DLGVBTUY7UUFDRixNQUFNQyxhQUFhLE1BQU0sSUFBSSxDQUFDSixXQUFXLENBQUNLLE9BQU87UUFDakQsTUFBTUMsU0FBUyxFQUFFO1FBRWpCLEtBQUssTUFBTUMsWUFBWUgsV0FBWTtZQUNqQyxNQUFNSSxhQUFhLE1BQU0sSUFBSSxDQUFDUCxZQUFZLENBQUNJLE9BQU8sQ0FBQ0UsU0FBU0UsV0FBVztZQUN2RSxNQUFNQyxpQkFBaUIsRUFBRTtZQUV6QixLQUFLLE1BQU1DLGFBQWFILFdBQVk7Z0JBQ2xDLE1BQU1JLFFBQVEsTUFBTSxJQUFJLENBQUNWLE9BQU8sQ0FBQ0csT0FBTyxDQUFDTSxVQUFVRSxZQUFZO2dCQUMvREgsZUFBZUksSUFBSSxDQUFDO29CQUNsQkg7b0JBQ0FDO2dCQUNGO1lBQ0Y7WUFFQU4sT0FBT1EsSUFBSSxDQUFDO2dCQUNWUDtnQkFDQUMsWUFBWUU7WUFDZDtRQUNGO1FBRUEsT0FBT0o7SUFDVDtJQUVBOztHQUVDLEdBQ0QsTUFBTVMsZ0JBQTRDO1FBQ2hELE9BQU8sSUFBSSxDQUFDZixXQUFXLENBQUNLLE9BQU87SUFDakM7SUFFQTs7R0FFQyxHQUNELE1BQU1XLGdCQUFnQkMsVUFBa0IsRUFBbUM7UUFDekUsT0FBTyxJQUFJLENBQUNqQixXQUFXLENBQUNrQixRQUFRLENBQUNEO0lBQ25DO0lBRUE7O0dBRUMsR0FDRCxNQUFNRSxlQUFlQyxJQU1wQixFQUE0QjtRQUMzQixPQUFPLElBQUksQ0FBQ3BCLFdBQVcsQ0FBQ3FCLE1BQU0sQ0FBQ0Q7SUFDakM7SUFFQTs7R0FFQyxHQUNELE1BQU1FLGVBQ0pMLFVBQWtCLEVBQ2xCTSxPQU1DLEVBQ3lCO1FBQzFCLE9BQU8sSUFBSSxDQUFDdkIsV0FBVyxDQUFDd0IsTUFBTSxDQUFDUCxZQUFZTTtJQUM3QztJQUVBOztHQUVDLEdBQ0QsTUFBTUUsZUFBZVIsVUFBa0IsRUFBaUI7UUFDdEQsT0FBTyxJQUFJLENBQUNqQixXQUFXLENBQUMwQixNQUFNLENBQUNUO0lBQ2pDO0lBRUE7O0dBRUMsR0FDRCxNQUFNVSxjQUFjVixVQUFtQixFQUErQjtRQUNwRSxPQUFPLElBQUksQ0FBQ2hCLFlBQVksQ0FBQ0ksT0FBTyxDQUFDWTtJQUNuQztJQUVBOztHQUVDLEdBQ0QsTUFBTVcsaUJBQWlCQyxXQUFtQixFQUFvQztRQUM1RSxPQUFPLElBQUksQ0FBQzVCLFlBQVksQ0FBQ2lCLFFBQVEsQ0FBQ1c7SUFDcEM7SUFFQTs7R0FFQyxHQUNELE1BQU1DLGdCQUFnQlYsSUFPckIsRUFBNkI7UUFDNUIsT0FBTyxJQUFJLENBQUNuQixZQUFZLENBQUNvQixNQUFNLENBQUNEO0lBQ2xDO0lBRUE7O0dBRUMsR0FDRCxNQUFNVyxnQkFDSkYsV0FBbUIsRUFDbkJOLE9BTUMsRUFDMEI7UUFDM0IsT0FBTyxJQUFJLENBQUN0QixZQUFZLENBQUN1QixNQUFNLENBQUNLLGFBQWFOO0lBQy9DO0lBRUE7O0dBRUMsR0FDRCxNQUFNUyxnQkFBZ0JILFdBQW1CLEVBQWlCO1FBQ3hELE9BQU8sSUFBSSxDQUFDNUIsWUFBWSxDQUFDeUIsTUFBTSxDQUFDRztJQUNsQztJQUVBOztHQUVDLEdBQ0QsTUFBTUksU0FBU0osV0FBb0IsRUFBMEI7UUFDM0QsT0FBTyxJQUFJLENBQUMzQixPQUFPLENBQUNHLE9BQU8sQ0FBQ3dCO0lBQzlCO0lBRUE7O0dBRUMsR0FDRCxNQUFNSyxZQUFZQyxNQUFjLEVBQStCO1FBQzdELE9BQU8sSUFBSSxDQUFDakMsT0FBTyxDQUFDZ0IsUUFBUSxDQUFDaUI7SUFDL0I7SUFFQTs7R0FFQyxHQUNELE1BQU1DLFdBQVdoQixJQWNoQixFQUF3QjtRQUN2QixPQUFPLElBQUksQ0FBQ2xCLE9BQU8sQ0FBQ21CLE1BQU0sQ0FBQ0Q7SUFDN0I7SUFFQTs7R0FFQyxHQUNELE1BQU1pQixXQUNKRixNQUFjLEVBQ2RaLE9BYUMsRUFDcUI7UUFDdEIsT0FBTyxJQUFJLENBQUNyQixPQUFPLENBQUNzQixNQUFNLENBQUNXLFFBQVFaO0lBQ3JDO0lBRUE7O0dBRUMsR0FDRCxNQUFNZSxXQUFXSCxNQUFjLEVBQWlCO1FBQzlDLE9BQU8sSUFBSSxDQUFDakMsT0FBTyxDQUFDd0IsTUFBTSxDQUFDUztJQUM3QjtBQUNGO0FBOU1hckMsc0JBQUFBLG9FQUFBQTtJQURaTCxvREFBVUE7SUFHTkMsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDO0lBQ1BBLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQztJQUNQQSxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7OztlQUYyQyx5RUFBa0IsNEJBQWxCLHlFQUFrQjtlQUNoQiwyRUFBbUIsNEJBQW5CLDJFQUFtQjtlQUM3QixpRUFBYyw0QkFBZCxpRUFBYzs7R0FKaERJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL3NlcnZpY2VzL2FiaWxpdHktbW9kZWwuc2VydmljZS50cz80ODNhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ3RzeXJpbmdlJztcbmltcG9ydCB7IEFiaWxpdHlDYXRlZ29yeURBTyB9IGZyb20gJ0AvZGFvL2FiaWxpdHktY2F0ZWdvcnkuZGFvJztcbmltcG9ydCB7IEFiaWxpdHlEaW1lbnNpb25EQU8gfSBmcm9tICdAL2Rhby9hYmlsaXR5LWRpbWVuc2lvbi5kYW8nO1xuaW1wb3J0IHsgQWJpbGl0eUl0ZW1EQU8gfSBmcm9tICdAL2Rhby9hYmlsaXR5LWl0ZW0uZGFvJztcbmltcG9ydCB0eXBlIHtcbiAgQWJpbGl0eUNhdGVnb3J5LFxuICBBYmlsaXR5RGltZW5zaW9uLFxuICBBYmlsaXR5SXRlbSxcbn0gZnJvbSAnQC9lbnRpdGllcyc7XG5cbi8qKlxuICog6IO95Yqb5qih5Z6L5pyN5YqhXG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBYmlsaXR5TW9kZWxTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQGluamVjdCgnQWJpbGl0eUNhdGVnb3J5REFPJykgcHJpdmF0ZSBjYXRlZ29yeURBTzogQWJpbGl0eUNhdGVnb3J5REFPLFxuICAgIEBpbmplY3QoJ0FiaWxpdHlEaW1lbnNpb25EQU8nKSBwcml2YXRlIGRpbWVuc2lvbkRBTzogQWJpbGl0eURpbWVuc2lvbkRBTyxcbiAgICBAaW5qZWN0KCdBYmlsaXR5SXRlbURBTycpIHByaXZhdGUgaXRlbURBTzogQWJpbGl0eUl0ZW1EQU9cbiAgKSB7fVxuXG4gIC8qKlxuICAgKiDojrflj5bog73lipvmqKHlnovmoJHlvaLnu5PmnoRcbiAgICovXG4gIGFzeW5jIGdldE1vZGVsVHJlZSgpOiBQcm9taXNlPEFycmF5PHtcbiAgICBjYXRlZ29yeTogQWJpbGl0eUNhdGVnb3J5O1xuICAgIGRpbWVuc2lvbnM6IEFycmF5PHtcbiAgICAgIGRpbWVuc2lvbjogQWJpbGl0eURpbWVuc2lvbjtcbiAgICAgIGl0ZW1zOiBBYmlsaXR5SXRlbVtdO1xuICAgIH0+O1xuICB9Pj4ge1xuICAgIGNvbnN0IGNhdGVnb3JpZXMgPSBhd2FpdCB0aGlzLmNhdGVnb3J5REFPLmZpbmRBbGwoKTtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcblxuICAgIGZvciAoY29uc3QgY2F0ZWdvcnkgb2YgY2F0ZWdvcmllcykge1xuICAgICAgY29uc3QgZGltZW5zaW9ucyA9IGF3YWl0IHRoaXMuZGltZW5zaW9uREFPLmZpbmRBbGwoY2F0ZWdvcnkuY2F0ZWdvcnlfaWQpO1xuICAgICAgY29uc3QgZGltZW5zaW9uSXRlbXMgPSBbXTtcblxuICAgICAgZm9yIChjb25zdCBkaW1lbnNpb24gb2YgZGltZW5zaW9ucykge1xuICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHRoaXMuaXRlbURBTy5maW5kQWxsKGRpbWVuc2lvbi5kaW1lbnNpb25faWQpO1xuICAgICAgICBkaW1lbnNpb25JdGVtcy5wdXNoKHtcbiAgICAgICAgICBkaW1lbnNpb24sXG4gICAgICAgICAgaXRlbXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgIGNhdGVnb3J5LFxuICAgICAgICBkaW1lbnNpb25zOiBkaW1lbnNpb25JdGVtcyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W6IO95Yqb57G75Yir5YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXRDYXRlZ29yaWVzKCk6IFByb21pc2U8QWJpbGl0eUNhdGVnb3J5W10+IHtcbiAgICByZXR1cm4gdGhpcy5jYXRlZ29yeURBTy5maW5kQWxsKCk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W6IO95Yqb57G75Yir6K+m5oOFXG4gICAqL1xuICBhc3luYyBnZXRDYXRlZ29yeUJ5SWQoY2F0ZWdvcnlJZDogc3RyaW5nKTogUHJvbWlzZTxBYmlsaXR5Q2F0ZWdvcnkgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMuY2F0ZWdvcnlEQU8uZmluZEJ5SWQoY2F0ZWdvcnlJZCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu66IO95Yqb57G75YirXG4gICAqL1xuICBhc3luYyBjcmVhdGVDYXRlZ29yeShkYXRhOiB7XG4gICAgY29kZTogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8QWJpbGl0eUNhdGVnb3J5PiB7XG4gICAgcmV0dXJuIHRoaXMuY2F0ZWdvcnlEQU8uY3JlYXRlKGRhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOiDveWKm+exu+WIq1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlQ2F0ZWdvcnkoXG4gICAgY2F0ZWdvcnlJZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IHtcbiAgICAgIGNvZGU/OiBzdHJpbmc7XG4gICAgICBuYW1lPzogc3RyaW5nO1xuICAgICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIH1cbiAgKTogUHJvbWlzZTxBYmlsaXR5Q2F0ZWdvcnk+IHtcbiAgICByZXR1cm4gdGhpcy5jYXRlZ29yeURBTy51cGRhdGUoY2F0ZWdvcnlJZCwgdXBkYXRlcyk7XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk6IO95Yqb57G75YirXG4gICAqL1xuICBhc3luYyBkZWxldGVDYXRlZ29yeShjYXRlZ29yeUlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5jYXRlZ29yeURBTy5kZWxldGUoY2F0ZWdvcnlJZCk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W6IO95Yqb57u05bqm5YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXREaW1lbnNpb25zKGNhdGVnb3J5SWQ/OiBzdHJpbmcpOiBQcm9taXNlPEFiaWxpdHlEaW1lbnNpb25bXT4ge1xuICAgIHJldHVybiB0aGlzLmRpbWVuc2lvbkRBTy5maW5kQWxsKGNhdGVnb3J5SWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluiDveWKm+e7tOW6puivpuaDhVxuICAgKi9cbiAgYXN5bmMgZ2V0RGltZW5zaW9uQnlJZChkaW1lbnNpb25JZDogc3RyaW5nKTogUHJvbWlzZTxBYmlsaXR5RGltZW5zaW9uIHwgbnVsbD4ge1xuICAgIHJldHVybiB0aGlzLmRpbWVuc2lvbkRBTy5maW5kQnlJZChkaW1lbnNpb25JZCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu66IO95Yqb57u05bqmXG4gICAqL1xuICBhc3luYyBjcmVhdGVEaW1lbnNpb24oZGF0YToge1xuICAgIGNhdGVnb3J5X2lkOiBzdHJpbmc7XG4gICAgY29kZTogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8QWJpbGl0eURpbWVuc2lvbj4ge1xuICAgIHJldHVybiB0aGlzLmRpbWVuc2lvbkRBTy5jcmVhdGUoZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICog5pu05paw6IO95Yqb57u05bqmXG4gICAqL1xuICBhc3luYyB1cGRhdGVEaW1lbnNpb24oXG4gICAgZGltZW5zaW9uSWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICBjb2RlPzogc3RyaW5nO1xuICAgICAgbmFtZT86IHN0cmluZztcbiAgICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgICAgc29ydF9vcmRlcj86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8QWJpbGl0eURpbWVuc2lvbj4ge1xuICAgIHJldHVybiB0aGlzLmRpbWVuc2lvbkRBTy51cGRhdGUoZGltZW5zaW9uSWQsIHVwZGF0ZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOiDveWKm+e7tOW6plxuICAgKi9cbiAgYXN5bmMgZGVsZXRlRGltZW5zaW9uKGRpbWVuc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5kaW1lbnNpb25EQU8uZGVsZXRlKGRpbWVuc2lvbklkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bog73lipvpobnliJfooahcbiAgICovXG4gIGFzeW5jIGdldEl0ZW1zKGRpbWVuc2lvbklkPzogc3RyaW5nKTogUHJvbWlzZTxBYmlsaXR5SXRlbVtdPiB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbURBTy5maW5kQWxsKGRpbWVuc2lvbklkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bog73lipvpobnor6bmg4VcbiAgICovXG4gIGFzeW5jIGdldEl0ZW1CeUlkKGl0ZW1JZDogc3RyaW5nKTogUHJvbWlzZTxBYmlsaXR5SXRlbSB8IG51bGw+IHtcbiAgICByZXR1cm4gdGhpcy5pdGVtREFPLmZpbmRCeUlkKGl0ZW1JZCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu66IO95Yqb6aG5XG4gICAqL1xuICBhc3luYyBjcmVhdGVJdGVtKGRhdGE6IHtcbiAgICBkaW1lbnNpb25faWQ6IHN0cmluZztcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIGRlZmluaXRpb24/OiBzdHJpbmc7XG4gICAgcGVyZm9ybWFuY2VfZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgZXZhbHVhdGlvbl9wb2ludHM/OiBzdHJpbmc7XG4gICAgdHJhaW5pbmdfc3RyYXRlZ2llcz86IHN0cmluZztcbiAgICB0aGVvcmV0aWNhbF9iYXNpcz86IHN0cmluZztcbiAgICB0YWxlbnRfcmF0aW8/OiBudW1iZXI7XG4gICAgYWNxdWlyZWRfdHJhaW5pbmdfcmF0aW8/OiBudW1iZXI7XG4gICAgc29ydF9vcmRlcj86IG51bWJlcjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPEFiaWxpdHlJdGVtPiB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbURBTy5jcmVhdGUoZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICog5pu05paw6IO95Yqb6aG5XG4gICAqL1xuICBhc3luYyB1cGRhdGVJdGVtKFxuICAgIGl0ZW1JZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IHtcbiAgICAgIGNvZGU/OiBzdHJpbmc7XG4gICAgICBuYW1lPzogc3RyaW5nO1xuICAgICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgICBkZWZpbml0aW9uPzogc3RyaW5nO1xuICAgICAgcGVyZm9ybWFuY2VfZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgICBldmFsdWF0aW9uX3BvaW50cz86IHN0cmluZztcbiAgICAgIHRyYWluaW5nX3N0cmF0ZWdpZXM/OiBzdHJpbmc7XG4gICAgICB0aGVvcmV0aWNhbF9iYXNpcz86IHN0cmluZztcbiAgICAgIHRhbGVudF9yYXRpbz86IG51bWJlcjtcbiAgICAgIGFjcXVpcmVkX3RyYWluaW5nX3JhdGlvPzogbnVtYmVyO1xuICAgICAgc29ydF9vcmRlcj86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8QWJpbGl0eUl0ZW0+IHtcbiAgICByZXR1cm4gdGhpcy5pdGVtREFPLnVwZGF0ZShpdGVtSWQsIHVwZGF0ZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOiDveWKm+mhuVxuICAgKi9cbiAgYXN5bmMgZGVsZXRlSXRlbShpdGVtSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLml0ZW1EQU8uZGVsZXRlKGl0ZW1JZCk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbImluamVjdGFibGUiLCJpbmplY3QiLCJBYmlsaXR5Q2F0ZWdvcnlEQU8iLCJBYmlsaXR5RGltZW5zaW9uREFPIiwiQWJpbGl0eUl0ZW1EQU8iLCJBYmlsaXR5TW9kZWxTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJjYXRlZ29yeURBTyIsImRpbWVuc2lvbkRBTyIsIml0ZW1EQU8iLCJnZXRNb2RlbFRyZWUiLCJjYXRlZ29yaWVzIiwiZmluZEFsbCIsInJlc3VsdCIsImNhdGVnb3J5IiwiZGltZW5zaW9ucyIsImNhdGVnb3J5X2lkIiwiZGltZW5zaW9uSXRlbXMiLCJkaW1lbnNpb24iLCJpdGVtcyIsImRpbWVuc2lvbl9pZCIsInB1c2giLCJnZXRDYXRlZ29yaWVzIiwiZ2V0Q2F0ZWdvcnlCeUlkIiwiY2F0ZWdvcnlJZCIsImZpbmRCeUlkIiwiY3JlYXRlQ2F0ZWdvcnkiLCJkYXRhIiwiY3JlYXRlIiwidXBkYXRlQ2F0ZWdvcnkiLCJ1cGRhdGVzIiwidXBkYXRlIiwiZGVsZXRlQ2F0ZWdvcnkiLCJkZWxldGUiLCJnZXREaW1lbnNpb25zIiwiZ2V0RGltZW5zaW9uQnlJZCIsImRpbWVuc2lvbklkIiwiY3JlYXRlRGltZW5zaW9uIiwidXBkYXRlRGltZW5zaW9uIiwiZGVsZXRlRGltZW5zaW9uIiwiZ2V0SXRlbXMiLCJnZXRJdGVtQnlJZCIsIml0ZW1JZCIsImNyZWF0ZUl0ZW0iLCJ1cGRhdGVJdGVtIiwiZGVsZXRlSXRlbSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/ability-model.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/auth.service.ts":
/*!**************************************!*\
  !*** ./src/services/auth.service.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthService: () => (/* binding */ AuthService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/../../node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/../../node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/user.dao */ \"(rsc)/./src/dao/user.dao.ts\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _core_redis__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/core/redis */ \"(rsc)/./src/core/redis.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__]);\n([_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\nclass AuthService {\n    constructor(userDAO, workspaceDAO, redis){\n        this.userDAO = userDAO;\n        this.workspaceDAO = workspaceDAO;\n        this.redis = redis;\n        this.redis = _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis.getInstance();\n    }\n    /**\n   * 用户注册\n   */ async register(data) {\n        // 检查邮箱是否已存在\n        const existingUser = await this.userDAO.findByEmail(data.email);\n        if (existingUser) {\n            throw new Error(\"Email already exists\");\n        }\n        // 加密密码\n        const hashedPassword = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().hash(data.password, 10);\n        // 创建用户\n        const user = await this.userDAO.create({\n            email: data.email,\n            password: hashedPassword,\n            name: data.name\n        });\n        // 创建默认工作空间\n        const defaultWorkspace = await this.workspaceDAO.create({\n            name: \"我的工作空间\",\n            owner_uid: user.uid\n        });\n        // 生成 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const refreshToken = this.generateRefreshToken(user.uid);\n        // 保存刷新令牌到数据库（这里简化处理，实际应该保存到数据库）\n        await this.redis.set(`refresh_token:${refreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60); // 30天\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { password, ...userWithoutPassword } = user;\n        return {\n            user: userWithoutPassword,\n            token,\n            refreshToken,\n            defaultWorkspaceId: defaultWorkspace.workspace_id\n        };\n    }\n    /**\n   * 用户登录\n   */ async login(email, password) {\n        const user = await this.userDAO.findByEmail(email);\n        if (!user) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 验证密码\n        const isValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(password, user.password);\n        if (!isValid) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 获取或创建默认工作空间\n        const defaultWorkspace = await this.workspaceDAO.getOrCreateDefault(user.uid);\n        // 生成 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const refreshToken = this.generateRefreshToken(user.uid);\n        // 保存刷新令牌\n        await this.redis.set(`refresh_token:${refreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60);\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { password: _, ...userWithoutPassword } = user;\n        return {\n            user: userWithoutPassword,\n            token,\n            refreshToken,\n            defaultWorkspaceId: defaultWorkspace.workspace_id\n        };\n    }\n    /**\n   * 管理员登录（仅允许 type 为 'admin' 的用户登录）\n   */ async adminLogin(email, password) {\n        const user = await this.userDAO.findByEmail(email);\n        if (!user) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 检查是否为管理员\n        if (user.type !== \"admin\") {\n            throw new Error(\"Access denied. Admin type required.\");\n        }\n        // 验证密码\n        const isValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(password, user.password);\n        if (!isValid) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 获取或创建默认工作空间\n        const defaultWorkspace = await this.workspaceDAO.getOrCreateDefault(user.uid);\n        // 生成 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const refreshToken = this.generateRefreshToken(user.uid);\n        // 保存刷新令牌\n        await this.redis.set(`refresh_token:${refreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60);\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { password: _, ...userWithoutPassword } = user;\n        return {\n            user: userWithoutPassword,\n            token,\n            refreshToken,\n            defaultWorkspaceId: defaultWorkspace.workspace_id\n        };\n    }\n    /**\n   * 刷新 token\n   */ async refreshToken(refreshToken) {\n        const uidStr = await this.redis.get(`refresh_token:${refreshToken}`);\n        if (!uidStr) {\n            throw new Error(\"Invalid refresh token\");\n        }\n        const uid = parseInt(uidStr, 10);\n        const user = await this.userDAO.findByUid(uid);\n        if (!user) {\n            throw new Error(\"User not found\");\n        }\n        // 生成新 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const newRefreshToken = this.generateRefreshToken(user.uid);\n        // 更新刷新令牌\n        await this.redis.del(`refresh_token:${refreshToken}`);\n        await this.redis.set(`refresh_token:${newRefreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60);\n        return {\n            token,\n            refreshToken: newRefreshToken\n        };\n    }\n    /**\n   * 验证 token\n   */ async verifyToken(token) {\n        try {\n            const secret = process.env.JWT_SECRET || \"your-secret-key\";\n            const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().verify(token, secret);\n            return decoded;\n        } catch  {\n            throw new Error(\"Invalid token\");\n        }\n    }\n    /**\n   * 从请求中获取当前用户（验证 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.verifyToken(token);\n    }\n    /**\n   * 从请求中获取当前用户完整信息（包括类型）\n   */ async getCurrentUserWithType(req) {\n        const { uid } = await this.getCurrentUser(req);\n        const user = await this.userDAO.findByUid(uid);\n        if (!user) {\n            throw new Error(\"User not found\");\n        }\n        return user;\n    }\n    /**\n   * 检查当前用户是否为管理员\n   */ async checkAdminRole(req) {\n        const user = await this.getCurrentUserWithType(req);\n        if (user.type !== \"admin\") {\n            throw new Error(\"Access denied. Admin type required.\");\n        }\n        return user;\n    }\n    /**\n   * 生成 JWT token\n   */ generateToken(uid, uuid) {\n        const secret = process.env.JWT_SECRET || \"your-secret-key\";\n        const expiresIn = process.env.JWT_EXPIRES_IN || \"7d\";\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().sign({\n            uid,\n            uuid\n        }, secret, {\n            expiresIn\n        });\n    }\n    /**\n   * 生成刷新 token\n   */ generateRefreshToken(uid) {\n        const secret = process.env.JWT_SECRET || \"your-secret-key\";\n        const expiresIn = process.env.JWT_REFRESH_EXPIRES_IN || \"30d\";\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().sign({\n            uid,\n            type: \"refresh\"\n        }, secret, {\n            expiresIn\n        });\n    }\n}\nAuthService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"UserDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"WorkspaceDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO === \"undefined\" ? Object : _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO,\n        typeof _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__.WorkspaceDAO === \"undefined\" ? Object : _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__.WorkspaceDAO,\n        typeof _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis === \"undefined\" ? Object : _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis\n    ])\n], AuthService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxJQUFJO1FBQ3pDLE1BQU1XLFlBQVliLFFBQVFDLEdBQUcsQ0FBQ2Usc0JBQXNCLElBQUk7UUFDeEQsT0FBT2xFLHdEQUFRLENBQUM7WUFBRXdCO1lBQUtpQixNQUFNO1FBQVUsR0FBR1EsUUFBUTtZQUFFYztRQUFVO0lBQ2hFO0FBQ0Y7QUF2UGEzRCxjQUFBQSxvRUFBQUE7SUFEWlAsb0RBQVVBO0lBR05DLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQztJQUNQQSxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7OztlQUQ0QixrREFBTyw0QkFBUCxrREFBTztlQUNHLDREQUFZLDRCQUFaLDREQUFZO2VBQzNDLDhDQUFLLDRCQUFMLDhDQUFLOztHQUpYTSIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UudHM/ZDZmYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJztcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcbmltcG9ydCB0eXBlIHsgU2lnbk9wdGlvbnMgfSBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IHR5cGUgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IFVzZXJEQU8gfSBmcm9tICdAL2Rhby91c2VyLmRhbyc7XG5pbXBvcnQgeyBXb3Jrc3BhY2VEQU8gfSBmcm9tICdAL2Rhby93b3Jrc3BhY2UuZGFvJztcbmltcG9ydCB0eXBlIHsgVXNlciB9IGZyb20gJ0AvZW50aXRpZXMnO1xuaW1wb3J0IHsgUmVkaXMgfSBmcm9tICdAL2NvcmUvcmVkaXMnO1xuXG4vKipcbiAqIOiupOivgeacjeWKoVxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQXV0aFNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdVc2VyREFPJykgcHJpdmF0ZSB1c2VyREFPOiBVc2VyREFPLFxuICAgIEBpbmplY3QoJ1dvcmtzcGFjZURBTycpIHByaXZhdGUgd29ya3NwYWNlREFPOiBXb3Jrc3BhY2VEQU8sXG4gICAgcHJpdmF0ZSByZWRpczogUmVkaXNcbiAgKSB7XG4gICAgdGhpcy5yZWRpcyA9IFJlZGlzLmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog55So5oi35rOo5YaMXG4gICAqL1xuICBhc3luYyByZWdpc3RlcihkYXRhOiB7IGVtYWlsOiBzdHJpbmc7IHBhc3N3b3JkOiBzdHJpbmc7IG5hbWU6IHN0cmluZyB9KTogUHJvbWlzZTx7XG4gICAgdXNlcjogT21pdDxVc2VyLCAncGFzc3dvcmQnPjtcbiAgICB0b2tlbjogc3RyaW5nO1xuICAgIHJlZnJlc2hUb2tlbjogc3RyaW5nO1xuICAgIGRlZmF1bHRXb3Jrc3BhY2VJZDogc3RyaW5nO1xuICB9PiB7XG4gICAgLy8g5qOA5p+l6YKu566x5piv5ZCm5bey5a2Y5ZyoXG4gICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgdGhpcy51c2VyREFPLmZpbmRCeUVtYWlsKGRhdGEuZW1haWwpO1xuICAgIGlmIChleGlzdGluZ1VzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRW1haWwgYWxyZWFkeSBleGlzdHMnKTtcbiAgICB9XG5cbiAgICAvLyDliqDlr4blr4bnoIFcbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKGRhdGEucGFzc3dvcmQsIDEwKTtcblxuICAgIC8vIOWIm+W7uueUqOaIt1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJEQU8uY3JlYXRlKHtcbiAgICAgIGVtYWlsOiBkYXRhLmVtYWlsLFxuICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgbmFtZTogZGF0YS5uYW1lLFxuICAgIH0pO1xuXG4gICAgLy8g5Yib5bu66buY6K6k5bel5L2c56m66Ze0XG4gICAgY29uc3QgZGVmYXVsdFdvcmtzcGFjZSA9IGF3YWl0IHRoaXMud29ya3NwYWNlREFPLmNyZWF0ZSh7XG4gICAgICBuYW1lOiAn5oiR55qE5bel5L2c56m66Ze0JyxcbiAgICAgIG93bmVyX3VpZDogdXNlci51aWQsXG4gICAgfSk7XG5cbiAgICAvLyDnlJ/miJAgdG9rZW5cbiAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2VuZXJhdGVUb2tlbih1c2VyLnVpZCwgdXNlci51dWlkKTtcbiAgICBjb25zdCByZWZyZXNoVG9rZW4gPSB0aGlzLmdlbmVyYXRlUmVmcmVzaFRva2VuKHVzZXIudWlkKTtcblxuICAgIC8vIOS/neWtmOWIt+aWsOS7pOeJjOWIsOaVsOaNruW6k++8iOi/memHjOeugOWMluWkhOeQhu+8jOWunumZheW6lOivpeS/neWtmOWIsOaVsOaNruW6k++8iVxuICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0KGByZWZyZXNoX3Rva2VuOiR7cmVmcmVzaFRva2VufWAsIHVzZXIudWlkLnRvU3RyaW5nKCksIDMwICogMjQgKiA2MCAqIDYwKTsgLy8gMzDlpKlcblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICBjb25zdCB7IHBhc3N3b3JkLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgIHJldHVybiB7XG4gICAgICB1c2VyOiB1c2VyV2l0aG91dFBhc3N3b3JkLFxuICAgICAgdG9rZW4sXG4gICAgICByZWZyZXNoVG9rZW4sXG4gICAgICBkZWZhdWx0V29ya3NwYWNlSWQ6IGRlZmF1bHRXb3Jrc3BhY2Uud29ya3NwYWNlX2lkLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog55So5oi355m75b2VXG4gICAqL1xuICBhc3luYyBsb2dpbihcbiAgICBlbWFpbDogc3RyaW5nLFxuICAgIHBhc3N3b3JkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTx7XG4gICAgdXNlcjogT21pdDxVc2VyLCAncGFzc3dvcmQnPjtcbiAgICB0b2tlbjogc3RyaW5nO1xuICAgIHJlZnJlc2hUb2tlbjogc3RyaW5nO1xuICAgIGRlZmF1bHRXb3Jrc3BhY2VJZDogc3RyaW5nO1xuICB9PiB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlckRBTy5maW5kQnlFbWFpbChlbWFpbCk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQnKTtcbiAgICB9XG5cbiAgICAvLyDpqozor4Hlr4bnoIFcbiAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpO1xuICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGVtYWlsIG9yIHBhc3N3b3JkJyk7XG4gICAgfVxuXG4gICAgLy8g6I635Y+W5oiW5Yib5bu66buY6K6k5bel5L2c56m66Ze0XG4gICAgY29uc3QgZGVmYXVsdFdvcmtzcGFjZSA9IGF3YWl0IHRoaXMud29ya3NwYWNlREFPLmdldE9yQ3JlYXRlRGVmYXVsdCh1c2VyLnVpZCk7XG5cbiAgICAvLyDnlJ/miJAgdG9rZW5cbiAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2VuZXJhdGVUb2tlbih1c2VyLnVpZCwgdXNlci51dWlkKTtcbiAgICBjb25zdCByZWZyZXNoVG9rZW4gPSB0aGlzLmdlbmVyYXRlUmVmcmVzaFRva2VuKHVzZXIudWlkKTtcblxuICAgIC8vIOS/neWtmOWIt+aWsOS7pOeJjFxuICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0KGByZWZyZXNoX3Rva2VuOiR7cmVmcmVzaFRva2VufWAsIHVzZXIudWlkLnRvU3RyaW5nKCksIDMwICogMjQgKiA2MCAqIDYwKTtcblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICBjb25zdCB7IHBhc3N3b3JkOiBfLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgIHJldHVybiB7XG4gICAgICB1c2VyOiB1c2VyV2l0aG91dFBhc3N3b3JkLFxuICAgICAgdG9rZW4sXG4gICAgICByZWZyZXNoVG9rZW4sXG4gICAgICBkZWZhdWx0V29ya3NwYWNlSWQ6IGRlZmF1bHRXb3Jrc3BhY2Uud29ya3NwYWNlX2lkLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog566h55CG5ZGY55m75b2V77yI5LuF5YWB6K64IHR5cGUg5Li6ICdhZG1pbicg55qE55So5oi355m75b2V77yJXG4gICAqL1xuICBhc3luYyBhZG1pbkxvZ2luKFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZ1xuICApOiBQcm9taXNlPHtcbiAgICB1c2VyOiBPbWl0PFVzZXIsICdwYXNzd29yZCc+O1xuICAgIHRva2VuOiBzdHJpbmc7XG4gICAgcmVmcmVzaFRva2VuOiBzdHJpbmc7XG4gICAgZGVmYXVsdFdvcmtzcGFjZUlkOiBzdHJpbmc7XG4gIH0+IHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyREFPLmZpbmRCeUVtYWlsKGVtYWlsKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcpO1xuICAgIH1cblxuICAgIC8vIOajgOafpeaYr+WQpuS4uueuoeeQhuWRmFxuICAgIGlmICh1c2VyLnR5cGUgIT09ICdhZG1pbicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQWNjZXNzIGRlbmllZC4gQWRtaW4gdHlwZSByZXF1aXJlZC4nKTtcbiAgICB9XG5cbiAgICAvLyDpqozor4Hlr4bnoIFcbiAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpO1xuICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGVtYWlsIG9yIHBhc3N3b3JkJyk7XG4gICAgfVxuXG4gICAgLy8g6I635Y+W5oiW5Yib5bu66buY6K6k5bel5L2c56m66Ze0XG4gICAgY29uc3QgZGVmYXVsdFdvcmtzcGFjZSA9IGF3YWl0IHRoaXMud29ya3NwYWNlREFPLmdldE9yQ3JlYXRlRGVmYXVsdCh1c2VyLnVpZCk7XG5cbiAgICAvLyDnlJ/miJAgdG9rZW5cbiAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2VuZXJhdGVUb2tlbih1c2VyLnVpZCwgdXNlci51dWlkKTtcbiAgICBjb25zdCByZWZyZXNoVG9rZW4gPSB0aGlzLmdlbmVyYXRlUmVmcmVzaFRva2VuKHVzZXIudWlkKTtcblxuICAgIC8vIOS/neWtmOWIt+aWsOS7pOeJjFxuICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0KGByZWZyZXNoX3Rva2VuOiR7cmVmcmVzaFRva2VufWAsIHVzZXIudWlkLnRvU3RyaW5nKCksIDMwICogMjQgKiA2MCAqIDYwKTtcblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICBjb25zdCB7IHBhc3N3b3JkOiBfLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgIHJldHVybiB7XG4gICAgICB1c2VyOiB1c2VyV2l0aG91dFBhc3N3b3JkLFxuICAgICAgdG9rZW4sXG4gICAgICByZWZyZXNoVG9rZW4sXG4gICAgICBkZWZhdWx0V29ya3NwYWNlSWQ6IGRlZmF1bHRXb3Jrc3BhY2Uud29ya3NwYWNlX2lkLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog5Yi35pawIHRva2VuXG4gICAqL1xuICBhc3luYyByZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHsgdG9rZW46IHN0cmluZzsgcmVmcmVzaFRva2VuOiBzdHJpbmcgfT4ge1xuICAgIGNvbnN0IHVpZFN0ciA9IGF3YWl0IHRoaXMucmVkaXMuZ2V0KGByZWZyZXNoX3Rva2VuOiR7cmVmcmVzaFRva2VufWApO1xuICAgIGlmICghdWlkU3RyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcmVmcmVzaCB0b2tlbicpO1xuICAgIH1cblxuICAgIGNvbnN0IHVpZCA9IHBhcnNlSW50KHVpZFN0ciwgMTApO1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJEQU8uZmluZEJ5VWlkKHVpZCk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgLy8g55Sf5oiQ5pawIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmdlbmVyYXRlVG9rZW4odXNlci51aWQsIHVzZXIudXVpZCk7XG4gICAgY29uc3QgbmV3UmVmcmVzaFRva2VuID0gdGhpcy5nZW5lcmF0ZVJlZnJlc2hUb2tlbih1c2VyLnVpZCk7XG5cbiAgICAvLyDmm7TmlrDliLfmlrDku6TniYxcbiAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChgcmVmcmVzaF90b2tlbjoke3JlZnJlc2hUb2tlbn1gKTtcbiAgICBhd2FpdCB0aGlzLnJlZGlzLnNldChcbiAgICAgIGByZWZyZXNoX3Rva2VuOiR7bmV3UmVmcmVzaFRva2VufWAsXG4gICAgICB1c2VyLnVpZC50b1N0cmluZygpLFxuICAgICAgMzAgKiAyNCAqIDYwICogNjBcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRva2VuLFxuICAgICAgcmVmcmVzaFRva2VuOiBuZXdSZWZyZXNoVG9rZW4sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDpqozor4EgdG9rZW5cbiAgICovXG4gIGFzeW5jIHZlcmlmeVRva2VuKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHsgdWlkOiBudW1iZXI7IHV1aWQ6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG4gICAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgc2VjcmV0KSBhcyB7IHVpZDogbnVtYmVyOyB1dWlkOiBzdHJpbmcgfTtcbiAgICAgIHJldHVybiBkZWNvZGVkO1xuICAgIH0gY2F0Y2gge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHRva2VuJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOS7juivt+axguS4reiOt+WPluW9k+WJjeeUqOaIt++8iOmqjOivgSB0b2tlbu+8iVxuICAgKi9cbiAgYXN5bmMgZ2V0Q3VycmVudFVzZXIocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8eyB1aWQ6IG51bWJlcjsgdXVpZDogc3RyaW5nIH0+IHtcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJyk7XG4gICAgaWYgKCFhdXRoSGVhZGVyIHx8ICFhdXRoSGVhZGVyLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmF1dGhvcml6ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnZlcmlmeVRva2VuKHRva2VuKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDku47or7fmsYLkuK3ojrflj5blvZPliY3nlKjmiLflrozmlbTkv6Hmga/vvIjljIXmi6znsbvlnovvvIlcbiAgICovXG4gIGFzeW5jIGdldEN1cnJlbnRVc2VyV2l0aFR5cGUocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8VXNlcj4ge1xuICAgIGNvbnN0IHsgdWlkIH0gPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlckRBTy5maW5kQnlVaWQodWlkKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHVzZXI7XG4gIH1cblxuICAvKipcbiAgICog5qOA5p+l5b2T5YmN55So5oi35piv5ZCm5Li6566h55CG5ZGYXG4gICAqL1xuICBhc3luYyBjaGVja0FkbWluUm9sZShyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxVc2VyPiB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXJXaXRoVHlwZShyZXEpO1xuICAgIGlmICh1c2VyLnR5cGUgIT09ICdhZG1pbicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQWNjZXNzIGRlbmllZC4gQWRtaW4gdHlwZSByZXF1aXJlZC4nKTtcbiAgICB9XG4gICAgcmV0dXJuIHVzZXI7XG4gIH1cblxuICAvKipcbiAgICog55Sf5oiQIEpXVCB0b2tlblxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVRva2VuKHVpZDogbnVtYmVyLCB1dWlkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG4gICAgY29uc3QgZXhwaXJlc0luID0gcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4gfHwgJzdkJztcbiAgICByZXR1cm4gand0LnNpZ24oeyB1aWQsIHV1aWQgfSwgc2VjcmV0LCB7IGV4cGlyZXNJbiB9IGFzIFNpZ25PcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnlJ/miJDliLfmlrAgdG9rZW5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVSZWZyZXNoVG9rZW4odWlkOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG4gICAgY29uc3QgZXhwaXJlc0luID0gcHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfRVhQSVJFU19JTiB8fCAnMzBkJztcbiAgICByZXR1cm4gand0LnNpZ24oeyB1aWQsIHR5cGU6ICdyZWZyZXNoJyB9LCBzZWNyZXQsIHsgZXhwaXJlc0luIH0gYXMgU2lnbk9wdGlvbnMpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiaW5qZWN0YWJsZSIsImluamVjdCIsImJjcnlwdCIsImp3dCIsIlVzZXJEQU8iLCJXb3Jrc3BhY2VEQU8iLCJSZWRpcyIsIkF1dGhTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJ1c2VyREFPIiwid29ya3NwYWNlREFPIiwicmVkaXMiLCJnZXRJbnN0YW5jZSIsInJlZ2lzdGVyIiwiZGF0YSIsImV4aXN0aW5nVXNlciIsImZpbmRCeUVtYWlsIiwiZW1haWwiLCJFcnJvciIsImhhc2hlZFBhc3N3b3JkIiwiaGFzaCIsInBhc3N3b3JkIiwidXNlciIsImNyZWF0ZSIsIm5hbWUiLCJkZWZhdWx0V29ya3NwYWNlIiwib3duZXJfdWlkIiwidWlkIiwidG9rZW4iLCJnZW5lcmF0ZVRva2VuIiwidXVpZCIsInJlZnJlc2hUb2tlbiIsImdlbmVyYXRlUmVmcmVzaFRva2VuIiwic2V0IiwidG9TdHJpbmciLCJ1c2VyV2l0aG91dFBhc3N3b3JkIiwiZGVmYXVsdFdvcmtzcGFjZUlkIiwid29ya3NwYWNlX2lkIiwibG9naW4iLCJpc1ZhbGlkIiwiY29tcGFyZSIsImdldE9yQ3JlYXRlRGVmYXVsdCIsIl8iLCJhZG1pbkxvZ2luIiwidHlwZSIsInVpZFN0ciIsImdldCIsInBhcnNlSW50IiwiZmluZEJ5VWlkIiwibmV3UmVmcmVzaFRva2VuIiwiZGVsIiwidmVyaWZ5VG9rZW4iLCJzZWNyZXQiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImRlY29kZWQiLCJ2ZXJpZnkiLCJnZXRDdXJyZW50VXNlciIsInJlcSIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwic3RhcnRzV2l0aCIsInN1YnN0cmluZyIsImdldEN1cnJlbnRVc2VyV2l0aFR5cGUiLCJjaGVja0FkbWluUm9sZSIsImV4cGlyZXNJbiIsIkpXVF9FWFBJUkVTX0lOIiwic2lnbiIsIkpXVF9SRUZSRVNIX0VYUElSRVNfSU4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/auth.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/document.service.ts":
/*!******************************************!*\
  !*** ./src/services/document.service.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentService: () => (/* binding */ DocumentService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var yjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! yjs */ \"(rsc)/../../node_modules/yjs/dist/yjs.mjs\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/document-change.dao */ \"(rsc)/./src/dao/document-change.dao.ts\");\n/* harmony import */ var _core_redis__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/core/redis */ \"(rsc)/./src/core/redis.ts\");\n/* harmony import */ var _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./snapshot-scheduler.service */ \"(rsc)/./src/services/snapshot-scheduler.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__, _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__]);\n([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__, _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\nclass DocumentService {\n    constructor(documentDAO, redis, snapshotScheduler, changeDAO){\n        this.documentDAO = documentDAO;\n        this.redis = redis;\n        this.snapshotScheduler = snapshotScheduler;\n        this.changeDAO = changeDAO;\n        this.redis = _core_redis__WEBPACK_IMPORTED_MODULE_3__.Redis.getInstance();\n    }\n    /**\n   * 创建文档\n   */ async createDocument(data) {\n        const document = await this.documentDAO.create({\n            workspace_id: data.workspace_id,\n            title: data.title,\n            content: data.content,\n            content_length: data.content.length,\n            owner_uid: data.owner_uid,\n            metadata: data.metadata\n        });\n        // 创建初始快照（无论是否有内容，都应该创建初始快照）\n        // 这样即使文档创建时为空，也能有一个基准快照用于时间间隔计算\n        if (this.snapshotScheduler) {\n            try {\n                console.log(`[DocumentService] Creating initial snapshot for document ${document.object_id}, contentLength: ${data.content?.length || 0}`);\n                // 创建初始快照（强制创建大版本）\n                // 即使 content 为空，也创建一个空内容的快照\n                const contentToSnapshot = data.content && data.content.length > 0 ? data.content : Buffer.alloc(0); // 空内容也创建快照\n                const snapshotResult = await this.snapshotScheduler.createSnapshotManually(document.object_id, document.workspace_id, contentToSnapshot, undefined, true // 强制创建大版本\n                );\n                console.log(`[DocumentService] Initial snapshot created:`, {\n                    snapshot_id: snapshotResult.snapshot_id,\n                    version_type: snapshotResult.version_type,\n                    created_at: snapshotResult.created_at\n                });\n            } catch (error) {\n                // 快照创建失败不应该影响文档创建，只记录错误\n                console.error(\"[DocumentService] Failed to create initial snapshot:\", error);\n            }\n        } else {\n            console.warn(`[DocumentService] SnapshotScheduler not available, cannot create initial snapshot`);\n        }\n        // 清除缓存\n        await this.redis.del(`document:${document.object_id}`);\n        // 清除该工作空间的所有文档列表缓存（因为缓存键包含 options 参数）\n        await this.redis.delByPattern(`documents:workspace:${data.workspace_id}:*`);\n        return document;\n    }\n    /**\n   * 获取文档\n   */ async getDocument(object_id, includeContent = true) {\n        // 尝试从缓存获取\n        const cacheKey = `document:${object_id}`;\n        const cached = await this.redis.getJSON(cacheKey);\n        if (cached) {\n            return cached;\n        }\n        const document = await this.documentDAO.findById(object_id);\n        if (!document) {\n            return null;\n        }\n        // 缓存文档（不包含 content，减少内存占用）\n        if (!includeContent) {\n            const { content, ...docWithoutContent } = document;\n            await this.redis.setJSON(cacheKey, docWithoutContent, 300); // 5分钟缓存\n        }\n        return document;\n    }\n    /**\n   * 更新文档\n   *\n   * 优化策略：\n   * - 如果只有 change_data（增量），应用增量到现有文档状态，然后更新数据库\n   * - 如果有 content（全量），直接使用全量更新数据库\n   */ async updateDocument(object_id, updates) {\n        // 如果更新了内容，先获取当前文档信息以便创建快照\n        const currentDoc = await this.documentDAO.findById(object_id);\n        if (!currentDoc) {\n            throw new Error(\"Document not found\");\n        }\n        // 优化：如果只有增量更新，应用增量到现有文档状态\n        let finalContent;\n        let finalContentLength;\n        if (updates.change_data && !updates.content) {\n            // 只有增量更新：应用增量到现有文档状态\n            console.log(`[DocumentService] Applying incremental update, size: ${updates.change_data.length} bytes`);\n            try {\n                // 创建临时 Y.Doc 并应用现有状态\n                const ydoc = new yjs__WEBPACK_IMPORTED_MODULE_5__.Doc();\n                if (currentDoc.content && currentDoc.content.length > 0) {\n                    yjs__WEBPACK_IMPORTED_MODULE_5__.applyUpdate(ydoc, currentDoc.content);\n                }\n                // 应用增量更新\n                yjs__WEBPACK_IMPORTED_MODULE_5__.applyUpdate(ydoc, updates.change_data);\n                // 获取新的完整状态\n                finalContent = Buffer.from(yjs__WEBPACK_IMPORTED_MODULE_5__.encodeStateAsUpdate(ydoc));\n                finalContentLength = finalContent.length;\n                console.log(`[DocumentService] Incremental update applied, new content size: ${finalContentLength} bytes`);\n            } catch (error) {\n                console.error(\"[DocumentService] Failed to apply incremental update:\", error);\n                throw new Error(\"Failed to apply incremental update\");\n            }\n        } else if (updates.content) {\n            // 有全量更新：直接使用\n            finalContent = updates.content;\n            finalContentLength = updates.content.length;\n            console.log(`[DocumentService] Using full update, size: ${finalContentLength} bytes`);\n        }\n        const updateData = {};\n        if (updates.title) updateData.title = updates.title;\n        if (finalContent) {\n            updateData.content = finalContent;\n            updateData.content_length = finalContentLength;\n        }\n        if (updates.metadata) updateData.metadata = updates.metadata;\n        const document = await this.documentDAO.update(object_id, updateData);\n        // 如果更新了内容，记录变更日志和快照\n        if (finalContent && finalContent.length > 0) {\n            try {\n                // 确定变更数据（用于变更日志）\n                // 优先使用 change_data（增量更新），如果没有则使用完整状态\n                const changeData = updates.change_data || finalContent;\n                // 2. 记录变更日志（每次保存都记录）\n                let snapshotId = null;\n                if (this.changeDAO) {\n                    // 检查是否已有快照\n                    const hasSnapshot = await this.documentDAO.getLatestSnapshot(document.object_id);\n                    // 如果是手动保存，使用策略判断是否创建快照及版本类型\n                    // 如果没有快照，强制创建大版本（初始快照）\n                    // 如果有快照，根据策略判断是否创建快照（避免频繁创建）\n                    if (updates.forceSnapshot && this.snapshotScheduler) {\n                        if (!hasSnapshot) {\n                            // 没有快照，强制创建大版本（初始快照）\n                            const snapshot = await this.snapshotScheduler.createSnapshotManually(document.object_id, document.workspace_id, finalContent, updates.snapshot, true // 强制创建大版本\n                            );\n                            snapshotId = snapshot.snapshot_id;\n                        } else {\n                            // 有快照，使用策略判断是否创建快照\n                            // 手动保存时，也使用 recordEdit 来判断（复用相同的策略）\n                            const snapshotResult = await this.snapshotScheduler.recordEdit(document.object_id, document.workspace_id, finalContent, updates.snapshot);\n                            // 如果 recordEdit 创建了快照，使用它；否则不创建快照\n                            if (snapshotResult) {\n                                snapshotId = snapshotResult.snapshot_id;\n                            }\n                        // 如果 recordEdit 没有创建快照（不满足条件），snapshotId 保持为 null\n                        }\n                    }\n                    await this.changeDAO.create({\n                        object_id: document.object_id,\n                        workspace_id: document.workspace_id,\n                        snapshot_id: snapshotId,\n                        change_type: updates.forceSnapshot ? \"manual_save\" : \"auto_save\",\n                        change_data: changeData,\n                        before_state_vector: updates.snapshot || null,\n                        after_state_vector: updates.snapshot || null,\n                        metadata: {\n                            content_length: finalContent?.length || 0,\n                            change_length: changeData.length,\n                            is_incremental: !!updates.change_data\n                        }\n                    });\n                }\n                // 3. 处理快照（自动保存时，由调度器决定是否创建快照及版本类型）\n                if (this.snapshotScheduler && !updates.forceSnapshot) {\n                    // 检查是否已有快照，如果没有，创建初始快照\n                    const hasSnapshot = await this.documentDAO.getLatestSnapshot(document.object_id);\n                    if (!hasSnapshot) {\n                        // 没有快照，创建初始快照（强制大版本）\n                        console.log(`[DocumentService] No snapshot found, creating initial snapshot for ${document.object_id}`);\n                        await this.snapshotScheduler.createSnapshotManually(document.object_id, document.workspace_id, finalContent, updates.snapshot, true // 强制创建大版本\n                        );\n                    } else {\n                        // 自动保存，由调度器决定是否创建快照\n                        await this.snapshotScheduler.recordEdit(document.object_id, document.workspace_id, finalContent, updates.snapshot);\n                    }\n                }\n            } catch (error) {\n                // 变更日志和快照创建失败不应该影响文档更新，只记录错误\n                console.error(\"Failed to create change log or snapshot:\", error);\n            }\n        }\n        // 清除缓存\n        await this.redis.del(`document:${object_id}`);\n        const doc = await this.documentDAO.findById(object_id);\n        if (doc) {\n            // 清除该工作空间的所有文档列表缓存（因为缓存键包含 options 参数）\n            await this.redis.delByPattern(`documents:workspace:${doc.workspace_id}:*`);\n        }\n        return document;\n    }\n    /**\n   * 获取文档列表\n   */ async getDocuments(workspace_id, options = {}) {\n        // 尝试从缓存获取\n        const cacheKey = `documents:workspace:${workspace_id}:${JSON.stringify(options)}`;\n        const cached = await this.redis.getJSON(cacheKey);\n        if (cached) {\n            return {\n                ...cached,\n                page: options.page || 1,\n                page_size: options.page_size || 20\n            };\n        }\n        const result = await this.documentDAO.findByWorkspaceId(workspace_id, options);\n        // 缓存结果\n        await this.redis.setJSON(cacheKey, result, 60); // 1分钟缓存\n        return {\n            ...result,\n            page: options.page || 1,\n            page_size: options.page_size || 20\n        };\n    }\n    /**\n   * 删除文档\n   */ async deleteDocument(object_id) {\n        // 先获取文档信息以便清除缓存\n        const doc = await this.documentDAO.findById(object_id);\n        await this.documentDAO.delete(object_id);\n        // 清除缓存\n        await this.redis.del(`document:${object_id}`);\n        if (doc) {\n            // 清除该工作空间的所有文档列表缓存（因为缓存键包含 options 参数）\n            await this.redis.delByPattern(`documents:workspace:${doc.workspace_id}:*`);\n        }\n    }\n    /**\n   * 创建文档快照\n   */ async createSnapshot(data) {\n        return await this.documentDAO.createSnapshot({\n            object_id: data.object_id,\n            workspace_id: data.workspace_id,\n            snapshot_data: data.snapshot_data,\n            snapshot_version: data.snapshot_version || 1,\n            doc_state: data.doc_state,\n            doc_state_version: data.doc_state_version || 1,\n            metadata: data.metadata\n        });\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(object_id, options = {}) {\n        return await this.documentDAO.getSnapshots(object_id, options);\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(object_id) {\n        return await this.documentDAO.getLatestSnapshot(object_id);\n    }\n    /**\n   * 根据 snapshot_id 获取快照内容\n   */ async getSnapshotById(snapshot_id) {\n        return await this.documentDAO.getSnapshotById(snapshot_id);\n    }\n    /**\n   * 搜索文档（简化版，实际应该使用向量搜索）\n   */ async searchDocuments(workspace_id, query, options = {}) {\n        // 这里简化实现，实际应该使用向量嵌入搜索\n        // 暂时使用简单的文本搜索\n        // TODO: 实现向量搜索\n        // 这里返回空数组，实际应该查询 document_embeddings 表\n        return [];\n    }\n    /**\n   * 计算两个文档状态之间的变更（简化版）\n   * 实际应该使用 Yjs 的 diff 算法\n   * 注意：当前实现中，change_data 存储的是完整的文档状态\n   * TODO: 优化为真正的增量更新\n   */ calculateChange(previousContent, currentContent) {\n        // 简化实现：直接返回当前内容\n        // TODO: 使用 Yjs 的 diff 算法计算真正的增量变更\n        // 或者，前端应该发送增量更新（Yjs update 事件），而不是完整状态\n        return currentContent;\n    }\n    /**\n   * 获取文档变更列表\n   */ async getDocumentChanges(object_id, options = {}) {\n        if (!this.changeDAO) {\n            throw new Error(\"DocumentChangeDAO not initialized\");\n        }\n        return await this.changeDAO.findByObjectId(object_id, options);\n    }\n    /**\n   * 获取两个快照之间的变更\n   */ async getChangesBetweenSnapshots(object_id, from_snapshot_id, to_snapshot_id) {\n        if (!this.changeDAO) {\n            throw new Error(\"DocumentChangeDAO not initialized\");\n        }\n        return await this.changeDAO.getChangesBetweenSnapshots(object_id, from_snapshot_id, to_snapshot_id);\n    }\n}\nDocumentService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(2, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"SnapshotScheduler\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(3, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentChangeDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO === \"undefined\" ? Object : _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO,\n        typeof _core_redis__WEBPACK_IMPORTED_MODULE_3__.Redis === \"undefined\" ? Object : _core_redis__WEBPACK_IMPORTED_MODULE_3__.Redis,\n        typeof _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__.SnapshotScheduler === \"undefined\" ? Object : _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__.SnapshotScheduler,\n        typeof _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__.DocumentChangeDAO === \"undefined\" ? Object : _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__.DocumentChangeDAO\n    ])\n], DocumentService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFNBQVMsRUFBRTtZQUNuQixNQUFNLElBQUl3QyxNQUFNO1FBQ2xCO1FBQ0EsT0FBTyxNQUFNLElBQUksQ0FBQ3hDLFNBQVMsQ0FBQ3VGLGNBQWMsQ0FBQ3hFLFdBQVdrRDtJQUN4RDtJQUVBOztHQUVDLEdBQ0QsTUFBTXVCLDJCQUNKekUsU0FBaUIsRUFDakIwRSxnQkFBd0IsRUFDeEJDLGNBQXNCLEVBQ0s7UUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQzFGLFNBQVMsRUFBRTtZQUNuQixNQUFNLElBQUl3QyxNQUFNO1FBQ2xCO1FBQ0EsT0FBTyxNQUFNLElBQUksQ0FBQ3hDLFNBQVMsQ0FBQ3dGLDBCQUEwQixDQUNwRHpFLFdBQ0EwRSxrQkFDQUM7SUFFSjtBQUNGO0FBamNhL0Ysa0JBQUFBLG9FQUFBQTtJQURaUCxvREFBVUE7SUFHTkMsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDO0lBRVBBLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQztJQUNQQSxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7OztlQUhvQywwREFBVyw0QkFBWCwwREFBVztlQUN4Qyw4Q0FBSyw0QkFBTCw4Q0FBSztlQUNxQywwRUFBaUIsNEJBQWpCLDBFQUFpQjtlQUN6Qix1RUFBaUIsNEJBQWpCLHVFQUFpQjs7R0FMekRNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL3NlcnZpY2VzL2RvY3VtZW50LnNlcnZpY2UudHM/Y2QxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgKiBhcyBZIGZyb20gJ3lqcyc7XG5pbXBvcnQgeyBEb2N1bWVudERBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LmRhbyc7XG5pbXBvcnQgeyBEb2N1bWVudENoYW5nZURBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LWNoYW5nZS5kYW8nO1xuaW1wb3J0IHR5cGUgeyBEb2N1bWVudCwgRG9jdW1lbnRTbmFwc2hvdCwgRG9jdW1lbnRDaGFuZ2UgfSBmcm9tICdAL2VudGl0aWVzJztcbmltcG9ydCB7IFJlZGlzIH0gZnJvbSAnQC9jb3JlL3JlZGlzJztcbmltcG9ydCB7IFNuYXBzaG90U2NoZWR1bGVyIH0gZnJvbSAnLi9zbmFwc2hvdC1zY2hlZHVsZXIuc2VydmljZSc7XG5cbi8qKlxuICog5paH5qGj5pyN5YqhXG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEb2N1bWVudFNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdEb2N1bWVudERBTycpIHByaXZhdGUgZG9jdW1lbnREQU86IERvY3VtZW50REFPLFxuICAgIHByaXZhdGUgcmVkaXM6IFJlZGlzLFxuICAgIEBpbmplY3QoJ1NuYXBzaG90U2NoZWR1bGVyJykgcHJpdmF0ZSBzbmFwc2hvdFNjaGVkdWxlcj86IFNuYXBzaG90U2NoZWR1bGVyLFxuICAgIEBpbmplY3QoJ0RvY3VtZW50Q2hhbmdlREFPJykgcHJpdmF0ZSBjaGFuZ2VEQU8/OiBEb2N1bWVudENoYW5nZURBT1xuICApIHtcbiAgICB0aGlzLnJlZGlzID0gUmVkaXMuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlofmoaNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZURvY3VtZW50KGRhdGE6IHtcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IEJ1ZmZlcjtcbiAgICBvd25lcl91aWQ6IG51bWJlcjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPERvY3VtZW50PiB7XG4gICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmNyZWF0ZSh7XG4gICAgICB3b3Jrc3BhY2VfaWQ6IGRhdGEud29ya3NwYWNlX2lkLFxuICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICBjb250ZW50X2xlbmd0aDogZGF0YS5jb250ZW50Lmxlbmd0aCxcbiAgICAgIG93bmVyX3VpZDogZGF0YS5vd25lcl91aWQsXG4gICAgICBtZXRhZGF0YTogZGF0YS5tZXRhZGF0YSxcbiAgICB9KTtcblxuICAgIC8vIOWIm+W7uuWIneWni+W/q+eFp++8iOaXoOiuuuaYr+WQpuacieWGheWuue+8jOmDveW6lOivpeWIm+W7uuWIneWni+W/q+eFp++8iVxuICAgIC8vIOi/meagt+WNs+S9v+aWh+aho+WIm+W7uuaXtuS4uuepuu+8jOS5n+iDveacieS4gOS4quWfuuWHhuW/q+eFp+eUqOS6juaXtumXtOmXtOmalOiuoeeul1xuICAgIGlmICh0aGlzLnNuYXBzaG90U2NoZWR1bGVyKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBgW0RvY3VtZW50U2VydmljZV0gQ3JlYXRpbmcgaW5pdGlhbCBzbmFwc2hvdCBmb3IgZG9jdW1lbnQgJHtcbiAgICAgICAgICAgIGRvY3VtZW50Lm9iamVjdF9pZFxuICAgICAgICAgIH0sIGNvbnRlbnRMZW5ndGg6ICR7ZGF0YS5jb250ZW50Py5sZW5ndGggfHwgMH1gXG4gICAgICAgICk7XG4gICAgICAgIC8vIOWIm+W7uuWIneWni+W/q+eFp++8iOW8uuWItuWIm+W7uuWkp+eJiOacrO+8iVxuICAgICAgICAvLyDljbPkvb8gY29udGVudCDkuLrnqbrvvIzkuZ/liJvlu7rkuIDkuKrnqbrlhoXlrrnnmoTlv6vnhadcbiAgICAgICAgY29uc3QgY29udGVudFRvU25hcHNob3QgPVxuICAgICAgICAgIGRhdGEuY29udGVudCAmJiBkYXRhLmNvbnRlbnQubGVuZ3RoID4gMCA/IGRhdGEuY29udGVudCA6IEJ1ZmZlci5hbGxvYygwKTsgLy8g56m65YaF5a655Lmf5Yib5bu65b+r54WnXG5cbiAgICAgICAgY29uc3Qgc25hcHNob3RSZXN1bHQgPSBhd2FpdCB0aGlzLnNuYXBzaG90U2NoZWR1bGVyLmNyZWF0ZVNuYXBzaG90TWFudWFsbHkoXG4gICAgICAgICAgZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgIGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgICBjb250ZW50VG9TbmFwc2hvdCxcbiAgICAgICAgICB1bmRlZmluZWQsIC8vIOWIneWni+W/q+eFp+WPr+iDveayoeaciSBzbmFwc2hvdFxuICAgICAgICAgIHRydWUgLy8g5by65Yi25Yib5bu65aSn54mI5pysXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbRG9jdW1lbnRTZXJ2aWNlXSBJbml0aWFsIHNuYXBzaG90IGNyZWF0ZWQ6YCwge1xuICAgICAgICAgIHNuYXBzaG90X2lkOiBzbmFwc2hvdFJlc3VsdC5zbmFwc2hvdF9pZCxcbiAgICAgICAgICB2ZXJzaW9uX3R5cGU6IHNuYXBzaG90UmVzdWx0LnZlcnNpb25fdHlwZSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiBzbmFwc2hvdFJlc3VsdC5jcmVhdGVkX2F0LFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIOW/q+eFp+WIm+W7uuWksei0peS4jeW6lOivpeW9seWTjeaWh+aho+WIm+W7uu+8jOWPquiusOW9lemUmeivr1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbRG9jdW1lbnRTZXJ2aWNlXSBGYWlsZWQgdG8gY3JlYXRlIGluaXRpYWwgc25hcHNob3Q6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBbRG9jdW1lbnRTZXJ2aWNlXSBTbmFwc2hvdFNjaGVkdWxlciBub3QgYXZhaWxhYmxlLCBjYW5ub3QgY3JlYXRlIGluaXRpYWwgc25hcHNob3RgXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIOa4hemZpOe8k+WtmFxuICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKGBkb2N1bWVudDoke2RvY3VtZW50Lm9iamVjdF9pZH1gKTtcbiAgICAvLyDmuIXpmaTor6Xlt6XkvZznqbrpl7TnmoTmiYDmnInmlofmoaPliJfooajnvJPlrZjvvIjlm6DkuLrnvJPlrZjplK7ljIXlkKsgb3B0aW9ucyDlj4LmlbDvvIlcbiAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbEJ5UGF0dGVybihgZG9jdW1lbnRzOndvcmtzcGFjZToke2RhdGEud29ya3NwYWNlX2lkfToqYCk7XG5cbiAgICByZXR1cm4gZG9jdW1lbnQ7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGjXG4gICAqL1xuICBhc3luYyBnZXREb2N1bWVudChvYmplY3RfaWQ6IHN0cmluZywgaW5jbHVkZUNvbnRlbnQ6IGJvb2xlYW4gPSB0cnVlKTogUHJvbWlzZTxEb2N1bWVudCB8IG51bGw+IHtcbiAgICAvLyDlsJ3or5Xku47nvJPlrZjojrflj5ZcbiAgICBjb25zdCBjYWNoZUtleSA9IGBkb2N1bWVudDoke29iamVjdF9pZH1gO1xuICAgIGNvbnN0IGNhY2hlZCA9IGF3YWl0IHRoaXMucmVkaXMuZ2V0SlNPTjxEb2N1bWVudD4oY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIHJldHVybiBjYWNoZWQ7XG4gICAgfVxuXG4gICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmZpbmRCeUlkKG9iamVjdF9pZCk7XG4gICAgaWYgKCFkb2N1bWVudCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8g57yT5a2Y5paH5qGj77yI5LiN5YyF5ZCrIGNvbnRlbnTvvIzlh4/lsJHlhoXlrZjljaDnlKjvvIlcbiAgICBpZiAoIWluY2x1ZGVDb250ZW50KSB7XG4gICAgICBjb25zdCB7IGNvbnRlbnQsIC4uLmRvY1dpdGhvdXRDb250ZW50IH0gPSBkb2N1bWVudDtcbiAgICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0SlNPTihjYWNoZUtleSwgZG9jV2l0aG91dENvbnRlbnQsIDMwMCk7IC8vIDXliIbpkp/nvJPlrZhcbiAgICB9XG5cbiAgICByZXR1cm4gZG9jdW1lbnQ7XG4gIH1cblxuICAvKipcbiAgICog5pu05paw5paH5qGjXG4gICAqXG4gICAqIOS8mOWMluetlueVpe+8mlxuICAgKiAtIOWmguaenOWPquaciSBjaGFuZ2VfZGF0Ye+8iOWinumHj++8ie+8jOW6lOeUqOWinumHj+WIsOeOsOacieaWh+aho+eKtuaAge+8jOeEtuWQjuabtOaWsOaVsOaNruW6k1xuICAgKiAtIOWmguaenOaciSBjb250ZW5077yI5YWo6YeP77yJ77yM55u05o6l5L2/55So5YWo6YeP5pu05paw5pWw5o2u5bqTXG4gICAqL1xuICBhc3luYyB1cGRhdGVEb2N1bWVudChcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICB0aXRsZT86IHN0cmluZztcbiAgICAgIGNvbnRlbnQ/OiBCdWZmZXI7XG4gICAgICBjaGFuZ2VfZGF0YT86IEJ1ZmZlcjsgLy8g5aKe6YeP5pu05paw77yIWWpzIFVwZGF0Ze+8iVxuICAgICAgc25hcHNob3Q/OiBCdWZmZXI7IC8vIFlqcyBTbmFwc2hvdO+8iOeKtuaAgeWQkemHj++8ie+8jOWPr+mAiVxuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgICAgZm9yY2VTbmFwc2hvdD86IGJvb2xlYW47IC8vIOaYr+WQpuW8uuWItuWIm+W7uuW/q+eFp++8iOaJi+WKqOS/neWtmO+8iVxuICAgIH1cbiAgKTogUHJvbWlzZTxEb2N1bWVudD4ge1xuICAgIC8vIOWmguaenOabtOaWsOS6huWGheWuue+8jOWFiOiOt+WPluW9k+WJjeaWh+aho+S/oeaBr+S7peS+v+WIm+W7uuW/q+eFp1xuICAgIGNvbnN0IGN1cnJlbnREb2MgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmZpbmRCeUlkKG9iamVjdF9pZCk7XG4gICAgaWYgKCFjdXJyZW50RG9jKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RvY3VtZW50IG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIOS8mOWMlu+8muWmguaenOWPquacieWinumHj+abtOaWsO+8jOW6lOeUqOWinumHj+WIsOeOsOacieaWh+aho+eKtuaAgVxuICAgIGxldCBmaW5hbENvbnRlbnQ6IEJ1ZmZlciB8IHVuZGVmaW5lZDtcbiAgICBsZXQgZmluYWxDb250ZW50TGVuZ3RoOiBudW1iZXIgfCB1bmRlZmluZWQ7XG5cbiAgICBpZiAodXBkYXRlcy5jaGFuZ2VfZGF0YSAmJiAhdXBkYXRlcy5jb250ZW50KSB7XG4gICAgICAvLyDlj6rmnInlop7ph4/mm7TmlrDvvJrlupTnlKjlop7ph4/liLDnjrDmnInmlofmoaPnirbmgIFcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBgW0RvY3VtZW50U2VydmljZV0gQXBwbHlpbmcgaW5jcmVtZW50YWwgdXBkYXRlLCBzaXplOiAke3VwZGF0ZXMuY2hhbmdlX2RhdGEubGVuZ3RofSBieXRlc2BcbiAgICAgICk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIOWIm+W7uuS4tOaXtiBZLkRvYyDlubblupTnlKjnjrDmnInnirbmgIFcbiAgICAgICAgY29uc3QgeWRvYyA9IG5ldyBZLkRvYygpO1xuICAgICAgICBpZiAoY3VycmVudERvYy5jb250ZW50ICYmIGN1cnJlbnREb2MuY29udGVudC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgWS5hcHBseVVwZGF0ZSh5ZG9jLCBjdXJyZW50RG9jLmNvbnRlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5bqU55So5aKe6YeP5pu05pawXG4gICAgICAgIFkuYXBwbHlVcGRhdGUoeWRvYywgdXBkYXRlcy5jaGFuZ2VfZGF0YSk7XG5cbiAgICAgICAgLy8g6I635Y+W5paw55qE5a6M5pW054q25oCBXG4gICAgICAgIGZpbmFsQ29udGVudCA9IEJ1ZmZlci5mcm9tKFkuZW5jb2RlU3RhdGVBc1VwZGF0ZSh5ZG9jKSk7XG4gICAgICAgIGZpbmFsQ29udGVudExlbmd0aCA9IGZpbmFsQ29udGVudC5sZW5ndGg7XG5cbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYFtEb2N1bWVudFNlcnZpY2VdIEluY3JlbWVudGFsIHVwZGF0ZSBhcHBsaWVkLCBuZXcgY29udGVudCBzaXplOiAke2ZpbmFsQ29udGVudExlbmd0aH0gYnl0ZXNgXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbRG9jdW1lbnRTZXJ2aWNlXSBGYWlsZWQgdG8gYXBwbHkgaW5jcmVtZW50YWwgdXBkYXRlOicsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gYXBwbHkgaW5jcmVtZW50YWwgdXBkYXRlJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh1cGRhdGVzLmNvbnRlbnQpIHtcbiAgICAgIC8vIOacieWFqOmHj+abtOaWsO+8muebtOaOpeS9v+eUqFxuICAgICAgZmluYWxDb250ZW50ID0gdXBkYXRlcy5jb250ZW50O1xuICAgICAgZmluYWxDb250ZW50TGVuZ3RoID0gdXBkYXRlcy5jb250ZW50Lmxlbmd0aDtcbiAgICAgIGNvbnNvbGUubG9nKGBbRG9jdW1lbnRTZXJ2aWNlXSBVc2luZyBmdWxsIHVwZGF0ZSwgc2l6ZTogJHtmaW5hbENvbnRlbnRMZW5ndGh9IGJ5dGVzYCk7XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge307XG4gICAgaWYgKHVwZGF0ZXMudGl0bGUpIHVwZGF0ZURhdGEudGl0bGUgPSB1cGRhdGVzLnRpdGxlO1xuICAgIGlmIChmaW5hbENvbnRlbnQpIHtcbiAgICAgIHVwZGF0ZURhdGEuY29udGVudCA9IGZpbmFsQ29udGVudDtcbiAgICAgIHVwZGF0ZURhdGEuY29udGVudF9sZW5ndGggPSBmaW5hbENvbnRlbnRMZW5ndGghO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5tZXRhZGF0YSkgdXBkYXRlRGF0YS5tZXRhZGF0YSA9IHVwZGF0ZXMubWV0YWRhdGE7XG5cbiAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8udXBkYXRlKG9iamVjdF9pZCwgdXBkYXRlRGF0YSk7XG5cbiAgICAvLyDlpoLmnpzmm7TmlrDkuoblhoXlrrnvvIzorrDlvZXlj5jmm7Tml6Xlv5flkozlv6vnhadcbiAgICBpZiAoZmluYWxDb250ZW50ICYmIGZpbmFsQ29udGVudC5sZW5ndGggPiAwKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyDnoa7lrprlj5jmm7TmlbDmja7vvIjnlKjkuo7lj5jmm7Tml6Xlv5fvvIlcbiAgICAgICAgLy8g5LyY5YWI5L2/55SoIGNoYW5nZV9kYXRh77yI5aKe6YeP5pu05paw77yJ77yM5aaC5p6c5rKh5pyJ5YiZ5L2/55So5a6M5pW054q25oCBXG4gICAgICAgIGNvbnN0IGNoYW5nZURhdGEgPSB1cGRhdGVzLmNoYW5nZV9kYXRhIHx8IGZpbmFsQ29udGVudCE7XG5cbiAgICAgICAgLy8gMi4g6K6w5b2V5Y+Y5pu05pel5b+X77yI5q+P5qyh5L+d5a2Y6YO96K6w5b2V77yJXG4gICAgICAgIGxldCBzbmFwc2hvdElkOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuY2hhbmdlREFPKSB7XG4gICAgICAgICAgLy8g5qOA5p+l5piv5ZCm5bey5pyJ5b+r54WnXG4gICAgICAgICAgY29uc3QgaGFzU25hcHNob3QgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmdldExhdGVzdFNuYXBzaG90KGRvY3VtZW50Lm9iamVjdF9pZCk7XG5cbiAgICAgICAgICAvLyDlpoLmnpzmmK/miYvliqjkv53lrZjvvIzkvb/nlKjnrZbnlaXliKTmlq3mmK/lkKbliJvlu7rlv6vnhaflj4rniYjmnKznsbvlnotcbiAgICAgICAgICAvLyDlpoLmnpzmsqHmnInlv6vnhafvvIzlvLrliLbliJvlu7rlpKfniYjmnKzvvIjliJ3lp4vlv6vnhafvvIlcbiAgICAgICAgICAvLyDlpoLmnpzmnInlv6vnhafvvIzmoLnmja7nrZbnlaXliKTmlq3mmK/lkKbliJvlu7rlv6vnhafvvIjpgb/lhY3popHnuYHliJvlu7rvvIlcbiAgICAgICAgICBpZiAodXBkYXRlcy5mb3JjZVNuYXBzaG90ICYmIHRoaXMuc25hcHNob3RTY2hlZHVsZXIpIHtcbiAgICAgICAgICAgIGlmICghaGFzU25hcHNob3QpIHtcbiAgICAgICAgICAgICAgLy8g5rKh5pyJ5b+r54Wn77yM5by65Yi25Yib5bu65aSn54mI5pys77yI5Yid5aeL5b+r54Wn77yJXG4gICAgICAgICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgdGhpcy5zbmFwc2hvdFNjaGVkdWxlci5jcmVhdGVTbmFwc2hvdE1hbnVhbGx5KFxuICAgICAgICAgICAgICAgIGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICAgICAgICBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICAgICAgZmluYWxDb250ZW50ISxcbiAgICAgICAgICAgICAgICB1cGRhdGVzLnNuYXBzaG90LFxuICAgICAgICAgICAgICAgIHRydWUgLy8g5by65Yi25Yib5bu65aSn54mI5pysXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHNuYXBzaG90SWQgPSBzbmFwc2hvdC5zbmFwc2hvdF9pZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIOacieW/q+eFp++8jOS9v+eUqOetlueVpeWIpOaWreaYr+WQpuWIm+W7uuW/q+eFp1xuICAgICAgICAgICAgICAvLyDmiYvliqjkv53lrZjml7bvvIzkuZ/kvb/nlKggcmVjb3JkRWRpdCDmnaXliKTmlq3vvIjlpI3nlKjnm7jlkIznmoTnrZbnlaXvvIlcbiAgICAgICAgICAgICAgY29uc3Qgc25hcHNob3RSZXN1bHQgPSBhd2FpdCB0aGlzLnNuYXBzaG90U2NoZWR1bGVyLnJlY29yZEVkaXQoXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgICAgICAgICBmaW5hbENvbnRlbnQhLFxuICAgICAgICAgICAgICAgIHVwZGF0ZXMuc25hcHNob3RcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgLy8g5aaC5p6cIHJlY29yZEVkaXQg5Yib5bu65LqG5b+r54Wn77yM5L2/55So5a6D77yb5ZCm5YiZ5LiN5Yib5bu65b+r54WnXG4gICAgICAgICAgICAgIGlmIChzbmFwc2hvdFJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHNuYXBzaG90SWQgPSBzbmFwc2hvdFJlc3VsdC5zbmFwc2hvdF9pZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvLyDlpoLmnpwgcmVjb3JkRWRpdCDmsqHmnInliJvlu7rlv6vnhafvvIjkuI3mu6HotrPmnaHku7bvvInvvIxzbmFwc2hvdElkIOS/neaMgeS4uiBudWxsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgYXdhaXQgdGhpcy5jaGFuZ2VEQU8uY3JlYXRlKHtcbiAgICAgICAgICAgIG9iamVjdF9pZDogZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgICAgd29ya3NwYWNlX2lkOiBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICBzbmFwc2hvdF9pZDogc25hcHNob3RJZCxcbiAgICAgICAgICAgIGNoYW5nZV90eXBlOiB1cGRhdGVzLmZvcmNlU25hcHNob3QgPyAnbWFudWFsX3NhdmUnIDogJ2F1dG9fc2F2ZScsXG4gICAgICAgICAgICBjaGFuZ2VfZGF0YTogY2hhbmdlRGF0YSxcbiAgICAgICAgICAgIGJlZm9yZV9zdGF0ZV92ZWN0b3I6IHVwZGF0ZXMuc25hcHNob3QgfHwgbnVsbCxcbiAgICAgICAgICAgIGFmdGVyX3N0YXRlX3ZlY3RvcjogdXBkYXRlcy5zbmFwc2hvdCB8fCBudWxsLFxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgY29udGVudF9sZW5ndGg6IGZpbmFsQ29udGVudD8ubGVuZ3RoIHx8IDAsXG4gICAgICAgICAgICAgIGNoYW5nZV9sZW5ndGg6IGNoYW5nZURhdGEubGVuZ3RoLFxuICAgICAgICAgICAgICBpc19pbmNyZW1lbnRhbDogISF1cGRhdGVzLmNoYW5nZV9kYXRhLCAvLyDmoIforrDmmK/lkKbkuLrlop7ph4/mm7TmlrBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAzLiDlpITnkIblv6vnhafvvIjoh6rliqjkv53lrZjml7bvvIznlLHosIPluqblmajlhrPlrprmmK/lkKbliJvlu7rlv6vnhaflj4rniYjmnKznsbvlnovvvIlcbiAgICAgICAgaWYgKHRoaXMuc25hcHNob3RTY2hlZHVsZXIgJiYgIXVwZGF0ZXMuZm9yY2VTbmFwc2hvdCkge1xuICAgICAgICAgIC8vIOajgOafpeaYr+WQpuW3suacieW/q+eFp++8jOWmguaenOayoeacie+8jOWIm+W7uuWIneWni+W/q+eFp1xuICAgICAgICAgIGNvbnN0IGhhc1NuYXBzaG90ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5nZXRMYXRlc3RTbmFwc2hvdChkb2N1bWVudC5vYmplY3RfaWQpO1xuICAgICAgICAgIGlmICghaGFzU25hcHNob3QpIHtcbiAgICAgICAgICAgIC8vIOayoeacieW/q+eFp++8jOWIm+W7uuWIneWni+W/q+eFp++8iOW8uuWItuWkp+eJiOacrO+8iVxuICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgIGBbRG9jdW1lbnRTZXJ2aWNlXSBObyBzbmFwc2hvdCBmb3VuZCwgY3JlYXRpbmcgaW5pdGlhbCBzbmFwc2hvdCBmb3IgJHtkb2N1bWVudC5vYmplY3RfaWR9YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc25hcHNob3RTY2hlZHVsZXIuY3JlYXRlU25hcHNob3RNYW51YWxseShcbiAgICAgICAgICAgICAgZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgICAgICBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICAgIGZpbmFsQ29udGVudCEsXG4gICAgICAgICAgICAgIHVwZGF0ZXMuc25hcHNob3QsXG4gICAgICAgICAgICAgIHRydWUgLy8g5by65Yi25Yib5bu65aSn54mI5pysXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyDoh6rliqjkv53lrZjvvIznlLHosIPluqblmajlhrPlrprmmK/lkKbliJvlu7rlv6vnhadcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc25hcHNob3RTY2hlZHVsZXIucmVjb3JkRWRpdChcbiAgICAgICAgICAgICAgZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgICAgICBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICAgIGZpbmFsQ29udGVudCEsXG4gICAgICAgICAgICAgIHVwZGF0ZXMuc25hcHNob3RcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyDlj5jmm7Tml6Xlv5flkozlv6vnhafliJvlu7rlpLHotKXkuI3lupTor6XlvbHlk43mlofmoaPmm7TmlrDvvIzlj6rorrDlvZXplJnor69cbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBjaGFuZ2UgbG9nIG9yIHNuYXBzaG90OicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmuIXpmaTnvJPlrZhcbiAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChgZG9jdW1lbnQ6JHtvYmplY3RfaWR9YCk7XG4gICAgY29uc3QgZG9jID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlJZChvYmplY3RfaWQpO1xuICAgIGlmIChkb2MpIHtcbiAgICAgIC8vIOa4hemZpOivpeW3peS9nOepuumXtOeahOaJgOacieaWh+aho+WIl+ihqOe8k+WtmO+8iOWboOS4uue8k+WtmOmUruWMheWQqyBvcHRpb25zIOWPguaVsO+8iVxuICAgICAgYXdhaXQgdGhpcy5yZWRpcy5kZWxCeVBhdHRlcm4oYGRvY3VtZW50czp3b3Jrc3BhY2U6JHtkb2Mud29ya3NwYWNlX2lkfToqYCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRvY3VtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0RG9jdW1lbnRzKFxuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgICBwYWdlX3NpemU/OiBudW1iZXI7XG4gICAgICBzb3J0X2J5PzogJ2NyZWF0ZWRfYXQnIHwgJ3VwZGF0ZWRfYXQnIHwgJ3RpdGxlJztcbiAgICAgIG9yZGVyPzogJ2FzYycgfCAnZGVzYyc7XG4gICAgfSA9IHt9XG4gICk6IFByb21pc2U8eyBkb2N1bWVudHM6IERvY3VtZW50W107IHRvdGFsOiBudW1iZXI7IHBhZ2U6IG51bWJlcjsgcGFnZV9zaXplOiBudW1iZXIgfT4ge1xuICAgIC8vIOWwneivleS7jue8k+WtmOiOt+WPllxuICAgIGNvbnN0IGNhY2hlS2V5ID0gYGRvY3VtZW50czp3b3Jrc3BhY2U6JHt3b3Jrc3BhY2VfaWR9OiR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucyl9YDtcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCB0aGlzLnJlZGlzLmdldEpTT048e1xuICAgICAgZG9jdW1lbnRzOiBEb2N1bWVudFtdO1xuICAgICAgdG90YWw6IG51bWJlcjtcbiAgICB9PihjYWNoZUtleSk7XG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uY2FjaGVkLFxuICAgICAgICBwYWdlOiBvcHRpb25zLnBhZ2UgfHwgMSxcbiAgICAgICAgcGFnZV9zaXplOiBvcHRpb25zLnBhZ2Vfc2l6ZSB8fCAyMCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlXb3Jrc3BhY2VJZCh3b3Jrc3BhY2VfaWQsIG9wdGlvbnMpO1xuXG4gICAgLy8g57yT5a2Y57uT5p6cXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5zZXRKU09OKGNhY2hlS2V5LCByZXN1bHQsIDYwKTsgLy8gMeWIhumSn+e8k+WtmFxuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnJlc3VsdCxcbiAgICAgIHBhZ2U6IG9wdGlvbnMucGFnZSB8fCAxLFxuICAgICAgcGFnZV9zaXplOiBvcHRpb25zLnBhZ2Vfc2l6ZSB8fCAyMCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOaWh+aho1xuICAgKi9cbiAgYXN5bmMgZGVsZXRlRG9jdW1lbnQob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyDlhYjojrflj5bmlofmoaPkv6Hmga/ku6Xkvr/muIXpmaTnvJPlrZhcbiAgICBjb25zdCBkb2MgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmZpbmRCeUlkKG9iamVjdF9pZCk7XG5cbiAgICBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmRlbGV0ZShvYmplY3RfaWQpO1xuXG4gICAgLy8g5riF6Zmk57yT5a2YXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5kZWwoYGRvY3VtZW50OiR7b2JqZWN0X2lkfWApO1xuICAgIGlmIChkb2MpIHtcbiAgICAgIC8vIOa4hemZpOivpeW3peS9nOepuumXtOeahOaJgOacieaWh+aho+WIl+ihqOe8k+WtmO+8iOWboOS4uue8k+WtmOmUruWMheWQqyBvcHRpb25zIOWPguaVsO+8iVxuICAgICAgYXdhaXQgdGhpcy5yZWRpcy5kZWxCeVBhdHRlcm4oYGRvY3VtZW50czp3b3Jrc3BhY2U6JHtkb2Mud29ya3NwYWNlX2lkfToqYCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuaWh+aho+W/q+eFp1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlU25hcHNob3QoZGF0YToge1xuICAgIG9iamVjdF9pZDogc3RyaW5nO1xuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nO1xuICAgIHNuYXBzaG90X2RhdGE6IEJ1ZmZlcjtcbiAgICBzbmFwc2hvdF92ZXJzaW9uPzogbnVtYmVyO1xuICAgIGRvY19zdGF0ZT86IEJ1ZmZlcjtcbiAgICBkb2Nfc3RhdGVfdmVyc2lvbj86IG51bWJlcjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPERvY3VtZW50U25hcHNob3Q+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5jcmVhdGVTbmFwc2hvdCh7XG4gICAgICBvYmplY3RfaWQ6IGRhdGEub2JqZWN0X2lkLFxuICAgICAgd29ya3NwYWNlX2lkOiBkYXRhLndvcmtzcGFjZV9pZCxcbiAgICAgIHNuYXBzaG90X2RhdGE6IGRhdGEuc25hcHNob3RfZGF0YSxcbiAgICAgIHNuYXBzaG90X3ZlcnNpb246IGRhdGEuc25hcHNob3RfdmVyc2lvbiB8fCAxLFxuICAgICAgZG9jX3N0YXRlOiBkYXRhLmRvY19zdGF0ZSxcbiAgICAgIGRvY19zdGF0ZV92ZXJzaW9uOiBkYXRhLmRvY19zdGF0ZV92ZXJzaW9uIHx8IDEsXG4gICAgICBtZXRhZGF0YTogZGF0YS5tZXRhZGF0YSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPlv6vnhafliJfooahcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90cyhcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSA9IHt9XG4gICk6IFByb21pc2U8eyBzbmFwc2hvdHM6IERvY3VtZW50U25hcHNob3RbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZ2V0U25hcHNob3RzKG9iamVjdF9pZCwgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5pyA5paw5b+r54WnXG4gICAqL1xuICBhc3luYyBnZXRMYXRlc3RTbmFwc2hvdChvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8RG9jdW1lbnRTbmFwc2hvdCB8IG51bGw+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5nZXRMYXRlc3RTbmFwc2hvdChvYmplY3RfaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBzbmFwc2hvdF9pZCDojrflj5blv6vnhaflhoXlrrlcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90QnlJZChzbmFwc2hvdF9pZDogc3RyaW5nKTogUHJvbWlzZTxEb2N1bWVudFNuYXBzaG90IHwgbnVsbD4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmdldFNuYXBzaG90QnlJZChzbmFwc2hvdF9pZCk7XG4gIH1cblxuICAvKipcbiAgICog5pCc57Si5paH5qGj77yI566A5YyW54mI77yM5a6e6ZmF5bqU6K+l5L2/55So5ZCR6YeP5pCc57Si77yJXG4gICAqL1xuICBhc3luYyBzZWFyY2hEb2N1bWVudHMoXG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmcsXG4gICAgcXVlcnk6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7XG4gICAgICBsaW1pdD86IG51bWJlcjtcbiAgICAgIG9mZnNldD86IG51bWJlcjtcbiAgICAgIHRocmVzaG9sZD86IG51bWJlcjtcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTxcbiAgICBBcnJheTx7XG4gICAgICBvYmplY3RfaWQ6IHN0cmluZztcbiAgICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgICBwcmV2aWV3OiBzdHJpbmc7XG4gICAgICBzY29yZTogbnVtYmVyO1xuICAgICAgdXBkYXRlZF9hdDogRGF0ZTtcbiAgICB9PlxuICA+IHtcbiAgICAvLyDov5nph4znroDljJblrp7njrDvvIzlrp7pmYXlupTor6Xkvb/nlKjlkJHph4/ltYzlhaXmkJzntKJcbiAgICAvLyDmmoLml7bkvb/nlKjnroDljZXnmoTmlofmnKzmkJzntKJcbiAgICAvLyBUT0RPOiDlrp7njrDlkJHph4/mkJzntKJcbiAgICAvLyDov5nph4zov5Tlm57nqbrmlbDnu4TvvIzlrp7pmYXlupTor6Xmn6Xor6IgZG9jdW1lbnRfZW1iZWRkaW5ncyDooahcbiAgICByZXR1cm4gW107XG4gIH1cblxuICAvKipcbiAgICog6K6h566X5Lik5Liq5paH5qGj54q25oCB5LmL6Ze055qE5Y+Y5pu077yI566A5YyW54mI77yJXG4gICAqIOWunumZheW6lOivpeS9v+eUqCBZanMg55qEIGRpZmYg566X5rOVXG4gICAqIOazqOaEj++8muW9k+WJjeWunueOsOS4re+8jGNoYW5nZV9kYXRhIOWtmOWCqOeahOaYr+WujOaVtOeahOaWh+aho+eKtuaAgVxuICAgKiBUT0RPOiDkvJjljJbkuLrnnJ/mraPnmoTlop7ph4/mm7TmlrBcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlQ2hhbmdlKHByZXZpb3VzQ29udGVudDogQnVmZmVyLCBjdXJyZW50Q29udGVudDogQnVmZmVyKTogQnVmZmVyIHtcbiAgICAvLyDnroDljJblrp7njrDvvJrnm7TmjqXov5Tlm57lvZPliY3lhoXlrrlcbiAgICAvLyBUT0RPOiDkvb/nlKggWWpzIOeahCBkaWZmIOeul+azleiuoeeul+ecn+ato+eahOWinumHj+WPmOabtFxuICAgIC8vIOaIluiAhe+8jOWJjeerr+W6lOivpeWPkemAgeWinumHj+abtOaWsO+8iFlqcyB1cGRhdGUg5LqL5Lu277yJ77yM6ICM5LiN5piv5a6M5pW054q25oCBXG4gICAgcmV0dXJuIGN1cnJlbnRDb250ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho+WPmOabtOWIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0RG9jdW1lbnRDaGFuZ2VzKFxuICAgIG9iamVjdF9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIGxpbWl0PzogbnVtYmVyO1xuICAgICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgICAgYWZ0ZXJfc25hcHNob3RfaWQ/OiBzdHJpbmcgfCBudWxsO1xuICAgIH0gPSB7fVxuICApOiBQcm9taXNlPHsgY2hhbmdlczogRG9jdW1lbnRDaGFuZ2VbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgaWYgKCF0aGlzLmNoYW5nZURBTykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb2N1bWVudENoYW5nZURBTyBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2hhbmdlREFPLmZpbmRCeU9iamVjdElkKG9iamVjdF9pZCwgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5Lik5Liq5b+r54Wn5LmL6Ze055qE5Y+Y5pu0XG4gICAqL1xuICBhc3luYyBnZXRDaGFuZ2VzQmV0d2VlblNuYXBzaG90cyhcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICBmcm9tX3NuYXBzaG90X2lkOiBzdHJpbmcsXG4gICAgdG9fc25hcHNob3RfaWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPERvY3VtZW50Q2hhbmdlW10+IHtcbiAgICBpZiAoIXRoaXMuY2hhbmdlREFPKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RvY3VtZW50Q2hhbmdlREFPIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jaGFuZ2VEQU8uZ2V0Q2hhbmdlc0JldHdlZW5TbmFwc2hvdHMoXG4gICAgICBvYmplY3RfaWQsXG4gICAgICBmcm9tX3NuYXBzaG90X2lkLFxuICAgICAgdG9fc25hcHNob3RfaWRcbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiaW5qZWN0YWJsZSIsImluamVjdCIsIlkiLCJEb2N1bWVudERBTyIsIkRvY3VtZW50Q2hhbmdlREFPIiwiUmVkaXMiLCJTbmFwc2hvdFNjaGVkdWxlciIsIkRvY3VtZW50U2VydmljZSIsImNvbnN0cnVjdG9yIiwiZG9jdW1lbnREQU8iLCJyZWRpcyIsInNuYXBzaG90U2NoZWR1bGVyIiwiY2hhbmdlREFPIiwiZ2V0SW5zdGFuY2UiLCJjcmVhdGVEb2N1bWVudCIsImRhdGEiLCJkb2N1bWVudCIsImNyZWF0ZSIsIndvcmtzcGFjZV9pZCIsInRpdGxlIiwiY29udGVudCIsImNvbnRlbnRfbGVuZ3RoIiwibGVuZ3RoIiwib3duZXJfdWlkIiwibWV0YWRhdGEiLCJjb25zb2xlIiwibG9nIiwib2JqZWN0X2lkIiwiY29udGVudFRvU25hcHNob3QiLCJCdWZmZXIiLCJhbGxvYyIsInNuYXBzaG90UmVzdWx0IiwiY3JlYXRlU25hcHNob3RNYW51YWxseSIsInVuZGVmaW5lZCIsInNuYXBzaG90X2lkIiwidmVyc2lvbl90eXBlIiwiY3JlYXRlZF9hdCIsImVycm9yIiwid2FybiIsImRlbCIsImRlbEJ5UGF0dGVybiIsImdldERvY3VtZW50IiwiaW5jbHVkZUNvbnRlbnQiLCJjYWNoZUtleSIsImNhY2hlZCIsImdldEpTT04iLCJmaW5kQnlJZCIsImRvY1dpdGhvdXRDb250ZW50Iiwic2V0SlNPTiIsInVwZGF0ZURvY3VtZW50IiwidXBkYXRlcyIsImN1cnJlbnREb2MiLCJFcnJvciIsImZpbmFsQ29udGVudCIsImZpbmFsQ29udGVudExlbmd0aCIsImNoYW5nZV9kYXRhIiwieWRvYyIsIkRvYyIsImFwcGx5VXBkYXRlIiwiZnJvbSIsImVuY29kZVN0YXRlQXNVcGRhdGUiLCJ1cGRhdGVEYXRhIiwidXBkYXRlIiwiY2hhbmdlRGF0YSIsInNuYXBzaG90SWQiLCJoYXNTbmFwc2hvdCIsImdldExhdGVzdFNuYXBzaG90IiwiZm9yY2VTbmFwc2hvdCIsInNuYXBzaG90IiwicmVjb3JkRWRpdCIsImNoYW5nZV90eXBlIiwiYmVmb3JlX3N0YXRlX3ZlY3RvciIsImFmdGVyX3N0YXRlX3ZlY3RvciIsImNoYW5nZV9sZW5ndGgiLCJpc19pbmNyZW1lbnRhbCIsImRvYyIsImdldERvY3VtZW50cyIsIm9wdGlvbnMiLCJKU09OIiwic3RyaW5naWZ5IiwicGFnZSIsInBhZ2Vfc2l6ZSIsInJlc3VsdCIsImZpbmRCeVdvcmtzcGFjZUlkIiwiZGVsZXRlRG9jdW1lbnQiLCJkZWxldGUiLCJjcmVhdGVTbmFwc2hvdCIsInNuYXBzaG90X2RhdGEiLCJzbmFwc2hvdF92ZXJzaW9uIiwiZG9jX3N0YXRlIiwiZG9jX3N0YXRlX3ZlcnNpb24iLCJnZXRTbmFwc2hvdHMiLCJnZXRTbmFwc2hvdEJ5SWQiLCJzZWFyY2hEb2N1bWVudHMiLCJxdWVyeSIsImNhbGN1bGF0ZUNoYW5nZSIsInByZXZpb3VzQ29udGVudCIsImN1cnJlbnRDb250ZW50IiwiZ2V0RG9jdW1lbnRDaGFuZ2VzIiwiZmluZEJ5T2JqZWN0SWQiLCJnZXRDaGFuZ2VzQmV0d2VlblNuYXBzaG90cyIsImZyb21fc25hcHNob3RfaWQiLCJ0b19zbmFwc2hvdF9pZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/document.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/experience.service.ts":
/*!********************************************!*\
  !*** ./src/services/experience.service.ts ***!
  \********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ExperienceService: () => (/* binding */ ExperienceService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/user-ability-level.dao */ \"(rsc)/./src/dao/user-ability-level.dao.ts\");\n/* harmony import */ var _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/user-ability-experience-log.dao */ \"(rsc)/./src/dao/user-ability-experience-log.dao.ts\");\n/* harmony import */ var _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/ability-item-level-config.dao */ \"(rsc)/./src/dao/ability-item-level-config.dao.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__]);\n([_dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\nclass ExperienceService {\n    constructor(userLevelDAO, experienceLogDAO, levelConfigDAO){\n        this.userLevelDAO = userLevelDAO;\n        this.experienceLogDAO = experienceLogDAO;\n        this.levelConfigDAO = levelConfigDAO;\n    }\n    /**\n   * 增加经验值\n   */ async addExperience(uid, itemId, expAmount, options) {\n        // 获取当前用户能力等级\n        let userLevel = await this.userLevelDAO.findByUserAndItem(uid, itemId);\n        const beforeLevel = userLevel ? Number(userLevel.current_level) : 1;\n        const beforeExp = userLevel ? Number(userLevel.current_exp) : 0;\n        // 增加经验值\n        if (!userLevel) {\n            userLevel = await this.userLevelDAO.create({\n                uid,\n                item_id: itemId,\n                current_level: 1,\n                current_exp: expAmount,\n                total_exp: expAmount\n            });\n        } else {\n            // 确保数字字段是数字类型（防止字符串拼接）\n            const currentExp = Number(userLevel.current_exp);\n            const totalExp = Number(userLevel.total_exp);\n            const updates = {\n                current_exp: currentExp + expAmount\n            };\n            // 只有当 expAmount > 0 时才增加 total_exp（完成考试时 expAmount 为 0）\n            if (expAmount > 0) {\n                updates.total_exp = totalExp + expAmount;\n            }\n            userLevel = await this.userLevelDAO.update(uid, itemId, updates);\n        }\n        // 确保数字字段是数字类型\n        let afterExp = Number(userLevel.current_exp); // 使用 let，因为升级后需要更新为 0\n        let afterLevel = Number(userLevel.current_level);\n        let levelUp = false;\n        const logs = [];\n        // 检查是否需要升级\n        while(true){\n            const nextLevel = afterLevel + 1;\n            const levelConfig = await this.levelConfigDAO.getConfigForItem(itemId, nextLevel);\n            if (!levelConfig) {\n                break;\n            }\n            // 检查经验值是否达到下一级要求（确保 required_exp 是数字类型）\n            const requiredExp = Number(levelConfig.required_exp);\n            if (afterExp >= requiredExp) {\n                // 检查是否需要考核\n                if (levelConfig.requires_assessment) {\n                    // 需要考核，停止自动升级\n                    // 这里可以检查用户是否已通过考核（从metadata中获取）\n                    const assessmentPassed = userLevel.metadata?.assessments?.[nextLevel]?.passed === true;\n                    if (!assessmentPassed) {\n                        break;\n                    }\n                }\n                // 升级\n                const beforeLevelExp = afterExp;\n                afterLevel = nextLevel;\n                levelUp = true;\n                // 升级后，当前等级的经验值重置为 0（根据规则：每一级别的经验值在升级后，对应等级的初始经验值应该是 0）\n                const afterLevelExp = 0;\n                // 更新用户等级\n                userLevel = await this.userLevelDAO.update(uid, itemId, {\n                    current_level: afterLevel,\n                    current_exp: afterLevelExp,\n                    level_up_count: userLevel.level_up_count + 1,\n                    last_level_up_at: new Date()\n                });\n                // 更新 afterExp 为升级后的经验值（0），用于后续可能的跨级升级判断\n                afterExp = afterLevelExp;\n                // 记录升级日志\n                const levelUpLog = await this.experienceLogDAO.create({\n                    uid,\n                    item_id: itemId,\n                    exp_amount: 0,\n                    exp_type: \"level_up\",\n                    before_level: afterLevel - 1,\n                    after_level: afterLevel,\n                    before_exp: beforeLevelExp,\n                    after_exp: afterLevelExp,\n                    is_level_up: true,\n                    notes: `升级到 ${afterLevel} 级`,\n                    metadata: options?.metadata || {}\n                });\n                logs.push(levelUpLog);\n            } else {\n                break;\n            }\n        }\n        // 记录经验获得日志\n        // 注意：如果发生了升级，afterExp 已经是升级后的经验值（0）\n        const finalExp = levelUp ? userLevel.current_exp : afterExp;\n        const expLog = await this.experienceLogDAO.create({\n            uid,\n            item_id: itemId,\n            exp_amount: expAmount,\n            exp_type: options?.expType || \"unknown\",\n            source_id: options?.sourceId || null,\n            source_type: options?.sourceType || null,\n            before_level: beforeLevel,\n            after_level: afterLevel,\n            before_exp: beforeExp,\n            after_exp: finalExp,\n            is_level_up: levelUp,\n            notes: options?.notes || null,\n            metadata: options?.metadata || {}\n        });\n        logs.push(expLog);\n        return {\n            userLevel,\n            levelUp,\n            newLevel: levelUp ? afterLevel : undefined,\n            logs\n        };\n    }\n    /**\n   * 完成考试（标记考试通过并升级）\n   */ async completeAssessment(uid, itemId, targetLevel) {\n        // 获取当前用户能力等级\n        let userLevel = await this.userLevelDAO.findByUserAndItem(uid, itemId);\n        if (!userLevel) {\n            throw new Error(\"未找到该能力项的等级信息\");\n        }\n        const currentLevel = Number(userLevel.current_level);\n        const currentExp = Number(userLevel.current_exp);\n        // 检查目标等级是否合理\n        if (targetLevel !== currentLevel + 1) {\n            throw new Error(`目标等级 ${targetLevel} 不是当前等级 ${currentLevel} 的下一级`);\n        }\n        // 获取目标等级的配置\n        const levelConfig = await this.levelConfigDAO.getConfigForItem(itemId, targetLevel);\n        if (!levelConfig) {\n            throw new Error(\"已达到最高等级或目标等级配置不存在\");\n        }\n        // 检查是否需要考试\n        if (!levelConfig.requires_assessment) {\n            throw new Error(\"该等级不需要考试，请直接升级\");\n        }\n        // 检查经验是否足够\n        const requiredExp = Number(levelConfig.required_exp);\n        if (currentExp < requiredExp) {\n            throw new Error(`经验不足，当前经验：${currentExp}，需要：${requiredExp}`);\n        }\n        // 标记考试通过（更新 metadata）\n        const metadata = userLevel.metadata || {};\n        if (!metadata.assessments) {\n            metadata.assessments = {};\n        }\n        metadata.assessments[targetLevel] = {\n            passed: true,\n            passed_at: new Date().toISOString()\n        };\n        // 更新用户等级 metadata（先标记考试通过）\n        userLevel = await this.userLevelDAO.update(uid, itemId, {\n            metadata\n        });\n        // 添加 0 经验值来触发升级检查（因为经验已经够了，只需要标记考试通过）\n        // 注意：addExperience 会重新获取 userLevel，所以 metadata 中的考试通过标记会被保留\n        const result = await this.addExperience(uid, itemId, 0, {\n            expType: \"assessment\",\n            notes: `完成 ${targetLevel} 级考试`,\n            metadata: {\n                assessment_level: targetLevel,\n                assessment_passed: true\n            }\n        });\n        return result;\n    }\n    /**\n   * 升级指定等级数（自动完成过程中需要的考试）\n   * 注意：如果用户还没有该能力项的等级记录，会自动创建（等级1，经验0）\n   */ async levelUpBy(uid, itemId, levels) {\n        // 获取当前用户能力等级，如果不存在则自动创建\n        let userLevel = await this.userLevelDAO.findByUserAndItem(uid, itemId);\n        if (!userLevel) {\n            // 自动创建用户等级记录（等级1，经验0）\n            userLevel = await this.userLevelDAO.create({\n                uid,\n                item_id: itemId,\n                current_level: 1,\n                current_exp: 0,\n                total_exp: 0,\n                level_up_count: 0\n            });\n        }\n        const startLevel = Number(userLevel.current_level);\n        const allLogs = [];\n        // 逐级升级，每级都检查是否需要考试并自动完成\n        for(let i = 0; i < levels; i++){\n            // 重新获取最新的用户等级\n            userLevel = await this.userLevelDAO.findByUserAndItem(uid, itemId);\n            if (!userLevel) {\n                // 如果还是不存在（理论上不应该发生），再次创建\n                userLevel = await this.userLevelDAO.create({\n                    uid,\n                    item_id: itemId,\n                    current_level: 1,\n                    current_exp: 0,\n                    total_exp: 0,\n                    level_up_count: 0\n                });\n            }\n            const currentLevel = Number(userLevel.current_level);\n            const currentExp = Number(userLevel.current_exp);\n            const nextLevel = currentLevel + 1;\n            // 获取下一级配置\n            const levelConfig = await this.levelConfigDAO.getConfigForItem(itemId, nextLevel);\n            if (!levelConfig) {\n                break;\n            }\n            const requiredExp = Number(levelConfig.required_exp);\n            const expNeeded = Math.max(0, requiredExp - currentExp);\n            // 如果经验不够，先添加经验\n            if (expNeeded > 0) {\n                const expResult = await this.addExperience(uid, itemId, expNeeded, {\n                    expType: \"level_up\",\n                    notes: `升级到 ${nextLevel} 级（添加经验）`\n                });\n                userLevel = expResult.userLevel;\n                allLogs.push(...expResult.logs);\n                // 重新获取最新的用户等级（addExperience 可能已经自动升级了）\n                userLevel = await this.userLevelDAO.findByUserAndItem(uid, itemId);\n                if (!userLevel) {\n                    throw new Error(\"未找到该能力项的等级信息\");\n                }\n                const newCurrentLevel = Number(userLevel.current_level);\n                // 如果已经升级了，继续下一级\n                if (newCurrentLevel >= nextLevel) {\n                    continue;\n                }\n            }\n            // 重新获取最新的用户等级和经验\n            userLevel = await this.userLevelDAO.findByUserAndItem(uid, itemId);\n            if (!userLevel) {\n                throw new Error(\"未找到该能力项的等级信息\");\n            }\n            const finalCurrentLevel = Number(userLevel.current_level);\n            const finalCurrentExp = Number(userLevel.current_exp);\n            // 如果已经升级到这个等级或更高，继续下一级\n            if (finalCurrentLevel >= nextLevel) {\n                continue;\n            }\n            // 检查经验是否足够\n            if (finalCurrentExp < requiredExp) {\n                throw new Error(`经验不足，无法升级到 ${nextLevel} 级`);\n            }\n            // 如果需要考试，自动完成考试\n            if (levelConfig.requires_assessment) {\n                // 检查是否已经通过考试\n                const metadata = userLevel.metadata || {};\n                const assessmentPassed = metadata.assessments?.[nextLevel]?.passed === true;\n                if (!assessmentPassed) {\n                    // 标记考试通过\n                    if (!metadata.assessments) {\n                        metadata.assessments = {};\n                    }\n                    metadata.assessments[nextLevel] = {\n                        passed: true,\n                        passed_at: new Date().toISOString()\n                    };\n                    // 更新用户等级 metadata\n                    userLevel = await this.userLevelDAO.update(uid, itemId, {\n                        metadata\n                    });\n                }\n            }\n            // 添加 0 经验值来触发升级检查\n            const result = await this.addExperience(uid, itemId, 0, {\n                expType: \"level_up\",\n                notes: `升级到 ${nextLevel} 级`\n            });\n            userLevel = result.userLevel;\n            allLogs.push(...result.logs);\n        }\n        // 获取最终的用户等级\n        userLevel = await this.userLevelDAO.findByUserAndItem(uid, itemId);\n        if (!userLevel) {\n            throw new Error(\"未找到该能力项的等级信息\");\n        }\n        const finalLevel = Number(userLevel.current_level);\n        const levelUp = finalLevel > startLevel;\n        return {\n            userLevel,\n            levelUp,\n            newLevel: levelUp ? finalLevel : undefined,\n            logs: allLogs\n        };\n    }\n}\nExperienceService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"UserAbilityLevelDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"UserAbilityExperienceLogDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(2, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"AbilityItemLevelConfigDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__.UserAbilityLevelDAO === \"undefined\" ? Object : _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__.UserAbilityLevelDAO,\n        typeof _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__.UserAbilityExperienceLogDAO === \"undefined\" ? Object : _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__.UserAbilityExperienceLogDAO,\n        typeof _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__.AbilityItemLevelConfigDAO === \"undefined\" ? Object : _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__.AbilityItemLevelConfigDAO\n    ])\n], ExperienceService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvZXhwZXJpZW5jZS5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUE4QztBQUNxQjtBQUNpQjtBQUNKO0FBUXpFLE1BQU1LO0lBQ1hDLFlBQ0UsWUFBd0UsRUFDeEUsZ0JBQTRGLEVBQzVGLGNBQXNGLENBQ3RGO2FBSHVDQyxlQUFBQTthQUNRQyxtQkFBQUE7YUFDRkMsaUJBQUFBO0lBQzVDO0lBRUg7O0dBRUMsR0FDRCxNQUFNQyxjQUNKQyxHQUFXLEVBQ1hDLE1BQWMsRUFDZEMsU0FBaUIsRUFDakJDLE9BTUMsRUFNQTtRQUNELGFBQWE7UUFDYixJQUFJQyxZQUFZLE1BQU0sSUFBSSxDQUFDUixZQUFZLENBQUNTLGlCQUFpQixDQUFDTCxLQUFLQztRQUMvRCxNQUFNSyxjQUFjRixZQUFZRyxPQUFPSCxVQUFVSSxhQUFhLElBQUk7UUFDbEUsTUFBTUMsWUFBWUwsWUFBWUcsT0FBT0gsVUFBVU0sV0FBVyxJQUFJO1FBRTlELFFBQVE7UUFDUixJQUFJLENBQUNOLFdBQVc7WUFDZEEsWUFBWSxNQUFNLElBQUksQ0FBQ1IsWUFBWSxDQUFDZSxNQUFNLENBQUM7Z0JBQ3pDWDtnQkFDQVksU0FBU1g7Z0JBQ1RPLGVBQWU7Z0JBQ2ZFLGFBQWFSO2dCQUNiVyxXQUFXWDtZQUNiO1FBQ0YsT0FBTztZQUNMLHVCQUF1QjtZQUN2QixNQUFNWSxhQUFhUCxPQUFPSCxVQUFVTSxXQUFXO1lBQy9DLE1BQU1LLFdBQVdSLE9BQU9ILFVBQVVTLFNBQVM7WUFDM0MsTUFBTUcsVUFHRjtnQkFDRk4sYUFBYUksYUFBYVo7WUFDNUI7WUFDQSx3REFBd0Q7WUFDeEQsSUFBSUEsWUFBWSxHQUFHO2dCQUNqQmMsUUFBUUgsU0FBUyxHQUFHRSxXQUFXYjtZQUNqQztZQUNBRSxZQUFZLE1BQU0sSUFBSSxDQUFDUixZQUFZLENBQUNxQixNQUFNLENBQUNqQixLQUFLQyxRQUFRZTtRQUMxRDtRQUVBLGNBQWM7UUFDZCxJQUFJRSxXQUFX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QUNML0Q7WUFDQWdCO1lBQ0FrQyxVQUFVbEMsVUFBVXlELGFBQWF0QjtZQUNqQ2xDLE1BQU0rQztRQUNSO0lBQ0Y7QUFDRjtBQTFYYTFFLG9CQUFBQSxvRUFBQUE7SUFEWkwsb0RBQVVBO0lBR05DLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQztJQUNQQSxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7SUFDUEEsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDOzs7ZUFGNkMsNEVBQW1CLDRCQUFuQiw0RUFBbUI7ZUFDUCw2RkFBMkIsNEJBQTNCLDZGQUEyQjtlQUMvQix5RkFBeUIsNEJBQXpCLHlGQUF5Qjs7R0FKN0VJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL3NlcnZpY2VzL2V4cGVyaWVuY2Uuc2VydmljZS50cz8yOWYyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ3RzeXJpbmdlJztcbmltcG9ydCB7IFVzZXJBYmlsaXR5TGV2ZWxEQU8gfSBmcm9tICdAL2Rhby91c2VyLWFiaWxpdHktbGV2ZWwuZGFvJztcbmltcG9ydCB7IFVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ0RBTyB9IGZyb20gJ0AvZGFvL3VzZXItYWJpbGl0eS1leHBlcmllbmNlLWxvZy5kYW8nO1xuaW1wb3J0IHsgQWJpbGl0eUl0ZW1MZXZlbENvbmZpZ0RBTyB9IGZyb20gJ0AvZGFvL2FiaWxpdHktaXRlbS1sZXZlbC1jb25maWcuZGFvJztcbmltcG9ydCB0eXBlIHsgVXNlckFiaWxpdHlMZXZlbCwgVXNlckFiaWxpdHlFeHBlcmllbmNlTG9nIH0gZnJvbSAnQC9lbnRpdGllcyc7XG5cbi8qKlxuICog57uP6aqM5YC85pyN5YqhXG4gKiDotJ/otKPnu4/pqozlgLzorqHnrpfjgIHljYfnuqfpgLvovpFcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEV4cGVyaWVuY2VTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQGluamVjdCgnVXNlckFiaWxpdHlMZXZlbERBTycpIHByaXZhdGUgdXNlckxldmVsREFPOiBVc2VyQWJpbGl0eUxldmVsREFPLFxuICAgIEBpbmplY3QoJ1VzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ0RBTycpIHByaXZhdGUgZXhwZXJpZW5jZUxvZ0RBTzogVXNlckFiaWxpdHlFeHBlcmllbmNlTG9nREFPLFxuICAgIEBpbmplY3QoJ0FiaWxpdHlJdGVtTGV2ZWxDb25maWdEQU8nKSBwcml2YXRlIGxldmVsQ29uZmlnREFPOiBBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPXG4gICkge31cblxuICAvKipcbiAgICog5aKe5Yqg57uP6aqM5YC8XG4gICAqL1xuICBhc3luYyBhZGRFeHBlcmllbmNlKFxuICAgIHVpZDogbnVtYmVyLFxuICAgIGl0ZW1JZDogc3RyaW5nLFxuICAgIGV4cEFtb3VudDogbnVtYmVyLFxuICAgIG9wdGlvbnM/OiB7XG4gICAgICBleHBUeXBlPzogc3RyaW5nO1xuICAgICAgc291cmNlSWQ/OiBzdHJpbmc7XG4gICAgICBzb3VyY2VUeXBlPzogc3RyaW5nO1xuICAgICAgbm90ZXM/OiBzdHJpbmc7XG4gICAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gICAgfVxuICApOiBQcm9taXNlPHtcbiAgICB1c2VyTGV2ZWw6IFVzZXJBYmlsaXR5TGV2ZWw7XG4gICAgbGV2ZWxVcDogYm9vbGVhbjtcbiAgICBuZXdMZXZlbD86IG51bWJlcjtcbiAgICBsb2dzOiBVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2dbXTtcbiAgfT4ge1xuICAgIC8vIOiOt+WPluW9k+WJjeeUqOaIt+iDveWKm+etiee6p1xuICAgIGxldCB1c2VyTGV2ZWwgPSBhd2FpdCB0aGlzLnVzZXJMZXZlbERBTy5maW5kQnlVc2VyQW5kSXRlbSh1aWQsIGl0ZW1JZCk7XG4gICAgY29uc3QgYmVmb3JlTGV2ZWwgPSB1c2VyTGV2ZWwgPyBOdW1iZXIodXNlckxldmVsLmN1cnJlbnRfbGV2ZWwpIDogMTtcbiAgICBjb25zdCBiZWZvcmVFeHAgPSB1c2VyTGV2ZWwgPyBOdW1iZXIodXNlckxldmVsLmN1cnJlbnRfZXhwKSA6IDA7XG5cbiAgICAvLyDlop7liqDnu4/pqozlgLxcbiAgICBpZiAoIXVzZXJMZXZlbCkge1xuICAgICAgdXNlckxldmVsID0gYXdhaXQgdGhpcy51c2VyTGV2ZWxEQU8uY3JlYXRlKHtcbiAgICAgICAgdWlkLFxuICAgICAgICBpdGVtX2lkOiBpdGVtSWQsXG4gICAgICAgIGN1cnJlbnRfbGV2ZWw6IDEsXG4gICAgICAgIGN1cnJlbnRfZXhwOiBleHBBbW91bnQsXG4gICAgICAgIHRvdGFsX2V4cDogZXhwQW1vdW50LFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIOehruS/neaVsOWtl+Wtl+auteaYr+aVsOWtl+exu+Wei++8iOmYsuatouWtl+espuS4suaLvOaOpe+8iVxuICAgICAgY29uc3QgY3VycmVudEV4cCA9IE51bWJlcih1c2VyTGV2ZWwuY3VycmVudF9leHApO1xuICAgICAgY29uc3QgdG90YWxFeHAgPSBOdW1iZXIodXNlckxldmVsLnRvdGFsX2V4cCk7XG4gICAgICBjb25zdCB1cGRhdGVzOiB7XG4gICAgICAgIGN1cnJlbnRfZXhwOiBudW1iZXI7XG4gICAgICAgIHRvdGFsX2V4cD86IG51bWJlcjtcbiAgICAgIH0gPSB7XG4gICAgICAgIGN1cnJlbnRfZXhwOiBjdXJyZW50RXhwICsgZXhwQW1vdW50LFxuICAgICAgfTtcbiAgICAgIC8vIOWPquacieW9kyBleHBBbW91bnQgPiAwIOaXtuaJjeWinuWKoCB0b3RhbF9leHDvvIjlrozmiJDogIPor5Xml7YgZXhwQW1vdW50IOS4uiAw77yJXG4gICAgICBpZiAoZXhwQW1vdW50ID4gMCkge1xuICAgICAgICB1cGRhdGVzLnRvdGFsX2V4cCA9IHRvdGFsRXhwICsgZXhwQW1vdW50O1xuICAgICAgfVxuICAgICAgdXNlckxldmVsID0gYXdhaXQgdGhpcy51c2VyTGV2ZWxEQU8udXBkYXRlKHVpZCwgaXRlbUlkLCB1cGRhdGVzKTtcbiAgICB9XG5cbiAgICAvLyDnoa7kv53mlbDlrZflrZfmrrXmmK/mlbDlrZfnsbvlnotcbiAgICBsZXQgYWZ0ZXJFeHAgPSBOdW1iZXIodXNlckxldmVsLmN1cnJlbnRfZXhwKTsgLy8g5L2/55SoIGxldO+8jOWboOS4uuWNh+e6p+WQjumcgOimgeabtOaWsOS4uiAwXG4gICAgbGV0IGFmdGVyTGV2ZWwgPSBOdW1iZXIodXNlckxldmVsLmN1cnJlbnRfbGV2ZWwpO1xuICAgIGxldCBsZXZlbFVwID0gZmFsc2U7XG4gICAgY29uc3QgbG9nczogVXNlckFiaWxpdHlFeHBlcmllbmNlTG9nW10gPSBbXTtcblxuICAgIC8vIOajgOafpeaYr+WQpumcgOimgeWNh+e6p1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBjb25zdCBuZXh0TGV2ZWwgPSBhZnRlckxldmVsICsgMTtcbiAgICAgIGNvbnN0IGxldmVsQ29uZmlnID0gYXdhaXQgdGhpcy5sZXZlbENvbmZpZ0RBTy5nZXRDb25maWdGb3JJdGVtKGl0ZW1JZCwgbmV4dExldmVsKTtcblxuICAgICAgaWYgKCFsZXZlbENvbmZpZykge1xuICAgICAgICAvLyDmsqHmnInkuIvkuIDnuqfphY3nva7vvIzlgZzmraLljYfnuqdcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIC8vIOajgOafpee7j+mqjOWAvOaYr+WQpui+vuWIsOS4i+S4gOe6p+imgeaxgu+8iOehruS/nSByZXF1aXJlZF9leHAg5piv5pWw5a2X57G75Z6L77yJXG4gICAgICBjb25zdCByZXF1aXJlZEV4cCA9IE51bWJlcihsZXZlbENvbmZpZy5yZXF1aXJlZF9leHApO1xuICAgICAgaWYgKGFmdGVyRXhwID49IHJlcXVpcmVkRXhwKSB7XG4gICAgICAgIC8vIOajgOafpeaYr+WQpumcgOimgeiAg+aguFxuICAgICAgICBpZiAobGV2ZWxDb25maWcucmVxdWlyZXNfYXNzZXNzbWVudCkge1xuICAgICAgICAgIC8vIOmcgOimgeiAg+aguO+8jOWBnOatouiHquWKqOWNh+e6p1xuICAgICAgICAgIC8vIOi/memHjOWPr+S7peajgOafpeeUqOaIt+aYr+WQpuW3sumAmui/h+iAg+aguO+8iOS7jm1ldGFkYXRh5Lit6I635Y+W77yJXG4gICAgICAgICAgY29uc3QgYXNzZXNzbWVudFBhc3NlZCA9IHVzZXJMZXZlbC5tZXRhZGF0YT8uYXNzZXNzbWVudHM/LltuZXh0TGV2ZWxdPy5wYXNzZWQgPT09IHRydWU7XG4gICAgICAgICAgaWYgKCFhc3Nlc3NtZW50UGFzc2VkKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyDljYfnuqdcbiAgICAgICAgY29uc3QgYmVmb3JlTGV2ZWxFeHAgPSBhZnRlckV4cDtcbiAgICAgICAgYWZ0ZXJMZXZlbCA9IG5leHRMZXZlbDtcbiAgICAgICAgbGV2ZWxVcCA9IHRydWU7XG5cbiAgICAgICAgLy8g5Y2H57qn5ZCO77yM5b2T5YmN562J57qn55qE57uP6aqM5YC86YeN572u5Li6IDDvvIjmoLnmja7op4TliJnvvJrmr4/kuIDnuqfliKvnmoTnu4/pqozlgLzlnKjljYfnuqflkI7vvIzlr7nlupTnrYnnuqfnmoTliJ3lp4vnu4/pqozlgLzlupTor6XmmK8gMO+8iVxuICAgICAgICBjb25zdCBhZnRlckxldmVsRXhwID0gMDtcblxuICAgICAgICAvLyDmm7TmlrDnlKjmiLfnrYnnuqdcbiAgICAgICAgdXNlckxldmVsID0gYXdhaXQgdGhpcy51c2VyTGV2ZWxEQU8udXBkYXRlKHVpZCwgaXRlbUlkLCB7XG4gICAgICAgICAgY3VycmVudF9sZXZlbDogYWZ0ZXJMZXZlbCxcbiAgICAgICAgICBjdXJyZW50X2V4cDogYWZ0ZXJMZXZlbEV4cCwgLy8g5Y2H57qn5ZCO57uP6aqM5YC86YeN572u5Li6IDBcbiAgICAgICAgICBsZXZlbF91cF9jb3VudDogdXNlckxldmVsLmxldmVsX3VwX2NvdW50ICsgMSxcbiAgICAgICAgICBsYXN0X2xldmVsX3VwX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyDmm7TmlrAgYWZ0ZXJFeHAg5Li65Y2H57qn5ZCO55qE57uP6aqM5YC877yIMO+8ie+8jOeUqOS6juWQjue7reWPr+iDveeahOi3qOe6p+WNh+e6p+WIpOaWrVxuICAgICAgICBhZnRlckV4cCA9IGFmdGVyTGV2ZWxFeHA7XG5cbiAgICAgICAgLy8g6K6w5b2V5Y2H57qn5pel5b+XXG4gICAgICAgIGNvbnN0IGxldmVsVXBMb2cgPSBhd2FpdCB0aGlzLmV4cGVyaWVuY2VMb2dEQU8uY3JlYXRlKHtcbiAgICAgICAgICB1aWQsXG4gICAgICAgICAgaXRlbV9pZDogaXRlbUlkLFxuICAgICAgICAgIGV4cF9hbW91bnQ6IDAsXG4gICAgICAgICAgZXhwX3R5cGU6ICdsZXZlbF91cCcsXG4gICAgICAgICAgYmVmb3JlX2xldmVsOiBhZnRlckxldmVsIC0gMSxcbiAgICAgICAgICBhZnRlcl9sZXZlbDogYWZ0ZXJMZXZlbCxcbiAgICAgICAgICBiZWZvcmVfZXhwOiBiZWZvcmVMZXZlbEV4cCxcbiAgICAgICAgICBhZnRlcl9leHA6IGFmdGVyTGV2ZWxFeHAsIC8vIOWNh+e6p+WQjue7j+mqjOWAvOS4uiAwXG4gICAgICAgICAgaXNfbGV2ZWxfdXA6IHRydWUsXG4gICAgICAgICAgbm90ZXM6IGDljYfnuqfliLAgJHthZnRlckxldmVsfSDnuqdgLFxuICAgICAgICAgIG1ldGFkYXRhOiBvcHRpb25zPy5tZXRhZGF0YSB8fCB7fSxcbiAgICAgICAgfSk7XG4gICAgICAgIGxvZ3MucHVzaChsZXZlbFVwTG9nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOiusOW9lee7j+mqjOiOt+W+l+aXpeW/l1xuICAgIC8vIOazqOaEj++8muWmguaenOWPkeeUn+S6huWNh+e6p++8jGFmdGVyRXhwIOW3sue7j+aYr+WNh+e6p+WQjueahOe7j+mqjOWAvO+8iDDvvIlcbiAgICBjb25zdCBmaW5hbEV4cCA9IGxldmVsVXAgPyB1c2VyTGV2ZWwuY3VycmVudF9leHAgOiBhZnRlckV4cDtcbiAgICBjb25zdCBleHBMb2cgPSBhd2FpdCB0aGlzLmV4cGVyaWVuY2VMb2dEQU8uY3JlYXRlKHtcbiAgICAgIHVpZCxcbiAgICAgIGl0ZW1faWQ6IGl0ZW1JZCxcbiAgICAgIGV4cF9hbW91bnQ6IGV4cEFtb3VudCxcbiAgICAgIGV4cF90eXBlOiBvcHRpb25zPy5leHBUeXBlIHx8ICd1bmtub3duJyxcbiAgICAgIHNvdXJjZV9pZDogb3B0aW9ucz8uc291cmNlSWQgfHwgbnVsbCxcbiAgICAgIHNvdXJjZV90eXBlOiBvcHRpb25zPy5zb3VyY2VUeXBlIHx8IG51bGwsXG4gICAgICBiZWZvcmVfbGV2ZWw6IGJlZm9yZUxldmVsLFxuICAgICAgYWZ0ZXJfbGV2ZWw6IGFmdGVyTGV2ZWwsXG4gICAgICBiZWZvcmVfZXhwOiBiZWZvcmVFeHAsXG4gICAgICBhZnRlcl9leHA6IGZpbmFsRXhwLCAvLyDlpoLmnpzljYfnuqfkuobvvIzov5nph4zmmK/ljYfnuqflkI7nmoTnu4/pqozlgLzvvIgw77yJXG4gICAgICBpc19sZXZlbF91cDogbGV2ZWxVcCxcbiAgICAgIG5vdGVzOiBvcHRpb25zPy5ub3RlcyB8fCBudWxsLFxuICAgICAgbWV0YWRhdGE6IG9wdGlvbnM/Lm1ldGFkYXRhIHx8IHt9LFxuICAgIH0pO1xuICAgIGxvZ3MucHVzaChleHBMb2cpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXJMZXZlbCxcbiAgICAgIGxldmVsVXAsXG4gICAgICBuZXdMZXZlbDogbGV2ZWxVcCA/IGFmdGVyTGV2ZWwgOiB1bmRlZmluZWQsXG4gICAgICBsb2dzLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog5a6M5oiQ6ICD6K+V77yI5qCH6K6w6ICD6K+V6YCa6L+H5bm25Y2H57qn77yJXG4gICAqL1xuICBhc3luYyBjb21wbGV0ZUFzc2Vzc21lbnQoXG4gICAgdWlkOiBudW1iZXIsXG4gICAgaXRlbUlkOiBzdHJpbmcsXG4gICAgdGFyZ2V0TGV2ZWw6IG51bWJlclxuICApOiBQcm9taXNlPHtcbiAgICB1c2VyTGV2ZWw6IFVzZXJBYmlsaXR5TGV2ZWw7XG4gICAgbGV2ZWxVcDogYm9vbGVhbjtcbiAgICBuZXdMZXZlbD86IG51bWJlcjtcbiAgICBsb2dzOiBVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2dbXTtcbiAgfT4ge1xuICAgIC8vIOiOt+WPluW9k+WJjeeUqOaIt+iDveWKm+etiee6p1xuICAgIGxldCB1c2VyTGV2ZWwgPSBhd2FpdCB0aGlzLnVzZXJMZXZlbERBTy5maW5kQnlVc2VyQW5kSXRlbSh1aWQsIGl0ZW1JZCk7XG4gICAgaWYgKCF1c2VyTGV2ZWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign5pyq5om+5Yiw6K+l6IO95Yqb6aG555qE562J57qn5L+h5oGvJyk7XG4gICAgfVxuXG4gICAgY29uc3QgY3VycmVudExldmVsID0gTnVtYmVyKHVzZXJMZXZlbC5jdXJyZW50X2xldmVsKTtcbiAgICBjb25zdCBjdXJyZW50RXhwID0gTnVtYmVyKHVzZXJMZXZlbC5jdXJyZW50X2V4cCk7XG5cbiAgICAvLyDmo4Dmn6Xnm67moIfnrYnnuqfmmK/lkKblkIjnkIZcbiAgICBpZiAodGFyZ2V0TGV2ZWwgIT09IGN1cnJlbnRMZXZlbCArIDEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihg55uu5qCH562J57qnICR7dGFyZ2V0TGV2ZWx9IOS4jeaYr+W9k+WJjeetiee6pyAke2N1cnJlbnRMZXZlbH0g55qE5LiL5LiA57qnYCk7XG4gICAgfVxuXG4gICAgLy8g6I635Y+W55uu5qCH562J57qn55qE6YWN572uXG4gICAgY29uc3QgbGV2ZWxDb25maWcgPSBhd2FpdCB0aGlzLmxldmVsQ29uZmlnREFPLmdldENvbmZpZ0Zvckl0ZW0oaXRlbUlkLCB0YXJnZXRMZXZlbCk7XG4gICAgaWYgKCFsZXZlbENvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCflt7Lovr7liLDmnIDpq5jnrYnnuqfmiJbnm67moIfnrYnnuqfphY3nva7kuI3lrZjlnKgnKTtcbiAgICB9XG5cbiAgICAvLyDmo4Dmn6XmmK/lkKbpnIDopoHogIPor5VcbiAgICBpZiAoIWxldmVsQ29uZmlnLnJlcXVpcmVzX2Fzc2Vzc21lbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign6K+l562J57qn5LiN6ZyA6KaB6ICD6K+V77yM6K+355u05o6l5Y2H57qnJyk7XG4gICAgfVxuXG4gICAgLy8g5qOA5p+l57uP6aqM5piv5ZCm6Laz5aSfXG4gICAgY29uc3QgcmVxdWlyZWRFeHAgPSBOdW1iZXIobGV2ZWxDb25maWcucmVxdWlyZWRfZXhwKTtcbiAgICBpZiAoY3VycmVudEV4cCA8IHJlcXVpcmVkRXhwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYOe7j+mqjOS4jei2s++8jOW9k+WJjee7j+mqjO+8miR7Y3VycmVudEV4cH3vvIzpnIDopoHvvJoke3JlcXVpcmVkRXhwfWApO1xuICAgIH1cblxuICAgIC8vIOagh+iusOiAg+ivlemAmui/h++8iOabtOaWsCBtZXRhZGF0Ye+8iVxuICAgIGNvbnN0IG1ldGFkYXRhID0gdXNlckxldmVsLm1ldGFkYXRhIHx8IHt9O1xuICAgIGlmICghbWV0YWRhdGEuYXNzZXNzbWVudHMpIHtcbiAgICAgIG1ldGFkYXRhLmFzc2Vzc21lbnRzID0ge307XG4gICAgfVxuICAgIG1ldGFkYXRhLmFzc2Vzc21lbnRzW3RhcmdldExldmVsXSA9IHtcbiAgICAgIHBhc3NlZDogdHJ1ZSxcbiAgICAgIHBhc3NlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG5cbiAgICAvLyDmm7TmlrDnlKjmiLfnrYnnuqcgbWV0YWRhdGHvvIjlhYjmoIforrDogIPor5XpgJrov4fvvIlcbiAgICB1c2VyTGV2ZWwgPSBhd2FpdCB0aGlzLnVzZXJMZXZlbERBTy51cGRhdGUodWlkLCBpdGVtSWQsIHtcbiAgICAgIG1ldGFkYXRhLFxuICAgIH0pO1xuXG4gICAgLy8g5re75YqgIDAg57uP6aqM5YC85p2l6Kem5Y+R5Y2H57qn5qOA5p+l77yI5Zug5Li657uP6aqM5bey57uP5aSf5LqG77yM5Y+q6ZyA6KaB5qCH6K6w6ICD6K+V6YCa6L+H77yJXG4gICAgLy8g5rOo5oSP77yaYWRkRXhwZXJpZW5jZSDkvJrph43mlrDojrflj5YgdXNlckxldmVs77yM5omA5LulIG1ldGFkYXRhIOS4reeahOiAg+ivlemAmui/h+agh+iusOS8muiiq+S/neeVmVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWRkRXhwZXJpZW5jZSh1aWQsIGl0ZW1JZCwgMCwge1xuICAgICAgZXhwVHlwZTogJ2Fzc2Vzc21lbnQnLFxuICAgICAgbm90ZXM6IGDlrozmiJAgJHt0YXJnZXRMZXZlbH0g57qn6ICD6K+VYCxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGFzc2Vzc21lbnRfbGV2ZWw6IHRhcmdldExldmVsLFxuICAgICAgICBhc3Nlc3NtZW50X3Bhc3NlZDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIOWNh+e6p+aMh+Wumuetiee6p+aVsO+8iOiHquWKqOWujOaIkOi/h+eoi+S4remcgOimgeeahOiAg+ivle+8iVxuICAgKiDms6jmhI/vvJrlpoLmnpznlKjmiLfov5jmsqHmnInor6Xog73lipvpobnnmoTnrYnnuqforrDlvZXvvIzkvJroh6rliqjliJvlu7rvvIjnrYnnuqcx77yM57uP6aqMMO+8iVxuICAgKi9cbiAgYXN5bmMgbGV2ZWxVcEJ5KFxuICAgIHVpZDogbnVtYmVyLFxuICAgIGl0ZW1JZDogc3RyaW5nLFxuICAgIGxldmVsczogbnVtYmVyXG4gICk6IFByb21pc2U8e1xuICAgIHVzZXJMZXZlbDogVXNlckFiaWxpdHlMZXZlbDtcbiAgICBsZXZlbFVwOiBib29sZWFuO1xuICAgIG5ld0xldmVsPzogbnVtYmVyO1xuICAgIGxvZ3M6IFVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ1tdO1xuICB9PiB7XG4gICAgLy8g6I635Y+W5b2T5YmN55So5oi36IO95Yqb562J57qn77yM5aaC5p6c5LiN5a2Y5Zyo5YiZ6Ieq5Yqo5Yib5bu6XG4gICAgbGV0IHVzZXJMZXZlbCA9IGF3YWl0IHRoaXMudXNlckxldmVsREFPLmZpbmRCeVVzZXJBbmRJdGVtKHVpZCwgaXRlbUlkKTtcbiAgICBpZiAoIXVzZXJMZXZlbCkge1xuICAgICAgLy8g6Ieq5Yqo5Yib5bu655So5oi3562J57qn6K6w5b2V77yI562J57qnMe+8jOe7j+mqjDDvvIlcbiAgICAgIHVzZXJMZXZlbCA9IGF3YWl0IHRoaXMudXNlckxldmVsREFPLmNyZWF0ZSh7XG4gICAgICAgIHVpZCxcbiAgICAgICAgaXRlbV9pZDogaXRlbUlkLFxuICAgICAgICBjdXJyZW50X2xldmVsOiAxLFxuICAgICAgICBjdXJyZW50X2V4cDogMCxcbiAgICAgICAgdG90YWxfZXhwOiAwLFxuICAgICAgICBsZXZlbF91cF9jb3VudDogMCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0TGV2ZWwgPSBOdW1iZXIodXNlckxldmVsLmN1cnJlbnRfbGV2ZWwpO1xuICAgIGNvbnN0IGFsbExvZ3M6IFVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ1tdID0gW107XG5cbiAgICAvLyDpgJDnuqfljYfnuqfvvIzmr4/nuqfpg73mo4Dmn6XmmK/lkKbpnIDopoHogIPor5Xlubboh6rliqjlrozmiJBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxldmVsczsgaSsrKSB7XG4gICAgICAvLyDph43mlrDojrflj5bmnIDmlrDnmoTnlKjmiLfnrYnnuqdcbiAgICAgIHVzZXJMZXZlbCA9IGF3YWl0IHRoaXMudXNlckxldmVsREFPLmZpbmRCeVVzZXJBbmRJdGVtKHVpZCwgaXRlbUlkKTtcbiAgICAgIGlmICghdXNlckxldmVsKSB7XG4gICAgICAgIC8vIOWmguaenOi/mOaYr+S4jeWtmOWcqO+8iOeQhuiuuuS4iuS4jeW6lOivpeWPkeeUn++8ie+8jOWGjeasoeWIm+W7ulxuICAgICAgICB1c2VyTGV2ZWwgPSBhd2FpdCB0aGlzLnVzZXJMZXZlbERBTy5jcmVhdGUoe1xuICAgICAgICAgIHVpZCxcbiAgICAgICAgICBpdGVtX2lkOiBpdGVtSWQsXG4gICAgICAgICAgY3VycmVudF9sZXZlbDogMSxcbiAgICAgICAgICBjdXJyZW50X2V4cDogMCxcbiAgICAgICAgICB0b3RhbF9leHA6IDAsXG4gICAgICAgICAgbGV2ZWxfdXBfY291bnQ6IDAsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjdXJyZW50TGV2ZWwgPSBOdW1iZXIodXNlckxldmVsLmN1cnJlbnRfbGV2ZWwpO1xuICAgICAgY29uc3QgY3VycmVudEV4cCA9IE51bWJlcih1c2VyTGV2ZWwuY3VycmVudF9leHApO1xuICAgICAgY29uc3QgbmV4dExldmVsID0gY3VycmVudExldmVsICsgMTtcblxuICAgICAgLy8g6I635Y+W5LiL5LiA57qn6YWN572uXG4gICAgICBjb25zdCBsZXZlbENvbmZpZyA9IGF3YWl0IHRoaXMubGV2ZWxDb25maWdEQU8uZ2V0Q29uZmlnRm9ySXRlbShpdGVtSWQsIG5leHRMZXZlbCk7XG4gICAgICBpZiAoIWxldmVsQ29uZmlnKSB7XG4gICAgICAgIC8vIOayoeacieS4i+S4gOe6p+mFjee9ru+8jOWBnOatouWNh+e6p1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVxdWlyZWRFeHAgPSBOdW1iZXIobGV2ZWxDb25maWcucmVxdWlyZWRfZXhwKTtcbiAgICAgIGNvbnN0IGV4cE5lZWRlZCA9IE1hdGgubWF4KDAsIHJlcXVpcmVkRXhwIC0gY3VycmVudEV4cCk7XG5cbiAgICAgIC8vIOWmguaenOe7j+mqjOS4jeWkn++8jOWFiOa3u+WKoOe7j+mqjFxuICAgICAgaWYgKGV4cE5lZWRlZCA+IDApIHtcbiAgICAgICAgY29uc3QgZXhwUmVzdWx0ID0gYXdhaXQgdGhpcy5hZGRFeHBlcmllbmNlKHVpZCwgaXRlbUlkLCBleHBOZWVkZWQsIHtcbiAgICAgICAgICBleHBUeXBlOiAnbGV2ZWxfdXAnLFxuICAgICAgICAgIG5vdGVzOiBg5Y2H57qn5YiwICR7bmV4dExldmVsfSDnuqfvvIjmt7vliqDnu4/pqozvvIlgLFxuICAgICAgICB9KTtcbiAgICAgICAgdXNlckxldmVsID0gZXhwUmVzdWx0LnVzZXJMZXZlbDtcbiAgICAgICAgYWxsTG9ncy5wdXNoKC4uLmV4cFJlc3VsdC5sb2dzKTtcblxuICAgICAgICAvLyDph43mlrDojrflj5bmnIDmlrDnmoTnlKjmiLfnrYnnuqfvvIhhZGRFeHBlcmllbmNlIOWPr+iDveW3sue7j+iHquWKqOWNh+e6p+S6hu+8iVxuICAgICAgICB1c2VyTGV2ZWwgPSBhd2FpdCB0aGlzLnVzZXJMZXZlbERBTy5maW5kQnlVc2VyQW5kSXRlbSh1aWQsIGl0ZW1JZCk7XG4gICAgICAgIGlmICghdXNlckxldmVsKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfmnKrmib7liLDor6Xog73lipvpobnnmoTnrYnnuqfkv6Hmga8nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5ld0N1cnJlbnRMZXZlbCA9IE51bWJlcih1c2VyTGV2ZWwuY3VycmVudF9sZXZlbCk7XG4gICAgICAgIC8vIOWmguaenOW3sue7j+WNh+e6p+S6hu+8jOe7p+e7reS4i+S4gOe6p1xuICAgICAgICBpZiAobmV3Q3VycmVudExldmVsID49IG5leHRMZXZlbCkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIOmHjeaWsOiOt+WPluacgOaWsOeahOeUqOaIt+etiee6p+WSjOe7j+mqjFxuICAgICAgdXNlckxldmVsID0gYXdhaXQgdGhpcy51c2VyTGV2ZWxEQU8uZmluZEJ5VXNlckFuZEl0ZW0odWlkLCBpdGVtSWQpO1xuICAgICAgaWYgKCF1c2VyTGV2ZWwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfmnKrmib7liLDor6Xog73lipvpobnnmoTnrYnnuqfkv6Hmga8nKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZmluYWxDdXJyZW50TGV2ZWwgPSBOdW1iZXIodXNlckxldmVsLmN1cnJlbnRfbGV2ZWwpO1xuICAgICAgY29uc3QgZmluYWxDdXJyZW50RXhwID0gTnVtYmVyKHVzZXJMZXZlbC5jdXJyZW50X2V4cCk7XG5cbiAgICAgIC8vIOWmguaenOW3sue7j+WNh+e6p+WIsOi/meS4quetiee6p+aIluabtOmrmO+8jOe7p+e7reS4i+S4gOe6p1xuICAgICAgaWYgKGZpbmFsQ3VycmVudExldmVsID49IG5leHRMZXZlbCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8g5qOA5p+l57uP6aqM5piv5ZCm6Laz5aSfXG4gICAgICBpZiAoZmluYWxDdXJyZW50RXhwIDwgcmVxdWlyZWRFeHApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDnu4/pqozkuI3otrPvvIzml6Dms5XljYfnuqfliLAgJHtuZXh0TGV2ZWx9IOe6p2ApO1xuICAgICAgfVxuXG4gICAgICAvLyDlpoLmnpzpnIDopoHogIPor5XvvIzoh6rliqjlrozmiJDogIPor5VcbiAgICAgIGlmIChsZXZlbENvbmZpZy5yZXF1aXJlc19hc3Nlc3NtZW50KSB7XG4gICAgICAgIC8vIOajgOafpeaYr+WQpuW3sue7j+mAmui/h+iAg+ivlVxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHVzZXJMZXZlbC5tZXRhZGF0YSB8fCB7fTtcbiAgICAgICAgY29uc3QgYXNzZXNzbWVudFBhc3NlZCA9IG1ldGFkYXRhLmFzc2Vzc21lbnRzPy5bbmV4dExldmVsXT8ucGFzc2VkID09PSB0cnVlO1xuXG4gICAgICAgIGlmICghYXNzZXNzbWVudFBhc3NlZCkge1xuICAgICAgICAgIC8vIOagh+iusOiAg+ivlemAmui/h1xuICAgICAgICAgIGlmICghbWV0YWRhdGEuYXNzZXNzbWVudHMpIHtcbiAgICAgICAgICAgIG1ldGFkYXRhLmFzc2Vzc21lbnRzID0ge307XG4gICAgICAgICAgfVxuICAgICAgICAgIG1ldGFkYXRhLmFzc2Vzc21lbnRzW25leHRMZXZlbF0gPSB7XG4gICAgICAgICAgICBwYXNzZWQ6IHRydWUsXG4gICAgICAgICAgICBwYXNzZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgLy8g5pu05paw55So5oi3562J57qnIG1ldGFkYXRhXG4gICAgICAgICAgdXNlckxldmVsID0gYXdhaXQgdGhpcy51c2VyTGV2ZWxEQU8udXBkYXRlKHVpZCwgaXRlbUlkLCB7XG4gICAgICAgICAgICBtZXRhZGF0YSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyDmt7vliqAgMCDnu4/pqozlgLzmnaXop6blj5HljYfnuqfmo4Dmn6VcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWRkRXhwZXJpZW5jZSh1aWQsIGl0ZW1JZCwgMCwge1xuICAgICAgICBleHBUeXBlOiAnbGV2ZWxfdXAnLFxuICAgICAgICBub3RlczogYOWNh+e6p+WIsCAke25leHRMZXZlbH0g57qnYCxcbiAgICAgIH0pO1xuXG4gICAgICB1c2VyTGV2ZWwgPSByZXN1bHQudXNlckxldmVsO1xuICAgICAgYWxsTG9ncy5wdXNoKC4uLnJlc3VsdC5sb2dzKTtcbiAgICB9XG5cbiAgICAvLyDojrflj5bmnIDnu4jnmoTnlKjmiLfnrYnnuqdcbiAgICB1c2VyTGV2ZWwgPSBhd2FpdCB0aGlzLnVzZXJMZXZlbERBTy5maW5kQnlVc2VyQW5kSXRlbSh1aWQsIGl0ZW1JZCk7XG4gICAgaWYgKCF1c2VyTGV2ZWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign5pyq5om+5Yiw6K+l6IO95Yqb6aG555qE562J57qn5L+h5oGvJyk7XG4gICAgfVxuXG4gICAgY29uc3QgZmluYWxMZXZlbCA9IE51bWJlcih1c2VyTGV2ZWwuY3VycmVudF9sZXZlbCk7XG4gICAgY29uc3QgbGV2ZWxVcCA9IGZpbmFsTGV2ZWwgPiBzdGFydExldmVsO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXJMZXZlbCxcbiAgICAgIGxldmVsVXAsXG4gICAgICBuZXdMZXZlbDogbGV2ZWxVcCA/IGZpbmFsTGV2ZWwgOiB1bmRlZmluZWQsXG4gICAgICBsb2dzOiBhbGxMb2dzLFxuICAgIH07XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbImluamVjdGFibGUiLCJpbmplY3QiLCJVc2VyQWJpbGl0eUxldmVsREFPIiwiVXNlckFiaWxpdHlFeHBlcmllbmNlTG9nREFPIiwiQWJpbGl0eUl0ZW1MZXZlbENvbmZpZ0RBTyIsIkV4cGVyaWVuY2VTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJ1c2VyTGV2ZWxEQU8iLCJleHBlcmllbmNlTG9nREFPIiwibGV2ZWxDb25maWdEQU8iLCJhZGRFeHBlcmllbmNlIiwidWlkIiwiaXRlbUlkIiwiZXhwQW1vdW50Iiwib3B0aW9ucyIsInVzZXJMZXZlbCIsImZpbmRCeVVzZXJBbmRJdGVtIiwiYmVmb3JlTGV2ZWwiLCJOdW1iZXIiLCJjdXJyZW50X2xldmVsIiwiYmVmb3JlRXhwIiwiY3VycmVudF9leHAiLCJjcmVhdGUiLCJpdGVtX2lkIiwidG90YWxfZXhwIiwiY3VycmVudEV4cCIsInRvdGFsRXhwIiwidXBkYXRlcyIsInVwZGF0ZSIsImFmdGVyRXhwIiwiYWZ0ZXJMZXZlbCIsImxldmVsVXAiLCJsb2dzIiwibmV4dExldmVsIiwibGV2ZWxDb25maWciLCJnZXRDb25maWdGb3JJdGVtIiwicmVxdWlyZWRFeHAiLCJyZXF1aXJlZF9leHAiLCJyZXF1aXJlc19hc3Nlc3NtZW50IiwiYXNzZXNzbWVudFBhc3NlZCIsIm1ldGFkYXRhIiwiYXNzZXNzbWVudHMiLCJwYXNzZWQiLCJiZWZvcmVMZXZlbEV4cCIsImFmdGVyTGV2ZWxFeHAiLCJsZXZlbF91cF9jb3VudCIsImxhc3RfbGV2ZWxfdXBfYXQiLCJEYXRlIiwibGV2ZWxVcExvZyIsImV4cF9hbW91bnQiLCJleHBfdHlwZSIsImJlZm9yZV9sZXZlbCIsImFmdGVyX2xldmVsIiwiYmVmb3JlX2V4cCIsImFmdGVyX2V4cCIsImlzX2xldmVsX3VwIiwibm90ZXMiLCJwdXNoIiwiZmluYWxFeHAiLCJleHBMb2ciLCJleHBUeXBlIiwic291cmNlX2lkIiwic291cmNlSWQiLCJzb3VyY2VfdHlwZSIsInNvdXJjZVR5cGUiLCJuZXdMZXZlbCIsInVuZGVmaW5lZCIsImNvbXBsZXRlQXNzZXNzbWVudCIsInRhcmdldExldmVsIiwiRXJyb3IiLCJjdXJyZW50TGV2ZWwiLCJwYXNzZWRfYXQiLCJ0b0lTT1N0cmluZyIsInJlc3VsdCIsImFzc2Vzc21lbnRfbGV2ZWwiLCJhc3Nlc3NtZW50X3Bhc3NlZCIsImxldmVsVXBCeSIsImxldmVscyIsInN0YXJ0TGV2ZWwiLCJhbGxMb2dzIiwiaSIsImV4cE5lZWRlZCIsIk1hdGgiLCJtYXgiLCJleHBSZXN1bHQiLCJuZXdDdXJyZW50TGV2ZWwiLCJmaW5hbEN1cnJlbnRMZXZlbCIsImZpbmFsQ3VycmVudEV4cCIsImZpbmFsTGV2ZWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/experience.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/snapshot-scheduler.service.ts":
/*!****************************************************!*\
  !*** ./src/services/snapshot-scheduler.service.ts ***!
  \****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CompositeOrStrategy: () => (/* binding */ CompositeOrStrategy),\n/* harmony export */   ContentChangeStrategy: () => (/* binding */ ContentChangeStrategy),\n/* harmony export */   EditFrequencyStrategy: () => (/* binding */ EditFrequencyStrategy),\n/* harmony export */   SnapshotScheduler: () => (/* binding */ SnapshotScheduler),\n/* harmony export */   TimeIntervalStrategy: () => (/* binding */ TimeIntervalStrategy)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _services_snapshot_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/snapshot.service */ \"(rsc)/./src/services/snapshot.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__]);\n_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n/**\n * 时间间隔策略：如果距离上次快照超过指定时间，创建大版本\n */ class TimeIntervalStrategy {\n    constructor(timeThresholdMs = 300000){\n        // 默认 5 分钟（300000 毫秒）\n        this.timeThreshold = timeThresholdMs;\n    }\n    shouldCreateMajorVersion(context) {\n        return context.timeSinceLastSnapshot >= this.timeThreshold;\n    }\n}\n/**\n * 内容变化策略：如果内容变化很大，创建大版本\n */ class ContentChangeStrategy {\n    constructor(changeThresholdBytes = 10000){\n        // 默认 10KB\n        this.changeThreshold = changeThresholdBytes;\n    }\n    shouldCreateMajorVersion(context) {\n        if (!context.lastSnapshotDocStateSize) {\n            // 如果没有上次快照，不基于内容变化判断\n            return false;\n        }\n        const currentSize = context.currentDocState.length;\n        const sizeChange = Math.abs(currentSize - context.lastSnapshotDocStateSize);\n        // 如果内容变化超过阈值，创建大版本\n        return sizeChange >= this.changeThreshold;\n    }\n}\n/**\n * 变更频次策略：如果变更频次超过阈值，创建大版本\n */ class EditFrequencyStrategy {\n    constructor(editThreshold = 50){\n        // 默认 50 次\n        this.editThreshold = editThreshold;\n    }\n    shouldCreateMajorVersion(context) {\n        return context.editCount >= this.editThreshold;\n    }\n}\n/**\n * 组合策略：多个策略中任意一个满足条件就创建大版本\n */ class CompositeOrStrategy {\n    constructor(strategies){\n        this.strategies = strategies;\n    }\n    async shouldCreateMajorVersion(context) {\n        for (const strategy of this.strategies){\n            const result = await strategy.shouldCreateMajorVersion(context);\n            if (result) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\nclass SnapshotScheduler {\n    constructor(documentDAO, snapshotService){\n        this.documentDAO = documentDAO;\n        this.snapshotService = snapshotService;\n        this.editCounts = new Map();\n        this.lastSnapshotTimes = new Map();\n        this.lastSnapshotSizes = new Map();\n        this.EDITS_THRESHOLD = parseInt(process.env.SNAPSHOT_EDITS_THRESHOLD || \"10\", 10);\n        this.TIME_THRESHOLD = parseInt(process.env.SNAPSHOT_TIME_THRESHOLD || \"300000\", 10);\n        // 初始化组合策略：时间间隔、内容变化、变更频次\n        const timeStrategy = new TimeIntervalStrategy(this.TIME_THRESHOLD);\n        const contentStrategy = new ContentChangeStrategy(parseInt(process.env.SNAPSHOT_CONTENT_CHANGE_THRESHOLD || \"10000\", 10));\n        const frequencyStrategy = new EditFrequencyStrategy(parseInt(process.env.SNAPSHOT_EDIT_FREQUENCY_THRESHOLD || \"50\", 10));\n        this.versionStrategy = new CompositeOrStrategy([\n            timeStrategy,\n            contentStrategy,\n            frequencyStrategy\n        ]);\n    }\n    /**\n   * 记录一次编辑\n   * @param objectId 文档 ID\n   * @param workspaceId 工作空间 ID\n   * @param docState 文档状态（Y.encodeStateAsUpdate）\n   * @param snapshot Yjs Snapshot（可选）\n   * @returns 如果创建了快照，返回快照信息；否则返回 null\n   */ async recordEdit(objectId, workspaceId, docState, snapshot) {\n        const key = objectId;\n        const editCount = (this.editCounts.get(key) || 0) + 1;\n        this.editCounts.set(key, editCount);\n        const now = Date.now();\n        let lastSnapshotTime = this.lastSnapshotTimes.get(key);\n        let lastSnapshotSize = this.lastSnapshotSizes.get(key);\n        // 如果内存中没有记录，从数据库查询最后一个快照的信息\n        if (!lastSnapshotTime || lastSnapshotSize === undefined) {\n            try {\n                const latestSnapshot = await this.documentDAO.getLatestSnapshot(objectId);\n                if (latestSnapshot) {\n                    lastSnapshotTime = latestSnapshot.created_at;\n                    lastSnapshotSize = latestSnapshot.doc_state?.length || 0;\n                    this.lastSnapshotTimes.set(key, lastSnapshotTime);\n                    this.lastSnapshotSizes.set(key, lastSnapshotSize);\n                } else {\n                    // 如果没有快照，尝试使用文档的创建时间作为基准\n                    // 这样可以确保即使没有快照，也能正确计算时间间隔\n                    try {\n                        const document = await this.documentDAO.findById(objectId);\n                        if (document && document.created_at) {\n                            // 文档创建时间（转换为毫秒时间戳）\n                            const docCreatedAt = typeof document.created_at === \"string\" ? new Date(document.created_at).getTime() : document.created_at instanceof Date ? document.created_at.getTime() : document.created_at;\n                            lastSnapshotTime = docCreatedAt;\n                            lastSnapshotSize = document.content_length || 0;\n                            console.log(`[SnapshotScheduler] No snapshot found, using document created_at: ${lastSnapshotTime}`);\n                        } else {\n                            // 如果连文档都找不到，设置为0\n                            lastSnapshotTime = 0;\n                            lastSnapshotSize = 0;\n                        }\n                    } catch (docError) {\n                        console.error(`Failed to get document for ${objectId}:`, docError);\n                        lastSnapshotTime = 0;\n                        lastSnapshotSize = 0;\n                    }\n                    this.lastSnapshotTimes.set(key, lastSnapshotTime);\n                    this.lastSnapshotSizes.set(key, lastSnapshotSize);\n                }\n            } catch (error) {\n                console.error(`Failed to get latest snapshot for ${objectId}:`, error);\n                lastSnapshotTime = 0;\n                lastSnapshotSize = 0;\n                this.lastSnapshotTimes.set(key, 0);\n                this.lastSnapshotSizes.set(key, 0);\n            }\n        }\n        const timeSinceLastSnapshot = now - lastSnapshotTime;\n        // 判断是否需要创建快照\n        // 如果时间间隔超过阈值，即使编辑次数不够，也应该创建快照\n        // 这样可以确保长时间不编辑的文档也能定期创建快照\n        const shouldCreateSnapshot = editCount >= this.EDITS_THRESHOLD || timeSinceLastSnapshot >= this.TIME_THRESHOLD;\n        console.log(`[SnapshotScheduler] recordEdit for ${objectId}:`, {\n            editCount,\n            timeSinceLastSnapshot,\n            timeSinceLastSnapshotMinutes: Math.round(timeSinceLastSnapshot / 60000),\n            shouldCreateSnapshot,\n            EDITS_THRESHOLD: this.EDITS_THRESHOLD,\n            TIME_THRESHOLD: this.TIME_THRESHOLD\n        });\n        if (shouldCreateSnapshot) {\n            // 使用策略判断版本类型\n            const context = {\n                objectId,\n                workspaceId,\n                currentDocState: docState,\n                currentTime: now,\n                editCount,\n                timeSinceLastSnapshot,\n                lastSnapshotDocStateSize: lastSnapshotSize,\n                lastSnapshotTime\n            };\n            const isMajor = await this.versionStrategy.shouldCreateMajorVersion(context);\n            const versionType = isMajor ? \"major\" : \"minor\";\n            console.log(`[SnapshotScheduler] Creating ${versionType} snapshot for ${objectId}`);\n            const result = await this.createSnapshot(objectId, workspaceId, docState, snapshot, versionType);\n            // 重置计数和时间\n            this.editCounts.set(key, 0);\n            this.lastSnapshotTimes.set(key, now);\n            this.lastSnapshotSizes.set(key, docState.length);\n            console.log(`[SnapshotScheduler] Snapshot created:`, {\n                snapshot_id: result.snapshot_id,\n                version_type: versionType\n            });\n            return {\n                ...result,\n                version_type: versionType\n            };\n        }\n        return null;\n    }\n    /**\n   * 创建快照\n   */ async createSnapshot(objectId, workspaceId, docState, snapshot, versionType = \"major\") {\n        try {\n            // 使用 SnapshotService 创建快照\n            const result = await this.snapshotService.createSnapshot({\n                workspaceId,\n                objectId,\n                docState,\n                snapshot,\n                metadata: {\n                    auto_save: versionType === \"major\",\n                    doc_state_length: docState.length,\n                    version_type: versionType\n                }\n            });\n            // 在数据库中记录快照元数据\n            console.log(`[SnapshotScheduler] Saving snapshot to database:`, {\n                object_id: objectId,\n                workspace_id: workspaceId,\n                version_type: versionType,\n                doc_state_length: docState.length,\n                snapshot_length: snapshot?.length || 0\n            });\n            const snapshotRecord = await this.documentDAO.createSnapshot({\n                object_id: objectId,\n                workspace_id: workspaceId,\n                snapshot_data: snapshot || Buffer.alloc(0),\n                snapshot_version: 1,\n                doc_state: docState,\n                doc_state_version: 1,\n                version_type: versionType,\n                metadata: {\n                    snapshot_id: result.snapshotId,\n                    created_at: result.createdAt,\n                    stored_in: \"file\"\n                }\n            });\n            console.log(`[SnapshotScheduler] Snapshot record saved to database:`, {\n                snapshot_id: snapshotRecord.snapshot_id,\n                object_id: objectId,\n                version_type: versionType,\n                created_at: snapshotRecord.created_at,\n                db_created_at_type: typeof snapshotRecord.created_at\n            });\n            return {\n                snapshot_id: snapshotRecord.snapshot_id,\n                created_at: result.createdAt\n            };\n        } catch (error) {\n            console.error(`Failed to create snapshot for document ${objectId}:`, error);\n            throw error;\n        }\n    }\n    /**\n   * 手动触发快照创建（用于手动保存）\n   * 会根据策略判断创建大版本还是小版本\n   * @param forceMajorVersion 是否强制创建大版本（用于初始快照等场景）\n   */ async createSnapshotManually(objectId, workspaceId, docState, snapshot, forceMajorVersion = false) {\n        const key = objectId;\n        const editCount = this.editCounts.get(key) || 0;\n        const now = Date.now();\n        let lastSnapshotTime = this.lastSnapshotTimes.get(key);\n        let lastSnapshotSize = this.lastSnapshotSizes.get(key);\n        // 如果内存中没有记录，从数据库查询\n        if (!lastSnapshotTime || lastSnapshotSize === undefined) {\n            try {\n                const latestSnapshot = await this.documentDAO.getLatestSnapshot(objectId);\n                if (latestSnapshot) {\n                    lastSnapshotTime = latestSnapshot.created_at;\n                    lastSnapshotSize = latestSnapshot.doc_state?.length || 0;\n                } else {\n                    // 如果没有快照，尝试使用文档的创建时间作为基准\n                    try {\n                        const document = await this.documentDAO.findById(objectId);\n                        if (document && document.created_at) {\n                            const docCreatedAt = typeof document.created_at === \"string\" ? new Date(document.created_at).getTime() : document.created_at instanceof Date ? document.created_at.getTime() : document.created_at;\n                            lastSnapshotTime = docCreatedAt;\n                            lastSnapshotSize = document.content_length || 0;\n                            console.log(`[SnapshotScheduler] No snapshot found, using document created_at: ${lastSnapshotTime}`);\n                        } else {\n                            lastSnapshotTime = 0;\n                            lastSnapshotSize = 0;\n                        }\n                    } catch (docError) {\n                        console.error(`Failed to get document for ${objectId}:`, docError);\n                        lastSnapshotTime = 0;\n                        lastSnapshotSize = 0;\n                    }\n                }\n            } catch (error) {\n                console.error(`Failed to get latest snapshot for ${objectId}:`, error);\n                lastSnapshotTime = 0;\n                lastSnapshotSize = 0;\n            }\n        }\n        const timeSinceLastSnapshot = now - (lastSnapshotTime || 0);\n        // 判断版本类型\n        let versionType;\n        if (forceMajorVersion) {\n            // 强制创建大版本（用于初始快照等场景）\n            versionType = \"major\";\n        } else {\n            // 使用策略判断版本类型\n            const context = {\n                objectId,\n                workspaceId,\n                currentDocState: docState,\n                currentTime: now,\n                editCount,\n                timeSinceLastSnapshot,\n                lastSnapshotDocStateSize: lastSnapshotSize,\n                lastSnapshotTime\n            };\n            const isMajor = await this.versionStrategy.shouldCreateMajorVersion(context);\n            versionType = isMajor ? \"major\" : \"minor\";\n        }\n        const result = await this.createSnapshot(objectId, workspaceId, docState, snapshot, versionType);\n        // 重置计数和时间\n        this.editCounts.set(key, 0);\n        this.lastSnapshotTimes.set(key, now);\n        this.lastSnapshotSizes.set(key, docState.length);\n        return {\n            ...result,\n            version_type: versionType\n        };\n    }\n    /**\n   * 重置文档的编辑计数（用于文档关闭等场景）\n   */ reset(objectId) {\n        this.editCounts.delete(objectId);\n        this.lastSnapshotTimes.delete(objectId);\n        this.lastSnapshotSizes.delete(objectId);\n    }\n}\nSnapshotScheduler = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"SnapshotService\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO === \"undefined\" ? Object : _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO,\n        typeof _services_snapshot_service__WEBPACK_IMPORTED_MODULE_2__.SnapshotService === \"undefined\" ? Object : _services_snapshot_service__WEBPACK_IMPORTED_MODULE_2__.SnapshotService\n    ])\n], SnapshotScheduler);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvc25hcHNob3Qtc2NoZWR1bGVyLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQThDO0FBQ0c7QUFDYTtBQTZCOUQ7O0NBRUMsR0FDTSxNQUFNSTtJQUdYQyxZQUFZQyxrQkFBMEIsTUFBTSxDQUFFO1FBQzVDLHFCQUFxQjtRQUNyQixJQUFJLENBQUNDLGFBQWEsR0FBR0Q7SUFDdkI7SUFFQUUseUJBQXlCQyxPQUErQixFQUFXO1FBQ2pFLE9BQU9BLFFBQVFDLHFCQUFxQixJQUFJLElBQUksQ0FBQ0gsYUFBYTtJQUM1RDtBQUNGO0FBRUE7O0NBRUMsR0FDTSxNQUFNSTtJQUdYTixZQUFZTyx1QkFBK0IsS0FBSyxDQUFFO1FBQ2hELFVBQVU7UUFDVixJQUFJLENBQUNDLGVBQWUsR0FBR0Q7SUFDekI7SUFFQUoseUJBQXlCQyxPQUErQixFQUFXO1FBQ2pFLElBQUksQ0FBQ0EsUUFBUUssd0JBQXdCLEVBQUU7WUFDckMscUJBQXFCO1lBQ3JCLE9BQU87UUFDVDtRQUVBLE1BQU1DLGNBQWNOLFFBQVFPLGVBQWUsQ0FBQ0MsTUFBTTtRQUNsRCxNQUFNQyxhQUFhQyxLQUFLQyxHQUFHLENBQUNMLGNBQWNOLFFBQVFLLHdCQUF3QjtRQUUxRSxtQkFBbUI7UUFDbkIsT0FBT0ksY0FBYyxJQUFJLENBQUNMLGVBQWU7SUFDM0M7QUFDRjtBQUVBOztDQUVDLEdBQ00sTUFBTVE7SUFHWGhCLFlBQVlpQixnQkFBd0IsRUFBRSxDQUFFO1FBQ3RDLFVBQVU7UUFDVixJQUFJLENBQUNBLGFBQWEsR0FBR0E7SUFDdkI7SUFFQWQseUJBQXlCQyxPQUErQixFQUFXO1FBQ2pFLE9BQU9BLFFBQVFjLFNBQVMsSUFBSSxJQUFJLENBQUNELGFBQWE7SUFDaEQ7QUFDRjtBQUVBOztDQUVDLEdBQ00sTUFBTUU7SUFHWG5CLFlBQVlvQixVQUFxQyxDQUFFO1FBQ2pELElBQUksQ0FBQ0EsVUFBVSxHQUFHQTtJQUNwQjtJQUVBLE1B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Q3JEO1FBQ3ZCLElBQUksQ0FBQ2hCLGlCQUFpQixDQUFDcUUsTUFBTSxDQUFDckQ7UUFDOUIsSUFBSSxDQUFDZixpQkFBaUIsQ0FBQ29FLE1BQU0sQ0FBQ3JEO0lBQ2hDO0FBQ0Y7QUFuVmFyQixvQkFBQUEsb0VBQUFBO0lBRFo1QixvREFBVUE7SUFZTkMsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDO0lBQ1BBLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQzs7O2VBRG9DLDBEQUFXLDRCQUFYLDBEQUFXO2VBQ0gsdUVBQWUsNEJBQWYsdUVBQWU7O0dBWjFEMkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvc2VydmljZXMvc25hcHNob3Qtc2NoZWR1bGVyLnNlcnZpY2UudHM/ZWJhNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgeyBEb2N1bWVudERBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LmRhbyc7XG5pbXBvcnQgeyBTbmFwc2hvdFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL3NuYXBzaG90LnNlcnZpY2UnO1xuXG4vKipcbiAqIOW/q+eFp+eJiOacrOexu+Wei+WIpOaWreetlueVpeaOpeWPo1xuICog55So5LqO5Yik5pat5piv5ZCm5bqU6K+l5Yib5bu65aSn54mI5pys5b+r54WnXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU25hcHNob3RWZXJzaW9uU3RyYXRlZ3kge1xuICAvKipcbiAgICog5Yik5pat5piv5ZCm5bqU6K+l5Yib5bu65aSn54mI5pys5b+r54WnXG4gICAqIEBwYXJhbSBjb250ZXh0IOWIpOaWreS4iuS4i+aWh1xuICAgKiBAcmV0dXJucyB0cnVlIOihqOekuuW6lOivpeWIm+W7uuWkp+eJiOacrO+8jGZhbHNlIOihqOekuuWIm+W7uuWwj+eJiOacrFxuICAgKi9cbiAgc2hvdWxkQ3JlYXRlTWFqb3JWZXJzaW9uKGNvbnRleHQ6IFNuYXBzaG90VmVyc2lvbkNvbnRleHQpOiBib29sZWFuIHwgUHJvbWlzZTxib29sZWFuPjtcbn1cblxuLyoqXG4gKiDlv6vnhafniYjmnKzliKTmlq3kuIrkuIvmlodcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTbmFwc2hvdFZlcnNpb25Db250ZXh0IHtcbiAgb2JqZWN0SWQ6IHN0cmluZztcbiAgd29ya3NwYWNlSWQ6IHN0cmluZztcbiAgY3VycmVudERvY1N0YXRlOiBCdWZmZXI7IC8vIOW9k+WJjeaWh+aho+eKtuaAgVxuICBjdXJyZW50VGltZTogbnVtYmVyOyAvLyDlvZPliY3ml7bpl7TmiLNcbiAgZWRpdENvdW50OiBudW1iZXI7IC8vIOiHquS4iuasoeW/q+eFp+S7peadpeeahOe8lui+keasoeaVsFxuICB0aW1lU2luY2VMYXN0U25hcHNob3Q6IG51bWJlcjsgLy8g6Led56a75LiK5qyh5b+r54Wn55qE5pe26Ze077yI5q+r56eS77yJXG4gIGxhc3RTbmFwc2hvdERvY1N0YXRlU2l6ZT86IG51bWJlcjsgLy8g5LiK5qyh5b+r54Wn55qE5paH5qGj54q25oCB5aSn5bCP77yI5a2X6IqC77yJXG4gIGxhc3RTbmFwc2hvdFRpbWU/OiBudW1iZXI7IC8vIOS4iuasoeW/q+eFp+eahOaXtumXtOaIs1xufVxuXG4vKipcbiAqIOaXtumXtOmXtOmalOetlueVpe+8muWmguaenOi3neemu+S4iuasoeW/q+eFp+i2hei/h+aMh+WumuaXtumXtO+8jOWIm+W7uuWkp+eJiOacrFxuICovXG5leHBvcnQgY2xhc3MgVGltZUludGVydmFsU3RyYXRlZ3kgaW1wbGVtZW50cyBTbmFwc2hvdFZlcnNpb25TdHJhdGVneSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgdGltZVRocmVzaG9sZDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKHRpbWVUaHJlc2hvbGRNczogbnVtYmVyID0gMzAwMDAwKSB7XG4gICAgLy8g6buY6K6kIDUg5YiG6ZKf77yIMzAwMDAwIOavq+enku+8iVxuICAgIHRoaXMudGltZVRocmVzaG9sZCA9IHRpbWVUaHJlc2hvbGRNcztcbiAgfVxuXG4gIHNob3VsZENyZWF0ZU1ham9yVmVyc2lvbihjb250ZXh0OiBTbmFwc2hvdFZlcnNpb25Db250ZXh0KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGNvbnRleHQudGltZVNpbmNlTGFzdFNuYXBzaG90ID49IHRoaXMudGltZVRocmVzaG9sZDtcbiAgfVxufVxuXG4vKipcbiAqIOWGheWuueWPmOWMluetlueVpe+8muWmguaenOWGheWuueWPmOWMluW+iOWkp++8jOWIm+W7uuWkp+eJiOacrFxuICovXG5leHBvcnQgY2xhc3MgQ29udGVudENoYW5nZVN0cmF0ZWd5IGltcGxlbWVudHMgU25hcHNob3RWZXJzaW9uU3RyYXRlZ3kge1xuICBwcml2YXRlIHJlYWRvbmx5IGNoYW5nZVRocmVzaG9sZDogbnVtYmVyOyAvLyDlj5jljJbpmIjlgLzvvIjlrZfoioLvvIlcblxuICBjb25zdHJ1Y3RvcihjaGFuZ2VUaHJlc2hvbGRCeXRlczogbnVtYmVyID0gMTAwMDApIHtcbiAgICAvLyDpu5jorqQgMTBLQlxuICAgIHRoaXMuY2hhbmdlVGhyZXNob2xkID0gY2hhbmdlVGhyZXNob2xkQnl0ZXM7XG4gIH1cblxuICBzaG91bGRDcmVhdGVNYWpvclZlcnNpb24oY29udGV4dDogU25hcHNob3RWZXJzaW9uQ29udGV4dCk6IGJvb2xlYW4ge1xuICAgIGlmICghY29udGV4dC5sYXN0U25hcHNob3REb2NTdGF0ZVNpemUpIHtcbiAgICAgIC8vIOWmguaenOayoeacieS4iuasoeW/q+eFp++8jOS4jeWfuuS6juWGheWuueWPmOWMluWIpOaWrVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRTaXplID0gY29udGV4dC5jdXJyZW50RG9jU3RhdGUubGVuZ3RoO1xuICAgIGNvbnN0IHNpemVDaGFuZ2UgPSBNYXRoLmFicyhjdXJyZW50U2l6ZSAtIGNvbnRleHQubGFzdFNuYXBzaG90RG9jU3RhdGVTaXplKTtcblxuICAgIC8vIOWmguaenOWGheWuueWPmOWMlui2hei/h+mYiOWAvO+8jOWIm+W7uuWkp+eJiOacrFxuICAgIHJldHVybiBzaXplQ2hhbmdlID49IHRoaXMuY2hhbmdlVGhyZXNob2xkO1xuICB9XG59XG5cbi8qKlxuICog5Y+Y5pu06aKR5qyh562W55Wl77ya5aaC5p6c5Y+Y5pu06aKR5qyh6LaF6L+H6ZiI5YC877yM5Yib5bu65aSn54mI5pysXG4gKi9cbmV4cG9ydCBjbGFzcyBFZGl0RnJlcXVlbmN5U3RyYXRlZ3kgaW1wbGVtZW50cyBTbmFwc2hvdFZlcnNpb25TdHJhdGVneSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgZWRpdFRocmVzaG9sZDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKGVkaXRUaHJlc2hvbGQ6IG51bWJlciA9IDUwKSB7XG4gICAgLy8g6buY6K6kIDUwIOasoVxuICAgIHRoaXMuZWRpdFRocmVzaG9sZCA9IGVkaXRUaHJlc2hvbGQ7XG4gIH1cblxuICBzaG91bGRDcmVhdGVNYWpvclZlcnNpb24oY29udGV4dDogU25hcHNob3RWZXJzaW9uQ29udGV4dCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBjb250ZXh0LmVkaXRDb3VudCA+PSB0aGlzLmVkaXRUaHJlc2hvbGQ7XG4gIH1cbn1cblxuLyoqXG4gKiDnu4TlkIjnrZbnlaXvvJrlpJrkuKrnrZbnlaXkuK3ku7vmhI/kuIDkuKrmu6HotrPmnaHku7blsLHliJvlu7rlpKfniYjmnKxcbiAqL1xuZXhwb3J0IGNsYXNzIENvbXBvc2l0ZU9yU3RyYXRlZ3kgaW1wbGVtZW50cyBTbmFwc2hvdFZlcnNpb25TdHJhdGVneSB7XG4gIHByaXZhdGUgc3RyYXRlZ2llczogU25hcHNob3RWZXJzaW9uU3RyYXRlZ3lbXTtcblxuICBjb25zdHJ1Y3RvcihzdHJhdGVnaWVzOiBTbmFwc2hvdFZlcnNpb25TdHJhdGVneVtdKSB7XG4gICAgdGhpcy5zdHJhdGVnaWVzID0gc3RyYXRlZ2llcztcbiAgfVxuXG4gIGFzeW5jIHNob3VsZENyZWF0ZU1ham9yVmVyc2lvbihjb250ZXh0OiBTbmFwc2hvdFZlcnNpb25Db250ZXh0KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgZm9yIChjb25zdCBzdHJhdGVneSBvZiB0aGlzLnN0cmF0ZWdpZXMpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN0cmF0ZWd5LnNob3VsZENyZWF0ZU1ham9yVmVyc2lvbihjb250ZXh0KTtcbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIOW/q+eFp+iwg+W6puWZqFxuICog6LSf6LSj5a6a5pyf5Yib5bu65paH5qGj5b+r54Wn77yM6ICM5LiN5piv5q+P5qyh5L+d5a2Y6YO95Yib5bu6XG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBTbmFwc2hvdFNjaGVkdWxlciB7XG4gIHByaXZhdGUgZWRpdENvdW50czogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTsgLy8gb2JqZWN0SWQgLT4gZWRpdENvdW50XG4gIHByaXZhdGUgbGFzdFNuYXBzaG90VGltZXM6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwKCk7IC8vIG9iamVjdElkIC0+IGxhc3RTbmFwc2hvdFRpbWVcbiAgcHJpdmF0ZSBsYXN0U25hcHNob3RTaXplczogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTsgLy8gb2JqZWN0SWQgLT4gbGFzdFNuYXBzaG90U2l6ZVxuXG4gIC8vIOetlueVpemFjee9rlxuICBwcml2YXRlIHJlYWRvbmx5IHZlcnNpb25TdHJhdGVneTogU25hcHNob3RWZXJzaW9uU3RyYXRlZ3k7XG4gIHByaXZhdGUgcmVhZG9ubHkgRURJVFNfVEhSRVNIT0xEID0gcGFyc2VJbnQocHJvY2Vzcy5lbnYuU05BUFNIT1RfRURJVFNfVEhSRVNIT0xEIHx8ICcxMCcsIDEwKTtcbiAgcHJpdmF0ZSByZWFkb25seSBUSU1FX1RIUkVTSE9MRCA9IHBhcnNlSW50KHByb2Nlc3MuZW52LlNOQVBTSE9UX1RJTUVfVEhSRVNIT0xEIHx8ICczMDAwMDAnLCAxMCk7IC8vIDXliIbpkp9cblxuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdEb2N1bWVudERBTycpIHByaXZhdGUgZG9jdW1lbnREQU86IERvY3VtZW50REFPLFxuICAgIEBpbmplY3QoJ1NuYXBzaG90U2VydmljZScpIHByaXZhdGUgc25hcHNob3RTZXJ2aWNlOiBTbmFwc2hvdFNlcnZpY2VcbiAgKSB7XG4gICAgLy8g5Yid5aeL5YyW57uE5ZCI562W55Wl77ya5pe26Ze06Ze06ZqU44CB5YaF5a655Y+Y5YyW44CB5Y+Y5pu06aKR5qyhXG4gICAgY29uc3QgdGltZVN0cmF0ZWd5ID0gbmV3IFRpbWVJbnRlcnZhbFN0cmF0ZWd5KHRoaXMuVElNRV9USFJFU0hPTEQpO1xuICAgIGNvbnN0IGNvbnRlbnRTdHJhdGVneSA9IG5ldyBDb250ZW50Q2hhbmdlU3RyYXRlZ3koXG4gICAgICBwYXJzZUludChwcm9jZXNzLmVudi5TTkFQU0hPVF9DT05URU5UX0NIQU5HRV9USFJFU0hPTEQgfHwgJzEwMDAwJywgMTApXG4gICAgKTtcbiAgICBjb25zdCBmcmVxdWVuY3lTdHJhdGVneSA9IG5ldyBFZGl0RnJlcXVlbmN5U3RyYXRlZ3koXG4gICAgICBwYXJzZUludChwcm9jZXNzLmVudi5TTkFQU0hPVF9FRElUX0ZSRVFVRU5DWV9USFJFU0hPTEQgfHwgJzUwJywgMTApXG4gICAgKTtcblxuICAgIHRoaXMudmVyc2lvblN0cmF0ZWd5ID0gbmV3IENvbXBvc2l0ZU9yU3RyYXRlZ3koW1xuICAgICAgdGltZVN0cmF0ZWd5LFxuICAgICAgY29udGVudFN0cmF0ZWd5LFxuICAgICAgZnJlcXVlbmN5U3RyYXRlZ3ksXG4gICAgXSk7XG4gIH1cblxuICAvKipcbiAgICog6K6w5b2V5LiA5qyh57yW6L6RXG4gICAqIEBwYXJhbSBvYmplY3RJZCDmlofmoaMgSURcbiAgICogQHBhcmFtIHdvcmtzcGFjZUlkIOW3peS9nOepuumXtCBJRFxuICAgKiBAcGFyYW0gZG9jU3RhdGUg5paH5qGj54q25oCB77yIWS5lbmNvZGVTdGF0ZUFzVXBkYXRl77yJXG4gICAqIEBwYXJhbSBzbmFwc2hvdCBZanMgU25hcHNob3TvvIjlj6/pgInvvIlcbiAgICogQHJldHVybnMg5aaC5p6c5Yib5bu65LqG5b+r54Wn77yM6L+U5Zue5b+r54Wn5L+h5oGv77yb5ZCm5YiZ6L+U5ZueIG51bGxcbiAgICovXG4gIGFzeW5jIHJlY29yZEVkaXQoXG4gICAgb2JqZWN0SWQ6IHN0cmluZyxcbiAgICB3b3Jrc3BhY2VJZDogc3RyaW5nLFxuICAgIGRvY1N0YXRlOiBCdWZmZXIsXG4gICAgc25hcHNob3Q/OiBCdWZmZXJcbiAgKTogUHJvbWlzZTx7IHNuYXBzaG90X2lkOiBzdHJpbmc7IGNyZWF0ZWRfYXQ6IG51bWJlcjsgdmVyc2lvbl90eXBlOiAnbWFqb3InIHwgJ21pbm9yJyB9IHwgbnVsbD4ge1xuICAgIGNvbnN0IGtleSA9IG9iamVjdElkO1xuICAgIGNvbnN0IGVkaXRDb3VudCA9ICh0aGlzLmVkaXRDb3VudHMuZ2V0KGtleSkgfHwgMCkgKyAxO1xuICAgIHRoaXMuZWRpdENvdW50cy5zZXQoa2V5LCBlZGl0Q291bnQpO1xuXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgbGFzdFNuYXBzaG90VGltZSA9IHRoaXMubGFzdFNuYXBzaG90VGltZXMuZ2V0KGtleSk7XG4gICAgbGV0IGxhc3RTbmFwc2hvdFNpemUgPSB0aGlzLmxhc3RTbmFwc2hvdFNpemVzLmdldChrZXkpO1xuXG4gICAgLy8g5aaC5p6c5YaF5a2Y5Lit5rKh5pyJ6K6w5b2V77yM5LuO5pWw5o2u5bqT5p+l6K+i5pyA5ZCO5LiA5Liq5b+r54Wn55qE5L+h5oGvXG4gICAgaWYgKCFsYXN0U25hcHNob3RUaW1lIHx8IGxhc3RTbmFwc2hvdFNpemUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbGF0ZXN0U25hcHNob3QgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmdldExhdGVzdFNuYXBzaG90KG9iamVjdElkKTtcbiAgICAgICAgaWYgKGxhdGVzdFNuYXBzaG90KSB7XG4gICAgICAgICAgbGFzdFNuYXBzaG90VGltZSA9IGxhdGVzdFNuYXBzaG90LmNyZWF0ZWRfYXQ7XG4gICAgICAgICAgbGFzdFNuYXBzaG90U2l6ZSA9IGxhdGVzdFNuYXBzaG90LmRvY19zdGF0ZT8ubGVuZ3RoIHx8IDA7XG4gICAgICAgICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5zZXQoa2V5LCBsYXN0U25hcHNob3RUaW1lKTtcbiAgICAgICAgICB0aGlzLmxhc3RTbmFwc2hvdFNpemVzLnNldChrZXksIGxhc3RTbmFwc2hvdFNpemUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOWmguaenOayoeacieW/q+eFp++8jOWwneivleS9v+eUqOaWh+aho+eahOWIm+W7uuaXtumXtOS9nOS4uuWfuuWHhlxuICAgICAgICAgIC8vIOi/meagt+WPr+S7peehruS/neWNs+S9v+ayoeacieW/q+eFp++8jOS5n+iDveato+ehruiuoeeul+aXtumXtOmXtOmalFxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZmluZEJ5SWQob2JqZWN0SWQpO1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50ICYmIGRvY3VtZW50LmNyZWF0ZWRfYXQpIHtcbiAgICAgICAgICAgICAgLy8g5paH5qGj5Yib5bu65pe26Ze077yI6L2s5o2i5Li65q+r56eS5pe26Ze05oiz77yJXG4gICAgICAgICAgICAgIGNvbnN0IGRvY0NyZWF0ZWRBdCA9XG4gICAgICAgICAgICAgICAgdHlwZW9mIGRvY3VtZW50LmNyZWF0ZWRfYXQgPT09ICdzdHJpbmcnXG4gICAgICAgICAgICAgICAgICA/IG5ldyBEYXRlKGRvY3VtZW50LmNyZWF0ZWRfYXQpLmdldFRpbWUoKVxuICAgICAgICAgICAgICAgICAgOiBkb2N1bWVudC5jcmVhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZVxuICAgICAgICAgICAgICAgICAgPyBkb2N1bWVudC5jcmVhdGVkX2F0LmdldFRpbWUoKVxuICAgICAgICAgICAgICAgICAgOiBkb2N1bWVudC5jcmVhdGVkX2F0O1xuICAgICAgICAgICAgICBsYXN0U25hcHNob3RUaW1lID0gZG9jQ3JlYXRlZEF0O1xuICAgICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gZG9jdW1lbnQuY29udGVudF9sZW5ndGggfHwgMDtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgICAgYFtTbmFwc2hvdFNjaGVkdWxlcl0gTm8gc25hcHNob3QgZm91bmQsIHVzaW5nIGRvY3VtZW50IGNyZWF0ZWRfYXQ6ICR7bGFzdFNuYXBzaG90VGltZX1gXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyDlpoLmnpzov57mlofmoaPpg73mib7kuI3liLDvvIzorr7nva7kuLowXG4gICAgICAgICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSAwO1xuICAgICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChkb2NFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGdldCBkb2N1bWVudCBmb3IgJHtvYmplY3RJZH06YCwgZG9jRXJyb3IpO1xuICAgICAgICAgICAgbGFzdFNuYXBzaG90VGltZSA9IDA7XG4gICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5zZXQoa2V5LCBsYXN0U25hcHNob3RUaW1lKTtcbiAgICAgICAgICB0aGlzLmxhc3RTbmFwc2hvdFNpemVzLnNldChrZXksIGxhc3RTbmFwc2hvdFNpemUpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZ2V0IGxhdGVzdCBzbmFwc2hvdCBmb3IgJHtvYmplY3RJZH06YCwgZXJyb3IpO1xuICAgICAgICBsYXN0U25hcHNob3RUaW1lID0gMDtcbiAgICAgICAgbGFzdFNuYXBzaG90U2l6ZSA9IDA7XG4gICAgICAgIHRoaXMubGFzdFNuYXBzaG90VGltZXMuc2V0KGtleSwgMCk7XG4gICAgICAgIHRoaXMubGFzdFNuYXBzaG90U2l6ZXMuc2V0KGtleSwgMCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgdGltZVNpbmNlTGFzdFNuYXBzaG90ID0gbm93IC0gbGFzdFNuYXBzaG90VGltZTtcblxuICAgIC8vIOWIpOaWreaYr+WQpumcgOimgeWIm+W7uuW/q+eFp1xuICAgIC8vIOWmguaenOaXtumXtOmXtOmalOi2hei/h+mYiOWAvO+8jOWNs+S9v+e8lui+keasoeaVsOS4jeWkn++8jOS5n+W6lOivpeWIm+W7uuW/q+eFp1xuICAgIC8vIOi/meagt+WPr+S7peehruS/nemVv+aXtumXtOS4jee8lui+keeahOaWh+aho+S5n+iDveWumuacn+WIm+W7uuW/q+eFp1xuICAgIGNvbnN0IHNob3VsZENyZWF0ZVNuYXBzaG90ID1cbiAgICAgIGVkaXRDb3VudCA+PSB0aGlzLkVESVRTX1RIUkVTSE9MRCB8fCB0aW1lU2luY2VMYXN0U25hcHNob3QgPj0gdGhpcy5USU1FX1RIUkVTSE9MRDtcblxuICAgIGNvbnNvbGUubG9nKGBbU25hcHNob3RTY2hlZHVsZXJdIHJlY29yZEVkaXQgZm9yICR7b2JqZWN0SWR9OmAsIHtcbiAgICAgIGVkaXRDb3VudCxcbiAgICAgIHRpbWVTaW5jZUxhc3RTbmFwc2hvdCxcbiAgICAgIHRpbWVTaW5jZUxhc3RTbmFwc2hvdE1pbnV0ZXM6IE1hdGgucm91bmQodGltZVNpbmNlTGFzdFNuYXBzaG90IC8gNjAwMDApLFxuICAgICAgc2hvdWxkQ3JlYXRlU25hcHNob3QsXG4gICAgICBFRElUU19USFJFU0hPTEQ6IHRoaXMuRURJVFNfVEhSRVNIT0xELFxuICAgICAgVElNRV9USFJFU0hPTEQ6IHRoaXMuVElNRV9USFJFU0hPTEQsXG4gICAgfSk7XG5cbiAgICBpZiAoc2hvdWxkQ3JlYXRlU25hcHNob3QpIHtcbiAgICAgIC8vIOS9v+eUqOetlueVpeWIpOaWreeJiOacrOexu+Wei1xuICAgICAgY29uc3QgY29udGV4dDogU25hcHNob3RWZXJzaW9uQ29udGV4dCA9IHtcbiAgICAgICAgb2JqZWN0SWQsXG4gICAgICAgIHdvcmtzcGFjZUlkLFxuICAgICAgICBjdXJyZW50RG9jU3RhdGU6IGRvY1N0YXRlLFxuICAgICAgICBjdXJyZW50VGltZTogbm93LFxuICAgICAgICBlZGl0Q291bnQsXG4gICAgICAgIHRpbWVTaW5jZUxhc3RTbmFwc2hvdCxcbiAgICAgICAgbGFzdFNuYXBzaG90RG9jU3RhdGVTaXplOiBsYXN0U25hcHNob3RTaXplLFxuICAgICAgICBsYXN0U25hcHNob3RUaW1lLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgaXNNYWpvciA9IGF3YWl0IHRoaXMudmVyc2lvblN0cmF0ZWd5LnNob3VsZENyZWF0ZU1ham9yVmVyc2lvbihjb250ZXh0KTtcbiAgICAgIGNvbnN0IHZlcnNpb25UeXBlOiAnbWFqb3InIHwgJ21pbm9yJyA9IGlzTWFqb3IgPyAnbWFqb3InIDogJ21pbm9yJztcblxuICAgICAgY29uc29sZS5sb2coYFtTbmFwc2hvdFNjaGVkdWxlcl0gQ3JlYXRpbmcgJHt2ZXJzaW9uVHlwZX0gc25hcHNob3QgZm9yICR7b2JqZWN0SWR9YCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY3JlYXRlU25hcHNob3QoXG4gICAgICAgIG9iamVjdElkLFxuICAgICAgICB3b3Jrc3BhY2VJZCxcbiAgICAgICAgZG9jU3RhdGUsXG4gICAgICAgIHNuYXBzaG90LFxuICAgICAgICB2ZXJzaW9uVHlwZVxuICAgICAgKTtcblxuICAgICAgLy8g6YeN572u6K6h5pWw5ZKM5pe26Ze0XG4gICAgICB0aGlzLmVkaXRDb3VudHMuc2V0KGtleSwgMCk7XG4gICAgICB0aGlzLmxhc3RTbmFwc2hvdFRpbWVzLnNldChrZXksIG5vdyk7XG4gICAgICB0aGlzLmxhc3RTbmFwc2hvdFNpemVzLnNldChrZXksIGRvY1N0YXRlLmxlbmd0aCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGBbU25hcHNob3RTY2hlZHVsZXJdIFNuYXBzaG90IGNyZWF0ZWQ6YCwge1xuICAgICAgICBzbmFwc2hvdF9pZDogcmVzdWx0LnNuYXBzaG90X2lkLFxuICAgICAgICB2ZXJzaW9uX3R5cGU6IHZlcnNpb25UeXBlLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgdmVyc2lvbl90eXBlOiB2ZXJzaW9uVHlwZSxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuW/q+eFp1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVTbmFwc2hvdChcbiAgICBvYmplY3RJZDogc3RyaW5nLFxuICAgIHdvcmtzcGFjZUlkOiBzdHJpbmcsXG4gICAgZG9jU3RhdGU6IEJ1ZmZlcixcbiAgICBzbmFwc2hvdD86IEJ1ZmZlcixcbiAgICB2ZXJzaW9uVHlwZTogJ21ham9yJyB8ICdtaW5vcicgPSAnbWFqb3InXG4gICk6IFByb21pc2U8eyBzbmFwc2hvdF9pZDogc3RyaW5nOyBjcmVhdGVkX2F0OiBudW1iZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyDkvb/nlKggU25hcHNob3RTZXJ2aWNlIOWIm+W7uuW/q+eFp1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zbmFwc2hvdFNlcnZpY2UuY3JlYXRlU25hcHNob3Qoe1xuICAgICAgICB3b3Jrc3BhY2VJZCxcbiAgICAgICAgb2JqZWN0SWQsXG4gICAgICAgIGRvY1N0YXRlLFxuICAgICAgICBzbmFwc2hvdCxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBhdXRvX3NhdmU6IHZlcnNpb25UeXBlID09PSAnbWFqb3InLFxuICAgICAgICAgIGRvY19zdGF0ZV9sZW5ndGg6IGRvY1N0YXRlLmxlbmd0aCxcbiAgICAgICAgICB2ZXJzaW9uX3R5cGU6IHZlcnNpb25UeXBlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIOWcqOaVsOaNruW6k+S4reiusOW9leW/q+eFp+WFg+aVsOaNrlxuICAgICAgY29uc29sZS5sb2coYFtTbmFwc2hvdFNjaGVkdWxlcl0gU2F2aW5nIHNuYXBzaG90IHRvIGRhdGFiYXNlOmAsIHtcbiAgICAgICAgb2JqZWN0X2lkOiBvYmplY3RJZCxcbiAgICAgICAgd29ya3NwYWNlX2lkOiB3b3Jrc3BhY2VJZCxcbiAgICAgICAgdmVyc2lvbl90eXBlOiB2ZXJzaW9uVHlwZSxcbiAgICAgICAgZG9jX3N0YXRlX2xlbmd0aDogZG9jU3RhdGUubGVuZ3RoLFxuICAgICAgICBzbmFwc2hvdF9sZW5ndGg6IHNuYXBzaG90Py5sZW5ndGggfHwgMCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzbmFwc2hvdFJlY29yZCA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uY3JlYXRlU25hcHNob3Qoe1xuICAgICAgICBvYmplY3RfaWQ6IG9iamVjdElkLFxuICAgICAgICB3b3Jrc3BhY2VfaWQ6IHdvcmtzcGFjZUlkLFxuICAgICAgICBzbmFwc2hvdF9kYXRhOiBzbmFwc2hvdCB8fCBCdWZmZXIuYWxsb2MoMCksIC8vIFNuYXBzaG9077yI54q25oCB5ZCR6YeP77yJXG4gICAgICAgIHNuYXBzaG90X3ZlcnNpb246IDEsXG4gICAgICAgIGRvY19zdGF0ZTogZG9jU3RhdGUsIC8vIERvYyBTdGF0Ze+8iOWujOaVtOeKtuaAge+8iVxuICAgICAgICBkb2Nfc3RhdGVfdmVyc2lvbjogMSxcbiAgICAgICAgdmVyc2lvbl90eXBlOiB2ZXJzaW9uVHlwZSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBzbmFwc2hvdF9pZDogcmVzdWx0LnNuYXBzaG90SWQsXG4gICAgICAgICAgY3JlYXRlZF9hdDogcmVzdWx0LmNyZWF0ZWRBdCxcbiAgICAgICAgICBzdG9yZWRfaW46ICdmaWxlJywgLy8g5a2Y5YKo5Zyo5paH5Lu257O757uf5LitXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc29sZS5sb2coYFtTbmFwc2hvdFNjaGVkdWxlcl0gU25hcHNob3QgcmVjb3JkIHNhdmVkIHRvIGRhdGFiYXNlOmAsIHtcbiAgICAgICAgc25hcHNob3RfaWQ6IHNuYXBzaG90UmVjb3JkLnNuYXBzaG90X2lkLFxuICAgICAgICBvYmplY3RfaWQ6IG9iamVjdElkLFxuICAgICAgICB2ZXJzaW9uX3R5cGU6IHZlcnNpb25UeXBlLFxuICAgICAgICBjcmVhdGVkX2F0OiBzbmFwc2hvdFJlY29yZC5jcmVhdGVkX2F0LFxuICAgICAgICBkYl9jcmVhdGVkX2F0X3R5cGU6IHR5cGVvZiBzbmFwc2hvdFJlY29yZC5jcmVhdGVkX2F0LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNuYXBzaG90X2lkOiBzbmFwc2hvdFJlY29yZC5zbmFwc2hvdF9pZCxcbiAgICAgICAgY3JlYXRlZF9hdDogcmVzdWx0LmNyZWF0ZWRBdCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgc25hcHNob3QgZm9yIGRvY3VtZW50ICR7b2JqZWN0SWR9OmAsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmiYvliqjop6blj5Hlv6vnhafliJvlu7rvvIjnlKjkuo7miYvliqjkv53lrZjvvIlcbiAgICog5Lya5qC55o2u562W55Wl5Yik5pat5Yib5bu65aSn54mI5pys6L+Y5piv5bCP54mI5pysXG4gICAqIEBwYXJhbSBmb3JjZU1ham9yVmVyc2lvbiDmmK/lkKblvLrliLbliJvlu7rlpKfniYjmnKzvvIjnlKjkuo7liJ3lp4vlv6vnhafnrYnlnLrmma/vvIlcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVNuYXBzaG90TWFudWFsbHkoXG4gICAgb2JqZWN0SWQ6IHN0cmluZyxcbiAgICB3b3Jrc3BhY2VJZDogc3RyaW5nLFxuICAgIGRvY1N0YXRlOiBCdWZmZXIsXG4gICAgc25hcHNob3Q/OiBCdWZmZXIsXG4gICAgZm9yY2VNYWpvclZlcnNpb246IGJvb2xlYW4gPSBmYWxzZVxuICApOiBQcm9taXNlPHsgc25hcHNob3RfaWQ6IHN0cmluZzsgY3JlYXRlZF9hdDogbnVtYmVyOyB2ZXJzaW9uX3R5cGU6ICdtYWpvcicgfCAnbWlub3InIH0+IHtcbiAgICBjb25zdCBrZXkgPSBvYmplY3RJZDtcbiAgICBjb25zdCBlZGl0Q291bnQgPSB0aGlzLmVkaXRDb3VudHMuZ2V0KGtleSkgfHwgMDtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG4gICAgbGV0IGxhc3RTbmFwc2hvdFRpbWUgPSB0aGlzLmxhc3RTbmFwc2hvdFRpbWVzLmdldChrZXkpO1xuICAgIGxldCBsYXN0U25hcHNob3RTaXplID0gdGhpcy5sYXN0U25hcHNob3RTaXplcy5nZXQoa2V5KTtcblxuICAgIC8vIOWmguaenOWGheWtmOS4reayoeacieiusOW9le+8jOS7juaVsOaNruW6k+afpeivolxuICAgIGlmICghbGFzdFNuYXBzaG90VGltZSB8fCBsYXN0U25hcHNob3RTaXplID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGxhdGVzdFNuYXBzaG90ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5nZXRMYXRlc3RTbmFwc2hvdChvYmplY3RJZCk7XG4gICAgICAgIGlmIChsYXRlc3RTbmFwc2hvdCkge1xuICAgICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSBsYXRlc3RTbmFwc2hvdC5jcmVhdGVkX2F0O1xuICAgICAgICAgIGxhc3RTbmFwc2hvdFNpemUgPSBsYXRlc3RTbmFwc2hvdC5kb2Nfc3RhdGU/Lmxlbmd0aCB8fCAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOWmguaenOayoeacieW/q+eFp++8jOWwneivleS9v+eUqOaWh+aho+eahOWIm+W7uuaXtumXtOS9nOS4uuWfuuWHhlxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZmluZEJ5SWQob2JqZWN0SWQpO1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50ICYmIGRvY3VtZW50LmNyZWF0ZWRfYXQpIHtcbiAgICAgICAgICAgICAgY29uc3QgZG9jQ3JlYXRlZEF0ID1cbiAgICAgICAgICAgICAgICB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlZF9hdCA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgICAgID8gbmV3IERhdGUoZG9jdW1lbnQuY3JlYXRlZF9hdCkuZ2V0VGltZSgpXG4gICAgICAgICAgICAgICAgICA6IGRvY3VtZW50LmNyZWF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlXG4gICAgICAgICAgICAgICAgICA/IGRvY3VtZW50LmNyZWF0ZWRfYXQuZ2V0VGltZSgpXG4gICAgICAgICAgICAgICAgICA6IGRvY3VtZW50LmNyZWF0ZWRfYXQ7XG4gICAgICAgICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSBkb2NDcmVhdGVkQXQ7XG4gICAgICAgICAgICAgIGxhc3RTbmFwc2hvdFNpemUgPSBkb2N1bWVudC5jb250ZW50X2xlbmd0aCB8fCAwO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICBgW1NuYXBzaG90U2NoZWR1bGVyXSBObyBzbmFwc2hvdCBmb3VuZCwgdXNpbmcgZG9jdW1lbnQgY3JlYXRlZF9hdDogJHtsYXN0U25hcHNob3RUaW1lfWBcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSAwO1xuICAgICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChkb2NFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGdldCBkb2N1bWVudCBmb3IgJHtvYmplY3RJZH06YCwgZG9jRXJyb3IpO1xuICAgICAgICAgICAgbGFzdFNuYXBzaG90VGltZSA9IDA7XG4gICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBnZXQgbGF0ZXN0IHNuYXBzaG90IGZvciAke29iamVjdElkfTpgLCBlcnJvcik7XG4gICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSAwO1xuICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCB0aW1lU2luY2VMYXN0U25hcHNob3QgPSBub3cgLSAobGFzdFNuYXBzaG90VGltZSB8fCAwKTtcblxuICAgIC8vIOWIpOaWreeJiOacrOexu+Wei1xuICAgIGxldCB2ZXJzaW9uVHlwZTogJ21ham9yJyB8ICdtaW5vcic7XG5cbiAgICBpZiAoZm9yY2VNYWpvclZlcnNpb24pIHtcbiAgICAgIC8vIOW8uuWItuWIm+W7uuWkp+eJiOacrO+8iOeUqOS6juWIneWni+W/q+eFp+etieWcuuaZr++8iVxuICAgICAgdmVyc2lvblR5cGUgPSAnbWFqb3InO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyDkvb/nlKjnrZbnlaXliKTmlq3niYjmnKznsbvlnotcbiAgICAgIGNvbnN0IGNvbnRleHQ6IFNuYXBzaG90VmVyc2lvbkNvbnRleHQgPSB7XG4gICAgICAgIG9iamVjdElkLFxuICAgICAgICB3b3Jrc3BhY2VJZCxcbiAgICAgICAgY3VycmVudERvY1N0YXRlOiBkb2NTdGF0ZSxcbiAgICAgICAgY3VycmVudFRpbWU6IG5vdyxcbiAgICAgICAgZWRpdENvdW50LFxuICAgICAgICB0aW1lU2luY2VMYXN0U25hcHNob3QsXG4gICAgICAgIGxhc3RTbmFwc2hvdERvY1N0YXRlU2l6ZTogbGFzdFNuYXBzaG90U2l6ZSxcbiAgICAgICAgbGFzdFNuYXBzaG90VGltZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGlzTWFqb3IgPSBhd2FpdCB0aGlzLnZlcnNpb25TdHJhdGVneS5zaG91bGRDcmVhdGVNYWpvclZlcnNpb24oY29udGV4dCk7XG4gICAgICB2ZXJzaW9uVHlwZSA9IGlzTWFqb3IgPyAnbWFqb3InIDogJ21pbm9yJztcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNyZWF0ZVNuYXBzaG90KFxuICAgICAgb2JqZWN0SWQsXG4gICAgICB3b3Jrc3BhY2VJZCxcbiAgICAgIGRvY1N0YXRlLFxuICAgICAgc25hcHNob3QsXG4gICAgICB2ZXJzaW9uVHlwZVxuICAgICk7XG5cbiAgICAvLyDph43nva7orqHmlbDlkozml7bpl7RcbiAgICB0aGlzLmVkaXRDb3VudHMuc2V0KGtleSwgMCk7XG4gICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5zZXQoa2V5LCBub3cpO1xuICAgIHRoaXMubGFzdFNuYXBzaG90U2l6ZXMuc2V0KGtleSwgZG9jU3RhdGUubGVuZ3RoKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5yZXN1bHQsXG4gICAgICB2ZXJzaW9uX3R5cGU6IHZlcnNpb25UeXBlLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog6YeN572u5paH5qGj55qE57yW6L6R6K6h5pWw77yI55So5LqO5paH5qGj5YWz6Zet562J5Zy65pmv77yJXG4gICAqL1xuICByZXNldChvYmplY3RJZDogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5lZGl0Q291bnRzLmRlbGV0ZShvYmplY3RJZCk7XG4gICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5kZWxldGUob2JqZWN0SWQpO1xuICAgIHRoaXMubGFzdFNuYXBzaG90U2l6ZXMuZGVsZXRlKG9iamVjdElkKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImluamVjdGFibGUiLCJpbmplY3QiLCJEb2N1bWVudERBTyIsIlNuYXBzaG90U2VydmljZSIsIlRpbWVJbnRlcnZhbFN0cmF0ZWd5IiwiY29uc3RydWN0b3IiLCJ0aW1lVGhyZXNob2xkTXMiLCJ0aW1lVGhyZXNob2xkIiwic2hvdWxkQ3JlYXRlTWFqb3JWZXJzaW9uIiwiY29udGV4dCIsInRpbWVTaW5jZUxhc3RTbmFwc2hvdCIsIkNvbnRlbnRDaGFuZ2VTdHJhdGVneSIsImNoYW5nZVRocmVzaG9sZEJ5dGVzIiwiY2hhbmdlVGhyZXNob2xkIiwibGFzdFNuYXBzaG90RG9jU3RhdGVTaXplIiwiY3VycmVudFNpemUiLCJjdXJyZW50RG9jU3RhdGUiLCJsZW5ndGgiLCJzaXplQ2hhbmdlIiwiTWF0aCIsImFicyIsIkVkaXRGcmVxdWVuY3lTdHJhdGVneSIsImVkaXRUaHJlc2hvbGQiLCJlZGl0Q291bnQiLCJDb21wb3NpdGVPclN0cmF0ZWd5Iiwic3RyYXRlZ2llcyIsInN0cmF0ZWd5IiwicmVzdWx0IiwiU25hcHNob3RTY2hlZHVsZXIiLCJkb2N1bWVudERBTyIsInNuYXBzaG90U2VydmljZSIsImVkaXRDb3VudHMiLCJNYXAiLCJsYXN0U25hcHNob3RUaW1lcyIsImxhc3RTbmFwc2hvdFNpemVzIiwiRURJVFNfVEhSRVNIT0xEIiwicGFyc2VJbnQiLCJwcm9jZXNzIiwiZW52IiwiU05BUFNIT1RfRURJVFNfVEhSRVNIT0xEIiwiVElNRV9USFJFU0hPTEQiLCJTTkFQU0hPVF9USU1FX1RIUkVTSE9MRCIsInRpbWVTdHJhdGVneSIsImNvbnRlbnRTdHJhdGVneSIsIlNOQVBTSE9UX0NPTlRFTlRfQ0hBTkdFX1RIUkVTSE9MRCIsImZyZXF1ZW5jeVN0cmF0ZWd5IiwiU05BUFNIT1RfRURJVF9GUkVRVUVOQ1lfVEhSRVNIT0xEIiwidmVyc2lvblN0cmF0ZWd5IiwicmVjb3JkRWRpdCIsIm9iamVjdElkIiwid29ya3NwYWNlSWQiLCJkb2NTdGF0ZSIsInNuYXBzaG90Iiwia2V5IiwiZ2V0Iiwic2V0Iiwibm93IiwiRGF0ZSIsImxhc3RTbmFwc2hvdFRpbWUiLCJsYXN0U25hcHNob3RTaXplIiwidW5kZWZpbmVkIiwibGF0ZXN0U25hcHNob3QiLCJnZXRMYXRlc3RTbmFwc2hvdCIsImNyZWF0ZWRfYXQiLCJkb2Nfc3RhdGUiLCJkb2N1bWVudCIsImZpbmRCeUlkIiwiZG9jQ3JlYXRlZEF0IiwiZ2V0VGltZSIsImNvbnRlbnRfbGVuZ3RoIiwiY29uc29sZSIsImxvZyIsImRvY0Vycm9yIiwiZXJyb3IiLCJzaG91bGRDcmVhdGVTbmFwc2hvdCIsInRpbWVTaW5jZUxhc3RTbmFwc2hvdE1pbnV0ZXMiLCJyb3VuZCIsImN1cnJlbnRUaW1lIiwiaXNNYWpvciIsInZlcnNpb25UeXBlIiwiY3JlYXRlU25hcHNob3QiLCJzbmFwc2hvdF9pZCIsInZlcnNpb25fdHlwZSIsIm1ldGFkYXRhIiwiYXV0b19zYXZlIiwiZG9jX3N0YXRlX2xlbmd0aCIsIm9iamVjdF9pZCIsIndvcmtzcGFjZV9pZCIsInNuYXBzaG90X2xlbmd0aCIsInNuYXBzaG90UmVjb3JkIiwic25hcHNob3RfZGF0YSIsIkJ1ZmZlciIsImFsbG9jIiwic25hcHNob3RfdmVyc2lvbiIsImRvY19zdGF0ZV92ZXJzaW9uIiwic25hcHNob3RJZCIsImNyZWF0ZWRBdCIsInN0b3JlZF9pbiIsImRiX2NyZWF0ZWRfYXRfdHlwZSIsImNyZWF0ZVNuYXBzaG90TWFudWFsbHkiLCJmb3JjZU1ham9yVmVyc2lvbiIsInJlc2V0IiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/services/snapshot-scheduler.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/snapshot.service.ts":
/*!******************************************!*\
  !*** ./src/services/snapshot.service.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SnapshotService: () => (/* binding */ SnapshotService)\n/* harmony export */ });\n/* harmony import */ var _core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/storage/storage.factory */ \"(rsc)/./src/core/storage/storage.factory.ts\");\n/* harmony import */ var zlib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zlib */ \"zlib\");\n/* harmony import */ var zlib__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(zlib__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! util */ \"util\");\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nconst gzip = (0,util__WEBPACK_IMPORTED_MODULE_2__.promisify)(zlib__WEBPACK_IMPORTED_MODULE_1__.gzip);\nconst gunzip = (0,util__WEBPACK_IMPORTED_MODULE_2__.promisify)(zlib__WEBPACK_IMPORTED_MODULE_1__.gunzip);\n/**\n * 快照服务\n * 负责创建、存储和管理文档快照\n */ class SnapshotService {\n    constructor(){\n        this.SNAPSHOT_LIMIT = parseInt(process.env.SNAPSHOT_LIMIT || \"100\", 10);\n        this.storage = _core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.StorageFactory.getInstance();\n    }\n    /**\n   * 创建并存储快照\n   * @param params 快照参数\n   * @returns 快照元数据（包含 snapshot_id 和 created_at）\n   */ async createSnapshot(params) {\n        const timestamp = Date.now();\n        const snapshotId = timestamp; // 使用时间戳作为 snapshot_id\n        // 压缩 doc_state（使用 gzip，后续可以切换到 zstd）\n        const compressed = await gzip(params.docState);\n        // 生成存储键\n        const key = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotKey)(params.workspaceId, params.objectId, timestamp);\n        // 存储到文件系统\n        await this.storage.put(key, compressed, {\n            snapshot_id: snapshotId,\n            object_id: params.objectId,\n            workspace_id: params.workspaceId,\n            doc_state_length: params.docState.length,\n            compressed_length: compressed.length,\n            snapshot_length: params.snapshot?.length || 0,\n            ...params.metadata\n        });\n        // 清理旧快照（如果超过限制）\n        await this.cleanupOldSnapshots(params.workspaceId, params.objectId);\n        return {\n            snapshotId,\n            createdAt: timestamp\n        };\n    }\n    /**\n   * 获取快照数据\n   */ async getSnapshot(workspaceId, objectId, snapshotId) {\n        // 从数据库查询快照元数据，获取时间戳\n        // 这里简化处理，直接使用 snapshotId 作为时间戳\n        const timestamp = snapshotId;\n        const key = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotKey)(workspaceId, objectId, timestamp);\n        const compressed = await this.storage.get(key);\n        if (!compressed) {\n            return null;\n        }\n        // 解压缩\n        const docState = await gunzip(compressed);\n        return docState;\n    }\n    /**\n   * 获取快照列表\n   */ async listSnapshots(workspaceId, objectId, limit) {\n        const prefix = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotPrefix)(workspaceId, objectId);\n        const keys = await this.storage.list(prefix, limit);\n        return keys.map((key)=>{\n            const timestamp = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.extractTimestampFromKey)(key);\n            if (!timestamp) return null;\n            return {\n                snapshotId: timestamp,\n                createdAt: timestamp,\n                key\n            };\n        }).filter((item)=>item !== null).sort((a, b)=>b.createdAt - a.createdAt); // 按时间降序\n    }\n    /**\n   * 删除快照\n   */ async deleteSnapshot(workspaceId, objectId, snapshotId) {\n        const timestamp = snapshotId;\n        const key = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotKey)(workspaceId, objectId, timestamp);\n        await this.storage.delete(key);\n    }\n    /**\n   * 清理旧快照（保留最新的 N 个）\n   */ async cleanupOldSnapshots(workspaceId, objectId) {\n        const snapshots = await this.listSnapshots(workspaceId, objectId);\n        if (snapshots.length > this.SNAPSHOT_LIMIT) {\n            const toDelete = snapshots.slice(this.SNAPSHOT_LIMIT);\n            const keysToDelete = toDelete.map((s)=>s.key);\n            await this.storage.deleteMany(keysToDelete);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvc25hcHNob3Quc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFLeUM7QUFFWjtBQUNJO0FBRWpDLE1BQU1NLE9BQU9ELCtDQUFTQSxDQUFDRCxzQ0FBUztBQUNoQyxNQUFNRyxTQUFTRiwrQ0FBU0EsQ0FBQ0Qsd0NBQVc7QUFFcEM7OztDQUdDLEdBQ00sTUFBTUk7SUFJWEMsYUFBYzthQUZHQyxpQkFBaUJDLFNBQVNDLFFBQVFDLEdBQUcsQ0FBQ0gsY0FBYyxJQUFJLE9BQU87UUFHOUUsSUFBSSxDQUFDSSxPQUFPLEdBQUdkLHlFQUFjQSxDQUFDZSxXQUFXO0lBQzNDO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1DLGVBQWVDLE1BTXBCLEVBQXNEO1FBQ3JELE1BQU1DLFlBQVlDLEtBQUtDLEdBQUc7UUFDMUIsTUFBTUMsYUFBYUgsV0FBVyxzQkFBc0I7UUFFcEQscUNBQXFDO1FBQ3JDLE1BQU1JLGFBQWEsTUFBTWhCLEtBQUtXLE9BQU9NLFFBQVE7UUFFN0MsUUFBUTtRQUNSLE1BQU1DLE1BQU12Qiw2RUFBY0EsQ0FBQ2dCLE9BQU9RLFdBQVcsRUFBRVIsT0FBT1MsUUFBUSxFQUFFUjtRQUVoRSxVQUFVO1FBQ1YsTUFBTSxJQUFJLENBQUNKLE9BQU8sQ0FBQ2EsR0FBRyxDQUFDSCxLQUFLRixZQUFZO1lBQ3RDTSxhQUFhUDtZQUNiUSxXQUFXWixPQUFPUyxRQUFRO1lBQzFCSSxjQUFjYixPQUFPUSxXQUFXO1lBQ2hDTSxrQkFBa0JkLE9BQU9NLFFBQVEsQ0FBQ1MsTUFBTTtZQUN4Q0MsbUJBQW1CWCxXQUFXVSxNQUFNO1lBQ3BDRSxpQkFBaUJqQixPQUFPa0IsUUFBUSxFQUFFSCxVQUFVO1lBQzVDLEdBQUdmLE9BQU9tQixRQUFRO1FBQ3BCO1FBRUEsZ0JBQWdCO1FBQ2hCLE1BQU0sSUFBSSxDQUFDQyxtQkFBbUIsQ0FBQ3BCLE9BQU9RLFdBQVcsRUFBRVIsT0FBT1MsUUFBUTtRQUVsRSxPQUFPO1lBQ0xMO1lBQ0FpQixXQUFXcEI7UUFDYjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFNcUIsWUFDSmQsV0FBbUIsRUFDbkJDLFFBQWdCLEVBQ2hCTCxVQUFrQixFQUNNO1FBQ3hCLG9CQUFvQjtRQUNwQiwrQkFBK0I7UUFDL0IsTUFBTUgsWUFBWUc7UUFDbEIsTUFBTUcsTUFBTXZCLDZFQUFjQSxDQUFDd0IsYUFBYUMsVUFBVVI7UUFFbEQsTUFBTUksYUFBYSxNQUFNLElBQUksQ0FBQ1IsT0FBTyxDQUFDMEIsR0FBRyxDQUFDaEI7UUFDMUMsSUFBSSxDQUFDRixZQUFZO1lBQ2YsT0FBTztRQUNUO1FBRUEsTUFBTTtRQUNOLE1BQU1DLFdBQVcsTUFBTWhCLE9BQU9lO1FBQzlCLE9BQU9DO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE1BQU1rQixjQUNKaEIsV0FBbUIsRUFDbkJDLFFBQWdCLEVBQ2hCZ0IsS0FBYyxFQUMwRDtRQUN4RSxNQUFNQyxTQUFTekMsZ0ZBQWlCQSxDQUFDdUIsYUFBYUM7UUFDOUMsTUFBTWtCLE9BQU8sTUFBTSxJQUFJLENBQUM5QixPQUFPLENBQUMrQixJQUFJLENBQUNGLFFBQVFEO1FBRTdDLE9BQU9FLEtBQ0pFLEdBQUcsQ0FBQyxDQUFDdEI7WUFDSixNQUFNTixZQUFZZixzRkFBdUJBLENBQUNxQjtZQUMxQyxJQUFJLENBQUNOLFdBQVcsT0FBTztZQUV2QixPQUFPO2dCQUNMRyxZQUFZSDtnQkFDWm9CLFdBQVdwQjtnQkFDWE07WUFDRjtRQUNGLEdBQ0N1QixNQUFNLENBQUMsQ0FBQ0MsT0FBMkNBLFNBQVMsTUFDNURDLElBQUksQ0FBQyxDQUFDQyxHQUFHQyxJQUFNQSxFQUFFYixTQUFTLEdBQUdZLEVBQUVaLFNBQVMsR0FBRyxRQUFRO0lBQ3hEO0lBRUE7O0dBRUMsR0FDRCxNQUFNYyxlQUFlM0IsV0FBbUIsRUFBRUMsUUFBZ0IsRUFBRUwsVUFBa0IsRUFBaUI7UUFDN0YsTUFBTUgsWUFBWUc7UUFDbEIsTUFBTUcsTUFBTXZCLDZFQUFjQSxDQUFDd0IsYUFBYUMsVUFBVVI7UUFDbEQsTUFBTSxJQUFJLENBQUNKLE9BQU8sQ0FBQ3VDLE1BQU0sQ0FBQzdCO0lBQzVCO0lBRUE7O0dBRUMsR0FDRCxNQUFjYSxvQkFBb0JaLFdBQW1CLEVBQUVDLFFBQWdCLEVBQWlCO1FBQ3RGLE1BQU00QixZQUFZLE1BQU0sSUFBSSxDQUFDYixhQUFhLENBQUNoQixhQUFhQztRQUV4RCxJQUFJNEIsVUFBVXRCLE1BQU0sR0FBRyxJQUFJLENBQUN0QixjQUFjLEVBQUU7WUFDMUMsTUFBTTZDLFdBQVdELFVBQVVFLEtBQUssQ0FBQyxJQUFJLENBQUM5QyxjQUFjO1lBQ3BELE1BQU0rQyxlQUFlRixTQUFTVCxHQUFHLENBQUMsQ0FBQ1ksSUFBTUEsRUFBRWxDLEdBQUc7WUFDOUMsTUFBTSxJQUFJLENBQUNWLE9BQU8sQ0FBQzZDLFVBQVUsQ0FBQ0Y7UUFDaEM7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL3NlcnZpY2VzL3NuYXBzaG90LnNlcnZpY2UudHM/YWViMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBTdG9yYWdlRmFjdG9yeSxcbiAgZ2V0U25hcHNob3RLZXksXG4gIGdldFNuYXBzaG90UHJlZml4LFxuICBleHRyYWN0VGltZXN0YW1wRnJvbUtleSxcbn0gZnJvbSAnLi4vY29yZS9zdG9yYWdlL3N0b3JhZ2UuZmFjdG9yeSc7XG5pbXBvcnQgeyBTdG9yYWdlQWRhcHRlciB9IGZyb20gJy4uL2NvcmUvc3RvcmFnZS9zdG9yYWdlLmludGVyZmFjZSc7XG5pbXBvcnQgKiBhcyB6bGliIGZyb20gJ3psaWInO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSAndXRpbCc7XG5cbmNvbnN0IGd6aXAgPSBwcm9taXNpZnkoemxpYi5nemlwKTtcbmNvbnN0IGd1bnppcCA9IHByb21pc2lmeSh6bGliLmd1bnppcCk7XG5cbi8qKlxuICog5b+r54Wn5pyN5YqhXG4gKiDotJ/otKPliJvlu7rjgIHlrZjlgqjlkoznrqHnkIbmlofmoaPlv6vnhadcbiAqL1xuZXhwb3J0IGNsYXNzIFNuYXBzaG90U2VydmljZSB7XG4gIHByaXZhdGUgc3RvcmFnZTogU3RvcmFnZUFkYXB0ZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgU05BUFNIT1RfTElNSVQgPSBwYXJzZUludChwcm9jZXNzLmVudi5TTkFQU0hPVF9MSU1JVCB8fCAnMTAwJywgMTApO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc3RvcmFnZSA9IFN0b3JhZ2VGYWN0b3J5LmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65bm25a2Y5YKo5b+r54WnXG4gICAqIEBwYXJhbSBwYXJhbXMg5b+r54Wn5Y+C5pWwXG4gICAqIEByZXR1cm5zIOW/q+eFp+WFg+aVsOaNru+8iOWMheWQqyBzbmFwc2hvdF9pZCDlkowgY3JlYXRlZF9hdO+8iVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlU25hcHNob3QocGFyYW1zOiB7XG4gICAgd29ya3NwYWNlSWQ6IHN0cmluZztcbiAgICBvYmplY3RJZDogc3RyaW5nO1xuICAgIGRvY1N0YXRlOiBCdWZmZXI7IC8vIOWujOaVtOaWh+aho+eKtuaAge+8iFkuZW5jb2RlU3RhdGVBc1VwZGF0Ze+8iVxuICAgIHNuYXBzaG90PzogQnVmZmVyOyAvLyBZanMgU25hcHNob3TvvIjnirbmgIHlkJHph4/vvInvvIzlj6/pgIlcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPHsgc25hcHNob3RJZDogbnVtYmVyOyBjcmVhdGVkQXQ6IG51bWJlciB9PiB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCBzbmFwc2hvdElkID0gdGltZXN0YW1wOyAvLyDkvb/nlKjml7bpl7TmiLPkvZzkuLogc25hcHNob3RfaWRcblxuICAgIC8vIOWOi+e8qSBkb2Nfc3RhdGXvvIjkvb/nlKggZ3ppcO+8jOWQjue7reWPr+S7peWIh+aNouWIsCB6c3Rk77yJXG4gICAgY29uc3QgY29tcHJlc3NlZCA9IGF3YWl0IGd6aXAocGFyYW1zLmRvY1N0YXRlKTtcblxuICAgIC8vIOeUn+aIkOWtmOWCqOmUrlxuICAgIGNvbnN0IGtleSA9IGdldFNuYXBzaG90S2V5KHBhcmFtcy53b3Jrc3BhY2VJZCwgcGFyYW1zLm9iamVjdElkLCB0aW1lc3RhbXApO1xuXG4gICAgLy8g5a2Y5YKo5Yiw5paH5Lu257O757ufXG4gICAgYXdhaXQgdGhpcy5zdG9yYWdlLnB1dChrZXksIGNvbXByZXNzZWQsIHtcbiAgICAgIHNuYXBzaG90X2lkOiBzbmFwc2hvdElkLFxuICAgICAgb2JqZWN0X2lkOiBwYXJhbXMub2JqZWN0SWQsXG4gICAgICB3b3Jrc3BhY2VfaWQ6IHBhcmFtcy53b3Jrc3BhY2VJZCxcbiAgICAgIGRvY19zdGF0ZV9sZW5ndGg6IHBhcmFtcy5kb2NTdGF0ZS5sZW5ndGgsXG4gICAgICBjb21wcmVzc2VkX2xlbmd0aDogY29tcHJlc3NlZC5sZW5ndGgsXG4gICAgICBzbmFwc2hvdF9sZW5ndGg6IHBhcmFtcy5zbmFwc2hvdD8ubGVuZ3RoIHx8IDAsXG4gICAgICAuLi5wYXJhbXMubWV0YWRhdGEsXG4gICAgfSk7XG5cbiAgICAvLyDmuIXnkIbml6flv6vnhafvvIjlpoLmnpzotoXov4fpmZDliLbvvIlcbiAgICBhd2FpdCB0aGlzLmNsZWFudXBPbGRTbmFwc2hvdHMocGFyYW1zLndvcmtzcGFjZUlkLCBwYXJhbXMub2JqZWN0SWQpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHNuYXBzaG90SWQsXG4gICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluW/q+eFp+aVsOaNrlxuICAgKi9cbiAgYXN5bmMgZ2V0U25hcHNob3QoXG4gICAgd29ya3NwYWNlSWQ6IHN0cmluZyxcbiAgICBvYmplY3RJZDogc3RyaW5nLFxuICAgIHNuYXBzaG90SWQ6IG51bWJlclxuICApOiBQcm9taXNlPEJ1ZmZlciB8IG51bGw+IHtcbiAgICAvLyDku47mlbDmja7lupPmn6Xor6Llv6vnhaflhYPmlbDmja7vvIzojrflj5bml7bpl7TmiLNcbiAgICAvLyDov5nph4znroDljJblpITnkIbvvIznm7TmjqXkvb/nlKggc25hcHNob3RJZCDkvZzkuLrml7bpl7TmiLNcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBzbmFwc2hvdElkO1xuICAgIGNvbnN0IGtleSA9IGdldFNuYXBzaG90S2V5KHdvcmtzcGFjZUlkLCBvYmplY3RJZCwgdGltZXN0YW1wKTtcblxuICAgIGNvbnN0IGNvbXByZXNzZWQgPSBhd2FpdCB0aGlzLnN0b3JhZ2UuZ2V0KGtleSk7XG4gICAgaWYgKCFjb21wcmVzc2VkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyDop6PljovnvKlcbiAgICBjb25zdCBkb2NTdGF0ZSA9IGF3YWl0IGd1bnppcChjb21wcmVzc2VkKTtcbiAgICByZXR1cm4gZG9jU3RhdGU7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5b+r54Wn5YiX6KGoXG4gICAqL1xuICBhc3luYyBsaXN0U25hcHNob3RzKFxuICAgIHdvcmtzcGFjZUlkOiBzdHJpbmcsXG4gICAgb2JqZWN0SWQ6IHN0cmluZyxcbiAgICBsaW1pdD86IG51bWJlclxuICApOiBQcm9taXNlPEFycmF5PHsgc25hcHNob3RJZDogbnVtYmVyOyBjcmVhdGVkQXQ6IG51bWJlcjsga2V5OiBzdHJpbmcgfT4+IHtcbiAgICBjb25zdCBwcmVmaXggPSBnZXRTbmFwc2hvdFByZWZpeCh3b3Jrc3BhY2VJZCwgb2JqZWN0SWQpO1xuICAgIGNvbnN0IGtleXMgPSBhd2FpdCB0aGlzLnN0b3JhZ2UubGlzdChwcmVmaXgsIGxpbWl0KTtcblxuICAgIHJldHVybiBrZXlzXG4gICAgICAubWFwKChrZXkpID0+IHtcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gZXh0cmFjdFRpbWVzdGFtcEZyb21LZXkoa2V5KTtcbiAgICAgICAgaWYgKCF0aW1lc3RhbXApIHJldHVybiBudWxsO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc25hcHNob3RJZDogdGltZXN0YW1wLFxuICAgICAgICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wLFxuICAgICAgICAgIGtleSxcbiAgICAgICAgfTtcbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKChpdGVtKTogaXRlbSBpcyBOb25OdWxsYWJsZTx0eXBlb2YgaXRlbT4gPT4gaXRlbSAhPT0gbnVsbClcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmNyZWF0ZWRBdCAtIGEuY3JlYXRlZEF0KTsgLy8g5oyJ5pe26Ze06ZmN5bqPXG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5b+r54WnXG4gICAqL1xuICBhc3luYyBkZWxldGVTbmFwc2hvdCh3b3Jrc3BhY2VJZDogc3RyaW5nLCBvYmplY3RJZDogc3RyaW5nLCBzbmFwc2hvdElkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBzbmFwc2hvdElkO1xuICAgIGNvbnN0IGtleSA9IGdldFNuYXBzaG90S2V5KHdvcmtzcGFjZUlkLCBvYmplY3RJZCwgdGltZXN0YW1wKTtcbiAgICBhd2FpdCB0aGlzLnN0b3JhZ2UuZGVsZXRlKGtleSk7XG4gIH1cblxuICAvKipcbiAgICog5riF55CG5pen5b+r54Wn77yI5L+d55WZ5pyA5paw55qEIE4g5Liq77yJXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNsZWFudXBPbGRTbmFwc2hvdHMod29ya3NwYWNlSWQ6IHN0cmluZywgb2JqZWN0SWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHNuYXBzaG90cyA9IGF3YWl0IHRoaXMubGlzdFNuYXBzaG90cyh3b3Jrc3BhY2VJZCwgb2JqZWN0SWQpO1xuXG4gICAgaWYgKHNuYXBzaG90cy5sZW5ndGggPiB0aGlzLlNOQVBTSE9UX0xJTUlUKSB7XG4gICAgICBjb25zdCB0b0RlbGV0ZSA9IHNuYXBzaG90cy5zbGljZSh0aGlzLlNOQVBTSE9UX0xJTUlUKTtcbiAgICAgIGNvbnN0IGtleXNUb0RlbGV0ZSA9IHRvRGVsZXRlLm1hcCgocykgPT4gcy5rZXkpO1xuICAgICAgYXdhaXQgdGhpcy5zdG9yYWdlLmRlbGV0ZU1hbnkoa2V5c1RvRGVsZXRlKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJTdG9yYWdlRmFjdG9yeSIsImdldFNuYXBzaG90S2V5IiwiZ2V0U25hcHNob3RQcmVmaXgiLCJleHRyYWN0VGltZXN0YW1wRnJvbUtleSIsInpsaWIiLCJwcm9taXNpZnkiLCJnemlwIiwiZ3VuemlwIiwiU25hcHNob3RTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJTTkFQU0hPVF9MSU1JVCIsInBhcnNlSW50IiwicHJvY2VzcyIsImVudiIsInN0b3JhZ2UiLCJnZXRJbnN0YW5jZSIsImNyZWF0ZVNuYXBzaG90IiwicGFyYW1zIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsInNuYXBzaG90SWQiLCJjb21wcmVzc2VkIiwiZG9jU3RhdGUiLCJrZXkiLCJ3b3Jrc3BhY2VJZCIsIm9iamVjdElkIiwicHV0Iiwic25hcHNob3RfaWQiLCJvYmplY3RfaWQiLCJ3b3Jrc3BhY2VfaWQiLCJkb2Nfc3RhdGVfbGVuZ3RoIiwibGVuZ3RoIiwiY29tcHJlc3NlZF9sZW5ndGgiLCJzbmFwc2hvdF9sZW5ndGgiLCJzbmFwc2hvdCIsIm1ldGFkYXRhIiwiY2xlYW51cE9sZFNuYXBzaG90cyIsImNyZWF0ZWRBdCIsImdldFNuYXBzaG90IiwiZ2V0IiwibGlzdFNuYXBzaG90cyIsImxpbWl0IiwicHJlZml4Iiwia2V5cyIsImxpc3QiLCJtYXAiLCJmaWx0ZXIiLCJpdGVtIiwic29ydCIsImEiLCJiIiwiZGVsZXRlU25hcHNob3QiLCJkZWxldGUiLCJzbmFwc2hvdHMiLCJ0b0RlbGV0ZSIsInNsaWNlIiwia2V5c1RvRGVsZXRlIiwicyIsImRlbGV0ZU1hbnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/snapshot.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/subject.service.ts":
/*!*****************************************!*\
  !*** ./src/services/subject.service.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SubjectService: () => (/* binding */ SubjectService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_subject_category_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/subject-category.dao */ \"(rsc)/./src/dao/subject-category.dao.ts\");\n/* harmony import */ var _dao_subject_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/subject.dao */ \"(rsc)/./src/dao/subject.dao.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_subject_category_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_subject_dao__WEBPACK_IMPORTED_MODULE_2__]);\n([_dao_subject_category_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_subject_dao__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\nclass SubjectService {\n    constructor(categoryDAO, subjectDAO){\n        this.categoryDAO = categoryDAO;\n        this.subjectDAO = subjectDAO;\n    }\n    /**\n   * 获取学科分类树形结构\n   */ async getCategoryTree() {\n        return this.categoryDAO.findTree();\n    }\n    /**\n   * 获取所有学科分类\n   */ async getCategories() {\n        return this.categoryDAO.findAll();\n    }\n    /**\n   * 根据父分类 ID 获取子分类（支持分页和搜索）\n   */ async getCategoriesByParentId(parentId, options) {\n        return this.categoryDAO.findByParentId(parentId, options);\n    }\n    /**\n   * 获取分类的直接子分类（用于树懒加载）\n   */ async getCategoryChildren(parentId) {\n        return this.categoryDAO.findChildrenByParentId(parentId);\n    }\n    /**\n   * 获取学科分类详情\n   */ async getCategoryById(categoryId) {\n        return this.categoryDAO.findById(categoryId);\n    }\n    /**\n   * 创建学科分类\n   */ async createCategory(data) {\n        return this.categoryDAO.create(data);\n    }\n    /**\n   * 更新学科分类\n   */ async updateCategory(categoryId, updates) {\n        return this.categoryDAO.update(categoryId, updates);\n    }\n    /**\n   * 删除学科分类\n   */ async deleteCategory(categoryId) {\n        return this.categoryDAO.delete(categoryId);\n    }\n    /**\n   * 获取所有学科\n   */ async getSubjects() {\n        return this.subjectDAO.findAll();\n    }\n    /**\n   * 根据分类 ID 获取学科（支持分页和搜索，categoryId 为 null 时查询所有学科）\n   */ async getSubjectsByCategoryId(categoryId, options) {\n        return this.subjectDAO.findByCategoryId(categoryId, options);\n    }\n    /**\n   * 获取学科详情\n   */ async getSubjectById(subjectId) {\n        return this.subjectDAO.findById(subjectId);\n    }\n    /**\n   * 创建学科\n   */ async createSubject(data) {\n        return this.subjectDAO.create(data);\n    }\n    /**\n   * 更新学科\n   */ async updateSubject(subjectId, updates) {\n        return this.subjectDAO.update(subjectId, updates);\n    }\n    /**\n   * 删除学科\n   */ async deleteSubject(subjectId) {\n        return this.subjectDAO.delete(subjectId);\n    }\n    /**\n   * 获取学科详情信息\n   */ async getSubjectDetail(subjectId) {\n        return this.subjectDAO.findDetailBySubjectId(subjectId);\n    }\n    /**\n   * 创建或更新学科详情\n   */ async upsertSubjectDetail(data) {\n        return this.subjectDAO.upsertDetail(data);\n    }\n}\nSubjectService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"SubjectCategoryDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"SubjectDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_subject_category_dao__WEBPACK_IMPORTED_MODULE_1__.SubjectCategoryDAO === \"undefined\" ? Object : _dao_subject_category_dao__WEBPACK_IMPORTED_MODULE_1__.SubjectCategoryDAO,\n        typeof _dao_subject_dao__WEBPACK_IMPORTED_MODULE_2__.SubjectDAO === \"undefined\" ? Object : _dao_subject_dao__WEBPACK_IMPORTED_MODULE_2__.SubjectDAO\n    ])\n], SubjectService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFsQix5RUFBa0I7ZUFDM0Isd0RBQVUsNEJBQVYsd0RBQVU7O0dBSDNDRyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9zZXJ2aWNlcy9zdWJqZWN0LnNlcnZpY2UudHM/NjkyMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgeyBTdWJqZWN0Q2F0ZWdvcnlEQU8gfSBmcm9tICdAL2Rhby9zdWJqZWN0LWNhdGVnb3J5LmRhbyc7XG5pbXBvcnQgeyBTdWJqZWN0REFPIH0gZnJvbSAnQC9kYW8vc3ViamVjdC5kYW8nO1xuaW1wb3J0IHR5cGUgeyBTdWJqZWN0Q2F0ZWdvcnksIFN1YmplY3QsIFN1YmplY3REZXRhaWwgfSBmcm9tICdAL2VudGl0aWVzJztcblxuLyoqXG4gKiDlrabnp5HmnI3liqFcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFN1YmplY3RTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQGluamVjdCgnU3ViamVjdENhdGVnb3J5REFPJykgcHJpdmF0ZSBjYXRlZ29yeURBTzogU3ViamVjdENhdGVnb3J5REFPLFxuICAgIEBpbmplY3QoJ1N1YmplY3REQU8nKSBwcml2YXRlIHN1YmplY3REQU86IFN1YmplY3REQU9cbiAgKSB7fVxuXG4gIC8qKlxuICAgKiDojrflj5blrabnp5HliIbnsbvmoJHlvaLnu5PmnoRcbiAgICovXG4gIGFzeW5jIGdldENhdGVnb3J5VHJlZSgpOiBQcm9taXNlPEFycmF5PFN1YmplY3RDYXRlZ29yeSAmIHsgY2hpbGRyZW4/OiBTdWJqZWN0Q2F0ZWdvcnlbXSB9Pj4ge1xuICAgIHJldHVybiB0aGlzLmNhdGVnb3J5REFPLmZpbmRUcmVlKCk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5omA5pyJ5a2m56eR5YiG57G7XG4gICAqL1xuICBhc3luYyBnZXRDYXRlZ29yaWVzKCk6IFByb21pc2U8U3ViamVjdENhdGVnb3J5W10+IHtcbiAgICByZXR1cm4gdGhpcy5jYXRlZ29yeURBTy5maW5kQWxsKCk7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u54i25YiG57G7IElEIOiOt+WPluWtkOWIhuexu++8iOaUr+aMgeWIhumhteWSjOaQnOe0ou+8iVxuICAgKi9cbiAgYXN5bmMgZ2V0Q2F0ZWdvcmllc0J5UGFyZW50SWQoXG4gICAgcGFyZW50SWQ6IHN0cmluZyB8IG51bGwsXG4gICAgb3B0aW9ucz86IHsgY3VycmVudD86IG51bWJlcjsgcGFnZVNpemU/OiBudW1iZXI7IGtleXdvcmQ/OiBzdHJpbmcgfVxuICApOiBQcm9taXNlPHsgY2F0ZWdvcmllczogU3ViamVjdENhdGVnb3J5W107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIHJldHVybiB0aGlzLmNhdGVnb3J5REFPLmZpbmRCeVBhcmVudElkKHBhcmVudElkLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bliIbnsbvnmoTnm7TmjqXlrZDliIbnsbvvvIjnlKjkuo7moJHmh5LliqDovb3vvIlcbiAgICovXG4gIGFzeW5jIGdldENhdGVnb3J5Q2hpbGRyZW4ocGFyZW50SWQ6IHN0cmluZyB8IG51bGwpOiBQcm9taXNlPFN1YmplY3RDYXRlZ29yeVtdPiB7XG4gICAgcmV0dXJuIHRoaXMuY2F0ZWdvcnlEQU8uZmluZENoaWxkcmVuQnlQYXJlbnRJZChwYXJlbnRJZCk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5a2m56eR5YiG57G76K+m5oOFXG4gICAqL1xuICBhc3luYyBnZXRDYXRlZ29yeUJ5SWQoY2F0ZWdvcnlJZDogc3RyaW5nKTogUHJvbWlzZTxTdWJqZWN0Q2F0ZWdvcnkgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMuY2F0ZWdvcnlEQU8uZmluZEJ5SWQoY2F0ZWdvcnlJZCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65a2m56eR5YiG57G7XG4gICAqL1xuICBhc3luYyBjcmVhdGVDYXRlZ29yeShkYXRhOiB7XG4gICAgcGFyZW50X2lkPzogc3RyaW5nIHwgbnVsbDtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIGljb25fdXJsPzogc3RyaW5nO1xuICAgIHNvcnRfb3JkZXI/OiBudW1iZXI7XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxTdWJqZWN0Q2F0ZWdvcnk+IHtcbiAgICByZXR1cm4gdGhpcy5jYXRlZ29yeURBTy5jcmVhdGUoZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICog5pu05paw5a2m56eR5YiG57G7XG4gICAqL1xuICBhc3luYyB1cGRhdGVDYXRlZ29yeShcbiAgICBjYXRlZ29yeUlkOiBzdHJpbmcsXG4gICAgdXBkYXRlczoge1xuICAgICAgcGFyZW50X2lkPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgIGNvZGU/OiBzdHJpbmc7XG4gICAgICBuYW1lPzogc3RyaW5nO1xuICAgICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgICBpY29uX3VybD86IHN0cmluZztcbiAgICAgIHNvcnRfb3JkZXI/OiBudW1iZXI7XG4gICAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gICAgfVxuICApOiBQcm9taXNlPFN1YmplY3RDYXRlZ29yeT4ge1xuICAgIHJldHVybiB0aGlzLmNhdGVnb3J5REFPLnVwZGF0ZShjYXRlZ29yeUlkLCB1cGRhdGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTlrabnp5HliIbnsbtcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUNhdGVnb3J5KGNhdGVnb3J5SWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmNhdGVnb3J5REFPLmRlbGV0ZShjYXRlZ29yeUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmiYDmnInlrabnp5FcbiAgICovXG4gIGFzeW5jIGdldFN1YmplY3RzKCk6IFByb21pc2U8U3ViamVjdFtdPiB7XG4gICAgcmV0dXJuIHRoaXMuc3ViamVjdERBTy5maW5kQWxsKCk7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u5YiG57G7IElEIOiOt+WPluWtpuenke+8iOaUr+aMgeWIhumhteWSjOaQnOe0ou+8jGNhdGVnb3J5SWQg5Li6IG51bGwg5pe25p+l6K+i5omA5pyJ5a2m56eR77yJXG4gICAqL1xuICBhc3luYyBnZXRTdWJqZWN0c0J5Q2F0ZWdvcnlJZChcbiAgICBjYXRlZ29yeUlkOiBzdHJpbmcgfCBudWxsLFxuICAgIG9wdGlvbnM/OiB7IGN1cnJlbnQ/OiBudW1iZXI7IHBhZ2VTaXplPzogbnVtYmVyOyBrZXl3b3JkPzogc3RyaW5nIH1cbiAgKTogUHJvbWlzZTx7IHN1YmplY3RzOiBTdWJqZWN0W107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIHJldHVybiB0aGlzLnN1YmplY3REQU8uZmluZEJ5Q2F0ZWdvcnlJZChjYXRlZ29yeUlkLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blrabnp5Hor6bmg4VcbiAgICovXG4gIGFzeW5jIGdldFN1YmplY3RCeUlkKHN1YmplY3RJZDogc3RyaW5nKTogUHJvbWlzZTxTdWJqZWN0IHwgbnVsbD4ge1xuICAgIHJldHVybiB0aGlzLnN1YmplY3REQU8uZmluZEJ5SWQoc3ViamVjdElkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlrabnp5FcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVN1YmplY3QoZGF0YToge1xuICAgIGNhdGVnb3J5X2lkOiBzdHJpbmc7XG4gICAgY29kZTogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBzaG9ydF9uYW1lPzogc3RyaW5nO1xuICAgIGljb25fdXJsPzogc3RyaW5nO1xuICAgIGNvdmVyX2ltYWdlX3VybD86IHN0cmluZztcbiAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgIGlzX3B1Ymxpc2hlZD86IGJvb2xlYW47XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxTdWJqZWN0PiB7XG4gICAgcmV0dXJuIHRoaXMuc3ViamVjdERBTy5jcmVhdGUoZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICog5pu05paw5a2m56eRXG4gICAqL1xuICBhc3luYyB1cGRhdGVTdWJqZWN0KFxuICAgIHN1YmplY3RJZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IHtcbiAgICAgIGNhdGVnb3J5X2lkPzogc3RyaW5nO1xuICAgICAgY29kZT86IHN0cmluZztcbiAgICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgICBzaG9ydF9uYW1lPzogc3RyaW5nO1xuICAgICAgaWNvbl91cmw/OiBzdHJpbmc7XG4gICAgICBjb3Zlcl9pbWFnZV91cmw/OiBzdHJpbmc7XG4gICAgICBzb3J0X29yZGVyPzogbnVtYmVyO1xuICAgICAgaXNfcHVibGlzaGVkPzogYm9vbGVhbjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8U3ViamVjdD4ge1xuICAgIHJldHVybiB0aGlzLnN1YmplY3REQU8udXBkYXRlKHN1YmplY3RJZCwgdXBkYXRlcyk7XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5a2m56eRXG4gICAqL1xuICBhc3luYyBkZWxldGVTdWJqZWN0KHN1YmplY3RJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuc3ViamVjdERBTy5kZWxldGUoc3ViamVjdElkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blrabnp5Hor6bmg4Xkv6Hmga9cbiAgICovXG4gIGFzeW5jIGdldFN1YmplY3REZXRhaWwoc3ViamVjdElkOiBzdHJpbmcpOiBQcm9taXNlPFN1YmplY3REZXRhaWwgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMuc3ViamVjdERBTy5maW5kRGV0YWlsQnlTdWJqZWN0SWQoc3ViamVjdElkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmiJbmm7TmlrDlrabnp5Hor6bmg4VcbiAgICovXG4gIGFzeW5jIHVwc2VydFN1YmplY3REZXRhaWwoZGF0YToge1xuICAgIHN1YmplY3RfaWQ6IHN0cmluZztcbiAgICBkZWZpbml0aW9uPzogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIHB1cnBvc2U/OiBzdHJpbmc7XG4gICAgdmFsdWU/OiBzdHJpbmc7XG4gICAgYXBwbGljYXRpb25fc2NlbmFyaW9zPzogc3RyaW5nO1xuICAgIGxlYXJuaW5nX29iamVjdGl2ZXM/OiBzdHJpbmc7XG4gICAgcHJlcmVxdWlzaXRlcz86IHN0cmluZztcbiAgICByZWxhdGVkX3N1YmplY3RzPzogc3RyaW5nW107XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxTdWJqZWN0RGV0YWlsPiB7XG4gICAgcmV0dXJuIHRoaXMuc3ViamVjdERBTy51cHNlcnREZXRhaWwoZGF0YSk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbImluamVjdGFibGUiLCJpbmplY3QiLCJTdWJqZWN0Q2F0ZWdvcnlEQU8iLCJTdWJqZWN0REFPIiwiU3ViamVjdFNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImNhdGVnb3J5REFPIiwic3ViamVjdERBTyIsImdldENhdGVnb3J5VHJlZSIsImZpbmRUcmVlIiwiZ2V0Q2F0ZWdvcmllcyIsImZpbmRBbGwiLCJnZXRDYXRlZ29yaWVzQnlQYXJlbnRJZCIsInBhcmVudElkIiwib3B0aW9ucyIsImZpbmRCeVBhcmVudElkIiwiZ2V0Q2F0ZWdvcnlDaGlsZHJlbiIsImZpbmRDaGlsZHJlbkJ5UGFyZW50SWQiLCJnZXRDYXRlZ29yeUJ5SWQiLCJjYXRlZ29yeUlkIiwiZmluZEJ5SWQiLCJjcmVhdGVDYXRlZ29yeSIsImRhdGEiLCJjcmVhdGUiLCJ1cGRhdGVDYXRlZ29yeSIsInVwZGF0ZXMiLCJ1cGRhdGUiLCJkZWxldGVDYXRlZ29yeSIsImRlbGV0ZSIsImdldFN1YmplY3RzIiwiZ2V0U3ViamVjdHNCeUNhdGVnb3J5SWQiLCJmaW5kQnlDYXRlZ29yeUlkIiwiZ2V0U3ViamVjdEJ5SWQiLCJzdWJqZWN0SWQiLCJjcmVhdGVTdWJqZWN0IiwidXBkYXRlU3ViamVjdCIsImRlbGV0ZVN1YmplY3QiLCJnZXRTdWJqZWN0RGV0YWlsIiwiZmluZERldGFpbEJ5U3ViamVjdElkIiwidXBzZXJ0U3ViamVjdERldGFpbCIsInVwc2VydERldGFpbCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/subject.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/user-ability.service.ts":
/*!**********************************************!*\
  !*** ./src/services/user-ability.service.ts ***!
  \**********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserAbilityService: () => (/* binding */ UserAbilityService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/user-ability-level.dao */ \"(rsc)/./src/dao/user-ability-level.dao.ts\");\n/* harmony import */ var _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/user-ability-experience-log.dao */ \"(rsc)/./src/dao/user-ability-experience-log.dao.ts\");\n/* harmony import */ var _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/ability-item-level-config.dao */ \"(rsc)/./src/dao/ability-item-level-config.dao.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__]);\n([_dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\nclass UserAbilityService {\n    constructor(userLevelDAO, experienceLogDAO, levelConfigDAO){\n        this.userLevelDAO = userLevelDAO;\n        this.experienceLogDAO = experienceLogDAO;\n        this.levelConfigDAO = levelConfigDAO;\n    }\n    /**\n   * 为单个用户能力等级添加下一级信息（辅助方法）\n   */ async enrichUserLevelWithNextInfo(level) {\n        const currentLevel = Number(level.current_level);\n        const currentExp = Number(level.current_exp);\n        const nextLevel = currentLevel + 1;\n        // 获取下一级配置（优先独立配置，没有则用模板）\n        const nextConfig = await this.levelConfigDAO.getConfigForItem(level.item_id, nextLevel);\n        if (!nextConfig) {\n            // 没有下一级配置，说明已满级\n            return {\n                ...level,\n                is_max_level: true\n            };\n        }\n        const requiredExp = Number(nextConfig.required_exp);\n        const expNeeded = Math.max(0, requiredExp - currentExp);\n        return {\n            ...level,\n            next_level: nextLevel,\n            next_level_required_exp: requiredExp,\n            exp_needed: expNeeded,\n            requires_assessment: nextConfig.requires_assessment,\n            next_level_name: nextConfig.level_name,\n            is_max_level: false\n        };\n    }\n    /**\n   * 获取用户的能力等级列表（包含下一级信息）\n   */ async getUserLevels(uid) {\n        const levels = await this.userLevelDAO.findByUserId(uid);\n        // 为每个能力项计算下一级信息\n        const levelsWithNextInfo = await Promise.all(levels.map((level)=>this.enrichUserLevelWithNextInfo(level)));\n        return levelsWithNextInfo;\n    }\n    /**\n   * 获取用户指定能力项的等级（包含下一级信息）\n   */ async getUserLevelWithNextInfo(uid, itemId) {\n        const level = await this.userLevelDAO.findByUserAndItem(uid, itemId);\n        if (!level) {\n            return null;\n        }\n        return this.enrichUserLevelWithNextInfo(level);\n    }\n    /**\n   * 获取用户指定能力项的等级\n   */ async getUserLevel(uid, itemId) {\n        return this.userLevelDAO.findByUserAndItem(uid, itemId);\n    }\n    /**\n   * 获取用户经验记录\n   */ async getExperienceLogs(uid, options) {\n        return this.experienceLogDAO.findByUserId(uid, options);\n    }\n}\nUserAbilityService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"UserAbilityLevelDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"UserAbilityExperienceLogDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(2, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"AbilityItemLevelConfigDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__.UserAbilityLevelDAO === \"undefined\" ? Object : _dao_user_ability_level_dao__WEBPACK_IMPORTED_MODULE_1__.UserAbilityLevelDAO,\n        typeof _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__.UserAbilityExperienceLogDAO === \"undefined\" ? Object : _dao_user_ability_experience_log_dao__WEBPACK_IMPORTED_MODULE_2__.UserAbilityExperienceLogDAO,\n        typeof _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__.AbilityItemLevelConfigDAO === \"undefined\" ? Object : _dao_ability_item_level_config_dao__WEBPACK_IMPORTED_MODULE_3__.AbilityItemLevelConfigDAO\n    ])\n], UserAbilityService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvdXNlci1hYmlsaXR5LnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQThDO0FBQ3FCO0FBQ2lCO0FBQ0o7QUFvQnpFLE1BQU1LO0lBQ1hDLFlBQ0UsWUFBd0UsRUFDeEUsZ0JBQTRGLEVBQzVGLGNBQXNGLENBQ3RGO2FBSHVDQyxlQUFBQTthQUNRQyxtQkFBQUE7YUFDRkMsaUJBQUFBO0lBQzVDO0lBRUg7O0dBRUMsR0FDRCxNQUFjQyw0QkFBNEJDLEtBQXVCLEVBQXlDO1FBQ3hHLE1BQU1DLGVBQWVDLE9BQU9GLE1BQU1HLGFBQWE7UUFDL0MsTUFBTUMsYUFBYUYsT0FBT0YsTUFBTUssV0FBVztRQUMzQyxNQUFNQyxZQUFZTCxlQUFlO1FBRWpDLHlCQUF5QjtRQUN6QixNQUFNTSxhQUFhLE1BQU0sSUFBSSxDQUFDVCxjQUFjLENBQUNVLGdCQUFnQixDQUFDUixNQUFNUyxPQUFPLEVBQUVIO1FBRTdFLElBQUksQ0FBQ0MsWUFBWTtZQUNmLGdCQUFnQjtZQUNoQixPQUFPO2dCQUNMLEdBQUdQLEtBQUs7Z0JBQ1JVLGNBQWM7WUFDaEI7UUFDRjtRQUVBLE1BQU1DLGNBQWNULE9BQU9LLFdBQVdLLFlBQVk7UUFDbEQsTUFBTUMsWUFBWUMsS0FBS0MsR0FBRyxDQUFDLEdBQUdKLGNBQWNQO1FBRTVDLE9BQU87WUFDTCxHQUFHSixLQUFLO1lBQ1JnQixZQUFZVjtZQUNaVyx5QkFBeUJOO1lBQ3pCTyxZQUFZTDtZQUNaTSxxQkFBcUJaLFdBQVdZLG1CQUFtQjtZQUNuREMsaUJBQWlCYixXQUFXYyxVQUFVO1lBQ3RDWCxjQUFjO1FBQ2hCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1ZLGNBQWNDLEdBQVcsRUFBMkM7UUFDeEUsTUFBTUMsU0FBUyxNQUFNLElBQUksQ0FBQzVCLFlBQVksQ0FBQzZCLFlBQVksQ0FBQ0Y7UUFFcEQsZ0JBQWdCO1FBQ2hCLE1BQU1HLHFCQUFxRCxNQUFNQyxRQUFRQyxHQUFHLENBQzFFSixPQUFPSyxHQUFHLENBQUMsQ0FBQzdCLFFBQVUsSUFBSSxDQUFDRCwyQkFBMkIsQ0FBQ0M7UUFHekQsT0FBTzBCO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE1BQU1JLHlCQUF5QlAsR0FBVyxFQUFFUSxNQUFjLEVBQWdEO1FBQ3hHLE1BQU0vQixRQUFRLE1BQU0sSUFBSSxDQUFDSixZQUFZLENBQUNvQyxpQkFBaUIsQ0FBQ1QsS0FBS1E7UUFDN0QsSUFBSSxDQUFDL0IsT0FBTztZQUNWLE9BQU87UUFDVDtRQUNBLE9BQU8sSUFBSSxDQUFDRCwyQkFBMkIsQ0FBQ0M7SUFDMUM7SUFFQTs7R0FFQyxHQUNELE1BQU1pQyxhQUFhVixHQUFXLEVBQUVRLE1BQWMsRUFBb0M7UUFDaEYsT0FBTyxJQUFJLENBQUNuQyxZQUFZLENBQUNvQyxpQkFBaUIsQ0FBQ1QsS0FBS1E7SUFDbEQ7SUFFQTs7R0FFQyxHQUNELE1BQU1HLGtCQUNKWCxHQUFXLEVBQ1hZLE9BS0MsRUFDb0M7UUFDckMsT0FBTyxJQUFJLENBQUN0QyxnQkFBZ0IsQ0FBQzRCLFlBQVksQ0FBQ0YsS0FBS1k7SUFDakQ7QUFDRjtBQXRGYXpDLHFCQUFBQSxvRUFBQUE7SUFEWkwsb0RBQVVBO0lBR05DLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQztJQUNQQSxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7SUFDUEEsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDOzs7ZUFGNkMsNEVBQW1CLDRCQUFuQiw0RUFBbUI7ZUFDUCw2RkFBMkIsNEJBQTNCLDZGQUEyQjtlQUMvQix5RkFBeUIsNEJBQXpCLHlGQUF5Qjs7R0FKN0VJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL3NlcnZpY2VzL3VzZXItYWJpbGl0eS5zZXJ2aWNlLnRzP2EzNDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgVXNlckFiaWxpdHlMZXZlbERBTyB9IGZyb20gJ0AvZGFvL3VzZXItYWJpbGl0eS1sZXZlbC5kYW8nO1xuaW1wb3J0IHsgVXNlckFiaWxpdHlFeHBlcmllbmNlTG9nREFPIH0gZnJvbSAnQC9kYW8vdXNlci1hYmlsaXR5LWV4cGVyaWVuY2UtbG9nLmRhbyc7XG5pbXBvcnQgeyBBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPIH0gZnJvbSAnQC9kYW8vYWJpbGl0eS1pdGVtLWxldmVsLWNvbmZpZy5kYW8nO1xuaW1wb3J0IHR5cGUgeyBVc2VyQWJpbGl0eUxldmVsLCBVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2cgfSBmcm9tICdAL2VudGl0aWVzJztcblxuLyoqXG4gKiDmianlsZXnmoTnlKjmiLfog73lipvnrYnnuqfkv6Hmga/vvIjljIXlkKvkuIvkuIDnuqfkv6Hmga/vvIlcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBVc2VyQWJpbGl0eUxldmVsV2l0aE5leHRJbmZvIGV4dGVuZHMgVXNlckFiaWxpdHlMZXZlbCB7XG4gIC8vIOS4i+S4gOe6p+S/oeaBr1xuICBuZXh0X2xldmVsPzogbnVtYmVyOyAvLyDkuIvkuIDnuqfnrYnnuqdcbiAgbmV4dF9sZXZlbF9yZXF1aXJlZF9leHA/OiBudW1iZXI7IC8vIOS4i+S4gOe6p+aJgOmcgOe7j+mqjFxuICBleHBfbmVlZGVkPzogbnVtYmVyOyAvLyDov5jpnIDlpJrlsJHnu4/pqoxcbiAgcmVxdWlyZXNfYXNzZXNzbWVudD86IGJvb2xlYW47IC8vIOaYr+WQpumcgOimgeiAg+ivlVxuICBuZXh0X2xldmVsX25hbWU/OiBzdHJpbmcgfCBudWxsOyAvLyDkuIvkuIDnuqflkI3np7BcbiAgaXNfbWF4X2xldmVsPzogYm9vbGVhbjsgLy8g5piv5ZCm5bey5ruh57qnXG59XG5cbi8qKlxuICog55So5oi36IO95Yqb5pyN5YqhXG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBVc2VyQWJpbGl0eVNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdVc2VyQWJpbGl0eUxldmVsREFPJykgcHJpdmF0ZSB1c2VyTGV2ZWxEQU86IFVzZXJBYmlsaXR5TGV2ZWxEQU8sXG4gICAgQGluamVjdCgnVXNlckFiaWxpdHlFeHBlcmllbmNlTG9nREFPJykgcHJpdmF0ZSBleHBlcmllbmNlTG9nREFPOiBVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2dEQU8sXG4gICAgQGluamVjdCgnQWJpbGl0eUl0ZW1MZXZlbENvbmZpZ0RBTycpIHByaXZhdGUgbGV2ZWxDb25maWdEQU86IEFiaWxpdHlJdGVtTGV2ZWxDb25maWdEQU9cbiAgKSB7fVxuXG4gIC8qKlxuICAgKiDkuLrljZXkuKrnlKjmiLfog73lipvnrYnnuqfmt7vliqDkuIvkuIDnuqfkv6Hmga/vvIjovoXliqnmlrnms5XvvIlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZW5yaWNoVXNlckxldmVsV2l0aE5leHRJbmZvKGxldmVsOiBVc2VyQWJpbGl0eUxldmVsKTogUHJvbWlzZTxVc2VyQWJpbGl0eUxldmVsV2l0aE5leHRJbmZvPiB7XG4gICAgY29uc3QgY3VycmVudExldmVsID0gTnVtYmVyKGxldmVsLmN1cnJlbnRfbGV2ZWwpO1xuICAgIGNvbnN0IGN1cnJlbnRFeHAgPSBOdW1iZXIobGV2ZWwuY3VycmVudF9leHApO1xuICAgIGNvbnN0IG5leHRMZXZlbCA9IGN1cnJlbnRMZXZlbCArIDE7XG5cbiAgICAvLyDojrflj5bkuIvkuIDnuqfphY3nva7vvIjkvJjlhYjni6znq4vphY3nva7vvIzmsqHmnInliJnnlKjmqKHmnb/vvIlcbiAgICBjb25zdCBuZXh0Q29uZmlnID0gYXdhaXQgdGhpcy5sZXZlbENvbmZpZ0RBTy5nZXRDb25maWdGb3JJdGVtKGxldmVsLml0ZW1faWQsIG5leHRMZXZlbCk7XG5cbiAgICBpZiAoIW5leHRDb25maWcpIHtcbiAgICAgIC8vIOayoeacieS4i+S4gOe6p+mFjee9ru+8jOivtOaYjuW3sua7oee6p1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ubGV2ZWwsXG4gICAgICAgIGlzX21heF9sZXZlbDogdHJ1ZSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgcmVxdWlyZWRFeHAgPSBOdW1iZXIobmV4dENvbmZpZy5yZXF1aXJlZF9leHApO1xuICAgIGNvbnN0IGV4cE5lZWRlZCA9IE1hdGgubWF4KDAsIHJlcXVpcmVkRXhwIC0gY3VycmVudEV4cCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4ubGV2ZWwsXG4gICAgICBuZXh0X2xldmVsOiBuZXh0TGV2ZWwsXG4gICAgICBuZXh0X2xldmVsX3JlcXVpcmVkX2V4cDogcmVxdWlyZWRFeHAsXG4gICAgICBleHBfbmVlZGVkOiBleHBOZWVkZWQsXG4gICAgICByZXF1aXJlc19hc3Nlc3NtZW50OiBuZXh0Q29uZmlnLnJlcXVpcmVzX2Fzc2Vzc21lbnQsXG4gICAgICBuZXh0X2xldmVsX25hbWU6IG5leHRDb25maWcubGV2ZWxfbmFtZSxcbiAgICAgIGlzX21heF9sZXZlbDogZmFsc2UsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfnmoTog73lipvnrYnnuqfliJfooajvvIjljIXlkKvkuIvkuIDnuqfkv6Hmga/vvIlcbiAgICovXG4gIGFzeW5jIGdldFVzZXJMZXZlbHModWlkOiBudW1iZXIpOiBQcm9taXNlPFVzZXJBYmlsaXR5TGV2ZWxXaXRoTmV4dEluZm9bXT4ge1xuICAgIGNvbnN0IGxldmVscyA9IGF3YWl0IHRoaXMudXNlckxldmVsREFPLmZpbmRCeVVzZXJJZCh1aWQpO1xuICAgIFxuICAgIC8vIOS4uuavj+S4quiDveWKm+mhueiuoeeul+S4i+S4gOe6p+S/oeaBr1xuICAgIGNvbnN0IGxldmVsc1dpdGhOZXh0SW5mbzogVXNlckFiaWxpdHlMZXZlbFdpdGhOZXh0SW5mb1tdID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBsZXZlbHMubWFwKChsZXZlbCkgPT4gdGhpcy5lbnJpY2hVc2VyTGV2ZWxXaXRoTmV4dEluZm8obGV2ZWwpKVxuICAgICk7XG5cbiAgICByZXR1cm4gbGV2ZWxzV2l0aE5leHRJbmZvO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlueUqOaIt+aMh+WumuiDveWKm+mhueeahOetiee6p++8iOWMheWQq+S4i+S4gOe6p+S/oeaBr++8iVxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlckxldmVsV2l0aE5leHRJbmZvKHVpZDogbnVtYmVyLCBpdGVtSWQ6IHN0cmluZyk6IFByb21pc2U8VXNlckFiaWxpdHlMZXZlbFdpdGhOZXh0SW5mbyB8IG51bGw+IHtcbiAgICBjb25zdCBsZXZlbCA9IGF3YWl0IHRoaXMudXNlckxldmVsREFPLmZpbmRCeVVzZXJBbmRJdGVtKHVpZCwgaXRlbUlkKTtcbiAgICBpZiAoIWxldmVsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZW5yaWNoVXNlckxldmVsV2l0aE5leHRJbmZvKGxldmVsKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfmjIflrprog73lipvpobnnmoTnrYnnuqdcbiAgICovXG4gIGFzeW5jIGdldFVzZXJMZXZlbCh1aWQ6IG51bWJlciwgaXRlbUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJBYmlsaXR5TGV2ZWwgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMudXNlckxldmVsREFPLmZpbmRCeVVzZXJBbmRJdGVtKHVpZCwgaXRlbUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfnu4/pqozorrDlvZVcbiAgICovXG4gIGFzeW5jIGdldEV4cGVyaWVuY2VMb2dzKFxuICAgIHVpZDogbnVtYmVyLFxuICAgIG9wdGlvbnM/OiB7XG4gICAgICBpdGVtSWQ/OiBzdHJpbmc7XG4gICAgICBleHBUeXBlPzogc3RyaW5nO1xuICAgICAgbGltaXQ/OiBudW1iZXI7XG4gICAgICBvZmZzZXQ/OiBudW1iZXI7XG4gICAgfVxuICApOiBQcm9taXNlPFVzZXJBYmlsaXR5RXhwZXJpZW5jZUxvZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMuZXhwZXJpZW5jZUxvZ0RBTy5maW5kQnlVc2VySWQodWlkLCBvcHRpb25zKTtcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiaW5qZWN0YWJsZSIsImluamVjdCIsIlVzZXJBYmlsaXR5TGV2ZWxEQU8iLCJVc2VyQWJpbGl0eUV4cGVyaWVuY2VMb2dEQU8iLCJBYmlsaXR5SXRlbUxldmVsQ29uZmlnREFPIiwiVXNlckFiaWxpdHlTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJ1c2VyTGV2ZWxEQU8iLCJleHBlcmllbmNlTG9nREFPIiwibGV2ZWxDb25maWdEQU8iLCJlbnJpY2hVc2VyTGV2ZWxXaXRoTmV4dEluZm8iLCJsZXZlbCIsImN1cnJlbnRMZXZlbCIsIk51bWJlciIsImN1cnJlbnRfbGV2ZWwiLCJjdXJyZW50RXhwIiwiY3VycmVudF9leHAiLCJuZXh0TGV2ZWwiLCJuZXh0Q29uZmlnIiwiZ2V0Q29uZmlnRm9ySXRlbSIsIml0ZW1faWQiLCJpc19tYXhfbGV2ZWwiLCJyZXF1aXJlZEV4cCIsInJlcXVpcmVkX2V4cCIsImV4cE5lZWRlZCIsIk1hdGgiLCJtYXgiLCJuZXh0X2xldmVsIiwibmV4dF9sZXZlbF9yZXF1aXJlZF9leHAiLCJleHBfbmVlZGVkIiwicmVxdWlyZXNfYXNzZXNzbWVudCIsIm5leHRfbGV2ZWxfbmFtZSIsImxldmVsX25hbWUiLCJnZXRVc2VyTGV2ZWxzIiwidWlkIiwibGV2ZWxzIiwiZmluZEJ5VXNlcklkIiwibGV2ZWxzV2l0aE5leHRJbmZvIiwiUHJvbWlzZSIsImFsbCIsIm1hcCIsImdldFVzZXJMZXZlbFdpdGhOZXh0SW5mbyIsIml0ZW1JZCIsImZpbmRCeVVzZXJBbmRJdGVtIiwiZ2V0VXNlckxldmVsIiwiZ2V0RXhwZXJpZW5jZUxvZ3MiLCJvcHRpb25zIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/services/user-ability.service.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@redis","vendor-chunks/yjs","vendor-chunks/next","vendor-chunks/zod","vendor-chunks/lib0","vendor-chunks/semver","vendor-chunks/reflect-metadata","vendor-chunks/bcryptjs","vendor-chunks/tsyringe","vendor-chunks/generic-pool","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/tslib","vendor-chunks/jws","vendor-chunks/lodash.once","vendor-chunks/jwa","vendor-chunks/cluster-key-slot","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/uuid","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/redis","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fability%2Fdimensions%2Froute&page=%2Fapi%2Fability%2Fdimensions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fability%2Fdimensions%2Froute.ts&appDir=%2FUsers%2Fpikun%2FDocuments%2Ftech_projects%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fpikun%2FDocuments%2Ftech_projects%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();