"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/workspace/[workspace_id]/documents/route";
exports.ids = ["app/api/workspace/[workspace_id]/documents/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("string_decoder");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = import("pg");;

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/workspace/[workspace_id]/documents/route.ts */ \"(rsc)/./src/app/api/workspace/[workspace_id]/documents/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/workspace/[workspace_id]/documents/route\",\n        pathname: \"/api/workspace/[workspace_id]/documents\",\n        filename: \"route\",\n        bundlePath: \"app/api/workspace/[workspace_id]/documents/route\"\n    },\n    resolvedPagePath: \"/Users/kp/Documents/ai-works/pikun-editor-monorepo/apps/server/src/app/api/workspace/[workspace_id]/documents/route.ts\",\n    nextConfigOutput,\n    userland: _Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/workspace/[workspace_id]/documents/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGd29ya3NwYWNlJTJGJTVCd29ya3NwYWNlX2lkJTVEJTJGZG9jdW1lbnRzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZ3b3Jrc3BhY2UlMkYlNUJ3b3Jrc3BhY2VfaWQlNUQlMkZkb2N1bWVudHMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ3b3Jrc3BhY2UlMkYlNUJ3b3Jrc3BhY2VfaWQlNUQlMkZkb2N1bWVudHMlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZrcCUyRkRvY3VtZW50cyUyRmFpLXdvcmtzJTJGcGlrdW4tZWRpdG9yLW1vbm9yZXBvJTJGYXBwcyUyRnNlcnZlciUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZrcCUyRkRvY3VtZW50cyUyRmFpLXdvcmtzJTJGcGlrdW4tZWRpdG9yLW1vbm9yZXBvJTJGYXBwcyUyRnNlcnZlciZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDc0U7QUFDbko7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvPzBmMzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2twL0RvY3VtZW50cy9haS13b3Jrcy9waWt1bi1lZGl0b3ItbW9ub3JlcG8vYXBwcy9zZXJ2ZXIvc3JjL2FwcC9hcGkvd29ya3NwYWNlL1t3b3Jrc3BhY2VfaWRdL2RvY3VtZW50cy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvd29ya3NwYWNlL1t3b3Jrc3BhY2VfaWRdL2RvY3VtZW50cy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3dvcmtzcGFjZS9bd29ya3NwYWNlX2lkXS9kb2N1bWVudHNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3dvcmtzcGFjZS9bd29ya3NwYWNlX2lkXS9kb2N1bWVudHMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMva3AvRG9jdW1lbnRzL2FpLXdvcmtzL3Bpa3VuLWVkaXRvci1tb25vcmVwby9hcHBzL3NlcnZlci9zcmMvYXBwL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/api/auth/auth.controller.ts":
/*!*****************************************!*\
  !*** ./src/api/auth/auth.controller.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthController: () => (/* binding */ AuthController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_auth_service__WEBPACK_IMPORTED_MODULE_2__]);\n_services_auth_service__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nclass AuthController {\n    constructor(authService){\n        this.authService = authService;\n    }\n    /**\n   * 用户注册\n   */ async register(req) {\n        try {\n            const body = await req.json();\n            const registerSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                email: zod__WEBPACK_IMPORTED_MODULE_3__.string().email(),\n                password: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(6),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1)\n            });\n            const validatedData = registerSchema.parse(body);\n            const result = await this.authService.register(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Registration failed\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 用户登录\n   */ async login(req) {\n        try {\n            const body = await req.json();\n            const loginSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                email: zod__WEBPACK_IMPORTED_MODULE_3__.string().email(),\n                password: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1)\n            });\n            const validatedData = loginSchema.parse(body);\n            const result = await this.authService.login(validatedData.email, validatedData.password);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Login failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 刷新 token\n   */ async refreshToken(req) {\n        try {\n            const body = await req.json();\n            const refreshSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                refreshToken: zod__WEBPACK_IMPORTED_MODULE_3__.string()\n            });\n            const validatedData = refreshSchema.parse(body);\n            const result = await this.authService.refreshToken(validatedData.refreshToken);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Token refresh failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 验证 token\n   */ async verifyToken(req) {\n        try {\n            const authHeader = req.headers.get(\"authorization\");\n            if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"No token provided\"\n                }, {\n                    status: 401\n                });\n            }\n            const token = authHeader.substring(7);\n            const decoded = await this.authService.verifyToken(token);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    is_new: false,\n                    uid: decoded.uid,\n                    uuid: decoded.uuid\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Token verification failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n}\nAuthController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:paramtypes\", [\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService\n    ])\n], AuthController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTUUsT0FBTyxJQUFJO1lBQzVCLEdBQ0E7Z0JBQUVFLFFBQVE7WUFBSTtRQUVsQjtJQUNGO0FBQ0Y7QUFoS2F2QixpQkFBQUEsb0VBQUFBO0lBRFpILG9EQUFVQTtJQUVJQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUNDLCtEQUFXQTs7O2VBQXVCLCtEQUFXLDRCQUFYLCtEQUFXOztHQUR0REMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBpL2F1dGgvYXV0aC5jb250cm9sbGVyLnRzPzExNWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XG5cbi8qKlxuICog6K6k6K+B5o6n5Yi25ZmoXG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBdXRoQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKEBpbmplY3QoQXV0aFNlcnZpY2UpIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlKSB7fVxuXG4gIC8qKlxuICAgKiDnlKjmiLfms6jlhoxcbiAgICovXG4gIGFzeW5jIHJlZ2lzdGVyKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICAgIGNvbnN0IHJlZ2lzdGVyU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxuICAgICAgICBwYXNzd29yZDogei5zdHJpbmcoKS5taW4oNiksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSByZWdpc3RlclNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UucmVnaXN0ZXIodmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIC8vIOWkhOeQhiBab2Qg6aqM6K+B6ZSZ6K+vXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdSZWdpc3RyYXRpb24gZmFpbGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDnlKjmiLfnmbvlvZVcbiAgICovXG4gIGFzeW5jIGxvZ2luKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICAgIGNvbnN0IGxvZ2luU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxuICAgICAgICBwYXNzd29yZDogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGxvZ2luU2NoZW1hLnBhcnNlKGJvZHkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5sb2dpbih2YWxpZGF0ZWREYXRhLmVtYWlsLCB2YWxpZGF0ZWREYXRhLnBhc3N3b3JkKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8g5aSE55CGIFpvZCDpqozor4HplJnor69cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0xvZ2luIGZhaWxlZCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yi35pawIHRva2VuXG4gICAqL1xuICBhc3luYyByZWZyZXNoVG9rZW4ocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuICAgICAgY29uc3QgcmVmcmVzaFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgcmVmcmVzaFRva2VuOiB6LnN0cmluZygpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSByZWZyZXNoU2NoZW1hLnBhcnNlKGJvZHkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5yZWZyZXNoVG9rZW4odmFsaWRhdGVkRGF0YS5yZWZyZXNoVG9rZW4pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyDlpITnkIYgWm9kIOmqjOivgemUmeivr1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnVG9rZW4gcmVmcmVzaCBmYWlsZWQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOmqjOivgSB0b2tlblxuICAgKi9cbiAgYXN5bmMgdmVyaWZ5VG9rZW4ocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ05vIHRva2VuIHByb3ZpZGVkJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UudmVyaWZ5VG9rZW4odG9rZW4pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaXNfbmV3OiBmYWxzZSwgLy8g5Y+v5Lul5qC55o2u6ZyA6KaB5a6e546wXG4gICAgICAgICAgdWlkOiBkZWNvZGVkLnVpZCxcbiAgICAgICAgICB1dWlkOiBkZWNvZGVkLnV1aWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdUb2tlbiB2ZXJpZmljYXRpb24gZmFpbGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInoiLCJpbmplY3RhYmxlIiwiaW5qZWN0IiwiQXV0aFNlcnZpY2UiLCJBdXRoQ29udHJvbGxlciIsImNvbnN0cnVjdG9yIiwiYXV0aFNlcnZpY2UiLCJyZWdpc3RlciIsInJlcSIsImJvZHkiLCJqc29uIiwicmVnaXN0ZXJTY2hlbWEiLCJvYmplY3QiLCJlbWFpbCIsInN0cmluZyIsInBhc3N3b3JkIiwibWluIiwibmFtZSIsInZhbGlkYXRlZERhdGEiLCJwYXJzZSIsInJlc3VsdCIsInN1Y2Nlc3MiLCJkYXRhIiwiZXJyb3IiLCJab2RFcnJvciIsIm1lc3NhZ2UiLCJlcnJvcnMiLCJzdGF0dXMiLCJsb2dpbiIsImxvZ2luU2NoZW1hIiwicmVmcmVzaFRva2VuIiwicmVmcmVzaFNjaGVtYSIsInZlcmlmeVRva2VuIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJzdGFydHNXaXRoIiwidG9rZW4iLCJzdWJzdHJpbmciLCJkZWNvZGVkIiwiaXNfbmV3IiwidWlkIiwidXVpZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/api/auth/auth.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/documents/document.controller.ts":
/*!**************************************************!*\
  !*** ./src/api/documents/document.controller.ts ***!
  \**************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentController: () => (/* binding */ DocumentController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_document_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/document.service */ \"(rsc)/./src/services/document.service.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_document_service__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_services_document_service__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\nclass DocumentController {\n    constructor(documentService, authService){\n        this.documentService = documentService;\n        this.authService = authService;\n    }\n    /**\n   * 获取当前用户（从 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.authService.verifyToken(token);\n    }\n    /**\n   * 创建文档\n   */ async createDocument(req, context) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const body = await req.json();\n            const createSchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n                title: zod__WEBPACK_IMPORTED_MODULE_4__.string().min(1),\n                content: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_4__.record(zod__WEBPACK_IMPORTED_MODULE_4__.any()).optional().nullable()\n            });\n            const validatedData = createSchema.parse(body);\n            // 如果没有提供 content，创建一个空的 Buffer（空 Yjs 文档）\n            const contentBuffer = validatedData.content ? Buffer.from(validatedData.content, \"base64\") : Buffer.alloc(0);\n            const document = await this.documentService.createDocument({\n                workspace_id: context.params.workspace_id,\n                title: validatedData.title,\n                content: contentBuffer,\n                owner_uid: user.uid,\n                metadata: validatedData.metadata\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    workspace_id: document.workspace_id,\n                    created_at: document.created_at instanceof Date ? document.created_at.toISOString() : document.created_at\n                }\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_5__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 400\n            });\n        }\n    }\n    /**\n   * 获取文档\n   */ async getDocument(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const includeContent = req.nextUrl.searchParams.get(\"include_content\") === \"true\";\n            const document = await this.documentService.getDocument(context.params.object_id, includeContent);\n            if (!document) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Document not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    workspace_id: document.workspace_id,\n                    title: document.title,\n                    content: includeContent ? document.content.toString(\"base64\") : undefined,\n                    content_length: document.content_length,\n                    owner_uid: document.owner_uid,\n                    metadata: document.metadata,\n                    created_at: document.created_at instanceof Date ? document.created_at.toISOString() : document.created_at,\n                    updated_at: document.updated_at instanceof Date ? document.updated_at.toISOString() : document.updated_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 更新文档\n   */ async updateDocument(req, context) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const body = await req.json();\n            const updateSchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n                title: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                content: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                change_data: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                snapshot: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_4__.record(zod__WEBPACK_IMPORTED_MODULE_4__.any()).optional().nullable(),\n                forceSnapshot: zod__WEBPACK_IMPORTED_MODULE_4__.boolean().optional().default(false)\n            });\n            const validatedData = updateSchema.parse(body);\n            const updates = {};\n            if (validatedData.title) updates.title = validatedData.title;\n            if (validatedData.content) {\n                updates.content = Buffer.from(validatedData.content, \"base64\");\n            }\n            if (validatedData.change_data) {\n                updates.change_data = Buffer.from(validatedData.change_data, \"base64\");\n            }\n            if (validatedData.snapshot) {\n                updates.snapshot = Buffer.from(validatedData.snapshot, \"base64\");\n            }\n            if (validatedData.metadata) updates.metadata = validatedData.metadata;\n            if (validatedData.forceSnapshot !== undefined) {\n                updates.forceSnapshot = validatedData.forceSnapshot;\n            }\n            const document = await this.documentService.updateDocument(context.params.object_id, updates);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    updated_at: document.updated_at instanceof Date ? document.updated_at.toISOString() : document.updated_at\n                }\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_5__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 400\n            });\n        }\n    }\n    /**\n   * 获取文档列表\n   */ async getDocuments(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const page = parseInt(req.nextUrl.searchParams.get(\"page\") || \"1\", 10);\n            const page_size = parseInt(req.nextUrl.searchParams.get(\"page_size\") || \"20\", 10);\n            const sort_by = req.nextUrl.searchParams.get(\"sort_by\") || \"updated_at\";\n            const order = req.nextUrl.searchParams.get(\"order\") || \"desc\";\n            const result = await this.documentService.getDocuments(context.params.workspace_id, {\n                page,\n                page_size,\n                sort_by,\n                order\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get documents\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 删除文档\n   */ async deleteDocument(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            await this.documentService.deleteDocument(context.params.object_id);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: \"Document deleted successfully\"\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const limit = parseInt(req.nextUrl.searchParams.get(\"limit\") || \"20\", 10);\n            const offset = parseInt(req.nextUrl.searchParams.get(\"offset\") || \"0\", 10);\n            const result = await this.documentService.getSnapshots(context.params.object_id, {\n                limit,\n                offset\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get snapshots\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const snapshot = await this.documentService.getLatestSnapshot(context.params.object_id);\n            if (!snapshot) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Snapshot not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    snapshot_id: snapshot.snapshot_id,\n                    doc_state: snapshot.doc_state?.toString(\"base64\"),\n                    snapshot: snapshot.snapshot_data.toString(\"base64\"),\n                    created_at: snapshot.created_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get latest snapshot\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 根据 snapshot_id 获取快照内容\n   */ async getSnapshotById(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const snapshot = await this.documentService.getSnapshotById(context.params.snapshot_id);\n            if (!snapshot) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Snapshot not found\"\n                }, {\n                    status: 404\n                });\n            }\n            // 从数据库获取快照内容\n            let docStateBase64 = null;\n            if (snapshot.doc_state) {\n                docStateBase64 = snapshot.doc_state.toString(\"base64\");\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    snapshot_id: snapshot.snapshot_id,\n                    doc_state: docStateBase64,\n                    snapshot: snapshot.snapshot_data?.toString(\"base64\") || null,\n                    created_at: snapshot.created_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get snapshot\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 搜索文档\n   */ async searchDocuments(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const query = req.nextUrl.searchParams.get(\"query\");\n            if (!query) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Query parameter is required\"\n                }, {\n                    status: 400\n                });\n            }\n            const limit = parseInt(req.nextUrl.searchParams.get(\"limit\") || \"10\", 10);\n            const offset = parseInt(req.nextUrl.searchParams.get(\"offset\") || \"0\", 10);\n            const threshold = parseFloat(req.nextUrl.searchParams.get(\"threshold\") || \"0.5\");\n            const results = await this.documentService.searchDocuments(context.params.workspace_id, query, {\n                limit,\n                offset,\n                threshold\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: results\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to search documents\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n}\nDocumentController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService === \"undefined\" ? Object : _services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService,\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService\n    ])\n], DocumentController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL2RvY3VtZW50cy9kb2N1bWVudC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXdEO0FBQ2hDO0FBQ3NCO0FBQ2dCO0FBQ1I7QUFNL0MsTUFBTU07SUFDWEMsWUFDRSxlQUFpRSxFQUNqRSxXQUFxRCxDQUNyRDthQUZpQ0Msa0JBQUFBO2FBQ0pDLGNBQUFBO0lBQzVCO0lBRUg7O0dBRUMsR0FDRCxNQUFjQyxlQUFlQyxHQUFnQixFQUEwQztRQUNyRixNQUFNQyxhQUFhRCxJQUFJRSxPQUFPLENBQUNDLEdBQUcsQ0FBQztRQUNuQyxJQUFJLENBQUNGLGNBQWMsQ0FBQ0EsV0FBV0csVUFBVSxDQUFDLFlBQVk7WUFDcEQsTUFBTSxJQUFJQyxNQUFNO1FBQ2xCO1FBRUEsTUFBTUMsUUFBUUwsV0FBV00sU0FBUyxDQUFDO1FBQ25DLE9BQU8sTUFBTSxJQUFJLENBQUNULFdBQVcsQ0FBQ1UsV0FBVyxDQUFDRjtJQUM1QztJQUVBOztHQUVDLEdBQ0QsTUFBTUcsZUFDSlQsR0FBZ0IsRUFDaEJVLE9BQTZDLEVBQ3RCO1FBQ3ZCLElBQUk7WUFDRixNQUFNQyxPQUFPLE1BQU0sSUFBSSxDQUFDWixjQUFjLENBQUNDO1lBQ3ZDLE1BQU1ZLE9BQU8sTUFBTVosSUFBSWEsSUFBSTtZQUUzQixNQUFNQyxlQUFleEIsdUNBQVEsQ0FBQztnQkFDNUIwQixPQUFPMUIsdUNBQVEsR0FBRzRCLEdBQUcsQ0FBQztnQkFDdEJDLFNBQVM3Qix1Q0FBUSxHQUFHOEIsUUFBUSxHQUFHQyxRQUFRO2dCQUN2Q0MsVUFBVWhDLHVDQUFRLENBQUNBLG9DQUFLLElBQUk4QixRQUFRLEdBQUdDLFFBQVE7WUFDakQ7WUFFQSxNQUFNSSxnQkFBZ0JYLGFBQWFZLEtBQUssQ0FBQ2Q7WUFDekMseUNBQXlDO1lBQ3pDLE1BQU1lLGdCQUFnQkYsY0FBY04sT0FBTyxHQUN2Q1MsT0FBT0MsSUFBSSxDQUFDSixjQUFjTixPQUFPLEVBQUUsWUFDbkNT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LFNBQVM7Z0JBQ1RDLE1BQU0rQztZQUNSO1FBQ0YsRUFBRSxPQUFPMUMsT0FBWTtZQUNuQixPQUFPckQscURBQVlBLENBQUN3QixJQUFJLENBQ3RCO2dCQUNFdUIsU0FBUztnQkFDVFEsU0FBU0YsTUFBTUUsT0FBTyxJQUFJO1lBQzVCLEdBQ0E7Z0JBQUVFLFFBQVFKLE1BQU1FLE9BQU8sS0FBSyxpQkFBaUIsTUFBTTtZQUFJO1FBRTNEO0lBQ0Y7QUFDRjtBQXRiYWpELHFCQUFBQSxvRUFBQUE7SUFEWkosb0RBQVVBO0lBR05DLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQ0MsdUVBQWVBO0lBQ3RCRCxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUNFLCtEQUFXQTs7O2VBRCtCLHVFQUFlLDRCQUFmLHVFQUFlO2VBQ3ZCLCtEQUFXLDRCQUFYLCtEQUFXOztHQUg1Q0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBpL2RvY3VtZW50cy9kb2N1bWVudC5jb250cm9sbGVyLnRzPzJlZjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgRG9jdW1lbnRTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9kb2N1bWVudC5zZXJ2aWNlJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xuXG4vKipcbiAqIOaWh+aho+aOp+WItuWZqFxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQGluamVjdChEb2N1bWVudFNlcnZpY2UpIHByaXZhdGUgZG9jdW1lbnRTZXJ2aWNlOiBEb2N1bWVudFNlcnZpY2UsXG4gICAgQGluamVjdChBdXRoU2VydmljZSkgcHJpdmF0ZSBhdXRoU2VydmljZTogQXV0aFNlcnZpY2VcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiDojrflj5blvZPliY3nlKjmiLfvvIjku44gdG9rZW7vvIlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q3VycmVudFVzZXIocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8eyB1aWQ6IG51bWJlcjsgdXVpZDogc3RyaW5nIH0+IHtcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJyk7XG4gICAgaWYgKCFhdXRoSGVhZGVyIHx8ICFhdXRoSGVhZGVyLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmF1dGhvcml6ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLnZlcmlmeVRva2VuKHRva2VuKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlofmoaNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZURvY3VtZW50KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmcgfSB9XG4gICk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcblxuICAgICAgY29uc3QgY3JlYXRlU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICB0aXRsZTogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICAgIGNvbnRlbnQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5udWxsYWJsZSgpLCAvLyBCYXNlNjQg57yW56CB55qE5YaF5a6577yM5Y+v6YCJXG4gICAgICAgIG1ldGFkYXRhOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNyZWF0ZVNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIC8vIOWmguaenOayoeacieaPkOS+myBjb250ZW5077yM5Yib5bu65LiA5Liq56m655qEIEJ1ZmZlcu+8iOepuiBZanMg5paH5qGj77yJXG4gICAgICBjb25zdCBjb250ZW50QnVmZmVyID0gdmFsaWRhdGVkRGF0YS5jb250ZW50XG4gICAgICAgID8gQnVmZmVyLmZyb20odmFsaWRhdGVkRGF0YS5jb250ZW50LCAnYmFzZTY0JylcbiAgICAgICAgOiBCdWZmZXIuYWxsb2MoMCk7XG5cbiAgICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2UuY3JlYXRlRG9jdW1lbnQoe1xuICAgICAgICB3b3Jrc3BhY2VfaWQ6IGNvbnRleHQucGFyYW1zLndvcmtzcGFjZV9pZCxcbiAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRCdWZmZXIsXG4gICAgICAgIG93bmVyX3VpZDogdXNlci51aWQsXG4gICAgICAgIG1ldGFkYXRhOiB2YWxpZGF0ZWREYXRhLm1ldGFkYXRhLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBvYmplY3RfaWQ6IGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICB3b3Jrc3BhY2VfaWQ6IGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgICBjcmVhdGVkX2F0OiBkb2N1bWVudC5jcmVhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZSA/IGRvY3VtZW50LmNyZWF0ZWRfYXQudG9JU09TdHJpbmcoKSA6IGRvY3VtZW50LmNyZWF0ZWRfYXQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyDlpITnkIYgWm9kIOmqjOivgemUmeivr1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGNyZWF0ZSBkb2N1bWVudCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaNcbiAgICovXG4gIGFzeW5jIGdldERvY3VtZW50KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGNvbnN0IGluY2x1ZGVDb250ZW50ID0gcmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnaW5jbHVkZV9jb250ZW50JykgPT09ICd0cnVlJztcbiAgICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2UuZ2V0RG9jdW1lbnQoXG4gICAgICAgIGNvbnRleHQucGFyYW1zLm9iamVjdF9pZCxcbiAgICAgICAgaW5jbHVkZUNvbnRlbnRcbiAgICAgICk7XG5cbiAgICAgIGlmICghZG9jdW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0RvY3VtZW50IG5vdCBmb3VuZCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG9iamVjdF9pZDogZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgIHdvcmtzcGFjZV9pZDogZG9jdW1lbnQud29ya3NwYWNlX2lkLFxuICAgICAgICAgIHRpdGxlOiBkb2N1bWVudC50aXRsZSxcbiAgICAgICAgICBjb250ZW50OiBpbmNsdWRlQ29udGVudCA/IGRvY3VtZW50LmNvbnRlbnQudG9TdHJpbmcoJ2Jhc2U2NCcpIDogdW5kZWZpbmVkLFxuICAgICAgICAgIGNvbnRlbnRfbGVuZ3RoOiBkb2N1bWVudC5jb250ZW50X2xlbmd0aCxcbiAgICAgICAgICBvd25lcl91aWQ6IGRvY3VtZW50Lm93bmVyX3VpZCxcbiAgICAgICAgICBtZXRhZGF0YTogZG9jdW1lbnQubWV0YWRhdGEsXG4gICAgICAgICAgY3JlYXRlZF9hdDogZG9jdW1lbnQuY3JlYXRlZF9hdCBpbnN0YW5jZW9mIERhdGUgPyBkb2N1bWVudC5jcmVhdGVkX2F0LnRvSVNPU3RyaW5nKCkgOiBkb2N1bWVudC5jcmVhdGVkX2F0LFxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IGRvY3VtZW50LnVwZGF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gZG9jdW1lbnQudXBkYXRlZF9hdC50b0lTT1N0cmluZygpIDogZG9jdW1lbnQudXBkYXRlZF9hdCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgZG9jdW1lbnQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5pu05paw5paH5qGjXG4gICAqL1xuICBhc3luYyB1cGRhdGVEb2N1bWVudChcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXIocmVxKTtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuXG4gICAgICBjb25zdCB1cGRhdGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIHRpdGxlOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICAgICAgY29udGVudDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksIC8vIEJhc2U2NCDnvJbnoIHnmoTlhoXlrrnvvIhEb2MgU3RhdGXvvIlcbiAgICAgICAgY2hhbmdlX2RhdGE6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5udWxsYWJsZSgpLCAvLyBCYXNlNjQg57yW56CB55qE5aKe6YeP5pu05paw77yIWWpzIFVwZGF0Ze+8iVxuICAgICAgICBzbmFwc2hvdDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksIC8vIEJhc2U2NCDnvJbnoIHnmoQgU25hcHNob3TvvIjnirbmgIHlkJHph4/vvIlcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICAgICAgZm9yY2VTbmFwc2hvdDogei5ib29sZWFuKCkub3B0aW9uYWwoKS5kZWZhdWx0KGZhbHNlKSwgLy8g5piv5ZCm5by65Yi25Yib5bu65b+r54WnXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHVwZGF0ZVNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IHVwZGF0ZXM6IGFueSA9IHt9O1xuXG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS50aXRsZSkgdXBkYXRlcy50aXRsZSA9IHZhbGlkYXRlZERhdGEudGl0bGU7XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5jb250ZW50KSB7XG4gICAgICAgIHVwZGF0ZXMuY29udGVudCA9IEJ1ZmZlci5mcm9tKHZhbGlkYXRlZERhdGEuY29udGVudCwgJ2Jhc2U2NCcpO1xuICAgICAgfVxuICAgICAgaWYgKHZhbGlkYXRlZERhdGEuY2hhbmdlX2RhdGEpIHtcbiAgICAgICAgdXBkYXRlcy5jaGFuZ2VfZGF0YSA9IEJ1ZmZlci5mcm9tKHZhbGlkYXRlZERhdGEuY2hhbmdlX2RhdGEsICdiYXNlNjQnKTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWxpZGF0ZWREYXRhLnNuYXBzaG90KSB7XG4gICAgICAgIHVwZGF0ZXMuc25hcHNob3QgPSBCdWZmZXIuZnJvbSh2YWxpZGF0ZWREYXRhLnNuYXBzaG90LCAnYmFzZTY0Jyk7XG4gICAgICB9XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5tZXRhZGF0YSkgdXBkYXRlcy5tZXRhZGF0YSA9IHZhbGlkYXRlZERhdGEubWV0YWRhdGE7XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5mb3JjZVNuYXBzaG90ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXBkYXRlcy5mb3JjZVNuYXBzaG90ID0gdmFsaWRhdGVkRGF0YS5mb3JjZVNuYXBzaG90O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLnVwZGF0ZURvY3VtZW50KGNvbnRleHQucGFyYW1zLm9iamVjdF9pZCwgdXBkYXRlcyk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBvYmplY3RfaWQ6IGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICB1cGRhdGVkX2F0OiBkb2N1bWVudC51cGRhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZSA/IGRvY3VtZW50LnVwZGF0ZWRfYXQudG9JU09TdHJpbmcoKSA6IGRvY3VtZW50LnVwZGF0ZWRfYXQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyDlpITnkIYgWm9kIOmqjOivgemUmeivr1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHVwZGF0ZSBkb2N1bWVudCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPliJfooahcbiAgICovXG4gIGFzeW5jIGdldERvY3VtZW50cyhcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGNvbnN0IHBhZ2UgPSBwYXJzZUludChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdwYWdlJykgfHwgJzEnLCAxMCk7XG4gICAgICBjb25zdCBwYWdlX3NpemUgPSBwYXJzZUludChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdwYWdlX3NpemUnKSB8fCAnMjAnLCAxMCk7XG4gICAgICBjb25zdCBzb3J0X2J5ID1cbiAgICAgICAgKHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ3NvcnRfYnknKSBhcyAnY3JlYXRlZF9hdCcgfCAndXBkYXRlZF9hdCcgfCAndGl0bGUnKSB8fFxuICAgICAgICAndXBkYXRlZF9hdCc7XG4gICAgICBjb25zdCBvcmRlciA9IChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdvcmRlcicpIGFzICdhc2MnIHwgJ2Rlc2MnKSB8fCAnZGVzYyc7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmdldERvY3VtZW50cyhjb250ZXh0LnBhcmFtcy53b3Jrc3BhY2VfaWQsIHtcbiAgICAgICAgcGFnZSxcbiAgICAgICAgcGFnZV9zaXplLFxuICAgICAgICBzb3J0X2J5LFxuICAgICAgICBvcmRlcixcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGRvY3VtZW50cycsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTmlofmoaNcbiAgICovXG4gIGFzeW5jIGRlbGV0ZURvY3VtZW50KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmRlbGV0ZURvY3VtZW50KGNvbnRleHQucGFyYW1zLm9iamVjdF9pZCk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdEb2N1bWVudCBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZGVsZXRlIGRvY3VtZW50JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho+W/q+eFp+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0U25hcHNob3RzKFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSB8fCAnMjAnLCAxMCk7XG4gICAgICBjb25zdCBvZmZzZXQgPSBwYXJzZUludChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdvZmZzZXQnKSB8fCAnMCcsIDEwKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2UuZ2V0U25hcHNob3RzKGNvbnRleHQucGFyYW1zLm9iamVjdF9pZCwge1xuICAgICAgICBsaW1pdCxcbiAgICAgICAgb2Zmc2V0LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgc25hcHNob3RzJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluacgOaWsOW/q+eFp1xuICAgKi9cbiAgYXN5bmMgZ2V0TGF0ZXN0U25hcHNob3QoXG4gICAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZzsgb2JqZWN0X2lkOiBzdHJpbmcgfSB9XG4gICk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXIocmVxKTtcblxuICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5nZXRMYXRlc3RTbmFwc2hvdChjb250ZXh0LnBhcmFtcy5vYmplY3RfaWQpO1xuXG4gICAgICBpZiAoIXNuYXBzaG90KSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTbmFwc2hvdCBub3QgZm91bmQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBzbmFwc2hvdF9pZDogc25hcHNob3Quc25hcHNob3RfaWQsXG4gICAgICAgICAgZG9jX3N0YXRlOiBzbmFwc2hvdC5kb2Nfc3RhdGU/LnRvU3RyaW5nKCdiYXNlNjQnKSxcbiAgICAgICAgICBzbmFwc2hvdDogc25hcHNob3Quc25hcHNob3RfZGF0YS50b1N0cmluZygnYmFzZTY0JyksXG4gICAgICAgICAgY3JlYXRlZF9hdDogc25hcHNob3QuY3JlYXRlZF9hdCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgbGF0ZXN0IHNuYXBzaG90JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBzbmFwc2hvdF9pZCDojrflj5blv6vnhaflhoXlrrlcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90QnlJZChcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZzsgc25hcHNob3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmdldFNuYXBzaG90QnlJZChjb250ZXh0LnBhcmFtcy5zbmFwc2hvdF9pZCk7XG5cbiAgICAgIGlmICghc25hcHNob3QpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1NuYXBzaG90IG5vdCBmb3VuZCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8g5LuO5pWw5o2u5bqT6I635Y+W5b+r54Wn5YaF5a65XG4gICAgICBsZXQgZG9jU3RhdGVCYXNlNjQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgICAgaWYgKHNuYXBzaG90LmRvY19zdGF0ZSkge1xuICAgICAgICBkb2NTdGF0ZUJhc2U2NCA9IHNuYXBzaG90LmRvY19zdGF0ZS50b1N0cmluZygnYmFzZTY0Jyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBzbmFwc2hvdF9pZDogc25hcHNob3Quc25hcHNob3RfaWQsXG4gICAgICAgICAgZG9jX3N0YXRlOiBkb2NTdGF0ZUJhc2U2NCxcbiAgICAgICAgICBzbmFwc2hvdDogc25hcHNob3Quc25hcHNob3RfZGF0YT8udG9TdHJpbmcoJ2Jhc2U2NCcpIHx8IG51bGwsXG4gICAgICAgICAgY3JlYXRlZF9hdDogc25hcHNob3QuY3JlYXRlZF9hdCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgc25hcHNob3QnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5pCc57Si5paH5qGjXG4gICAqL1xuICBhc3luYyBzZWFyY2hEb2N1bWVudHMoXG4gICAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBjb25zdCBxdWVyeSA9IHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ3F1ZXJ5Jyk7XG4gICAgICBpZiAoIXF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdRdWVyeSBwYXJhbWV0ZXIgaXMgcmVxdWlyZWQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSB8fCAnMTAnLCAxMCk7XG4gICAgICBjb25zdCBvZmZzZXQgPSBwYXJzZUludChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdvZmZzZXQnKSB8fCAnMCcsIDEwKTtcbiAgICAgIGNvbnN0IHRocmVzaG9sZCA9IHBhcnNlRmxvYXQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgndGhyZXNob2xkJykgfHwgJzAuNScpO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2Uuc2VhcmNoRG9jdW1lbnRzKFxuICAgICAgICBjb250ZXh0LnBhcmFtcy53b3Jrc3BhY2VfaWQsXG4gICAgICAgIHF1ZXJ5LFxuICAgICAgICB7XG4gICAgICAgICAgbGltaXQsXG4gICAgICAgICAgb2Zmc2V0LFxuICAgICAgICAgIHRocmVzaG9sZCxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0cyxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBzZWFyY2ggZG9jdW1lbnRzJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwieiIsImluamVjdGFibGUiLCJpbmplY3QiLCJEb2N1bWVudFNlcnZpY2UiLCJBdXRoU2VydmljZSIsIkRvY3VtZW50Q29udHJvbGxlciIsImNvbnN0cnVjdG9yIiwiZG9jdW1lbnRTZXJ2aWNlIiwiYXV0aFNlcnZpY2UiLCJnZXRDdXJyZW50VXNlciIsInJlcSIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwiZ2V0Iiwic3RhcnRzV2l0aCIsIkVycm9yIiwidG9rZW4iLCJzdWJzdHJpbmciLCJ2ZXJpZnlUb2tlbiIsImNyZWF0ZURvY3VtZW50IiwiY29udGV4dCIsInVzZXIiLCJib2R5IiwianNvbiIsImNyZWF0ZVNjaGVtYSIsIm9iamVjdCIsInRpdGxlIiwic3RyaW5nIiwibWluIiwiY29udGVudCIsIm9wdGlvbmFsIiwibnVsbGFibGUiLCJtZXRhZGF0YSIsInJlY29yZCIsImFueSIsInZhbGlkYXRlZERhdGEiLCJwYXJzZSIsImNvbnRlbnRCdWZmZXIiLCJCdWZmZXIiLCJmcm9tIiwiYWxsb2MiLCJkb2N1bWVudCIsIndvcmtzcGFjZV9pZCIsInBhcmFtcyIsIm93bmVyX3VpZCIsInVpZCIsInN1Y2Nlc3MiLCJkYXRhIiwib2JqZWN0X2lkIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImVycm9yIiwiWm9kRXJyb3IiLCJtZXNzYWdlIiwiZXJyb3JzIiwic3RhdHVzIiwiZ2V0RG9jdW1lbnQiLCJpbmNsdWRlQ29udGVudCIsIm5leHRVcmwiLCJzZWFyY2hQYXJhbXMiLCJ0b1N0cmluZyIsInVuZGVmaW5lZCIsImNvbnRlbnRfbGVuZ3RoIiwidXBkYXRlZF9hdCIsInVwZGF0ZURvY3VtZW50IiwidXBkYXRlU2NoZW1hIiwiY2hhbmdlX2RhdGEiLCJzbmFwc2hvdCIsImZvcmNlU25hcHNob3QiLCJib29sZWFuIiwiZGVmYXVsdCIsInVwZGF0ZXMiLCJnZXREb2N1bWVudHMiLCJwYWdlIiwicGFyc2VJbnQiLCJwYWdlX3NpemUiLCJzb3J0X2J5Iiwib3JkZXIiLCJyZXN1bHQiLCJkZWxldGVEb2N1bWVudCIsImdldFNuYXBzaG90cyIsImxpbWl0Iiwib2Zmc2V0IiwiZ2V0TGF0ZXN0U25hcHNob3QiLCJzbmFwc2hvdF9pZCIsImRvY19zdGF0ZSIsInNuYXBzaG90X2RhdGEiLCJnZXRTbmFwc2hvdEJ5SWQiLCJkb2NTdGF0ZUJhc2U2NCIsInNlYXJjaERvY3VtZW50cyIsInF1ZXJ5IiwidGhyZXNob2xkIiwicGFyc2VGbG9hdCIsInJlc3VsdHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/api/documents/document.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/workspace/workspace.controller.ts":
/*!***************************************************!*\
  !*** ./src/api/workspace/workspace.controller.ts ***!
  \***************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WorkspaceController: () => (/* binding */ WorkspaceController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\nclass WorkspaceController {\n    constructor(workspaceDAO, authService){\n        this.workspaceDAO = workspaceDAO;\n        this.authService = authService;\n    }\n    /**\n   * 获取当前用户（从 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.authService.verifyToken(token);\n    }\n    /**\n   * 获取用户的默认工作空间\n   */ async getDefaultWorkspace(req) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const workspace = await this.workspaceDAO.getOrCreateDefault(user.uid);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    workspace_id: workspace.workspace_id,\n                    name: workspace.name,\n                    owner_uid: workspace.owner_uid,\n                    icon: workspace.icon,\n                    metadata: workspace.metadata,\n                    created_at: workspace.created_at instanceof Date ? workspace.created_at.toISOString() : workspace.created_at,\n                    updated_at: workspace.updated_at instanceof Date ? workspace.updated_at.toISOString() : workspace.updated_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get default workspace\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取用户的所有工作空间\n   */ async getWorkspaces(req) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const workspaces = await this.workspaceDAO.findByOwnerUid(user.uid);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: workspaces.map((w)=>({\n                        workspace_id: w.workspace_id,\n                        name: w.name,\n                        owner_uid: w.owner_uid,\n                        icon: w.icon,\n                        metadata: w.metadata,\n                        created_at: w.created_at instanceof Date ? w.created_at.toISOString() : w.created_at,\n                        updated_at: w.updated_at instanceof Date ? w.updated_at.toISOString() : w.updated_at\n                    }))\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get workspaces\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n}\nWorkspaceController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(\"WorkspaceDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__.WorkspaceDAO === \"undefined\" ? Object : _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__.WorkspaceDAO,\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService\n    ])\n], WorkspaceController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL3dvcmtzcGFjZS93b3Jrc3BhY2UuY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDVjtBQUNLO0FBQ0c7QUFNL0MsTUFBTUs7SUFDWEMsWUFDRSxZQUEwRCxFQUMxRCxXQUFxRCxDQUNyRDthQUZnQ0MsZUFBQUE7YUFDSEMsY0FBQUE7SUFDNUI7SUFFSDs7R0FFQyxHQUNELE1BQWNDLGVBQWVDLEdBQWdCLEVBQTBDO1FBQ3JGLE1BQU1DLGFBQWFELElBQUlFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO1FBQ25DLElBQUksQ0FBQ0YsY0FBYyxDQUFDQSxXQUFXRyxVQUFVLENBQUMsWUFBWTtZQUNwRCxNQUFNLElBQUlDLE1BQU07UUFDbEI7UUFFQSxNQUFNQyxRQUFRTCxXQUFXTSxTQUFTLENBQUM7UUFDbkMsT0FBTyxNQUFNLElBQUksQ0FBQ1QsV0FBVyxDQUFDVSxXQUFXLENBQUNGO0lBQzVDO0lBRUE7O0dBRUMsR0FDRCxNQUFNRyxvQkFBb0JULEdBQWdCLEVBQXlCO1FBQ2pFLElBQUk7WUFDRixNQUFNVSxPQUFPLE1BQU0sSUFBSSxDQUFDWCxjQUFjLENBQUNDO1lBQ3ZDLE1BQU1XLFlBQVksTUFBTSxJQUFJLENBQUNkLFlBQVksQ0FBQ2Usa0JBQWtCLENBQUNGLEtBQUtHLEdBQUc7WUFFckUsT0FBT3ZCLHFEQUFZQSxDQUFDd0IsSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztnQkFDVEMsTUFBTTtvQkFDSkMsY0FBY04sVUFBVU0sWUFBWTtvQkFDcENDLE1BQU1QLFVBQVVPLElBQUk7b0JBQ3BCQyxXQUFXUixVQUFVUSxTQUFTO29CQUM5QkMsTUFBTVQsVUFBVVMsSUFBSTtvQkFDcEJDLFVBQVVWLFVBQVVVLFFBQVE7b0JBQzVCQyxZQUFZWCxVQUFVVyxVQUFVLFlBQVlDLE9BQU9aLFVBQVVXLFVBQVUsQ0FBQ0UsV0FBVyxLQUFLYixVQUFVVyxVQUFVO29CQUM1R0csWUFBWWQsVUFBVWMsVUFBVSxZQUFZRixPQUFPWixVQUFVYyxVQUFVLENBQUNELFdBQVcsS0FBS2IsVUFBVWMsVUFBVTtnQkFDOUc7WUFDRjtRQUNGLEVBQUUsT0FBT0MsT0FBWTtZQUNuQixPQUFPcEMscURBQVlBLENBQUN3QixJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNUWSxTQUFTRCxNQUFNQyxPQUFPLElBQUk7WUFDNUIsR0FDQTtnQkFBRUMsUUFBUUYsTUFBTUMsT0FBTyxLQUFLLGlCQUFpQixNQUFNO1lBQUk7UUFFM0Q7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTUUsY0FBYzdCLEdBQWdCLEVBQXlCO1FBQzNELElBQUk7WUFDRixNQUFNVSxPQUFPLE1BQU0sSUFBSSxDQUFDWCxjQUFjLENBQUNDO1lBQ3ZDLE1BQU04QixhQUFhLE1BQU0sSUFBSSxDQUFDakMsWUFBWSxDQUFDa0MsY0FBYyxDQUFDckIsS0FBS0csR0FBRztZQUVsRSxPQUFPdkIscURBQVlBLENBQUN3QixJQUFJLENBQUM7Z0JBQ3ZCQyxTQUFTO2dCQUNUQyxNQUFNYyxXQUFXRSxHQUFHLENBQUMsQ0FBQ0MsSUFBTzt3QkFDM0JoQixjQUFjZ0IsRUFBRWhCLFlBQVk7d0JBQzVCQyxNQUFNZSxFQUFFZixJQUFJO3dCQUNaQyxXQUFXYyxFQUFFZCxTQUFTO3dCQUN0QkMsTUFBTWEsRUFBRWIsSUFBSTt3QkFDWkMsVUFBVVksRUFBRVosUUFBUTt3QkFDcEJDLFlBQVlXLEVBQUVYLFVBQVUsWUFBWUMsT0FBT1UsRUFBRVgsVUFBVSxDQUFDRSxXQUFXLEtBQUtTLEVBQUVYLFVBQVU7d0JBQ3BGRyxZQUFZUSxFQUFFUixVQUFVLFlBQVlGLE9BQU9VLEVBQUVSLFVBQVUsQ0FBQ0QsV0FBVyxLQUFLUyxFQUFFUixVQUFVO29CQUN0RjtZQUNGO1FBQ0YsRUFBRSxPQUFPQyxPQUFZO1lBQ25CLE9BQU9wQyxxREFBWUEsQ0FBQ3dCLElBQUksQ0FDdEI7Z0JBQ0VDLFNBQVM7Z0JBQ1RZLFNBQVNELE1BQU1DLE9BQU8sSUFBSTtZQUM1QixHQUNBO2dCQUFFQyxRQUFRRixNQUFNQyxPQUFPLEtBQUssaUJBQWlCLE1BQU07WUFBSTtRQUUzRDtJQUNGO0FBQ0Y7QUFoRmFoQyxzQkFBQUEsb0VBQUFBO0lBRFpKLG9EQUFVQTtJQUdOQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7SUFDUEEsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDRSwrREFBV0E7OztlQUQyQiw0REFBWSw0QkFBWiw0REFBWTtlQUNoQiwrREFBVyw0QkFBWCwrREFBVzs7R0FINUNDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2FwaS93b3Jrc3BhY2Uvd29ya3NwYWNlLmNvbnRyb2xsZXIudHM/MDU0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgV29ya3NwYWNlREFPIH0gZnJvbSAnQC9kYW8vd29ya3NwYWNlLmRhbyc7XG5pbXBvcnQgeyBBdXRoU2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvYXV0aC5zZXJ2aWNlJztcblxuLyoqXG4gKiDlt6XkvZznqbrpl7TmjqfliLblmahcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFdvcmtzcGFjZUNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdXb3Jrc3BhY2VEQU8nKSBwcml2YXRlIHdvcmtzcGFjZURBTzogV29ya3NwYWNlREFPLFxuICAgIEBpbmplY3QoQXV0aFNlcnZpY2UpIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlXG4gICkge31cblxuICAvKipcbiAgICog6I635Y+W5b2T5YmN55So5oi377yI5LuOIHRva2Vu77yJXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEN1cnJlbnRVc2VyKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPHsgdWlkOiBudW1iZXI7IHV1aWQ6IHN0cmluZyB9PiB7XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpO1xuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnN1YnN0cmluZyg3KTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5hdXRoU2VydmljZS52ZXJpZnlUb2tlbih0b2tlbik7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE6buY6K6k5bel5L2c56m66Ze0XG4gICAqL1xuICBhc3luYyBnZXREZWZhdWx0V29ya3NwYWNlKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuICAgICAgY29uc3Qgd29ya3NwYWNlID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uZ2V0T3JDcmVhdGVEZWZhdWx0KHVzZXIudWlkKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHdvcmtzcGFjZV9pZDogd29ya3NwYWNlLndvcmtzcGFjZV9pZCxcbiAgICAgICAgICBuYW1lOiB3b3Jrc3BhY2UubmFtZSxcbiAgICAgICAgICBvd25lcl91aWQ6IHdvcmtzcGFjZS5vd25lcl91aWQsXG4gICAgICAgICAgaWNvbjogd29ya3NwYWNlLmljb24sXG4gICAgICAgICAgbWV0YWRhdGE6IHdvcmtzcGFjZS5tZXRhZGF0YSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiB3b3Jrc3BhY2UuY3JlYXRlZF9hdCBpbnN0YW5jZW9mIERhdGUgPyB3b3Jrc3BhY2UuY3JlYXRlZF9hdC50b0lTT1N0cmluZygpIDogd29ya3NwYWNlLmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogd29ya3NwYWNlLnVwZGF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gd29ya3NwYWNlLnVwZGF0ZWRfYXQudG9JU09TdHJpbmcoKSA6IHdvcmtzcGFjZS51cGRhdGVkX2F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkZWZhdWx0IHdvcmtzcGFjZScsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfnmoTmiYDmnInlt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGdldFdvcmtzcGFjZXMocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG4gICAgICBjb25zdCB3b3Jrc3BhY2VzID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uZmluZEJ5T3duZXJVaWQodXNlci51aWQpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB3b3Jrc3BhY2VzLm1hcCgodykgPT4gKHtcbiAgICAgICAgICB3b3Jrc3BhY2VfaWQ6IHcud29ya3NwYWNlX2lkLFxuICAgICAgICAgIG5hbWU6IHcubmFtZSxcbiAgICAgICAgICBvd25lcl91aWQ6IHcub3duZXJfdWlkLFxuICAgICAgICAgIGljb246IHcuaWNvbixcbiAgICAgICAgICBtZXRhZGF0YTogdy5tZXRhZGF0YSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiB3LmNyZWF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gdy5jcmVhdGVkX2F0LnRvSVNPU3RyaW5nKCkgOiB3LmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogdy51cGRhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZSA/IHcudXBkYXRlZF9hdC50b0lTT1N0cmluZygpIDogdy51cGRhdGVkX2F0LFxuICAgICAgICB9KSksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IHdvcmtzcGFjZXMnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImluamVjdGFibGUiLCJpbmplY3QiLCJXb3Jrc3BhY2VEQU8iLCJBdXRoU2VydmljZSIsIldvcmtzcGFjZUNvbnRyb2xsZXIiLCJjb25zdHJ1Y3RvciIsIndvcmtzcGFjZURBTyIsImF1dGhTZXJ2aWNlIiwiZ2V0Q3VycmVudFVzZXIiLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInN0YXJ0c1dpdGgiLCJFcnJvciIsInRva2VuIiwic3Vic3RyaW5nIiwidmVyaWZ5VG9rZW4iLCJnZXREZWZhdWx0V29ya3NwYWNlIiwidXNlciIsIndvcmtzcGFjZSIsImdldE9yQ3JlYXRlRGVmYXVsdCIsInVpZCIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsIndvcmtzcGFjZV9pZCIsIm5hbWUiLCJvd25lcl91aWQiLCJpY29uIiwibWV0YWRhdGEiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidXBkYXRlZF9hdCIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImdldFdvcmtzcGFjZXMiLCJ3b3Jrc3BhY2VzIiwiZmluZEJ5T3duZXJVaWQiLCJtYXAiLCJ3Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/api/workspace/workspace.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/workspace/[workspace_id]/documents/route.ts":
/*!*****************************************************************!*\
  !*** ./src/app/api/workspace/[workspace_id]/documents/route.ts ***!
  \*****************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var _core_init__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/init */ \"(rsc)/./src/core/init.ts\");\n/* harmony import */ var _core_container__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/core/container */ \"(rsc)/./src/core/container.ts\");\n/* harmony import */ var _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/api/documents/document.controller */ \"(rsc)/./src/api/documents/document.controller.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_init__WEBPACK_IMPORTED_MODULE_0__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__]);\n([_core_init__WEBPACK_IMPORTED_MODULE_0__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n/**\n * GET /api/workspace/[workspace_id]/documents - 获取文档列表\n * POST /api/workspace/[workspace_id]/documents - 创建文档\n */ async function GET(req, { params }) {\n    const controller = _core_container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__.DocumentController);\n    return controller.getDocuments(req, {\n        params\n    });\n}\nasync function POST(req, { params }) {\n    const controller = _core_container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__.DocumentController);\n    return controller.createDocument(req, {\n        params\n    });\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQ3FCO0FBQ3dCO0FBQzRCO0FBRXpFOzs7Q0FHQyxHQUNNLGVBQWVFLElBQ3BCQyxHQUFnQixFQUNoQixFQUFFQyxNQUFNLEVBQXdDO0lBRWhELE1BQU1DLGFBQWFMLHNEQUFTQSxDQUFDTSxPQUFPLENBQXFCTCxrRkFBa0JBO0lBQzNFLE9BQU9JLFdBQVdFLFlBQVksQ0FBQ0osS0FBSztRQUFFQztJQUFPO0FBQy9DO0FBRU8sZUFBZUksS0FDcEJMLEdBQWdCLEVBQ2hCLEVBQUVDLE1BQU0sRUFBd0M7SUFFaEQsTUFBTUMsYUFBYUwsc0RBQVNBLENBQUNNLE9BQU8sQ0FBcUJMLGtGQUFrQkE7SUFDM0UsT0FBT0ksV0FBV0ksY0FBYyxDQUFDTixLQUFLO1FBQUVDO0lBQU87QUFDakQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBwL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL3JvdXRlLnRzPzQxYzAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgJ0AvY29yZS9pbml0JztcbmltcG9ydCB7IENvbnRhaW5lciB9IGZyb20gJ0AvY29yZS9jb250YWluZXInO1xuaW1wb3J0IHsgRG9jdW1lbnRDb250cm9sbGVyIH0gZnJvbSAnQC9hcGkvZG9jdW1lbnRzL2RvY3VtZW50LmNvbnRyb2xsZXInO1xuXG4vKipcbiAqIEdFVCAvYXBpL3dvcmtzcGFjZS9bd29ya3NwYWNlX2lkXS9kb2N1bWVudHMgLSDojrflj5bmlofmoaPliJfooahcbiAqIFBPU1QgL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzIC0g5Yib5bu65paH5qGjXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoXG4gIHJlcTogTmV4dFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nIH0gfVxuKSB7XG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBDb250YWluZXIucmVzb2x2ZTxEb2N1bWVudENvbnRyb2xsZXI+KERvY3VtZW50Q29udHJvbGxlcik7XG4gIHJldHVybiBjb250cm9sbGVyLmdldERvY3VtZW50cyhyZXEsIHsgcGFyYW1zIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChcbiAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmcgfSB9XG4pIHtcbiAgY29uc3QgY29udHJvbGxlciA9IENvbnRhaW5lci5yZXNvbHZlPERvY3VtZW50Q29udHJvbGxlcj4oRG9jdW1lbnRDb250cm9sbGVyKTtcbiAgcmV0dXJuIGNvbnRyb2xsZXIuY3JlYXRlRG9jdW1lbnQocmVxLCB7IHBhcmFtcyB9KTtcbn1cblxuIl0sIm5hbWVzIjpbIkNvbnRhaW5lciIsIkRvY3VtZW50Q29udHJvbGxlciIsIkdFVCIsInJlcSIsInBhcmFtcyIsImNvbnRyb2xsZXIiLCJyZXNvbHZlIiwiZ2V0RG9jdW1lbnRzIiwiUE9TVCIsImNyZWF0ZURvY3VtZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/workspace/[workspace_id]/documents/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/container.ts":
/*!*******************************!*\
  !*** ./src/core/container.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Container: () => (/* binding */ Container)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n\n\n/**\n * 依赖注入容器单例\n */ class Container {\n    static getInstance() {\n        if (!Container.instance) {\n            Container.instance = tsyringe__WEBPACK_IMPORTED_MODULE_1__.container;\n        }\n        return Container.instance;\n    }\n    /**\n   * 注册服务\n   */ static register(token, factory) {\n        tsyringe__WEBPACK_IMPORTED_MODULE_1__.container.register(token, {\n            useFactory: factory\n        });\n    }\n    /**\n   * 解析服务\n   */ static resolve(token) {\n        return tsyringe__WEBPACK_IMPORTED_MODULE_1__.container.resolve(token);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9jb250YWluZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUEwQjtBQUNnQztBQUUxRDs7Q0FFQyxHQUNNLE1BQU1DO0lBR1gsT0FBY0MsY0FBbUM7UUFDL0MsSUFBSSxDQUFDRCxVQUFVRSxRQUFRLEVBQUU7WUFDdkJGLFVBQVVFLFFBQVEsR0FBR0gsK0NBQVNBO1FBQ2hDO1FBQ0EsT0FBT0MsVUFBVUUsUUFBUTtJQUMzQjtJQUVBOztHQUVDLEdBQ0QsT0FBY0MsU0FDWkMsS0FBaUMsRUFDakNDLE9BQWdCLEVBQ1Y7UUFDTk4sK0NBQVNBLENBQUNJLFFBQVEsQ0FBQ0MsT0FBTztZQUFFRSxZQUFZRDtRQUFRO0lBQ2xEO0lBRUE7O0dBRUMsR0FDRCxPQUFjRSxRQUFXSCxLQUFpQyxFQUFLO1FBQzdELE9BQU9MLCtDQUFTQSxDQUFDUSxPQUFPLENBQUlIO0lBQzlCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9jb250YWluZXIudHM/YjZhNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuaW1wb3J0IHsgY29udGFpbmVyLCBEZXBlbmRlbmN5Q29udGFpbmVyIH0gZnJvbSAndHN5cmluZ2UnO1xuXG4vKipcbiAqIOS+nei1luazqOWFpeWuueWZqOWNleS+i1xuICovXG5leHBvcnQgY2xhc3MgQ29udGFpbmVyIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IERlcGVuZGVuY3lDb250YWluZXI7XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBEZXBlbmRlbmN5Q29udGFpbmVyIHtcbiAgICBpZiAoIUNvbnRhaW5lci5pbnN0YW5jZSkge1xuICAgICAgQ29udGFpbmVyLmluc3RhbmNlID0gY29udGFpbmVyO1xuICAgIH1cbiAgICByZXR1cm4gQ29udGFpbmVyLmluc3RhbmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIOazqOWGjOacjeWKoVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyByZWdpc3RlcjxUPihcbiAgICB0b2tlbjogc3RyaW5nIHwgc3ltYm9sIHwgRnVuY3Rpb24sXG4gICAgZmFjdG9yeTogKCkgPT4gVFxuICApOiB2b2lkIHtcbiAgICBjb250YWluZXIucmVnaXN0ZXIodG9rZW4sIHsgdXNlRmFjdG9yeTogZmFjdG9yeSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDop6PmnpDmnI3liqFcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcmVzb2x2ZTxUPih0b2tlbjogc3RyaW5nIHwgc3ltYm9sIHwgRnVuY3Rpb24pOiBUIHtcbiAgICByZXR1cm4gY29udGFpbmVyLnJlc29sdmU8VD4odG9rZW4pO1xuICB9XG59XG5cblxuXG5cbiJdLCJuYW1lcyI6WyJjb250YWluZXIiLCJDb250YWluZXIiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwicmVnaXN0ZXIiLCJ0b2tlbiIsImZhY3RvcnkiLCJ1c2VGYWN0b3J5IiwicmVzb2x2ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/container.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/database.ts":
/*!******************************!*\
  !*** ./src/core/database.ts ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Database: () => (/* binding */ Database)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pg */ \"pg\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_1__]);\npg__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nclass Database {\n    constructor(){\n        const connectionString = \"postgresql://pikun@localhost:5432/postgres\";\n        console.log(\"connectionString\", connectionString);\n        if (!connectionString) {\n            throw new Error(\"DATABASE_URL environment variable is not set. \" + \"Please create a .env file in apps/server/ directory with DATABASE_URL=postgresql://pikun@localhost:5432/postgres\");\n        }\n        const config = {\n            connectionString,\n            min: parseInt(\"2\" || 0, 10),\n            max: parseInt(\"10\" || 0, 10),\n            idleTimeoutMillis: 30000,\n            connectionTimeoutMillis: 2000\n        };\n        this.pool = new pg__WEBPACK_IMPORTED_MODULE_1__.Pool(config);\n        // 处理连接错误\n        this.pool.on(\"error\", (err)=>{\n            console.error(\"Unexpected error on idle client\", err);\n        });\n    }\n    static getInstance() {\n        if (!Database.instance) {\n            Database.instance = new Database();\n        }\n        return Database.instance;\n    }\n    getPool() {\n        return this.pool;\n    }\n    /**\n   * 执行查询（使用参数化查询防止 SQL 注入）\n   */ async query(text, params) {\n        const start = Date.now();\n        try {\n            // 设置默认 schema\n            await this.pool.query(\"SET search_path TO pikun_db, public\");\n            const result = await this.pool.query(text, params);\n            const duration = Date.now() - start;\n            console.log(\"Executed query\", {\n                text,\n                duration,\n                rows: result.rowCount\n            });\n            return {\n                rows: result.rows,\n                rowCount: result.rowCount || 0\n            };\n        } catch (error) {\n            console.error(\"Database query error\", {\n                text,\n                error\n            });\n            throw error;\n        }\n    }\n    /**\n   * 执行事务\n   */ async transaction(callback) {\n        const client = await this.pool.connect();\n        try {\n            await client.query(\"SET search_path TO pikun_db, public\");\n            await client.query(\"BEGIN\");\n            const result = await callback(client);\n            await client.query(\"COMMIT\");\n            return result;\n        } catch (error) {\n            await client.query(\"ROLLBACK\");\n            throw error;\n        } finally{\n            client.release();\n        }\n    }\n    /**\n   * 关闭连接池\n   */ async close() {\n        await this.pool.end();\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9kYXRhYmFzZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQTBCO0FBQ1k7QUFFL0IsTUFBTUM7SUFJWCxhQUFzQjtRQUNwQixNQUFNQyxtQkFBbUJDLDRDQUF3QjtRQUNqREcsUUFBUUMsR0FBRyxDQUFDLG9CQUFvQkw7UUFFaEMsSUFBSSxDQUFDQSxrQkFBa0I7WUFDckIsTUFBTSxJQUFJTSxNQUNSLG1EQUNFO1FBRU47UUFFQSxNQUFNQyxTQUFxQjtZQUN6QlA7WUFDQVEsS0FBS0MsU0FBU1IsR0FBNkIsSUFBSSxHQUFLO1lBQ3BEVSxLQUFLRixTQUFTUixJQUE2QixJQUFJLEdBQU07WUFDckRZLG1CQUFtQjtZQUNuQkMseUJBQXlCO1FBQzNCO1FBRUEsSUFBSSxDQUFDQyxJQUFJLEdBQUcsSUFBSWpCLG9DQUFJQSxDQUFDUztRQUVyQixTQUFTO1FBQ1QsSUFBSSxDQUFDUSxJQUFJLENBQUNDLEVBQUUsQ0FBQyxTQUFTLENBQUNDO1lBQ3JCYixRQUFRYyxLQUFLLENBQUMsbUNBQW1DRDtRQUNuRDtJQUNGO0lBRUEsT0FBY0UsY0FBd0I7UUFDcEMsSUFBSSxDQUFDcEIsU0FBU3FCLFFBQVEsRUFBRTtZQUN0QnJCLFNBQVNxQixRQUFRLEdBQUcsSUFBSXJCO1FBQzFCO1FBQ0EsT0FBT0EsU0FBU3FCLFFBQVE7SUFDMUI7SUFFT0MsVUFBZ0I7UUFDckIsT0FBTyxJQUFJLENBQUNOLElBQUk7SUFDbEI7SUFFQTs7R0FFQyxHQUNELE1BQWFPLE1BQ1hDLElBQVksRUFDWkMsTUFBYyxFQUM0QjtRQUMxQyxNQUFNQyxRQUFRQyxLQUFLQyxHQUFHO1FBQ3RCLElBQUk7WUFDRixjQUFjO1lBQ2QsTUFBTSxJQUFJLENBQUNaLElBQUksQ0FBQ08sS0FBSyxDQUFDO1lBQ3RCLE1BQU1NLFNBQVMsTUFBTSxJQUFJLENBQUNiLElBQUksQ0FBQ08sS0FBSyxDQUFDQyxNQUFNQztZQUMzQyxNQUFNSyxXQUFXSCxLQUFLQyxHQUFHLEtBQUtGO1lBQzlCckIsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQjtnQkFBRWtCO2dCQUFNTTtnQkFBVUMsTUFBTUYsT0FBT0csUUFBUTtZQUFDO1lBQ3RFLE9BQU87Z0JBQ0xELE1BQU1GLE9BQU9FLElBQUk7Z0JBQ2pCQyxVQUFVSCxPQUFPRyxRQUFRLElBQUk7WUFDL0I7UUFDRixFQUFFLE9BQU9iLE9BQU87WUFDZGQsUUFBUWMsS0FBSyxDQUFDLHdCQUF3QjtnQkFBRUs7Z0JBQU1MO1lBQU07WUFDcEQsTUFBTUE7UUFDUjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFhYyxZQUFlQyxRQUFxQyxFQUFjO1FBQzdFLE1BQU1DLFNBQVMsTUFBTSxJQUFJLENBQUNuQixJQUFJLENBQUNvQixPQUFPO1FBQ3RDLElBQUk7WUFDRixNQUFNRCxPQUFPWixLQUFLLENBQUM7WUFDbkIsTUFBTVksT0FBT1osS0FBSyxDQUFDO1lBQ25CLE1BQU1NLFNBQVMsTUFBTUssU0FBU0M7WUFDOUIsTUFBTUEsT0FBT1osS0FBSyxDQUFDO1lBQ25CLE9BQU9NO1FBQ1QsRUFBRSxPQUFPVixPQUFPO1lBQ2QsTUFBTWdCLE9BQU9aLEtBQUssQ0FBQztZQUNuQixNQUFNSjtRQUNSLFNBQVU7WUFDUmdCLE9BQU9FLE9BQU87UUFDaEI7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBYUMsUUFBdUI7UUFDbEMsTUFBTSxJQUFJLENBQUN0QixJQUFJLENBQUN1QixHQUFHO0lBQ3JCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9kYXRhYmFzZS50cz85ZTE2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5pbXBvcnQgeyBQb29sLCBQb29sQ29uZmlnIH0gZnJvbSAncGcnO1xuXG5leHBvcnQgY2xhc3MgRGF0YWJhc2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogRGF0YWJhc2U7XG4gIHByaXZhdGUgcG9vbDogUG9vbDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IGNvbm5lY3Rpb25TdHJpbmcgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkw7XG4gICAgY29uc29sZS5sb2coJ2Nvbm5lY3Rpb25TdHJpbmcnLCBjb25uZWN0aW9uU3RyaW5nKTtcblxuICAgIGlmICghY29ubmVjdGlvblN0cmluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnREFUQUJBU0VfVVJMIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIG5vdCBzZXQuICcgK1xuICAgICAgICAgICdQbGVhc2UgY3JlYXRlIGEgLmVudiBmaWxlIGluIGFwcHMvc2VydmVyLyBkaXJlY3Rvcnkgd2l0aCBEQVRBQkFTRV9VUkw9cG9zdGdyZXNxbDovL3Bpa3VuQGxvY2FsaG9zdDo1NDMyL3Bvc3RncmVzJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb25maWc6IFBvb2xDb25maWcgPSB7XG4gICAgICBjb25uZWN0aW9uU3RyaW5nLFxuICAgICAgbWluOiBwYXJzZUludChwcm9jZXNzLmVudi5EQVRBQkFTRV9QT09MX01JTiB8fCAnMicsIDEwKSxcbiAgICAgIG1heDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuREFUQUJBU0VfUE9PTF9NQVggfHwgJzEwJywgMTApLFxuICAgICAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxuICAgICAgY29ubmVjdGlvblRpbWVvdXRNaWxsaXM6IDIwMDAsXG4gICAgfTtcblxuICAgIHRoaXMucG9vbCA9IG5ldyBQb29sKGNvbmZpZyk7XG5cbiAgICAvLyDlpITnkIbov57mjqXplJnor69cbiAgICB0aGlzLnBvb2wub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignVW5leHBlY3RlZCBlcnJvciBvbiBpZGxlIGNsaWVudCcsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IERhdGFiYXNlIHtcbiAgICBpZiAoIURhdGFiYXNlLmluc3RhbmNlKSB7XG4gICAgICBEYXRhYmFzZS5pbnN0YW5jZSA9IG5ldyBEYXRhYmFzZSgpO1xuICAgIH1cbiAgICByZXR1cm4gRGF0YWJhc2UuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgZ2V0UG9vbCgpOiBQb29sIHtcbiAgICByZXR1cm4gdGhpcy5wb29sO1xuICB9XG5cbiAgLyoqXG4gICAqIOaJp+ihjOafpeivou+8iOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWl77yJXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgcXVlcnk8VCA9IGFueT4oXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIHBhcmFtcz86IGFueVtdXG4gICk6IFByb21pc2U8eyByb3dzOiBUW107IHJvd0NvdW50OiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICB0cnkge1xuICAgICAgLy8g6K6+572u6buY6K6kIHNjaGVtYVxuICAgICAgYXdhaXQgdGhpcy5wb29sLnF1ZXJ5KCdTRVQgc2VhcmNoX3BhdGggVE8gcGlrdW5fZGIsIHB1YmxpYycpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wb29sLnF1ZXJ5KHRleHQsIHBhcmFtcyk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydDtcbiAgICAgIGNvbnNvbGUubG9nKCdFeGVjdXRlZCBxdWVyeScsIHsgdGV4dCwgZHVyYXRpb24sIHJvd3M6IHJlc3VsdC5yb3dDb3VudCB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJvd3M6IHJlc3VsdC5yb3dzIGFzIFRbXSxcbiAgICAgICAgcm93Q291bnQ6IHJlc3VsdC5yb3dDb3VudCB8fCAwLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgcXVlcnkgZXJyb3InLCB7IHRleHQsIGVycm9yIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOaJp+ihjOS6i+WKoVxuICAgKi9cbiAgcHVibGljIGFzeW5jIHRyYW5zYWN0aW9uPFQ+KGNhbGxiYWNrOiAoY2xpZW50OiBhbnkpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+IHtcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCB0aGlzLnBvb2wuY29ubmVjdCgpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoJ1NFVCBzZWFyY2hfcGF0aCBUTyBwaWt1bl9kYiwgcHVibGljJyk7XG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0JFR0lOJyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxsYmFjayhjbGllbnQpO1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdDT01NSVQnKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnUk9MTEJBQ0snKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBjbGllbnQucmVsZWFzZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlhbPpl63ov57mjqXmsaBcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnBvb2wuZW5kKCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJQb29sIiwiRGF0YWJhc2UiLCJjb25uZWN0aW9uU3RyaW5nIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsImNvbnNvbGUiLCJsb2ciLCJFcnJvciIsImNvbmZpZyIsIm1pbiIsInBhcnNlSW50IiwiREFUQUJBU0VfUE9PTF9NSU4iLCJtYXgiLCJEQVRBQkFTRV9QT09MX01BWCIsImlkbGVUaW1lb3V0TWlsbGlzIiwiY29ubmVjdGlvblRpbWVvdXRNaWxsaXMiLCJwb29sIiwib24iLCJlcnIiLCJlcnJvciIsImdldEluc3RhbmNlIiwiaW5zdGFuY2UiLCJnZXRQb29sIiwicXVlcnkiLCJ0ZXh0IiwicGFyYW1zIiwic3RhcnQiLCJEYXRlIiwibm93IiwicmVzdWx0IiwiZHVyYXRpb24iLCJyb3dzIiwicm93Q291bnQiLCJ0cmFuc2FjdGlvbiIsImNhbGxiYWNrIiwiY2xpZW50IiwiY29ubmVjdCIsInJlbGVhc2UiLCJjbG9zZSIsImVuZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/database.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/init.ts":
/*!**************************!*\
  !*** ./src/core/init.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initializeContainer: () => (/* binding */ initializeContainer)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _container__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./container */ \"(rsc)/./src/core/container.ts\");\n/* harmony import */ var _dao_user_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/user.dao */ \"(rsc)/./src/dao/user.dao.ts\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/dao/document-change.dao */ \"(rsc)/./src/dao/document-change.dao.ts\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\n/* harmony import */ var _services_document_service__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/services/document.service */ \"(rsc)/./src/services/document.service.ts\");\n/* harmony import */ var _services_snapshot_service__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @/services/snapshot.service */ \"(rsc)/./src/services/snapshot.service.ts\");\n/* harmony import */ var _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @/services/snapshot-scheduler.service */ \"(rsc)/./src/services/snapshot-scheduler.service.ts\");\n/* harmony import */ var _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @/api/auth/auth.controller */ \"(rsc)/./src/api/auth/auth.controller.ts\");\n/* harmony import */ var _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @/api/documents/document.controller */ \"(rsc)/./src/api/documents/document.controller.ts\");\n/* harmony import */ var _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @/api/workspace/workspace.controller */ \"(rsc)/./src/api/workspace/workspace.controller.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__, _services_auth_service__WEBPACK_IMPORTED_MODULE_6__, _services_document_service__WEBPACK_IMPORTED_MODULE_7__, _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_9__, _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__, _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__]);\n([_dao_user_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__, _services_auth_service__WEBPACK_IMPORTED_MODULE_6__, _services_document_service__WEBPACK_IMPORTED_MODULE_7__, _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_9__, _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__, _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * 初始化依赖注入容器\n * 注册所有服务和控制器\n */ function initializeContainer() {\n    // 注册 DAO\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"UserDAO\", ()=>new _dao_user_dao__WEBPACK_IMPORTED_MODULE_2__.UserDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"DocumentDAO\", ()=>new _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__.DocumentDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"WorkspaceDAO\", ()=>new _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__.WorkspaceDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"DocumentChangeDAO\", ()=>new _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__.DocumentChangeDAO());\n    // 注册 Service\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService, ()=>{\n        const userDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"UserDAO\");\n        const workspaceDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"WorkspaceDAO\");\n        return new _services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService(userDAO, workspaceDAO, null);\n    });\n    // 注册 SnapshotService\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"SnapshotService\", ()=>new _services_snapshot_service__WEBPACK_IMPORTED_MODULE_8__.SnapshotService());\n    // 注册 SnapshotScheduler（需要在 DocumentService 之前注册）\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"SnapshotScheduler\", ()=>{\n        const documentDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentDAO\");\n        const snapshotService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"SnapshotService\");\n        return new _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_9__.SnapshotScheduler(documentDAO, snapshotService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_document_service__WEBPACK_IMPORTED_MODULE_7__.DocumentService, ()=>{\n        const documentDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentDAO\");\n        const snapshotScheduler = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"SnapshotScheduler\");\n        const changeDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentChangeDAO\");\n        return new _services_document_service__WEBPACK_IMPORTED_MODULE_7__.DocumentService(documentDAO, null, snapshotScheduler, changeDAO);\n    });\n    // 注册 Controller\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__.AuthController, ()=>{\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService);\n        return new _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__.AuthController(authService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__.DocumentController, ()=>{\n        const documentService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_document_service__WEBPACK_IMPORTED_MODULE_7__.DocumentService);\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService);\n        return new _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__.DocumentController(documentService, authService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__.WorkspaceController, ()=>{\n        const workspaceDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"WorkspaceDAO\");\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService);\n        return new _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__.WorkspaceController(workspaceDAO, authService);\n    });\n}\n// 自动初始化\ninitializeContainer();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9pbml0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUEwQjtBQUNjO0FBQ0M7QUFDUTtBQUNhO0FBQ1g7QUFDRztBQUNRO0FBQ0E7QUFDWTtBQUNkO0FBQ2E7QUFDRTtBQUUzRTs7O0NBR0MsR0FDTSxTQUFTWTtJQUNkLFNBQVM7SUFDVFosaURBQVNBLENBQUNhLFFBQVEsQ0FBQyxXQUFXLElBQU0sSUFBSVosa0RBQU9BO0lBQy9DRCxpREFBU0EsQ0FBQ2EsUUFBUSxDQUFDLGVBQWUsSUFBTSxJQUFJWCwwREFBV0E7SUFDdkRGLGlEQUFTQSxDQUFDYSxRQUFRLENBQUMsZ0JBQWdCLElBQU0sSUFBSVQsNERBQVlBO0lBQ3pESixpREFBU0EsQ0FBQ2EsUUFBUSxDQUFDLHFCQUFxQixJQUFNLElBQUlWLHVFQUFpQkE7SUFFbkUsYUFBYTtJQUNiSCxpREFBU0EsQ0FBQ2EsUUFBUSxDQUFDUiwrREFBV0EsRUFBRTtRQUM5QixNQUFNUyxVQUFVZCxpREFBU0EsQ0FBQ2UsT0FBTyxDQUFVO1FBQzNDLE1BQU1DLGVBQWVoQixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFlO1FBQ3JELE9BQU8sSUFBSVYsK0RBQVdBLENBQUNTLFNBQVNFLGNBQWM7SUFDaEQ7SUFFQSxxQkFBcUI7SUFDckJoQixpREFBU0EsQ0FBQ2EsUUFBUSxDQUFDLG1CQUFtQixJQUFNLElBQUlOLHVFQUFlQTtJQUUvRCxpREFBaUQ7SUFDakRQLGlEQUFTQSxDQUFDYSxRQUFRLENBQUMscUJBQXFCO1FBQ3RDLE1BQU1JLGNBQWNqQixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFjO1FBQ25ELE1BQU1HLGtCQUFrQmxCLGlEQUFTQSxDQUFDZSxPQUFPLENBQWtCO1FBQzNELE9BQU8sSUFBSVAsbUZBQWlCQSxDQUFDUyxhQUFhQztJQUM1QztJQUVBbEIsaURBQVNBLENBQUNhLFFBQVEsQ0FBQ1AsdUVBQWVBLEVBQUU7UUFDbEMsTUFBTVcsY0FBY2pCLGlEQUFTQSxDQUFDZSxPQUFPLENBQWM7UUFDbkQsTUFBTUksb0JBQW9CbkIsaURBQVNBLENBQUNlLE9BQU8sQ0FBb0I7UUFDL0QsTUFBTUssWUFBWXBCLGlEQUFTQSxDQUFDZSxPQUFPLENBQW9CO1FBQ3ZELE9BQU8sSUFBSVQsdUVBQWVBLENBQUNXLGFBQWEsTUFBYUUsbUJBQW1CQztJQUMxRTtJQUVBLGdCQUFnQjtJQUNoQnBCLGlEQUFTQSxDQUFDYSxRQUFRLENBQUNKLHNFQUFjQSxFQUFFO1FBQ2pDLE1BQU1ZLGNBQWNyQixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFjViwrREFBV0E7UUFDOUQsT0FBTyxJQUFJSSxzRUFBY0EsQ0FBQ1k7SUFDNUI7SUFFQXJCLGlEQUFTQSxDQUFDYSxRQUFRLENBQUNILG1GQUFrQkEsRUFBRTtRQUNyQyxNQUFNWSxrQkFBa0J0QixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFrQlQsdUVBQWVBO1FBQzFFLE1BQU1lLGNBQWNyQixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFjViwrREFBV0E7UUFDOUQsT0FBTyxJQUFJSyxtRkFBa0JBLENBQUNZLGlCQUFpQkQ7SUFDakQ7SUFFQXJCLGlEQUFTQSxDQUFDYSxRQUFRLENBQUNGLHFGQUFtQkEsRUFBRTtRQUN0QyxNQUFNSyxlQUFlaEIsaURBQVNBLENBQUNlLE9BQU8sQ0FBZTtRQUNyRCxNQUFNTSxjQUFjckIsaURBQVNBLENBQUNlLE9BQU8sQ0FBY1YsK0RBQVdBO1FBQzlELE9BQU8sSUFBSU0scUZBQW1CQSxDQUFDSyxjQUFjSztJQUMvQztBQUNGO0FBRUEsUUFBUTtBQUNSVCIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9jb3JlL2luaXQudHM/MzUzZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuaW1wb3J0IHsgQ29udGFpbmVyIH0gZnJvbSAnLi9jb250YWluZXInO1xuaW1wb3J0IHsgVXNlckRBTyB9IGZyb20gJ0AvZGFvL3VzZXIuZGFvJztcbmltcG9ydCB7IERvY3VtZW50REFPIH0gZnJvbSAnQC9kYW8vZG9jdW1lbnQuZGFvJztcbmltcG9ydCB7IERvY3VtZW50Q2hhbmdlREFPIH0gZnJvbSAnQC9kYW8vZG9jdW1lbnQtY2hhbmdlLmRhbyc7XG5pbXBvcnQgeyBXb3Jrc3BhY2VEQU8gfSBmcm9tICdAL2Rhby93b3Jrc3BhY2UuZGFvJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xuaW1wb3J0IHsgRG9jdW1lbnRTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9kb2N1bWVudC5zZXJ2aWNlJztcbmltcG9ydCB7IFNuYXBzaG90U2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvc25hcHNob3Quc2VydmljZSc7XG5pbXBvcnQgeyBTbmFwc2hvdFNjaGVkdWxlciB9IGZyb20gJ0Avc2VydmljZXMvc25hcHNob3Qtc2NoZWR1bGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXV0aENvbnRyb2xsZXIgfSBmcm9tICdAL2FwaS9hdXRoL2F1dGguY29udHJvbGxlcic7XG5pbXBvcnQgeyBEb2N1bWVudENvbnRyb2xsZXIgfSBmcm9tICdAL2FwaS9kb2N1bWVudHMvZG9jdW1lbnQuY29udHJvbGxlcic7XG5pbXBvcnQgeyBXb3Jrc3BhY2VDb250cm9sbGVyIH0gZnJvbSAnQC9hcGkvd29ya3NwYWNlL3dvcmtzcGFjZS5jb250cm9sbGVyJztcblxuLyoqXG4gKiDliJ3lp4vljJbkvp3otZbms6jlhaXlrrnlmahcbiAqIOazqOWGjOaJgOacieacjeWKoeWSjOaOp+WItuWZqFxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZUNvbnRhaW5lcigpIHtcbiAgLy8g5rOo5YaMIERBT1xuICBDb250YWluZXIucmVnaXN0ZXIoJ1VzZXJEQU8nLCAoKSA9PiBuZXcgVXNlckRBTygpKTtcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdEb2N1bWVudERBTycsICgpID0+IG5ldyBEb2N1bWVudERBTygpKTtcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdXb3Jrc3BhY2VEQU8nLCAoKSA9PiBuZXcgV29ya3NwYWNlREFPKCkpO1xuICBDb250YWluZXIucmVnaXN0ZXIoJ0RvY3VtZW50Q2hhbmdlREFPJywgKCkgPT4gbmV3IERvY3VtZW50Q2hhbmdlREFPKCkpO1xuXG4gIC8vIOazqOWGjCBTZXJ2aWNlXG4gIENvbnRhaW5lci5yZWdpc3RlcihBdXRoU2VydmljZSwgKCkgPT4ge1xuICAgIGNvbnN0IHVzZXJEQU8gPSBDb250YWluZXIucmVzb2x2ZTxVc2VyREFPPignVXNlckRBTycpO1xuICAgIGNvbnN0IHdvcmtzcGFjZURBTyA9IENvbnRhaW5lci5yZXNvbHZlPFdvcmtzcGFjZURBTz4oJ1dvcmtzcGFjZURBTycpO1xuICAgIHJldHVybiBuZXcgQXV0aFNlcnZpY2UodXNlckRBTywgd29ya3NwYWNlREFPLCBudWxsIGFzIGFueSk7XG4gIH0pO1xuXG4gIC8vIOazqOWGjCBTbmFwc2hvdFNlcnZpY2VcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdTbmFwc2hvdFNlcnZpY2UnLCAoKSA9PiBuZXcgU25hcHNob3RTZXJ2aWNlKCkpO1xuXG4gIC8vIOazqOWGjCBTbmFwc2hvdFNjaGVkdWxlcu+8iOmcgOimgeWcqCBEb2N1bWVudFNlcnZpY2Ug5LmL5YmN5rOo5YaM77yJXG4gIENvbnRhaW5lci5yZWdpc3RlcignU25hcHNob3RTY2hlZHVsZXInLCAoKSA9PiB7XG4gICAgY29uc3QgZG9jdW1lbnREQU8gPSBDb250YWluZXIucmVzb2x2ZTxEb2N1bWVudERBTz4oJ0RvY3VtZW50REFPJyk7XG4gICAgY29uc3Qgc25hcHNob3RTZXJ2aWNlID0gQ29udGFpbmVyLnJlc29sdmU8U25hcHNob3RTZXJ2aWNlPignU25hcHNob3RTZXJ2aWNlJyk7XG4gICAgcmV0dXJuIG5ldyBTbmFwc2hvdFNjaGVkdWxlcihkb2N1bWVudERBTywgc25hcHNob3RTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgQ29udGFpbmVyLnJlZ2lzdGVyKERvY3VtZW50U2VydmljZSwgKCkgPT4ge1xuICAgIGNvbnN0IGRvY3VtZW50REFPID0gQ29udGFpbmVyLnJlc29sdmU8RG9jdW1lbnREQU8+KCdEb2N1bWVudERBTycpO1xuICAgIGNvbnN0IHNuYXBzaG90U2NoZWR1bGVyID0gQ29udGFpbmVyLnJlc29sdmU8U25hcHNob3RTY2hlZHVsZXI+KCdTbmFwc2hvdFNjaGVkdWxlcicpO1xuICAgIGNvbnN0IGNoYW5nZURBTyA9IENvbnRhaW5lci5yZXNvbHZlPERvY3VtZW50Q2hhbmdlREFPPignRG9jdW1lbnRDaGFuZ2VEQU8nKTtcbiAgICByZXR1cm4gbmV3IERvY3VtZW50U2VydmljZShkb2N1bWVudERBTywgbnVsbCBhcyBhbnksIHNuYXBzaG90U2NoZWR1bGVyLCBjaGFuZ2VEQU8pO1xuICB9KTtcblxuICAvLyDms6jlhowgQ29udHJvbGxlclxuICBDb250YWluZXIucmVnaXN0ZXIoQXV0aENvbnRyb2xsZXIsICgpID0+IHtcbiAgICBjb25zdCBhdXRoU2VydmljZSA9IENvbnRhaW5lci5yZXNvbHZlPEF1dGhTZXJ2aWNlPihBdXRoU2VydmljZSk7XG4gICAgcmV0dXJuIG5ldyBBdXRoQ29udHJvbGxlcihhdXRoU2VydmljZSk7XG4gIH0pO1xuXG4gIENvbnRhaW5lci5yZWdpc3RlcihEb2N1bWVudENvbnRyb2xsZXIsICgpID0+IHtcbiAgICBjb25zdCBkb2N1bWVudFNlcnZpY2UgPSBDb250YWluZXIucmVzb2x2ZTxEb2N1bWVudFNlcnZpY2U+KERvY3VtZW50U2VydmljZSk7XG4gICAgY29uc3QgYXV0aFNlcnZpY2UgPSBDb250YWluZXIucmVzb2x2ZTxBdXRoU2VydmljZT4oQXV0aFNlcnZpY2UpO1xuICAgIHJldHVybiBuZXcgRG9jdW1lbnRDb250cm9sbGVyKGRvY3VtZW50U2VydmljZSwgYXV0aFNlcnZpY2UpO1xuICB9KTtcblxuICBDb250YWluZXIucmVnaXN0ZXIoV29ya3NwYWNlQ29udHJvbGxlciwgKCkgPT4ge1xuICAgIGNvbnN0IHdvcmtzcGFjZURBTyA9IENvbnRhaW5lci5yZXNvbHZlPFdvcmtzcGFjZURBTz4oJ1dvcmtzcGFjZURBTycpO1xuICAgIGNvbnN0IGF1dGhTZXJ2aWNlID0gQ29udGFpbmVyLnJlc29sdmU8QXV0aFNlcnZpY2U+KEF1dGhTZXJ2aWNlKTtcbiAgICByZXR1cm4gbmV3IFdvcmtzcGFjZUNvbnRyb2xsZXIod29ya3NwYWNlREFPLCBhdXRoU2VydmljZSk7XG4gIH0pO1xufVxuXG4vLyDoh6rliqjliJ3lp4vljJZcbmluaXRpYWxpemVDb250YWluZXIoKTtcbiJdLCJuYW1lcyI6WyJDb250YWluZXIiLCJVc2VyREFPIiwiRG9jdW1lbnREQU8iLCJEb2N1bWVudENoYW5nZURBTyIsIldvcmtzcGFjZURBTyIsIkF1dGhTZXJ2aWNlIiwiRG9jdW1lbnRTZXJ2aWNlIiwiU25hcHNob3RTZXJ2aWNlIiwiU25hcHNob3RTY2hlZHVsZXIiLCJBdXRoQ29udHJvbGxlciIsIkRvY3VtZW50Q29udHJvbGxlciIsIldvcmtzcGFjZUNvbnRyb2xsZXIiLCJpbml0aWFsaXplQ29udGFpbmVyIiwicmVnaXN0ZXIiLCJ1c2VyREFPIiwicmVzb2x2ZSIsIndvcmtzcGFjZURBTyIsImRvY3VtZW50REFPIiwic25hcHNob3RTZXJ2aWNlIiwic25hcHNob3RTY2hlZHVsZXIiLCJjaGFuZ2VEQU8iLCJhdXRoU2VydmljZSIsImRvY3VtZW50U2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/init.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/redis.ts":
/*!***************************!*\
  !*** ./src/core/redis.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Redis: () => (/* binding */ Redis)\n/* harmony export */ });\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! redis */ \"(rsc)/../../node_modules/redis/dist/index.js\");\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(redis__WEBPACK_IMPORTED_MODULE_0__);\n\nclass Redis {\n    constructor(){\n        const url = process.env.REDIS_URL || \"redis://localhost:6379\";\n        this.client = (0,redis__WEBPACK_IMPORTED_MODULE_0__.createClient)({\n            url,\n            password: process.env.REDIS_PASSWORD || undefined\n        });\n        this.client.on(\"error\", (err)=>{\n            console.error(\"Redis Client Error\", err);\n        });\n    }\n    static getInstance() {\n        if (!Redis.instance) {\n            Redis.instance = new Redis();\n        }\n        return Redis.instance;\n    }\n    async connect() {\n        if (!this.client.isOpen) {\n            await this.client.connect();\n        }\n    }\n    getClient() {\n        return this.client;\n    }\n    /**\n   * 设置缓存\n   */ async set(key, value, ttl) {\n        await this.connect();\n        if (ttl) {\n            await this.client.setEx(key, ttl, value);\n        } else {\n            await this.client.set(key, value);\n        }\n    }\n    /**\n   * 获取缓存\n   */ async get(key) {\n        await this.connect();\n        return await this.client.get(key);\n    }\n    /**\n   * 删除缓存\n   */ async del(key) {\n        await this.connect();\n        await this.client.del(key);\n    }\n    /**\n   * 设置 JSON 缓存\n   */ async setJSON(key, value, ttl) {\n        await this.set(key, JSON.stringify(value), ttl);\n    }\n    /**\n   * 获取 JSON 缓存\n   */ async getJSON(key) {\n        const value = await this.get(key);\n        if (!value) return null;\n        try {\n            return JSON.parse(value);\n        } catch  {\n            return null;\n        }\n    }\n    /**\n   * 关闭连接\n   */ async close() {\n        if (this.client.isOpen) {\n            await this.client.quit();\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9yZWRpcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBc0Q7QUFFL0MsTUFBTUM7SUFJWCxhQUFzQjtRQUNwQixNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFNBQVMsSUFBSTtRQUNyQyxJQUFJLENBQUNDLE1BQU0sR0FBR04sbURBQVlBLENBQUM7WUFDekJFO1lBQ0FLLFVBQVVKLFFBQVFDLEdBQUcsQ0FBQ0ksY0FBYyxJQUFJQztRQUMxQztRQUVBLElBQUksQ0FBQ0gsTUFBTSxDQUFDSSxFQUFFLENBQUMsU0FBUyxDQUFDQztZQUN2QkMsUUFBUUMsS0FBSyxDQUFDLHNCQUFzQkY7UUFDdEM7SUFDRjtJQUVBLE9BQWNHLGNBQXFCO1FBQ2pDLElBQUksQ0FBQ2IsTUFBTWMsUUFBUSxFQUFFO1lBQ25CZCxNQUFNYyxRQUFRLEdBQUcsSUFBSWQ7UUFDdkI7UUFDQSxPQUFPQSxNQUFNYyxRQUFRO0lBQ3ZCO0lBRUEsTUFBYUMsVUFBeUI7UUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQ1YsTUFBTSxDQUFDVyxNQUFNLEVBQUU7WUFDdkIsTUFBTSxJQUFJLENBQUNYLE1BQU0sQ0FBQ1UsT0FBTztRQUMzQjtJQUNGO0lBRU9FLFlBQTZCO1FBQ2xDLE9BQU8sSUFBSSxDQUFDWixNQUFNO0lBQ3BCO0lBRUE7O0dBRUMsR0FDRCxNQUFhYSxJQUNYQyxHQUFXLEVBQ1hDLEtBQWEsRUFDYkMsR0FBWSxFQUNHO1FBQ2YsTUFBTSxJQUFJLENBQUNOLE9BQU87UUFDbEIsSUFBSU0sS0FBSztZQUNQLE1BQU0sSUFBSSxDQUFDaEIsTUFBTSxDQUFDaUIsS0FBSyxDQUFDSCxLQUFLRSxLQUFLRDtRQUNwQyxPQUFPO1lBQ0wsTUFBTSxJQUFJLENBQUNmLE1BQU0sQ0FBQ2EsR0FBRyxDQUFDQyxLQUFLQztRQUM3QjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFhRyxJQUFJSixHQUFXLEVBQTBCO1FBQ3BELE1BQU0sSUFBSSxDQUFDSixPQUFPO1FBQ2xCLE9BQU8sTUFBTSxJQUFJLENBQUNWLE1BQU0sQ0FBQ2tCLEdBQUcsQ0FBQ0o7SUFDL0I7SUFFQTs7R0FFQyxHQUNELE1BQWFLLElBQUlMLEdBQVcsRUFBaUI7UUFDM0MsTUFBTSxJQUFJLENBQUNKLE9BQU87UUFDbEIsTUFBTSxJQUFJLENBQUNWLE1BQU0sQ0FBQ21CLEdBQUcsQ0FBQ0w7SUFDeEI7SUFFQTs7R0FFQyxHQUNELE1BQWFNLFFBQVdOLEdBQVcsRUFBRUMsS0FBUSxFQUFFQyxHQUFZLEVBQWlCO1FBQzFFLE1BQU0sSUFBSSxDQUFDSCxHQUFHLENBQUNDLEtBQUtPLEtBQUtDLFNBQVMsQ0FBQ1AsUUFBUUM7SUFDN0M7SUFFQTs7R0FFQyxHQUNELE1BQWFPLFFBQVdULEdBQVcsRUFBcUI7UUFDdEQsTUFBTUMsUUFBUSxNQUFNLElBQUksQ0FBQ0csR0FBRyxDQUFDSjtRQUM3QixJQUFJLENBQUNDLE9BQU8sT0FBTztRQUNuQixJQUFJO1lBQ0YsT0FBT00sS0FBS0csS0FBSyxDQUFDVDtRQUNwQixFQUFFLE9BQU07WUFDTixPQUFPO1FBQ1Q7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBYVUsUUFBdUI7UUFDbEMsSUFBSSxJQUFJLENBQUN6QixNQUFNLENBQUNXLE1BQU0sRUFBRTtZQUN0QixNQUFNLElBQUksQ0FBQ1gsTUFBTSxDQUFDMEIsSUFBSTtRQUN4QjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9yZWRpcy50cz8xZTJiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCwgUmVkaXNDbGllbnRUeXBlIH0gZnJvbSAncmVkaXMnO1xuXG5leHBvcnQgY2xhc3MgUmVkaXMge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUmVkaXM7XG4gIHByaXZhdGUgY2xpZW50OiBSZWRpc0NsaWVudFR5cGU7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknO1xuICAgIHRoaXMuY2xpZW50ID0gY3JlYXRlQ2xpZW50KHtcbiAgICAgIHVybCxcbiAgICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5SRURJU19QQVNTV09SRCB8fCB1bmRlZmluZWQsXG4gICAgfSkgYXMgUmVkaXNDbGllbnRUeXBlO1xuXG4gICAgdGhpcy5jbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignUmVkaXMgQ2xpZW50IEVycm9yJywgZXJyKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogUmVkaXMge1xuICAgIGlmICghUmVkaXMuaW5zdGFuY2UpIHtcbiAgICAgIFJlZGlzLmluc3RhbmNlID0gbmV3IFJlZGlzKCk7XG4gICAgfVxuICAgIHJldHVybiBSZWRpcy5pbnN0YW5jZTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBjb25uZWN0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5jbGllbnQuaXNPcGVuKSB7XG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5jb25uZWN0KCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldENsaWVudCgpOiBSZWRpc0NsaWVudFR5cGUge1xuICAgIHJldHVybiB0aGlzLmNsaWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiDorr7nva7nvJPlrZhcbiAgICovXG4gIHB1YmxpYyBhc3luYyBzZXQoXG4gICAga2V5OiBzdHJpbmcsXG4gICAgdmFsdWU6IHN0cmluZyxcbiAgICB0dGw/OiBudW1iZXJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5jb25uZWN0KCk7XG4gICAgaWYgKHR0bCkge1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuc2V0RXgoa2V5LCB0dGwsIHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuc2V0KGtleSwgdmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnvJPlrZhcbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXQoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICBhd2FpdCB0aGlzLmNvbm5lY3QoKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jbGllbnQuZ2V0KGtleSk7XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk57yT5a2YXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZGVsKGtleTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5jb25uZWN0KCk7XG4gICAgYXdhaXQgdGhpcy5jbGllbnQuZGVsKGtleSk7XG4gIH1cblxuICAvKipcbiAgICog6K6+572uIEpTT04g57yT5a2YXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc2V0SlNPTjxUPihrZXk6IHN0cmluZywgdmFsdWU6IFQsIHR0bD86IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuc2V0KGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpLCB0dGwpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPliBKU09OIOe8k+WtmFxuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldEpTT048VD4oa2V5OiBzdHJpbmcpOiBQcm9taXNlPFQgfCBudWxsPiB7XG4gICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLmdldChrZXkpO1xuICAgIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSkgYXMgVDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlhbPpl63ov57mjqVcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5jbGllbnQuaXNPcGVuKSB7XG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5xdWl0KCk7XG4gICAgfVxuICB9XG59XG5cblxuXG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJSZWRpcyIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19VUkwiLCJjbGllbnQiLCJwYXNzd29yZCIsIlJFRElTX1BBU1NXT1JEIiwidW5kZWZpbmVkIiwib24iLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiY29ubmVjdCIsImlzT3BlbiIsImdldENsaWVudCIsInNldCIsImtleSIsInZhbHVlIiwidHRsIiwic2V0RXgiLCJnZXQiLCJkZWwiLCJzZXRKU09OIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldEpTT04iLCJwYXJzZSIsImNsb3NlIiwicXVpdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/redis.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/storage/local-file-storage.ts":
/*!************************************************!*\
  !*** ./src/core/storage/local-file-storage.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LocalFileStorage: () => (/* binding */ LocalFileStorage)\n/* harmony export */ });\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n\n\n/**\n * 本地文件存储实现\n * 存储路径：{basePath}/{workspaceId}/{objectId}/snapshot_{timestamp}.gz\n */ class LocalFileStorage {\n    constructor(basePath = \"./storage/snapshots\"){\n        this.basePath = basePath;\n    }\n    /**\n   * 确保目录存在\n   */ async ensureDir(dirPath) {\n        try {\n            await fs_promises__WEBPACK_IMPORTED_MODULE_0__.mkdir(dirPath, {\n                recursive: true\n            });\n        } catch (error) {\n            if (error.code !== \"EEXIST\") {\n                throw error;\n            }\n        }\n    }\n    /**\n   * 获取完整文件路径\n   */ getFilePath(key) {\n        return path__WEBPACK_IMPORTED_MODULE_1__.join(this.basePath, key);\n    }\n    /**\n   * 存储快照数据\n   */ async put(key, data, metadata) {\n        const filePath = this.getFilePath(key);\n        const dirPath = path__WEBPACK_IMPORTED_MODULE_1__.dirname(filePath);\n        // 确保目录存在\n        await this.ensureDir(dirPath);\n        // 写入文件\n        await fs_promises__WEBPACK_IMPORTED_MODULE_0__.writeFile(filePath, data);\n        // 如果有元数据，写入元数据文件\n        if (metadata) {\n            const metaPath = filePath + \".meta.json\";\n            await fs_promises__WEBPACK_IMPORTED_MODULE_0__.writeFile(metaPath, JSON.stringify(metadata, null, 2));\n        }\n    }\n    /**\n   * 获取快照数据\n   */ async get(key) {\n        const filePath = this.getFilePath(key);\n        try {\n            const data = await fs_promises__WEBPACK_IMPORTED_MODULE_0__.readFile(filePath);\n            return data;\n        } catch (error) {\n            if (error.code === \"ENOENT\") {\n                return null;\n            }\n            throw error;\n        }\n    }\n    /**\n   * 删除快照数据\n   */ async delete(key) {\n        const filePath = this.getFilePath(key);\n        try {\n            await fs_promises__WEBPACK_IMPORTED_MODULE_0__.unlink(filePath);\n            // 同时删除元数据文件\n            const metaPath = filePath + \".meta.json\";\n            try {\n                await fs_promises__WEBPACK_IMPORTED_MODULE_0__.unlink(metaPath);\n            } catch  {\n            // 忽略元数据文件不存在的错误\n            }\n        } catch (error) {\n            if (error.code !== \"ENOENT\") {\n                throw error;\n            }\n        }\n    }\n    /**\n   * 列出指定前缀的所有键\n   */ async list(prefix, limit) {\n        const dirPath = this.getFilePath(prefix);\n        const keys = [];\n        try {\n            // 递归读取目录\n            const readDirRecursive = async (dir, baseDir)=>{\n                const entries = await fs_promises__WEBPACK_IMPORTED_MODULE_0__.readdir(dir, {\n                    withFileTypes: true\n                });\n                const files = [];\n                for (const entry of entries){\n                    const fullPath = path__WEBPACK_IMPORTED_MODULE_1__.join(dir, entry.name);\n                    const relativePath = path__WEBPACK_IMPORTED_MODULE_1__.relative(baseDir, fullPath);\n                    if (entry.isDirectory()) {\n                        const subFiles = await readDirRecursive(fullPath, baseDir);\n                        files.push(...subFiles);\n                    } else if (entry.isFile() && !entry.name.endsWith(\".meta.json\")) {\n                        files.push(relativePath);\n                    }\n                }\n                return files;\n            };\n            const allFiles = await readDirRecursive(dirPath, this.basePath);\n            // 按文件名排序（时间戳降序）\n            allFiles.sort((a, b)=>{\n                const aName = path__WEBPACK_IMPORTED_MODULE_1__.basename(a);\n                const bName = path__WEBPACK_IMPORTED_MODULE_1__.basename(b);\n                return bName.localeCompare(aName);\n            });\n            // 应用限制\n            if (limit) {\n                return allFiles.slice(0, limit);\n            }\n            return allFiles;\n        } catch (error) {\n            if (error.code === \"ENOENT\") {\n                return [];\n            }\n            throw error;\n        }\n    }\n    /**\n   * 批量删除\n   */ async deleteMany(keys) {\n        await Promise.all(keys.map((key)=>this.delete(key)));\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9zdG9yYWdlL2xvY2FsLWZpbGUtc3RvcmFnZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFrQztBQUNMO0FBRzdCOzs7Q0FHQyxHQUNNLE1BQU1FO0lBR1hDLFlBQVlDLFdBQW1CLHFCQUFxQixDQUFFO1FBQ3BELElBQUksQ0FBQ0EsUUFBUSxHQUFHQTtJQUNsQjtJQUVBOztHQUVDLEdBQ0QsTUFBY0MsVUFBVUMsT0FBZSxFQUFpQjtRQUN0RCxJQUFJO1lBQ0YsTUFBTU4sOENBQVEsQ0FBQ00sU0FBUztnQkFBRUUsV0FBVztZQUFLO1FBQzVDLEVBQUUsT0FBT0MsT0FBWTtZQUNuQixJQUFJQSxNQUFNQyxJQUFJLEtBQUssVUFBVTtnQkFDM0IsTUFBTUQ7WUFDUjtRQUNGO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELFlBQW9CRyxHQUFXLEVBQVU7UUFDdkMsT0FBT1gsc0NBQVMsQ0FBQyxJQUFJLENBQUNHLFFBQVEsRUFBRVE7SUFDbEM7SUFFQTs7R0FFQyxHQUNELE1BQU1FLElBQUlGLEdBQVcsRUFBRUcsSUFBWSxFQUFFQyxRQUE4QixFQUFpQjtRQUNsRixNQUFNQyxXQUFXLElBQUksQ0FBQ04sV0FBVyxDQUFDQztRQUNsQyxNQUFNTixVQUFVTCx5Q0FBWSxDQUFDZ0I7UUFFN0IsU0FBUztRQUNULE1BQU0sSUFBSSxDQUFDWixTQUFTLENBQUNDO1FBRXJCLE9BQU87UUFDUCxNQUFNTixrREFBWSxDQUFDaUIsVUFBVUY7UUFFN0IsaUJBQWlCO1FBQ2pCLElBQUlDLFVBQVU7WUFDWixNQUFNSSxXQUFXSCxXQUFXO1lBQzVCLE1BQU1qQixrREFBWSxDQUFDb0IsVUFBVUMsS0FBS0MsU0FBUyxDQUFDTixVQUFVLE1BQU07UUFDOUQ7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTU8sSUFBSVgsR0FBVyxFQUEwQjtRQUM3QyxNQUFNSyxXQUFXLElBQUksQ0FBQ04sV0FBVyxDQUFDQztRQUNsQyxJQUFJO1lBQ0YsTUFBTUcsT0FBTyxNQUFNZixpREFBVyxDQUFDaUI7WUFDL0IsT0FBT0Y7UUFDVCxFQUFFLE9BQU9OLE9BQVk7WUFDbkIsSUFBSUEsTUFBTUMsSUFBSSxLQUFLLFVBQVU7Z0JBQzNCLE9BQU87WUFDVDtZQUNBLE1BQU1EO1FBQ1I7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTWdCLE9BQU9iLEdBQVcsRUFBaUI7UUFDdkMsTUFBTUssV0FBVyxJQUFJLENBQUNOLFdBQVcsQ0FBQ0M7UUFDbEMsSUFBSTtZQUNGLE1BQU1aLCtDQUFTLENBQUNpQjtZQUNoQixZQUFZO1lBQ1osTUFBTUcsV0FBV0gsV0FBVztZQUM1QixJQUFJO2dCQUNGLE1BQU1qQiwrQ0FBUyxDQUFDb0I7WUFDbEIsRUFBRSxPQUFNO1lBQ04sZ0JBQWdCO1lBQ2xCO1FBQ0YsRUFBRSxPQUFPWCxPQUFZO1lBQ25CLElBQUlBLE1BQU1DLElBQUksS0FBSyxVQUFVO2dCQUMzQixNQUFNRDtZQUNSO1FBQ0Y7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTWtCLEtBQUtDLE1BQWMsRUFBRUMsS0FBYyxFQUFxQjtRQUM1RCxNQUFNdkIsVUFBVSxJQUFJLENBQUNLLFdBQVcsQ0FBQ2lCO1FBQ2pDLE1BQU1FLE9BQWlCLEVBQUU7UUFFekIsSUFBSTtZQUNGLFNBQVM7WUFDVCxNQUFNQyxtQkFBbUIsT0FBT0MsS0FBYUM7Z0JBQzNDLE1BQU1DLFVBQVUsTUFBTWxDLGdEQUFVLENBQUNnQyxLQUFLO29CQUFFSSxlQUFlO2dCQUFLO2dCQUM1RCxNQUFNQyxRQUFrQixFQUFFO2dCQUUxQixLQUFLLE1BQU1DLFNBQVNKLFFBQVM7b0JBQzNCLE1BQU1LLFdBQVd0QyxzQ0FBUyxDQUFDK0IsS0FBS00sTUFBTUUsSUFBSTtvQkFDMUMsTUFBTUMsZUFBZXhDLDBDQUFhLENBQUNnQyxTQUFTTTtvQkFFNUMsSUFBSUQsTUFBTUssV0FBVyxJQUFJO3dCQUN2QixNQUFNQyxXQUFXLE1BQU1iLGlCQUFpQlEsVUFBVU47d0JBQ2xESSxNQUFNUSxJQUFJLElBQUlEO29CQUNoQixPQUFPLElBQUlOLE1BQU1RLE1BQU0sTUFBTSxDQUFDUixNQUFNRSxJQUFJLENBQUNPLFFBQVEsQ0FBQyxlQUFlO3dCQUMvRFYsTUFBTVEsSUFBSSxDQUFDSjtvQkFDYjtnQkFDRjtnQkFFQSxPQUFPSjtZQUNUO1lBRUEsTUFBTVcsV0FBVyxNQUFNakIsaUJBQWlCekIsU0FBUyxJQUFJLENBQUNGLFFBQVE7WUFFOUQsZ0JBQWdCO1lBQ2hCNEMsU0FBU0MsSUFBSSxDQUFDLENBQUNDLEdBQUdDO2dCQUNoQixNQUFNQyxRQUFRbkQsMENBQWEsQ0FBQ2lEO2dCQUM1QixNQUFNSSxRQUFRckQsMENBQWEsQ0FBQ2tEO2dCQUM1QixPQUFPRyxNQUFNQyxhQUFhLENBQUNIO1lBQzdCO1lBRUEsT0FBTztZQUNQLElBQUl2QixPQUFPO2dCQUNULE9BQU9tQixTQUFTUSxLQUFLLENBQUMsR0FBRzNCO1lBQzNCO1lBRUEsT0FBT21CO1FBQ1QsRUFBRSxPQUFPdkMsT0FBWTtZQUNuQixJQUFJQSxNQUFNQyxJQUFJLEtBQUssVUFBVTtnQkFDM0IsT0FBTyxFQUFFO1lBQ1g7WUFDQSxNQUFNRDtRQUNSO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1nRCxXQUFXM0IsSUFBYyxFQUFpQjtRQUM5QyxNQUFNNEIsUUFBUUMsR0FBRyxDQUFDN0IsS0FBSzhCLEdBQUcsQ0FBQyxDQUFDaEQsTUFBUSxJQUFJLENBQUNhLE1BQU0sQ0FBQ2I7SUFDbEQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9jb3JlL3N0b3JhZ2UvbG9jYWwtZmlsZS1zdG9yYWdlLnRzPzYzMmMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFN0b3JhZ2VBZGFwdGVyIH0gZnJvbSAnLi9zdG9yYWdlLmludGVyZmFjZSc7XG5cbi8qKlxuICog5pys5Zyw5paH5Lu25a2Y5YKo5a6e546wXG4gKiDlrZjlgqjot6/lvoTvvJp7YmFzZVBhdGh9L3t3b3Jrc3BhY2VJZH0ve29iamVjdElkfS9zbmFwc2hvdF97dGltZXN0YW1wfS5nelxuICovXG5leHBvcnQgY2xhc3MgTG9jYWxGaWxlU3RvcmFnZSBpbXBsZW1lbnRzIFN0b3JhZ2VBZGFwdGVyIHtcbiAgcHJpdmF0ZSBiYXNlUGF0aDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGJhc2VQYXRoOiBzdHJpbmcgPSAnLi9zdG9yYWdlL3NuYXBzaG90cycpIHtcbiAgICB0aGlzLmJhc2VQYXRoID0gYmFzZVBhdGg7XG4gIH1cblxuICAvKipcbiAgICog56Gu5L+d55uu5b2V5a2Y5ZyoXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGVuc3VyZURpcihkaXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMubWtkaXIoZGlyUGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yLmNvZGUgIT09ICdFRVhJU1QnKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blrozmlbTmlofku7bot6/lvoRcbiAgICovXG4gIHByaXZhdGUgZ2V0RmlsZVBhdGgoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBwYXRoLmpvaW4odGhpcy5iYXNlUGF0aCwga2V5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlrZjlgqjlv6vnhafmlbDmja5cbiAgICovXG4gIGFzeW5jIHB1dChrZXk6IHN0cmluZywgZGF0YTogQnVmZmVyLCBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBmaWxlUGF0aCA9IHRoaXMuZ2V0RmlsZVBhdGgoa2V5KTtcbiAgICBjb25zdCBkaXJQYXRoID0gcGF0aC5kaXJuYW1lKGZpbGVQYXRoKTtcblxuICAgIC8vIOehruS/neebruW9leWtmOWcqFxuICAgIGF3YWl0IHRoaXMuZW5zdXJlRGlyKGRpclBhdGgpO1xuXG4gICAgLy8g5YaZ5YWl5paH5Lu2XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKGZpbGVQYXRoLCBkYXRhKTtcblxuICAgIC8vIOWmguaenOacieWFg+aVsOaNru+8jOWGmeWFpeWFg+aVsOaNruaWh+S7tlxuICAgIGlmIChtZXRhZGF0YSkge1xuICAgICAgY29uc3QgbWV0YVBhdGggPSBmaWxlUGF0aCArICcubWV0YS5qc29uJztcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZShtZXRhUGF0aCwgSlNPTi5zdHJpbmdpZnkobWV0YWRhdGEsIG51bGwsIDIpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5b+r54Wn5pWw5o2uXG4gICAqL1xuICBhc3luYyBnZXQoa2V5OiBzdHJpbmcpOiBQcm9taXNlPEJ1ZmZlciB8IG51bGw+IHtcbiAgICBjb25zdCBmaWxlUGF0aCA9IHRoaXMuZ2V0RmlsZVBhdGgoa2V5KTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKGZpbGVQYXRoKTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnRU5PRU5UJykge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTlv6vnhafmlbDmja5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZShrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGZpbGVQYXRoID0gdGhpcy5nZXRGaWxlUGF0aChrZXkpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsoZmlsZVBhdGgpO1xuICAgICAgLy8g5ZCM5pe25Yig6Zmk5YWD5pWw5o2u5paH5Lu2XG4gICAgICBjb25zdCBtZXRhUGF0aCA9IGZpbGVQYXRoICsgJy5tZXRhLmpzb24nO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZnMudW5saW5rKG1ldGFQYXRoKTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICAvLyDlv73nlaXlhYPmlbDmja7mlofku7bkuI3lrZjlnKjnmoTplJnor69cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSAhPT0gJ0VOT0VOVCcpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIl+WHuuaMh+WumuWJjee8gOeahOaJgOaciemUrlxuICAgKi9cbiAgYXN5bmMgbGlzdChwcmVmaXg6IHN0cmluZywgbGltaXQ/OiBudW1iZXIpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgZGlyUGF0aCA9IHRoaXMuZ2V0RmlsZVBhdGgocHJlZml4KTtcbiAgICBjb25zdCBrZXlzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIOmAkuW9kuivu+WPluebruW9lVxuICAgICAgY29uc3QgcmVhZERpclJlY3Vyc2l2ZSA9IGFzeW5jIChkaXI6IHN0cmluZywgYmFzZURpcjogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmdbXT4gPT4ge1xuICAgICAgICBjb25zdCBlbnRyaWVzID0gYXdhaXQgZnMucmVhZGRpcihkaXIsIHsgd2l0aEZpbGVUeXBlczogdHJ1ZSB9KTtcbiAgICAgICAgY29uc3QgZmlsZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgICAgY29uc3QgZnVsbFBhdGggPSBwYXRoLmpvaW4oZGlyLCBlbnRyeS5uYW1lKTtcbiAgICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBwYXRoLnJlbGF0aXZlKGJhc2VEaXIsIGZ1bGxQYXRoKTtcblxuICAgICAgICAgIGlmIChlbnRyeS5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICBjb25zdCBzdWJGaWxlcyA9IGF3YWl0IHJlYWREaXJSZWN1cnNpdmUoZnVsbFBhdGgsIGJhc2VEaXIpO1xuICAgICAgICAgICAgZmlsZXMucHVzaCguLi5zdWJGaWxlcyk7XG4gICAgICAgICAgfSBlbHNlIGlmIChlbnRyeS5pc0ZpbGUoKSAmJiAhZW50cnkubmFtZS5lbmRzV2l0aCgnLm1ldGEuanNvbicpKSB7XG4gICAgICAgICAgICBmaWxlcy5wdXNoKHJlbGF0aXZlUGF0aCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZpbGVzO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgYWxsRmlsZXMgPSBhd2FpdCByZWFkRGlyUmVjdXJzaXZlKGRpclBhdGgsIHRoaXMuYmFzZVBhdGgpO1xuXG4gICAgICAvLyDmjInmlofku7blkI3mjpLluo/vvIjml7bpl7TmiLPpmY3luo/vvIlcbiAgICAgIGFsbEZpbGVzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgY29uc3QgYU5hbWUgPSBwYXRoLmJhc2VuYW1lKGEpO1xuICAgICAgICBjb25zdCBiTmFtZSA9IHBhdGguYmFzZW5hbWUoYik7XG4gICAgICAgIHJldHVybiBiTmFtZS5sb2NhbGVDb21wYXJlKGFOYW1lKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyDlupTnlKjpmZDliLZcbiAgICAgIGlmIChsaW1pdCkge1xuICAgICAgICByZXR1cm4gYWxsRmlsZXMuc2xpY2UoMCwgbGltaXQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYWxsRmlsZXM7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdFTk9FTlQnKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmibnph4/liKDpmaRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZU1hbnkoa2V5czogc3RyaW5nW10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChrZXlzLm1hcCgoa2V5KSA9PiB0aGlzLmRlbGV0ZShrZXkpKSk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbImZzIiwicGF0aCIsIkxvY2FsRmlsZVN0b3JhZ2UiLCJjb25zdHJ1Y3RvciIsImJhc2VQYXRoIiwiZW5zdXJlRGlyIiwiZGlyUGF0aCIsIm1rZGlyIiwicmVjdXJzaXZlIiwiZXJyb3IiLCJjb2RlIiwiZ2V0RmlsZVBhdGgiLCJrZXkiLCJqb2luIiwicHV0IiwiZGF0YSIsIm1ldGFkYXRhIiwiZmlsZVBhdGgiLCJkaXJuYW1lIiwid3JpdGVGaWxlIiwibWV0YVBhdGgiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0IiwicmVhZEZpbGUiLCJkZWxldGUiLCJ1bmxpbmsiLCJsaXN0IiwicHJlZml4IiwibGltaXQiLCJrZXlzIiwicmVhZERpclJlY3Vyc2l2ZSIsImRpciIsImJhc2VEaXIiLCJlbnRyaWVzIiwicmVhZGRpciIsIndpdGhGaWxlVHlwZXMiLCJmaWxlcyIsImVudHJ5IiwiZnVsbFBhdGgiLCJuYW1lIiwicmVsYXRpdmVQYXRoIiwicmVsYXRpdmUiLCJpc0RpcmVjdG9yeSIsInN1YkZpbGVzIiwicHVzaCIsImlzRmlsZSIsImVuZHNXaXRoIiwiYWxsRmlsZXMiLCJzb3J0IiwiYSIsImIiLCJhTmFtZSIsImJhc2VuYW1lIiwiYk5hbWUiLCJsb2NhbGVDb21wYXJlIiwic2xpY2UiLCJkZWxldGVNYW55IiwiUHJvbWlzZSIsImFsbCIsIm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/storage/local-file-storage.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/storage/storage.factory.ts":
/*!*********************************************!*\
  !*** ./src/core/storage/storage.factory.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   StorageFactory: () => (/* binding */ StorageFactory),\n/* harmony export */   extractTimestampFromKey: () => (/* binding */ extractTimestampFromKey),\n/* harmony export */   getSnapshotKey: () => (/* binding */ getSnapshotKey),\n/* harmony export */   getSnapshotPrefix: () => (/* binding */ getSnapshotPrefix)\n/* harmony export */ });\n/* harmony import */ var _local_file_storage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./local-file-storage */ \"(rsc)/./src/core/storage/local-file-storage.ts\");\n\n/**\n * 存储工厂\n * 根据配置创建不同的存储实现\n */ class StorageFactory {\n    static{\n        this.instance = null;\n    }\n    /**\n   * 获取存储实例（单例）\n   */ static getInstance() {\n        if (!StorageFactory.instance) {\n            const storageType = process.env.STORAGE_TYPE || \"local\";\n            const basePath = process.env.STORAGE_BASE_PATH || \"./storage/snapshots\";\n            switch(storageType){\n                case \"local\":\n                    StorageFactory.instance = new _local_file_storage__WEBPACK_IMPORTED_MODULE_0__.LocalFileStorage(basePath);\n                    break;\n                case \"s3\":\n                    // TODO: 实现 S3 存储\n                    // StorageFactory.instance = new S3Storage(...);\n                    throw new Error(\"S3 storage not implemented yet\");\n                default:\n                    throw new Error(`Unknown storage type: ${storageType}`);\n            }\n        }\n        return StorageFactory.instance;\n    }\n    /**\n   * 重置实例（用于测试）\n   */ static reset() {\n        StorageFactory.instance = null;\n    }\n}\n/**\n * 生成快照存储键\n * 格式：{workspaceId}/{objectId}/snapshot_{timestamp}.gz\n */ function getSnapshotKey(workspaceId, objectId, timestamp) {\n    // 使用倒序时间戳作为文件名的一部分，便于排序\n    const reversedTimestamp = Number.MAX_SAFE_INTEGER - timestamp;\n    return `${workspaceId}/${objectId}/snapshot_${reversedTimestamp.toString(16).padStart(16, \"0\")}.gz`;\n}\n/**\n * 生成快照前缀（用于列出某个文档的所有快照）\n */ function getSnapshotPrefix(workspaceId, objectId) {\n    return `${workspaceId}/${objectId}/snapshot_`;\n}\n/**\n * 从键中提取时间戳\n */ function extractTimestampFromKey(key) {\n    const match = key.match(/snapshot_([0-9a-f]+)\\.gz$/);\n    if (!match) return null;\n    const reversedTimestamp = parseInt(match[1], 16);\n    return Number.MAX_SAFE_INTEGER - reversedTimestamp;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9zdG9yYWdlL3N0b3JhZ2UuZmFjdG9yeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUN3RDtBQUV4RDs7O0NBR0MsR0FDTSxNQUFNQzs7YUFDSUMsV0FBa0M7O0lBRWpEOztHQUVDLEdBQ0QsT0FBT0MsY0FBOEI7UUFDbkMsSUFBSSxDQUFDRixlQUFlQyxRQUFRLEVBQUU7WUFDNUIsTUFBTUUsY0FBY0MsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLElBQUk7WUFDaEQsTUFBTUMsV0FBV0gsUUFBUUMsR0FBRyxDQUFDRyxpQkFBaUIsSUFBSTtZQUVsRCxPQUFRTDtnQkFDTixLQUFLO29CQUNISCxlQUFlQyxRQUFRLEdBQUcsSUFBSUYsaUVBQWdCQSxDQUFDUTtvQkFDL0M7Z0JBQ0YsS0FBSztvQkFDSCxpQkFBaUI7b0JBQ2pCLGdEQUFnRDtvQkFDaEQsTUFBTSxJQUFJRSxNQUFNO2dCQUNsQjtvQkFDRSxNQUFNLElBQUlBLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRU4sWUFBWSxDQUFDO1lBQzFEO1FBQ0Y7UUFFQSxPQUFPSCxlQUFlQyxRQUFRO0lBQ2hDO0lBRUE7O0dBRUMsR0FDRCxPQUFPUyxRQUFjO1FBQ25CVixlQUFlQyxRQUFRLEdBQUc7SUFDNUI7QUFDRjtBQUVBOzs7Q0FHQyxHQUNNLFNBQVNVLGVBQ2RDLFdBQW1CLEVBQ25CQyxRQUFnQixFQUNoQkMsU0FBaUI7SUFFakIsd0JBQXdCO0lBQ3hCLE1BQU1DLG9CQUFvQkMsT0FBT0MsZ0JBQWdCLEdBQUdIO0lBQ3BELE9BQU8sQ0FBQyxFQUFFRixZQUFZLENBQUMsRUFBRUMsU0FBUyxVQUFVLEVBQUVFLGtCQUFrQkcsUUFBUSxDQUFDLElBQUlDLFFBQVEsQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDO0FBQ3JHO0FBRUE7O0NBRUMsR0FDTSxTQUFTQyxrQkFBa0JSLFdBQW1CLEVBQUVDLFFBQWdCO0lBQ3JFLE9BQU8sQ0FBQyxFQUFFRCxZQUFZLENBQUMsRUFBRUMsU0FBUyxVQUFVLENBQUM7QUFDL0M7QUFFQTs7Q0FFQyxHQUNNLFNBQVNRLHdCQUF3QkMsR0FBVztJQUNqRCxNQUFNQyxRQUFRRCxJQUFJQyxLQUFLLENBQUM7SUFDeEIsSUFBSSxDQUFDQSxPQUFPLE9BQU87SUFFbkIsTUFBTVIsb0JBQW9CUyxTQUFTRCxLQUFLLENBQUMsRUFBRSxFQUFFO0lBQzdDLE9BQU9QLE9BQU9DLGdCQUFnQixHQUFHRjtBQUNuQyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9jb3JlL3N0b3JhZ2Uvc3RvcmFnZS5mYWN0b3J5LnRzPzM5ZjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RvcmFnZUFkYXB0ZXIgfSBmcm9tICcuL3N0b3JhZ2UuaW50ZXJmYWNlJztcbmltcG9ydCB7IExvY2FsRmlsZVN0b3JhZ2UgfSBmcm9tICcuL2xvY2FsLWZpbGUtc3RvcmFnZSc7XG5cbi8qKlxuICog5a2Y5YKo5bel5Y6CXG4gKiDmoLnmja7phY3nva7liJvlu7rkuI3lkIznmoTlrZjlgqjlrp7njrBcbiAqL1xuZXhwb3J0IGNsYXNzIFN0b3JhZ2VGYWN0b3J5IHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFN0b3JhZ2VBZGFwdGVyIHwgbnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIOiOt+WPluWtmOWCqOWunuS+i++8iOWNleS+i++8iVxuICAgKi9cbiAgc3RhdGljIGdldEluc3RhbmNlKCk6IFN0b3JhZ2VBZGFwdGVyIHtcbiAgICBpZiAoIVN0b3JhZ2VGYWN0b3J5Lmluc3RhbmNlKSB7XG4gICAgICBjb25zdCBzdG9yYWdlVHlwZSA9IHByb2Nlc3MuZW52LlNUT1JBR0VfVFlQRSB8fCAnbG9jYWwnO1xuICAgICAgY29uc3QgYmFzZVBhdGggPSBwcm9jZXNzLmVudi5TVE9SQUdFX0JBU0VfUEFUSCB8fCAnLi9zdG9yYWdlL3NuYXBzaG90cyc7XG5cbiAgICAgIHN3aXRjaCAoc3RvcmFnZVR5cGUpIHtcbiAgICAgICAgY2FzZSAnbG9jYWwnOlxuICAgICAgICAgIFN0b3JhZ2VGYWN0b3J5Lmluc3RhbmNlID0gbmV3IExvY2FsRmlsZVN0b3JhZ2UoYmFzZVBhdGgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdzMyc6XG4gICAgICAgICAgLy8gVE9ETzog5a6e546wIFMzIOWtmOWCqFxuICAgICAgICAgIC8vIFN0b3JhZ2VGYWN0b3J5Lmluc3RhbmNlID0gbmV3IFMzU3RvcmFnZSguLi4pO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUzMgc3RvcmFnZSBub3QgaW1wbGVtZW50ZWQgeWV0Jyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHN0b3JhZ2UgdHlwZTogJHtzdG9yYWdlVHlwZX1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gU3RvcmFnZUZhY3RvcnkuaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICog6YeN572u5a6e5L6L77yI55So5LqO5rWL6K+V77yJXG4gICAqL1xuICBzdGF0aWMgcmVzZXQoKTogdm9pZCB7XG4gICAgU3RvcmFnZUZhY3RvcnkuaW5zdGFuY2UgPSBudWxsO1xuICB9XG59XG5cbi8qKlxuICog55Sf5oiQ5b+r54Wn5a2Y5YKo6ZSuXG4gKiDmoLzlvI/vvJp7d29ya3NwYWNlSWR9L3tvYmplY3RJZH0vc25hcHNob3Rfe3RpbWVzdGFtcH0uZ3pcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNuYXBzaG90S2V5KFxuICB3b3Jrc3BhY2VJZDogc3RyaW5nLFxuICBvYmplY3RJZDogc3RyaW5nLFxuICB0aW1lc3RhbXA6IG51bWJlclxuKTogc3RyaW5nIHtcbiAgLy8g5L2/55So5YCS5bqP5pe26Ze05oiz5L2c5Li65paH5Lu25ZCN55qE5LiA6YOo5YiG77yM5L6/5LqO5o6S5bqPXG4gIGNvbnN0IHJldmVyc2VkVGltZXN0YW1wID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgLSB0aW1lc3RhbXA7XG4gIHJldHVybiBgJHt3b3Jrc3BhY2VJZH0vJHtvYmplY3RJZH0vc25hcHNob3RfJHtyZXZlcnNlZFRpbWVzdGFtcC50b1N0cmluZygxNikucGFkU3RhcnQoMTYsICcwJyl9Lmd6YDtcbn1cblxuLyoqXG4gKiDnlJ/miJDlv6vnhafliY3nvIDvvIjnlKjkuo7liJflh7rmn5DkuKrmlofmoaPnmoTmiYDmnInlv6vnhafvvIlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNuYXBzaG90UHJlZml4KHdvcmtzcGFjZUlkOiBzdHJpbmcsIG9iamVjdElkOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gYCR7d29ya3NwYWNlSWR9LyR7b2JqZWN0SWR9L3NuYXBzaG90X2A7XG59XG5cbi8qKlxuICog5LuO6ZSu5Lit5o+Q5Y+W5pe26Ze05oizXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0VGltZXN0YW1wRnJvbUtleShrZXk6IHN0cmluZyk6IG51bWJlciB8IG51bGwge1xuICBjb25zdCBtYXRjaCA9IGtleS5tYXRjaCgvc25hcHNob3RfKFswLTlhLWZdKylcXC5neiQvKTtcbiAgaWYgKCFtYXRjaCkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgcmV2ZXJzZWRUaW1lc3RhbXAgPSBwYXJzZUludChtYXRjaFsxXSwgMTYpO1xuICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgLSByZXZlcnNlZFRpbWVzdGFtcDtcbn1cblxuIl0sIm5hbWVzIjpbIkxvY2FsRmlsZVN0b3JhZ2UiLCJTdG9yYWdlRmFjdG9yeSIsImluc3RhbmNlIiwiZ2V0SW5zdGFuY2UiLCJzdG9yYWdlVHlwZSIsInByb2Nlc3MiLCJlbnYiLCJTVE9SQUdFX1RZUEUiLCJiYXNlUGF0aCIsIlNUT1JBR0VfQkFTRV9QQVRIIiwiRXJyb3IiLCJyZXNldCIsImdldFNuYXBzaG90S2V5Iiwid29ya3NwYWNlSWQiLCJvYmplY3RJZCIsInRpbWVzdGFtcCIsInJldmVyc2VkVGltZXN0YW1wIiwiTnVtYmVyIiwiTUFYX1NBRkVfSU5URUdFUiIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJnZXRTbmFwc2hvdFByZWZpeCIsImV4dHJhY3RUaW1lc3RhbXBGcm9tS2V5Iiwia2V5IiwibWF0Y2giLCJwYXJzZUludCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/storage/storage.factory.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/document-change.dao.ts":
/*!****************************************!*\
  !*** ./src/dao/document-change.dao.ts ***!
  \****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentChangeDAO: () => (/* binding */ DocumentChangeDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! uuid */ \"(rsc)/../../node_modules/uuid/dist/esm-node/v4.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_1__]);\n_core_database__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nclass DocumentChangeDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_1__.Database.getInstance();\n    }\n    /**\n   * 创建变更记录\n   */ async create(change) {\n        const created_at = Date.now();\n        const result = await this.db.query(`INSERT INTO pikun_db.document_changes (\n        change_id, object_id, workspace_id, snapshot_id, change_type, \n        change_data, before_state_vector, after_state_vector, change_size, metadata, created_at\n      )\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\n      RETURNING *`, [\n            (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(),\n            change.object_id,\n            change.workspace_id,\n            change.snapshot_id || null,\n            change.change_type,\n            change.change_data,\n            change.before_state_vector || null,\n            change.after_state_vector || null,\n            change.change_data.length,\n            JSON.stringify(change.metadata || {}),\n            created_at\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 获取文档的变更列表\n   */ async findByObjectId(object_id, options = {}) {\n        const { limit = 100, offset = 0, after_snapshot_id } = options;\n        let query = `\n      SELECT COUNT(*) as count \n      FROM pikun_db.document_changes \n      WHERE object_id = $1\n    `;\n        const countParams = [\n            object_id\n        ];\n        if (after_snapshot_id) {\n            query += ` AND created_at > (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $2)`;\n            countParams.push(after_snapshot_id);\n        }\n        const countResult = await this.db.query(query, countParams);\n        const total = parseInt(countResult.rows[0].count, 10);\n        let listQuery = `\n      SELECT * FROM pikun_db.document_changes\n      WHERE object_id = $1\n    `;\n        const listParams = [\n            object_id\n        ];\n        if (after_snapshot_id) {\n            listQuery += ` AND created_at > (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $2)`;\n            listParams.push(after_snapshot_id);\n        }\n        listQuery += ` ORDER BY created_at ASC LIMIT $${listParams.length + 1} OFFSET $${listParams.length + 2}`;\n        listParams.push(limit, offset);\n        const result = await this.db.query(listQuery, listParams);\n        return {\n            changes: result.rows,\n            total\n        };\n    }\n    /**\n   * 获取两个快照之间的变更\n   */ async getChangesBetweenSnapshots(object_id, from_snapshot_id, to_snapshot_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_changes\n       WHERE object_id = $1\n         AND created_at > (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $2)\n         AND created_at <= (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $3)\n       ORDER BY created_at ASC`, [\n            object_id,\n            from_snapshot_id,\n            to_snapshot_id\n        ]);\n        return result.rows;\n    }\n    /**\n   * 删除文档的所有变更记录\n   */ async deleteByObjectId(object_id) {\n        await this.db.query(\"DELETE FROM pikun_db.document_changes WHERE object_id = $1\", [\n            object_id\n        ]);\n    }\n}\nDocumentChangeDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_0__.Injectable)(\"DocumentChangeDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [])\n], DocumentChangeDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cmMvZGFvL2RvY3VtZW50LWNoYW5nZS5kYW8udHM/ZjVlNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQC9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yJztcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSAnQC9jb3JlL2RhdGFiYXNlJztcbmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gJ3V1aWQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIERvY3VtZW50Q2hhbmdlIHtcbiAgY2hhbmdlX2lkOiBzdHJpbmc7XG4gIG9iamVjdF9pZDogc3RyaW5nO1xuICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgc25hcHNob3RfaWQ6IHN0cmluZyB8IG51bGw7XG4gIGNoYW5nZV90eXBlOiAnYXV0b19zYXZlJyB8ICdtYW51YWxfc2F2ZSc7XG4gIGNoYW5nZV9kYXRhOiBCdWZmZXI7XG4gIGJlZm9yZV9zdGF0ZV92ZWN0b3I6IEJ1ZmZlciB8IG51bGw7XG4gIGFmdGVyX3N0YXRlX3ZlY3RvcjogQnVmZmVyIHwgbnVsbDtcbiAgY2hhbmdlX3NpemU6IG51bWJlcjtcbiAgbWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIGNyZWF0ZWRfYXQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiDmlofmoaPlj5jmm7Tml6Xlv5cgREFPXG4gKi9cbkBJbmplY3RhYmxlKCdEb2N1bWVudENoYW5nZURBTycpXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRDaGFuZ2VEQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlj5jmm7TorrDlvZVcbiAgICovXG4gIGFzeW5jIGNyZWF0ZShjaGFuZ2U6IHtcbiAgICBvYmplY3RfaWQ6IHN0cmluZztcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgICBzbmFwc2hvdF9pZD86IHN0cmluZyB8IG51bGw7XG4gICAgY2hhbmdlX3R5cGU6ICdhdXRvX3NhdmUnIHwgJ21hbnVhbF9zYXZlJztcbiAgICBjaGFuZ2VfZGF0YTogQnVmZmVyO1xuICAgIGJlZm9yZV9zdGF0ZV92ZWN0b3I/OiBCdWZmZXIgfCBudWxsO1xuICAgIGFmdGVyX3N0YXRlX3ZlY3Rvcj86IEJ1ZmZlciB8IG51bGw7XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxEb2N1bWVudENoYW5nZT4ge1xuICAgIGNvbnN0IGNyZWF0ZWRfYXQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRDaGFuZ2U+KFxuICAgICAgYElOU0VSVCBJTlRPIHBpa3VuX2RiLmRvY3VtZW50X2NoYW5nZXMgKFxuICAgICAgICBjaGFuZ2VfaWQsIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCBzbmFwc2hvdF9pZCwgY2hhbmdlX3R5cGUsIFxuICAgICAgICBjaGFuZ2VfZGF0YSwgYmVmb3JlX3N0YXRlX3ZlY3RvciwgYWZ0ZXJfc3RhdGVfdmVjdG9yLCBjaGFuZ2Vfc2l6ZSwgbWV0YWRhdGEsIGNyZWF0ZWRfYXRcbiAgICAgIClcbiAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4LCAkOSwgJDEwLCAkMTEpXG4gICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICBbXG4gICAgICAgIHV1aWR2NCgpLFxuICAgICAgICBjaGFuZ2Uub2JqZWN0X2lkLFxuICAgICAgICBjaGFuZ2Uud29ya3NwYWNlX2lkLFxuICAgICAgICBjaGFuZ2Uuc25hcHNob3RfaWQgfHwgbnVsbCxcbiAgICAgICAgY2hhbmdlLmNoYW5nZV90eXBlLFxuICAgICAgICBjaGFuZ2UuY2hhbmdlX2RhdGEsXG4gICAgICAgIGNoYW5nZS5iZWZvcmVfc3RhdGVfdmVjdG9yIHx8IG51bGwsXG4gICAgICAgIGNoYW5nZS5hZnRlcl9zdGF0ZV92ZWN0b3IgfHwgbnVsbCxcbiAgICAgICAgY2hhbmdlLmNoYW5nZV9kYXRhLmxlbmd0aCxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoY2hhbmdlLm1ldGFkYXRhIHx8IHt9KSxcbiAgICAgICAgY3JlYXRlZF9hdCxcbiAgICAgIF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPnmoTlj5jmm7TliJfooahcbiAgICovXG4gIGFzeW5jIGZpbmRCeU9iamVjdElkKFxuICAgIG9iamVjdF9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIGxpbWl0PzogbnVtYmVyO1xuICAgICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgICAgYWZ0ZXJfc25hcHNob3RfaWQ/OiBzdHJpbmcgfCBudWxsOyAvLyDojrflj5bmn5DkuKrlv6vnhafkuYvlkI7nmoTlj5jmm7RcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTx7IGNoYW5nZXM6IERvY3VtZW50Q2hhbmdlW107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IHsgbGltaXQgPSAxMDAsIG9mZnNldCA9IDAsIGFmdGVyX3NuYXBzaG90X2lkIH0gPSBvcHRpb25zO1xuXG4gICAgbGV0IHF1ZXJ5ID0gYFxuICAgICAgU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IFxuICAgICAgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9jaGFuZ2VzIFxuICAgICAgV0hFUkUgb2JqZWN0X2lkID0gJDFcbiAgICBgO1xuICAgIGNvbnN0IGNvdW50UGFyYW1zOiBhbnlbXSA9IFtvYmplY3RfaWRdO1xuXG4gICAgaWYgKGFmdGVyX3NuYXBzaG90X2lkKSB7XG4gICAgICBxdWVyeSArPSBgIEFORCBjcmVhdGVkX2F0ID4gKFNFTEVDVCBjcmVhdGVkX2F0IEZST00gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIFdIRVJFIHNuYXBzaG90X2lkID0gJDIpYDtcbiAgICAgIGNvdW50UGFyYW1zLnB1c2goYWZ0ZXJfc25hcHNob3RfaWQpO1xuICAgIH1cblxuICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTx7IGNvdW50OiBzdHJpbmcgfT4ocXVlcnksIGNvdW50UGFyYW1zKTtcbiAgICBjb25zdCB0b3RhbCA9IHBhcnNlSW50KGNvdW50UmVzdWx0LnJvd3NbMF0uY291bnQsIDEwKTtcblxuICAgIGxldCBsaXN0UXVlcnkgPSBgXG4gICAgICBTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X2NoYW5nZXNcbiAgICAgIFdIRVJFIG9iamVjdF9pZCA9ICQxXG4gICAgYDtcbiAgICBjb25zdCBsaXN0UGFyYW1zOiBhbnlbXSA9IFtvYmplY3RfaWRdO1xuXG4gICAgaWYgKGFmdGVyX3NuYXBzaG90X2lkKSB7XG4gICAgICBsaXN0UXVlcnkgKz0gYCBBTkQgY3JlYXRlZF9hdCA+IChTRUxFQ1QgY3JlYXRlZF9hdCBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X3NuYXBzaG90cyBXSEVSRSBzbmFwc2hvdF9pZCA9ICQyKWA7XG4gICAgICBsaXN0UGFyYW1zLnB1c2goYWZ0ZXJfc25hcHNob3RfaWQpO1xuICAgIH1cblxuICAgIGxpc3RRdWVyeSArPSBgIE9SREVSIEJZIGNyZWF0ZWRfYXQgQVNDIExJTUlUICQke2xpc3RQYXJhbXMubGVuZ3RoICsgMX0gT0ZGU0VUICQke2xpc3RQYXJhbXMubGVuZ3RoICsgMn1gO1xuICAgIGxpc3RQYXJhbXMucHVzaChsaW1pdCwgb2Zmc2V0KTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRDaGFuZ2U+KGxpc3RRdWVyeSwgbGlzdFBhcmFtcyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY2hhbmdlczogcmVzdWx0LnJvd3MsXG4gICAgICB0b3RhbCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluS4pOS4quW/q+eFp+S5i+mXtOeahOWPmOabtFxuICAgKi9cbiAgYXN5bmMgZ2V0Q2hhbmdlc0JldHdlZW5TbmFwc2hvdHMoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgZnJvbV9zbmFwc2hvdF9pZDogc3RyaW5nLFxuICAgIHRvX3NuYXBzaG90X2lkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxEb2N1bWVudENoYW5nZVtdPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudENoYW5nZT4oXG4gICAgICBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9jaGFuZ2VzXG4gICAgICAgV0hFUkUgb2JqZWN0X2lkID0gJDFcbiAgICAgICAgIEFORCBjcmVhdGVkX2F0ID4gKFNFTEVDVCBjcmVhdGVkX2F0IEZST00gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIFdIRVJFIHNuYXBzaG90X2lkID0gJDIpXG4gICAgICAgICBBTkQgY3JlYXRlZF9hdCA8PSAoU0VMRUNUIGNyZWF0ZWRfYXQgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHMgV0hFUkUgc25hcHNob3RfaWQgPSAkMylcbiAgICAgICBPUkRFUiBCWSBjcmVhdGVkX2F0IEFTQ2AsXG4gICAgICBbb2JqZWN0X2lkLCBmcm9tX3NuYXBzaG90X2lkLCB0b19zbmFwc2hvdF9pZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93cztcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTmlofmoaPnmoTmiYDmnInlj5jmm7TorrDlvZVcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUJ5T2JqZWN0SWQob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ0RFTEVURSBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X2NoYW5nZXMgV0hFUkUgb2JqZWN0X2lkID0gJDEnLFxuICAgICAgW29iamVjdF9pZF1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJJbmplY3RhYmxlIiwiRGF0YWJhc2UiLCJ2NCIsInV1aWR2NCIsIkRvY3VtZW50Q2hhbmdlREFPIiwiY29uc3RydWN0b3IiLCJkYiIsImdldEluc3RhbmNlIiwiY3JlYXRlIiwiY2hhbmdlIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJub3ciLCJyZXN1bHQiLCJxdWVyeSIsIm9iamVjdF9pZCIsIndvcmtzcGFjZV9pZCIsInNuYXBzaG90X2lkIiwiY2hhbmdlX3R5cGUiLCJjaGFuZ2VfZGF0YSIsImJlZm9yZV9zdGF0ZV92ZWN0b3IiLCJhZnRlcl9zdGF0ZV92ZWN0b3IiLCJsZW5ndGgiLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YWRhdGEiLCJyb3dzIiwiZmluZEJ5T2JqZWN0SWQiLCJvcHRpb25zIiwibGltaXQiLCJvZmZzZXQiLCJhZnRlcl9zbmFwc2hvdF9pZCIsImNvdW50UGFyYW1zIiwicHVzaCIsImNvdW50UmVzdWx0IiwidG90YWwiLCJwYXJzZUludCIsImNvdW50IiwibGlzdFF1ZXJ5IiwibGlzdFBhcmFtcyIsImNoYW5nZXMiLCJnZXRDaGFuZ2VzQmV0d2VlblNuYXBzaG90cyIsImZyb21fc25hcHNob3RfaWQiLCJ0b19zbmFwc2hvdF9pZCIsImRlbGV0ZUJ5T2JqZWN0SWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/document-change.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/document.dao.ts":
/*!*********************************!*\
  !*** ./src/dao/document.dao.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentDAO: () => (/* binding */ DocumentDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass DocumentDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 创建文档\n   */ async create(document) {\n        const result = await this.db.query(`INSERT INTO pikun_db.documents (workspace_id, title, content, content_length, owner_uid, metadata)\n       VALUES ($1, $2, $3, $4, $5, $6)\n       RETURNING object_id, workspace_id, title, content, content_length, owner_uid, metadata, deleted_at, created_at, updated_at`, [\n            document.workspace_id,\n            document.title,\n            document.content,\n            document.content_length,\n            document.owner_uid,\n            JSON.stringify(document.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 根据 ID 查找文档\n   */ async findById(object_id) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.documents WHERE object_id = $1 AND deleted_at IS NULL\", [\n            object_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据工作空间 ID 查找文档列表\n   */ async findByWorkspaceId(workspace_id, options = {}) {\n        const page = options.page || 1;\n        const page_size = options.page_size || 20;\n        const sort_by = options.sort_by || \"updated_at\";\n        const order = options.order || \"desc\";\n        const offset = (page - 1) * page_size;\n        // 获取总数\n        const countResult = await this.db.query(\"SELECT COUNT(*) as count FROM pikun_db.documents WHERE workspace_id = $1 AND deleted_at IS NULL\", [\n            workspace_id\n        ]);\n        const total = parseInt(countResult.rows[0].count, 10);\n        // 获取文档列表（不包含 content，减少数据传输）\n        const result = await this.db.query(`SELECT object_id, workspace_id, title, content_length, owner_uid, metadata, deleted_at, created_at, updated_at\n       FROM pikun_db.documents\n       WHERE workspace_id = $1 AND deleted_at IS NULL\n       ORDER BY ${sort_by} ${order}\n       LIMIT $2 OFFSET $3`, [\n            workspace_id,\n            page_size,\n            offset\n        ]);\n        return {\n            documents: result.rows,\n            total\n        };\n    }\n    /**\n   * 更新文档\n   */ async update(object_id, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.title !== undefined) {\n            fields.push(`title = $${paramIndex++}`);\n            values.push(updates.title);\n        }\n        if (updates.content !== undefined) {\n            fields.push(`content = $${paramIndex++}`);\n            values.push(updates.content);\n        }\n        if (updates.content_length !== undefined) {\n            fields.push(`content_length = $${paramIndex++}`);\n            values.push(updates.content_length);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(object_id);\n        }\n        values.push(object_id);\n        const result = await this.db.query(`UPDATE pikun_db.documents SET ${fields.join(\", \")} WHERE object_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING object_id, workspace_id, title, content, content_length, owner_uid, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除文档（软删除）\n   */ async delete(object_id) {\n        await this.db.query(\"UPDATE pikun_db.documents SET deleted_at = CURRENT_TIMESTAMP WHERE object_id = $1\", [\n            object_id\n        ]);\n    }\n    /**\n   * 创建文档快照\n   */ async createSnapshot(snapshot) {\n        const created_at = Date.now();\n        const result = await this.db.query(`INSERT INTO pikun_db.document_snapshots (\n        snapshot_id, object_id, workspace_id, snapshot_data, snapshot_version, \n        doc_state, doc_state_version, version_type, metadata, created_at\n      )\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)\n      RETURNING *`, [\n            uuidv4(),\n            snapshot.object_id,\n            snapshot.workspace_id,\n            snapshot.snapshot_data,\n            snapshot.snapshot_version,\n            snapshot.doc_state || null,\n            snapshot.doc_state_version || 1,\n            snapshot.version_type || \"major\",\n            JSON.stringify(snapshot.metadata || {}),\n            created_at\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(object_id, options = {}) {\n        const limit = options.limit || 20;\n        const offset = options.offset || 0;\n        const countResult = await this.db.query(\"SELECT COUNT(*) as count FROM pikun_db.document_snapshots WHERE object_id = $1\", [\n            object_id\n        ]);\n        const total = parseInt(countResult.rows[0].count, 10);\n        // 只返回必要的字段，不返回 snapshot_data 和 doc_state（这些是大字段）\n        // 注意：返回的数据结构需要匹配 DocumentSnapshot，但 snapshot_data 和 doc_state 可以为空\n        const result = await this.db.query(`SELECT snapshot_id, object_id, workspace_id, snapshot_version, doc_state_version, version_type, metadata, created_at\n       FROM pikun_db.document_snapshots\n       WHERE object_id = $1\n       ORDER BY created_at DESC\n       LIMIT $2 OFFSET $3`, [\n            object_id,\n            limit,\n            offset\n        ]);\n        // 转换为 DocumentSnapshot 格式，将缺失的字段设为空 Buffer\n        const snapshots = result.rows.map((row)=>({\n                ...row,\n                snapshot_data: Buffer.alloc(0),\n                doc_state: null\n            }));\n        return {\n            snapshots,\n            total\n        };\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(object_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_snapshots\n       WHERE object_id = $1\n       ORDER BY created_at DESC\n       LIMIT 1`, [\n            object_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 snapshot_id 获取快照\n   */ async getSnapshotById(snapshot_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_snapshots\n       WHERE snapshot_id = $1`, [\n            snapshot_id\n        ]);\n        return result.rows[0] || null;\n    }\n}\nDocumentDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"DocumentDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], DocumentDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Iiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2Rhby9kb2N1bWVudC5kYW8udHM/NDY5MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gJ0AvY29yZS9kYXRhYmFzZSc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQC9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yJztcbmltcG9ydCB0eXBlIHsgRG9jdW1lbnQsIERvY3VtZW50U25hcHNob3QgfSBmcm9tICdAL2VudGl0aWVzJztcblxuLyoqXG4gKiDmlofmoaMgREFPXG4gKiDotJ/otKPmlofmoaPnm7jlhbPnmoTmlbDmja7lupPmk43kvZzvvIzkvb/nlKjlj4LmlbDljJbmn6Xor6LpmLLmraIgU1FMIOazqOWFpVxuICovXG5ASW5qZWN0YWJsZSgnRG9jdW1lbnREQU8nKVxuZXhwb3J0IGNsYXNzIERvY3VtZW50REFPIHtcbiAgcHJpdmF0ZSBkYjogRGF0YWJhc2U7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5kYiA9IERhdGFiYXNlLmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65paH5qGjXG4gICAqL1xuICBhc3luYyBjcmVhdGUoZG9jdW1lbnQ6IHtcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IEJ1ZmZlcjtcbiAgICBjb250ZW50X2xlbmd0aDogbnVtYmVyO1xuICAgIG93bmVyX3VpZDogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8RG9jdW1lbnQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PERvY3VtZW50PihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi5kb2N1bWVudHMgKHdvcmtzcGFjZV9pZCwgdGl0bGUsIGNvbnRlbnQsIGNvbnRlbnRfbGVuZ3RoLCBvd25lcl91aWQsIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNilcbiAgICAgICBSRVRVUk5JTkcgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50LCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICBbXG4gICAgICAgIGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgZG9jdW1lbnQudGl0bGUsXG4gICAgICAgIGRvY3VtZW50LmNvbnRlbnQsXG4gICAgICAgIGRvY3VtZW50LmNvbnRlbnRfbGVuZ3RoLFxuICAgICAgICBkb2N1bWVudC5vd25lcl91aWQsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGRvY3VtZW50Lm1ldGFkYXRhIHx8IHt9KSxcbiAgICAgIF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja4gSUQg5p+l5om+5paH5qGjXG4gICAqL1xuICBhc3luYyBmaW5kQnlJZChvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8RG9jdW1lbnQgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudD4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudHMgV0hFUkUgb2JqZWN0X2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbb2JqZWN0X2lkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u5bel5L2c56m66Ze0IElEIOafpeaJvuaWh+aho+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZmluZEJ5V29ya3NwYWNlSWQoXG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmcsXG4gICAgb3B0aW9uczoge1xuICAgICAgcGFnZT86IG51bWJlcjtcbiAgICAgIHBhZ2Vfc2l6ZT86IG51bWJlcjtcbiAgICAgIHNvcnRfYnk/OiAnY3JlYXRlZF9hdCcgfCAndXBkYXRlZF9hdCcgfCAndGl0bGUnO1xuICAgICAgb3JkZXI/OiAnYXNjJyB8ICdkZXNjJztcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTx7IGRvY3VtZW50czogRG9jdW1lbnRbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgY29uc3QgcGFnZSA9IG9wdGlvbnMucGFnZSB8fCAxO1xuICAgIGNvbnN0IHBhZ2Vfc2l6ZSA9IG9wdGlvbnMucGFnZV9zaXplIHx8IDIwO1xuICAgIGNvbnN0IHNvcnRfYnkgPSBvcHRpb25zLnNvcnRfYnkgfHwgJ3VwZGF0ZWRfYXQnO1xuICAgIGNvbnN0IG9yZGVyID0gb3B0aW9ucy5vcmRlciB8fCAnZGVzYyc7XG4gICAgY29uc3Qgb2Zmc2V0ID0gKHBhZ2UgLSAxKSAqIHBhZ2Vfc2l6ZTtcblxuICAgIC8vIOiOt+WPluaAu+aVsFxuICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTx7IGNvdW50OiBzdHJpbmcgfT4oXG4gICAgICAnU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gcGlrdW5fZGIuZG9jdW1lbnRzIFdIRVJFIHdvcmtzcGFjZV9pZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW3dvcmtzcGFjZV9pZF1cbiAgICApO1xuICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY291bnRSZXN1bHQucm93c1swXS5jb3VudCwgMTApO1xuXG4gICAgLy8g6I635Y+W5paH5qGj5YiX6KGo77yI5LiN5YyF5ZCrIGNvbnRlbnTvvIzlh4/lsJHmlbDmja7kvKDovpPvvIlcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PERvY3VtZW50PihcbiAgICAgIGBTRUxFQ1Qgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdFxuICAgICAgIEZST00gcGlrdW5fZGIuZG9jdW1lbnRzXG4gICAgICAgV0hFUkUgd29ya3NwYWNlX2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTFxuICAgICAgIE9SREVSIEJZICR7c29ydF9ieX0gJHtvcmRlcn1cbiAgICAgICBMSU1JVCAkMiBPRkZTRVQgJDNgLFxuICAgICAgW3dvcmtzcGFjZV9pZCwgcGFnZV9zaXplLCBvZmZzZXRdXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBkb2N1bWVudHM6IHJlc3VsdC5yb3dzLFxuICAgICAgdG90YWwsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrDmlofmoaNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZShcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICB0aXRsZT86IHN0cmluZztcbiAgICAgIGNvbnRlbnQ/OiBCdWZmZXI7XG4gICAgICBjb250ZW50X2xlbmd0aD86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8RG9jdW1lbnQ+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGB0aXRsZSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMudGl0bGUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5jb250ZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBjb250ZW50ID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jb250ZW50KTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuY29udGVudF9sZW5ndGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGNvbnRlbnRfbGVuZ3RoID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jb250ZW50X2xlbmd0aCk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLm1ldGFkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBtZXRhZGF0YSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKEpTT04uc3RyaW5naWZ5KHVwZGF0ZXMubWV0YWRhdGEpKTtcbiAgICB9XG5cbiAgICBpZiAoZmllbGRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuZmluZEJ5SWQob2JqZWN0X2lkKSBhcyBQcm9taXNlPERvY3VtZW50PjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaChvYmplY3RfaWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnQ+KFxuICAgICAgYFVQREFURSBwaWt1bl9kYi5kb2N1bWVudHMgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIG9iamVjdF9pZCA9ICQke3BhcmFtSW5kZXh9IEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBSRVRVUk5JTkcgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50LCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICB2YWx1ZXNcbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTmlofmoaPvvIjova/liKDpmaTvvIlcbiAgICovXG4gIGFzeW5jIGRlbGV0ZShvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuZGIucXVlcnkoXG4gICAgICAnVVBEQVRFIHBpa3VuX2RiLmRvY3VtZW50cyBTRVQgZGVsZXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QIFdIRVJFIG9iamVjdF9pZCA9ICQxJyxcbiAgICAgIFtvYmplY3RfaWRdXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlofmoaPlv6vnhadcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVNuYXBzaG90KHNuYXBzaG90OiB7XG4gICAgb2JqZWN0X2lkOiBzdHJpbmc7XG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmc7XG4gICAgc25hcHNob3RfZGF0YTogQnVmZmVyO1xuICAgIHNuYXBzaG90X3ZlcnNpb246IG51bWJlcjtcbiAgICBkb2Nfc3RhdGU/OiBCdWZmZXI7XG4gICAgZG9jX3N0YXRlX3ZlcnNpb24/OiBudW1iZXI7XG4gICAgdmVyc2lvbl90eXBlPzogJ21ham9yJyB8ICdtaW5vcic7IC8vIOeJiOacrOexu+Wei1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8RG9jdW1lbnRTbmFwc2hvdD4ge1xuICAgIGNvbnN0IGNyZWF0ZWRfYXQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRTbmFwc2hvdD4oXG4gICAgICBgSU5TRVJUIElOVE8gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIChcbiAgICAgICAgc25hcHNob3RfaWQsIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCBzbmFwc2hvdF9kYXRhLCBzbmFwc2hvdF92ZXJzaW9uLCBcbiAgICAgICAgZG9jX3N0YXRlLCBkb2Nfc3RhdGVfdmVyc2lvbiwgdmVyc2lvbl90eXBlLCBtZXRhZGF0YSwgY3JlYXRlZF9hdFxuICAgICAgKVxuICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgsICQ5LCAkMTApXG4gICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICBbXG4gICAgICAgIHV1aWR2NCgpLFxuICAgICAgICBzbmFwc2hvdC5vYmplY3RfaWQsXG4gICAgICAgIHNuYXBzaG90LndvcmtzcGFjZV9pZCxcbiAgICAgICAgc25hcHNob3Quc25hcHNob3RfZGF0YSxcbiAgICAgICAgc25hcHNob3Quc25hcHNob3RfdmVyc2lvbixcbiAgICAgICAgc25hcHNob3QuZG9jX3N0YXRlIHx8IG51bGwsXG4gICAgICAgIHNuYXBzaG90LmRvY19zdGF0ZV92ZXJzaW9uIHx8IDEsXG4gICAgICAgIHNuYXBzaG90LnZlcnNpb25fdHlwZSB8fCAnbWFqb3InLFxuICAgICAgICBKU09OLnN0cmluZ2lmeShzbmFwc2hvdC5tZXRhZGF0YSB8fCB7fSksXG4gICAgICAgIGNyZWF0ZWRfYXQsXG4gICAgICBdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGj5b+r54Wn5YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXRTbmFwc2hvdHMoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgb3B0aW9uczogeyBsaW1pdD86IG51bWJlcjsgb2Zmc2V0PzogbnVtYmVyIH0gPSB7fVxuICApOiBQcm9taXNlPHsgc25hcHNob3RzOiBEb2N1bWVudFNuYXBzaG90W107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IGxpbWl0ID0gb3B0aW9ucy5saW1pdCB8fCAyMDtcbiAgICBjb25zdCBvZmZzZXQgPSBvcHRpb25zLm9mZnNldCB8fCAwO1xuXG4gICAgY29uc3QgY291bnRSZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PHsgY291bnQ6IHN0cmluZyB9PihcbiAgICAgICdTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHMgV0hFUkUgb2JqZWN0X2lkID0gJDEnLFxuICAgICAgW29iamVjdF9pZF1cbiAgICApO1xuICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY291bnRSZXN1bHQucm93c1swXS5jb3VudCwgMTApO1xuXG4gICAgLy8g5Y+q6L+U5Zue5b+F6KaB55qE5a2X5q6177yM5LiN6L+U5ZueIHNuYXBzaG90X2RhdGEg5ZKMIGRvY19zdGF0Ze+8iOi/meS6m+aYr+Wkp+Wtl+aute+8iVxuICAgIC8vIOazqOaEj++8mui/lOWbnueahOaVsOaNrue7k+aehOmcgOimgeWMuemFjSBEb2N1bWVudFNuYXBzaG9077yM5L2GIHNuYXBzaG90X2RhdGEg5ZKMIGRvY19zdGF0ZSDlj6/ku6XkuLrnqbpcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PE9taXQ8RG9jdW1lbnRTbmFwc2hvdCwgJ3NuYXBzaG90X2RhdGEnIHwgJ2RvY19zdGF0ZSc+ICYgeyBzbmFwc2hvdF9kYXRhPzogQnVmZmVyOyBkb2Nfc3RhdGU/OiBCdWZmZXIgfCBudWxsIH0+KFxuICAgICAgYFNFTEVDVCBzbmFwc2hvdF9pZCwgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHNuYXBzaG90X3ZlcnNpb24sIGRvY19zdGF0ZV92ZXJzaW9uLCB2ZXJzaW9uX3R5cGUsIG1ldGFkYXRhLCBjcmVhdGVkX2F0XG4gICAgICAgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHNcbiAgICAgICBXSEVSRSBvYmplY3RfaWQgPSAkMVxuICAgICAgIE9SREVSIEJZIGNyZWF0ZWRfYXQgREVTQ1xuICAgICAgIExJTUlUICQyIE9GRlNFVCAkM2AsXG4gICAgICBbb2JqZWN0X2lkLCBsaW1pdCwgb2Zmc2V0XVxuICAgICk7XG5cbiAgICAvLyDovazmjaLkuLogRG9jdW1lbnRTbmFwc2hvdCDmoLzlvI/vvIzlsIbnvLrlpLHnmoTlrZfmrrXorr7kuLrnqbogQnVmZmVyXG4gICAgY29uc3Qgc25hcHNob3RzOiBEb2N1bWVudFNuYXBzaG90W10gPSByZXN1bHQucm93cy5tYXAocm93ID0+ICh7XG4gICAgICAuLi5yb3csXG4gICAgICBzbmFwc2hvdF9kYXRhOiBCdWZmZXIuYWxsb2MoMCksIC8vIOWIl+ihqOafpeivouS4jemcgOimgeWunumZheaVsOaNrlxuICAgICAgZG9jX3N0YXRlOiBudWxsLFxuICAgIH0pKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzbmFwc2hvdHMsXG4gICAgICB0b3RhbCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluacgOaWsOW/q+eFp1xuICAgKi9cbiAgYXN5bmMgZ2V0TGF0ZXN0U25hcHNob3Qob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPERvY3VtZW50U25hcHNob3QgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudFNuYXBzaG90PihcbiAgICAgIGBTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X3NuYXBzaG90c1xuICAgICAgIFdIRVJFIG9iamVjdF9pZCA9ICQxXG4gICAgICAgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDXG4gICAgICAgTElNSVQgMWAsXG4gICAgICBbb2JqZWN0X2lkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2uIHNuYXBzaG90X2lkIOiOt+WPluW/q+eFp1xuICAgKi9cbiAgYXN5bmMgZ2V0U25hcHNob3RCeUlkKHNuYXBzaG90X2lkOiBzdHJpbmcpOiBQcm9taXNlPERvY3VtZW50U25hcHNob3QgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudFNuYXBzaG90PihcbiAgICAgIGBTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X3NuYXBzaG90c1xuICAgICAgIFdIRVJFIHNuYXBzaG90X2lkID0gJDFgLFxuICAgICAgW3NuYXBzaG90X2lkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIkRhdGFiYXNlIiwiSW5qZWN0YWJsZSIsIkRvY3VtZW50REFPIiwiY29uc3RydWN0b3IiLCJkYiIsImdldEluc3RhbmNlIiwiY3JlYXRlIiwiZG9jdW1lbnQiLCJyZXN1bHQiLCJxdWVyeSIsIndvcmtzcGFjZV9pZCIsInRpdGxlIiwiY29udGVudCIsImNvbnRlbnRfbGVuZ3RoIiwib3duZXJfdWlkIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwicm93cyIsImZpbmRCeUlkIiwib2JqZWN0X2lkIiwiZmluZEJ5V29ya3NwYWNlSWQiLCJvcHRpb25zIiwicGFnZSIsInBhZ2Vfc2l6ZSIsInNvcnRfYnkiLCJvcmRlciIsIm9mZnNldCIsImNvdW50UmVzdWx0IiwidG90YWwiLCJwYXJzZUludCIsImNvdW50IiwiZG9jdW1lbnRzIiwidXBkYXRlIiwidXBkYXRlcyIsImZpZWxkcyIsInZhbHVlcyIsInBhcmFtSW5kZXgiLCJ1bmRlZmluZWQiLCJwdXNoIiwibGVuZ3RoIiwiam9pbiIsImRlbGV0ZSIsImNyZWF0ZVNuYXBzaG90Iiwic25hcHNob3QiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsIm5vdyIsInV1aWR2NCIsInNuYXBzaG90X2RhdGEiLCJzbmFwc2hvdF92ZXJzaW9uIiwiZG9jX3N0YXRlIiwiZG9jX3N0YXRlX3ZlcnNpb24iLCJ2ZXJzaW9uX3R5cGUiLCJnZXRTbmFwc2hvdHMiLCJsaW1pdCIsInNuYXBzaG90cyIsIm1hcCIsInJvdyIsIkJ1ZmZlciIsImFsbG9jIiwiZ2V0TGF0ZXN0U25hcHNob3QiLCJnZXRTbmFwc2hvdEJ5SWQiLCJzbmFwc2hvdF9pZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/document.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/user.dao.ts":
/*!*****************************!*\
  !*** ./src/dao/user.dao.ts ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserDAO: () => (/* binding */ UserDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass UserDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 根据邮箱查找用户\n   */ async findByEmail(email) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.users WHERE email = $1 AND deleted_at IS NULL\", [\n            email\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 UUID 查找用户\n   */ async findByUuid(uuid) {\n        const result = await this.db.query(\"SELECT uid, uuid, email, name, metadata, deleted_at, created_at, updated_at FROM pikun_db.users WHERE uuid = $1 AND deleted_at IS NULL\", [\n            uuid\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 UID 查找用户\n   */ async findByUid(uid) {\n        const result = await this.db.query(\"SELECT uid, uuid, email, name, metadata, deleted_at, created_at, updated_at FROM pikun_db.users WHERE uid = $1 AND deleted_at IS NULL\", [\n            uid\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 创建用户\n   */ async create(user) {\n        const result = await this.db.query(`INSERT INTO pikun_db.users (email, password, name, metadata)\n       VALUES ($1, $2, $3, $4)\n       RETURNING uid, uuid, email, name, metadata, deleted_at, created_at, updated_at`, [\n            user.email,\n            user.password,\n            user.name,\n            JSON.stringify(user.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 更新用户信息\n   */ async update(uid, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.email !== undefined) {\n            fields.push(`email = $${paramIndex++}`);\n            values.push(updates.email);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findByUid(uid);\n        }\n        values.push(uid);\n        const result = await this.db.query(`UPDATE pikun_db.users SET ${fields.join(\", \")} WHERE uid = $${paramIndex} AND deleted_at IS NULL\n       RETURNING uid, uuid, email, name, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除用户（软删除）\n   */ async delete(uid) {\n        await this.db.query(\"UPDATE pikun_db.users SET deleted_at = CURRENT_TIMESTAMP WHERE uid = $1\", [\n            uid\n        ]);\n    }\n}\nUserDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"UserDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], UserDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvZGFvL3VzZXIuZGFvLnRzPzYyODQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IFVzZXIsIERvY3VtZW50LCBEb2N1bWVudFNuYXBzaG90LCBXb3Jrc3BhY2UgfSBmcm9tICdAL2VudGl0aWVzJztcblxuLyoqXG4gKiDnlKjmiLcgREFPXG4gKiDotJ/otKPnlKjmiLfnm7jlhbPnmoTmlbDmja7lupPmk43kvZzvvIzkvb/nlKjlj4LmlbDljJbmn6Xor6LpmLLmraIgU1FMIOazqOWFpVxuICovXG5ASW5qZWN0YWJsZSgnVXNlckRBTycpXG5leHBvcnQgY2xhc3MgVXNlckRBTyB7XG4gIHByaXZhdGUgZGI6IERhdGFiYXNlO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZGIgPSBEYXRhYmFzZS5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNrumCrueuseafpeaJvueUqOaIt1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXI+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIudXNlcnMgV0hFUkUgZW1haWwgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFtlbWFpbF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBVVUlEIOafpeaJvueUqOaIt1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5VXVpZCh1dWlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxVc2VyPihcbiAgICAgICdTRUxFQ1QgdWlkLCB1dWlkLCBlbWFpbCwgbmFtZSwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQgRlJPTSBwaWt1bl9kYi51c2VycyBXSEVSRSB1dWlkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbdXVpZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBVSUQg5p+l5om+55So5oi3XG4gICAqL1xuICBhc3luYyBmaW5kQnlVaWQodWlkOiBudW1iZXIpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxVc2VyPihcbiAgICAgICdTRUxFQ1QgdWlkLCB1dWlkLCBlbWFpbCwgbmFtZSwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQgRlJPTSBwaWt1bl9kYi51c2VycyBXSEVSRSB1aWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt1aWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rnlKjmiLdcbiAgICovXG4gIGFzeW5jIGNyZWF0ZSh1c2VyOiB7XG4gICAgZW1haWw6IHN0cmluZztcbiAgICBwYXNzd29yZDogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFVzZXI+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXI+KFxuICAgICAgYElOU0VSVCBJTlRPIHBpa3VuX2RiLnVzZXJzIChlbWFpbCwgcGFzc3dvcmQsIG5hbWUsIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQpXG4gICAgICAgUkVUVVJOSU5HIHVpZCwgdXVpZCwgZW1haWwsIG5hbWUsIG1ldGFkYXRhLCBkZWxldGVkX2F0LCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0YCxcbiAgICAgIFt1c2VyLmVtYWlsLCB1c2VyLnBhc3N3b3JkLCB1c2VyLm5hbWUsIEpTT04uc3RyaW5naWZ5KHVzZXIubWV0YWRhdGEgfHwge30pXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOeUqOaIt+S/oeaBr1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlKHVpZDogbnVtYmVyLCB1cGRhdGVzOiB7XG4gICAgbmFtZT86IHN0cmluZztcbiAgICBlbWFpbD86IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFVzZXI+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLm5hbWUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5lbWFpbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgZW1haWwgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmVtYWlsKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlVaWQodWlkKSBhcyBQcm9taXNlPFVzZXI+O1xuICAgIH1cblxuICAgIHZhbHVlcy5wdXNoKHVpZCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxVc2VyPihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIudXNlcnMgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIHVpZCA9ICQke3BhcmFtSW5kZXh9IEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBSRVRVUk5JTkcgdWlkLCB1dWlkLCBlbWFpbCwgbmFtZSwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk55So5oi377yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUodWlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi51c2VycyBTRVQgZGVsZXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QIFdIRVJFIHVpZCA9ICQxJyxcbiAgICAgIFt1aWRdXG4gICAgKTtcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiRGF0YWJhc2UiLCJJbmplY3RhYmxlIiwiVXNlckRBTyIsImNvbnN0cnVjdG9yIiwiZGIiLCJnZXRJbnN0YW5jZSIsImZpbmRCeUVtYWlsIiwiZW1haWwiLCJyZXN1bHQiLCJxdWVyeSIsInJvd3MiLCJmaW5kQnlVdWlkIiwidXVpZCIsImZpbmRCeVVpZCIsInVpZCIsImNyZWF0ZSIsInVzZXIiLCJwYXNzd29yZCIsIm5hbWUiLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YWRhdGEiLCJ1cGRhdGUiLCJ1cGRhdGVzIiwiZmllbGRzIiwidmFsdWVzIiwicGFyYW1JbmRleCIsInVuZGVmaW5lZCIsInB1c2giLCJsZW5ndGgiLCJqb2luIiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/user.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/workspace.dao.ts":
/*!**********************************!*\
  !*** ./src/dao/workspace.dao.ts ***!
  \**********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WorkspaceDAO: () => (/* binding */ WorkspaceDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass WorkspaceDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 创建工作空间\n   */ async create(workspace) {\n        const result = await this.db.query(`INSERT INTO pikun_db.workspaces (name, owner_uid, icon, metadata)\n       VALUES ($1, $2, $3, $4)\n       RETURNING workspace_id, name, owner_uid, icon, metadata, deleted_at, created_at, updated_at`, [\n            workspace.name,\n            workspace.owner_uid,\n            workspace.icon || null,\n            JSON.stringify(workspace.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 根据 ID 查找工作空间\n   */ async findById(workspace_id) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.workspaces WHERE workspace_id = $1 AND deleted_at IS NULL\", [\n            workspace_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据用户 ID 查找用户的所有工作空间\n   */ async findByOwnerUid(owner_uid) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.workspaces WHERE owner_uid = $1 AND deleted_at IS NULL ORDER BY created_at DESC\", [\n            owner_uid\n        ]);\n        return result.rows;\n    }\n    /**\n   * 获取用户的默认工作空间（第一个工作空间或创建新的）\n   */ async getOrCreateDefault(owner_uid) {\n        // 先查找用户的工作空间\n        const workspaces = await this.findByOwnerUid(owner_uid);\n        if (workspaces.length > 0) {\n            return workspaces[0];\n        }\n        // 如果没有，创建默认工作空间\n        return await this.create({\n            name: \"我的工作空间\",\n            owner_uid\n        });\n    }\n    /**\n   * 更新工作空间\n   */ async update(workspace_id, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.icon !== undefined) {\n            fields.push(`icon = $${paramIndex++}`);\n            values.push(updates.icon);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(workspace_id);\n        }\n        values.push(workspace_id);\n        const result = await this.db.query(`UPDATE pikun_db.workspaces SET ${fields.join(\", \")} WHERE workspace_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING workspace_id, name, owner_uid, icon, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除工作空间（软删除）\n   */ async delete(workspace_id) {\n        await this.db.query(\"UPDATE pikun_db.workspaces SET deleted_at = CURRENT_TIMESTAMP WHERE workspace_id = $1\", [\n            workspace_id\n        ]);\n    }\n}\nWorkspaceDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"WorkspaceDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], WorkspaceDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDSyxLQUFLLENBQ2pCLHlGQUNBO1lBQUNTO1NBQWE7SUFFbEI7QUFDRjtBQXZIYWhCLGVBQUFBLG9FQUFBQTtJQURaRCw0RUFBVUEsQ0FBQzs7O0dBQ0NDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2Rhby93b3Jrc3BhY2UuZGFvLnRzP2VlOGMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IFdvcmtzcGFjZSB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOW3peS9nOepuumXtCBEQU9cbiAqIOi0n+i0o+W3peS9nOepuumXtOebuOWFs+eahOaVsOaNruW6k+aTjeS9nFxuICovXG5ASW5qZWN0YWJsZSgnV29ya3NwYWNlREFPJylcbmV4cG9ydCBjbGFzcyBXb3Jrc3BhY2VEQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGNyZWF0ZSh3b3Jrc3BhY2U6IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgb3duZXJfdWlkOiBudW1iZXI7XG4gICAgaWNvbj86IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFdvcmtzcGFjZT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8V29ya3NwYWNlPihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi53b3Jrc3BhY2VzIChuYW1lLCBvd25lcl91aWQsIGljb24sIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQpXG4gICAgICAgUkVUVVJOSU5HIHdvcmtzcGFjZV9pZCwgbmFtZSwgb3duZXJfdWlkLCBpY29uLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICBbXG4gICAgICAgIHdvcmtzcGFjZS5uYW1lLFxuICAgICAgICB3b3Jrc3BhY2Uub3duZXJfdWlkLFxuICAgICAgICB3b3Jrc3BhY2UuaWNvbiB8fCBudWxsLFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh3b3Jrc3BhY2UubWV0YWRhdGEgfHwge30pLFxuICAgICAgXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBJRCDmn6Xmib7lt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGZpbmRCeUlkKHdvcmtzcGFjZV9pZDogc3RyaW5nKTogUHJvbWlzZTxXb3Jrc3BhY2UgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxXb3Jrc3BhY2U+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIud29ya3NwYWNlcyBXSEVSRSB3b3Jrc3BhY2VfaWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt3b3Jrc3BhY2VfaWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7nlKjmiLcgSUQg5p+l5om+55So5oi355qE5omA5pyJ5bel5L2c56m66Ze0XG4gICAqL1xuICBhc3luYyBmaW5kQnlPd25lclVpZChvd25lcl91aWQ6IG51bWJlcik6IFByb21pc2U8V29ya3NwYWNlW10+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFdvcmtzcGFjZT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi53b3Jrc3BhY2VzIFdIRVJFIG93bmVyX3VpZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDJyxcbiAgICAgIFtvd25lcl91aWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3M7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE6buY6K6k5bel5L2c56m66Ze077yI56ys5LiA5Liq5bel5L2c56m66Ze05oiW5Yib5bu65paw55qE77yJXG4gICAqL1xuICBhc3luYyBnZXRPckNyZWF0ZURlZmF1bHQob3duZXJfdWlkOiBudW1iZXIpOiBQcm9taXNlPFdvcmtzcGFjZT4ge1xuICAgIC8vIOWFiOafpeaJvueUqOaIt+eahOW3peS9nOepuumXtFxuICAgIGNvbnN0IHdvcmtzcGFjZXMgPSBhd2FpdCB0aGlzLmZpbmRCeU93bmVyVWlkKG93bmVyX3VpZCk7XG4gICAgaWYgKHdvcmtzcGFjZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHdvcmtzcGFjZXNbMF07XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5rKh5pyJ77yM5Yib5bu66buY6K6k5bel5L2c56m66Ze0XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY3JlYXRlKHtcbiAgICAgIG5hbWU6ICfmiJHnmoTlt6XkvZznqbrpl7QnLFxuICAgICAgb3duZXJfdWlkLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOW3peS9nOepuumXtFxuICAgKi9cbiAgYXN5bmMgdXBkYXRlKFxuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IHtcbiAgICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgICBpY29uPzogc3RyaW5nO1xuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIH1cbiAgKTogUHJvbWlzZTxXb3Jrc3BhY2U+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLm5hbWUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5pY29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBpY29uID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5pY29uKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlJZCh3b3Jrc3BhY2VfaWQpIGFzIFByb21pc2U8V29ya3NwYWNlPjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaCh3b3Jrc3BhY2VfaWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8V29ya3NwYWNlPihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIud29ya3NwYWNlcyBTRVQgJHtmaWVsZHMuam9pbignLCAnKX0gV0hFUkUgd29ya3NwYWNlX2lkID0gJCR7cGFyYW1JbmRleH0gQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTFxuICAgICAgIFJFVFVSTklORyB3b3Jrc3BhY2VfaWQsIG5hbWUsIG93bmVyX3VpZCwgaWNvbiwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5bel5L2c56m66Ze077yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUod29ya3NwYWNlX2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi53b3Jrc3BhY2VzIFNFVCBkZWxldGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgd29ya3NwYWNlX2lkID0gJDEnLFxuICAgICAgW3dvcmtzcGFjZV9pZF1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJEYXRhYmFzZSIsIkluamVjdGFibGUiLCJXb3Jrc3BhY2VEQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJjcmVhdGUiLCJ3b3Jrc3BhY2UiLCJyZXN1bHQiLCJxdWVyeSIsIm5hbWUiLCJvd25lcl91aWQiLCJpY29uIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwicm93cyIsImZpbmRCeUlkIiwid29ya3NwYWNlX2lkIiwiZmluZEJ5T3duZXJVaWQiLCJnZXRPckNyZWF0ZURlZmF1bHQiLCJ3b3Jrc3BhY2VzIiwibGVuZ3RoIiwidXBkYXRlIiwidXBkYXRlcyIsImZpZWxkcyIsInZhbHVlcyIsInBhcmFtSW5kZXgiLCJ1bmRlZmluZWQiLCJwdXNoIiwiam9pbiIsImRlbGV0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/workspace.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/decorators/injectable.decorator.ts":
/*!************************************************!*\
  !*** ./src/decorators/injectable.decorator.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Inject: () => (/* binding */ Inject),\n/* harmony export */   Injectable: () => (/* binding */ Injectable)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\n * 可注入装饰器\n * 标记类可以被依赖注入容器管理\n */ function Injectable(token) {\n    return function(target) {\n        Reflect.defineMetadata(\"injectable\", true, target);\n        if (token) {\n            Reflect.defineMetadata(\"injectionToken\", token, target);\n        }\n    };\n}\n/**\n * 注入依赖装饰器\n */ function Inject(token) {\n    return function(target, propertyKey, parameterIndex) {\n        const existingTokens = Reflect.getMetadata(\"injections\", target) || [];\n        existingTokens.push({\n            index: parameterIndex,\n            token\n        });\n        Reflect.defineMetadata(\"injections\", existingTokens, target);\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTBCO0FBRTFCOzs7Q0FHQyxHQUNNLFNBQVNBLFdBQVdDLEtBQXVCO0lBQ2hELE9BQU8sU0FBVUMsTUFBVztRQUMxQkMsUUFBUUMsY0FBYyxDQUFDLGNBQWMsTUFBTUY7UUFDM0MsSUFBSUQsT0FBTztZQUNURSxRQUFRQyxjQUFjLENBQUMsa0JBQWtCSCxPQUFPQztRQUNsRDtJQUNGO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLFNBQVNHLE9BQU9KLEtBQXNCO0lBQzNDLE9BQU8sU0FBVUMsTUFBVyxFQUFFSSxXQUF3QyxFQUFFQyxjQUFzQjtRQUM1RixNQUFNQyxpQkFBaUJMLFFBQVFNLFdBQVcsQ0FBQyxjQUFjUCxXQUFXLEVBQUU7UUFDdEVNLGVBQWVFLElBQUksQ0FBQztZQUFFQyxPQUFPSjtZQUFnQk47UUFBTTtRQUNuREUsUUFBUUMsY0FBYyxDQUFDLGNBQWNJLGdCQUFnQk47SUFDdkQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yLnRzPzZhMzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcblxuLyoqXG4gKiDlj6/ms6jlhaXoo4XppbDlmahcbiAqIOagh+iusOexu+WPr+S7peiiq+S+nei1luazqOWFpeWuueWZqOeuoeeQhlxuICovXG5leHBvcnQgZnVuY3Rpb24gSW5qZWN0YWJsZSh0b2tlbj86IHN0cmluZyB8IHN5bWJvbCk6IENsYXNzRGVjb3JhdG9yIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQ6IGFueSkge1xuICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoJ2luamVjdGFibGUnLCB0cnVlLCB0YXJnZXQpO1xuICAgIGlmICh0b2tlbikge1xuICAgICAgUmVmbGVjdC5kZWZpbmVNZXRhZGF0YSgnaW5qZWN0aW9uVG9rZW4nLCB0b2tlbiwgdGFyZ2V0KTtcbiAgICB9XG4gIH07XG59XG5cbi8qKlxuICog5rOo5YWl5L6d6LWW6KOF6aWw5ZmoXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBJbmplY3QodG9rZW46IHN0cmluZyB8IHN5bWJvbCk6IFBhcmFtZXRlckRlY29yYXRvciB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcgfCBzeW1ib2wgfCB1bmRlZmluZWQsIHBhcmFtZXRlckluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBleGlzdGluZ1Rva2VucyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ2luamVjdGlvbnMnLCB0YXJnZXQpIHx8IFtdO1xuICAgIGV4aXN0aW5nVG9rZW5zLnB1c2goeyBpbmRleDogcGFyYW1ldGVySW5kZXgsIHRva2VuIH0pO1xuICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoJ2luamVjdGlvbnMnLCBleGlzdGluZ1Rva2VucywgdGFyZ2V0KTtcbiAgfTtcbn1cblxuXG5cblxuIl0sIm5hbWVzIjpbIkluamVjdGFibGUiLCJ0b2tlbiIsInRhcmdldCIsIlJlZmxlY3QiLCJkZWZpbmVNZXRhZGF0YSIsIkluamVjdCIsInByb3BlcnR5S2V5IiwicGFyYW1ldGVySW5kZXgiLCJleGlzdGluZ1Rva2VucyIsImdldE1ldGFkYXRhIiwicHVzaCIsImluZGV4Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/decorators/injectable.decorator.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/auth.service.ts":
/*!**************************************!*\
  !*** ./src/services/auth.service.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthService: () => (/* binding */ AuthService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/../../node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/../../node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/user.dao */ \"(rsc)/./src/dao/user.dao.ts\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _core_redis__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/core/redis */ \"(rsc)/./src/core/redis.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__]);\n([_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\nclass AuthService {\n    constructor(userDAO, workspaceDAO, redis){\n        this.userDAO = userDAO;\n        this.workspaceDAO = workspaceDAO;\n        this.redis = redis;\n        this.redis = _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis.getInstance();\n    }\n    /**\n   * 用户注册\n   */ async register(data) {\n        // 检查邮箱是否已存在\n        const existingUser = await this.userDAO.findByEmail(data.email);\n        if (existingUser) {\n            throw new Error(\"Email already exists\");\n        }\n        // 加密密码\n        const hashedPassword = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().hash(data.password, 10);\n        // 创建用户\n        const user = await this.userDAO.create({\n            email: data.email,\n            password: hashedPassword,\n            name: data.name\n        });\n        // 创建默认工作空间\n        const defaultWorkspace = await this.workspaceDAO.create({\n            name: \"我的工作空间\",\n            owner_uid: user.uid\n        });\n        // 生成 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const refreshToken = this.generateRefreshToken(user.uid);\n        // 保存刷新令牌到数据库（这里简化处理，实际应该保存到数据库）\n        await this.redis.set(`refresh_token:${refreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60); // 30天\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { password, ...userWithoutPassword } = user;\n        return {\n            user: userWithoutPassword,\n            token,\n            refreshToken,\n            defaultWorkspaceId: defaultWorkspace.workspace_id\n        };\n    }\n    /**\n   * 用户登录\n   */ async login(email, password) {\n        const user = await this.userDAO.findByEmail(email);\n        if (!user) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 验证密码\n        const isValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(password, user.password);\n        if (!isValid) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 获取或创建默认工作空间\n        const defaultWorkspace = await this.workspaceDAO.getOrCreateDefault(user.uid);\n        // 生成 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const refreshToken = this.generateRefreshToken(user.uid);\n        // 保存刷新令牌\n        await this.redis.set(`refresh_token:${refreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60);\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { password: _, ...userWithoutPassword } = user;\n        return {\n            user: userWithoutPassword,\n            token,\n            refreshToken,\n            defaultWorkspaceId: defaultWorkspace.workspace_id\n        };\n    }\n    /**\n   * 刷新 token\n   */ async refreshToken(refreshToken) {\n        const uidStr = await this.redis.get(`refresh_token:${refreshToken}`);\n        if (!uidStr) {\n            throw new Error(\"Invalid refresh token\");\n        }\n        const uid = parseInt(uidStr, 10);\n        const user = await this.userDAO.findByUid(uid);\n        if (!user) {\n            throw new Error(\"User not found\");\n        }\n        // 生成新 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const newRefreshToken = this.generateRefreshToken(user.uid);\n        // 更新刷新令牌\n        await this.redis.del(`refresh_token:${refreshToken}`);\n        await this.redis.set(`refresh_token:${newRefreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60);\n        return {\n            token,\n            refreshToken: newRefreshToken\n        };\n    }\n    /**\n   * 验证 token\n   */ async verifyToken(token) {\n        try {\n            const secret = \"e88b7d11b577a5a638587f93a4b9348ab34152ab9042cb6b096fc29504732171\" || 0;\n            const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().verify(token, secret);\n            return decoded;\n        } catch  {\n            throw new Error(\"Invalid token\");\n        }\n    }\n    /**\n   * 从请求中获取当前用户（验证 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.verifyToken(token);\n    }\n    /**\n   * 生成 JWT token\n   */ generateToken(uid, uuid) {\n        const secret = \"e88b7d11b577a5a638587f93a4b9348ab34152ab9042cb6b096fc29504732171\" || 0;\n        const expiresIn = \"7d\" || 0;\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().sign({\n            uid,\n            uuid\n        }, secret, {\n            expiresIn\n        });\n    }\n    /**\n   * 生成刷新 token\n   */ generateRefreshToken(uid) {\n        const secret = \"e88b7d11b577a5a638587f93a4b9348ab34152ab9042cb6b096fc29504732171\" || 0;\n        const expiresIn = \"30d\" || 0;\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().sign({\n            uid,\n            type: \"refresh\"\n        }, secret, {\n            expiresIn\n        });\n    }\n}\nAuthService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"UserDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"WorkspaceDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO === \"undefined\" ? Object : _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO,\n        typeof _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__.WorkspaceDAO === \"undefined\" ? Object : _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__.WorkspaceDAO,\n        typeof _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis === \"undefined\" ? Object : _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis\n    ])\n], AuthService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VCxFQUFFLE9BQU07WUFDTixNQUFNLElBQUlwQyxNQUFNO1FBQ2xCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1zQyxlQUFlQyxHQUFnQixFQUEwQztRQUM3RSxNQUFNQyxhQUFhRCxJQUFJRSxPQUFPLENBQUNmLEdBQUcsQ0FBQztRQUNuQyxJQUFJLENBQUNjLGNBQWMsQ0FBQ0EsV0FBV0UsVUFBVSxDQUFDLFlBQVk7WUFDcEQsTUFBTSxJQUFJMUMsTUFBTTtRQUNsQjtRQUVBLE1BQU1VLFFBQVE4QixXQUFXRyxTQUFTLENBQUM7UUFDbkMsT0FBTyxNQUFNLElBQUksQ0FBQ1osV0FBVyxDQUFDckI7SUFDaEM7SUFFQTs7R0FFQyxHQUNELGNBQXNCRCxHQUFXLEVBQUVHLElBQVksRUFBVTtRQUN2RCxNQUFNb0IsU0FBU0Msa0VBQXNCLElBQUk7UUFDekMsTUFBTVcsWUFBWVgsSUFBMEIsSUFBSTtRQUNoRCxPQUFPaEQsd0RBQVEsQ0FBQztZQUFFd0I7WUFBS0c7UUFBSyxHQUFHb0IsUUFBUTtZQUFFWTtRQUFVO0lBQ3JEO0lBRUE7O0dBRUMsR0FDRCxxQkFBNkJuQyxHQUFXLEVBQVU7UUFDaEQsTUFBTXVCLFNBQVNDLGtFQUFzQixJQUFJO1FBQ3pDLE1BQU1XLFlBQVlYLEtBQWtDLElBQUk7UUFDeEQsT0FBT2hELHdEQUFRLENBQUM7WUFBRXdCO1lBQUt1QyxNQUFNO1FBQVUsR0FBR2hCLFFBQVE7WUFBRVk7UUFBVTtJQUNoRTtBQUNGO0FBaExhdkQsY0FBQUEsb0VBQUFBO0lBRFpQLG9EQUFVQTtJQUdOQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7SUFDUEEsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDOzs7ZUFENEIsa0RBQU8sNEJBQVAsa0RBQU87ZUFDRyw0REFBWSw0QkFBWiw0REFBWTtlQUMzQyw4Q0FBSyw0QkFBTCw4Q0FBSzs7R0FKWE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvc2VydmljZXMvYXV0aC5zZXJ2aWNlLnRzP2Q2ZmEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XG5pbXBvcnQgdHlwZSB7IFNpZ25PcHRpb25zIH0gZnJvbSAnanNvbndlYnRva2VuJztcbmltcG9ydCB0eXBlIHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBVc2VyREFPIH0gZnJvbSAnQC9kYW8vdXNlci5kYW8nO1xuaW1wb3J0IHsgV29ya3NwYWNlREFPIH0gZnJvbSAnQC9kYW8vd29ya3NwYWNlLmRhbyc7XG5pbXBvcnQgdHlwZSB7IFVzZXIgfSBmcm9tICdAL2VudGl0aWVzJztcbmltcG9ydCB7IFJlZGlzIH0gZnJvbSAnQC9jb3JlL3JlZGlzJztcblxuLyoqXG4gKiDorqTor4HmnI3liqFcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEF1dGhTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQGluamVjdCgnVXNlckRBTycpIHByaXZhdGUgdXNlckRBTzogVXNlckRBTyxcbiAgICBAaW5qZWN0KCdXb3Jrc3BhY2VEQU8nKSBwcml2YXRlIHdvcmtzcGFjZURBTzogV29ya3NwYWNlREFPLFxuICAgIHByaXZhdGUgcmVkaXM6IFJlZGlzXG4gICkge1xuICAgIHRoaXMucmVkaXMgPSBSZWRpcy5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeUqOaIt+azqOWGjFxuICAgKi9cbiAgYXN5bmMgcmVnaXN0ZXIoZGF0YTogeyBlbWFpbDogc3RyaW5nOyBwYXNzd29yZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfSk6IFByb21pc2U8e1xuICAgIHVzZXI6IE9taXQ8VXNlciwgJ3Bhc3N3b3JkJz47XG4gICAgdG9rZW46IHN0cmluZztcbiAgICByZWZyZXNoVG9rZW46IHN0cmluZztcbiAgICBkZWZhdWx0V29ya3NwYWNlSWQ6IHN0cmluZztcbiAgfT4ge1xuICAgIC8vIOajgOafpemCrueuseaYr+WQpuW3suWtmOWcqFxuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHRoaXMudXNlckRBTy5maW5kQnlFbWFpbChkYXRhLmVtYWlsKTtcbiAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VtYWlsIGFscmVhZHkgZXhpc3RzJyk7XG4gICAgfVxuXG4gICAgLy8g5Yqg5a+G5a+G56CBXG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChkYXRhLnBhc3N3b3JkLCAxMCk7XG5cbiAgICAvLyDliJvlu7rnlKjmiLdcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyREFPLmNyZWF0ZSh7XG4gICAgICBlbWFpbDogZGF0YS5lbWFpbCxcbiAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICB9KTtcblxuICAgIC8vIOWIm+W7uum7mOiupOW3peS9nOepuumXtFxuICAgIGNvbnN0IGRlZmF1bHRXb3Jrc3BhY2UgPSBhd2FpdCB0aGlzLndvcmtzcGFjZURBTy5jcmVhdGUoe1xuICAgICAgbmFtZTogJ+aIkeeahOW3peS9nOepuumXtCcsXG4gICAgICBvd25lcl91aWQ6IHVzZXIudWlkLFxuICAgIH0pO1xuXG4gICAgLy8g55Sf5oiQIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmdlbmVyYXRlVG9rZW4odXNlci51aWQsIHVzZXIudXVpZCk7XG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gdGhpcy5nZW5lcmF0ZVJlZnJlc2hUb2tlbih1c2VyLnVpZCk7XG5cbiAgICAvLyDkv53lrZjliLfmlrDku6TniYzliLDmlbDmja7lupPvvIjov5nph4znroDljJblpITnkIbvvIzlrp7pmYXlupTor6Xkv53lrZjliLDmlbDmja7lupPvvIlcbiAgICBhd2FpdCB0aGlzLnJlZGlzLnNldChgcmVmcmVzaF90b2tlbjoke3JlZnJlc2hUb2tlbn1gLCB1c2VyLnVpZC50b1N0cmluZygpLCAzMCAqIDI0ICogNjAgKiA2MCk7IC8vIDMw5aSpXG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gICAgY29uc3QgeyBwYXNzd29yZCwgLi4udXNlcldpdGhvdXRQYXNzd29yZCB9ID0gdXNlcjtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjogdXNlcldpdGhvdXRQYXNzd29yZCxcbiAgICAgIHRva2VuLFxuICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgZGVmYXVsdFdvcmtzcGFjZUlkOiBkZWZhdWx0V29ya3NwYWNlLndvcmtzcGFjZV9pZCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOeUqOaIt+eZu+W9lVxuICAgKi9cbiAgYXN5bmMgbG9naW4oXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nXG4gICk6IFByb21pc2U8e1xuICAgIHVzZXI6IE9taXQ8VXNlciwgJ3Bhc3N3b3JkJz47XG4gICAgdG9rZW46IHN0cmluZztcbiAgICByZWZyZXNoVG9rZW46IHN0cmluZztcbiAgICBkZWZhdWx0V29ya3NwYWNlSWQ6IHN0cmluZztcbiAgfT4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJEQU8uZmluZEJ5RW1haWwoZW1haWwpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGVtYWlsIG9yIHBhc3N3b3JkJyk7XG4gICAgfVxuXG4gICAgLy8g6aqM6K+B5a+G56CBXG4gICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKTtcbiAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcpO1xuICAgIH1cblxuICAgIC8vIOiOt+WPluaIluWIm+W7uum7mOiupOW3peS9nOepuumXtFxuICAgIGNvbnN0IGRlZmF1bHRXb3Jrc3BhY2UgPSBhd2FpdCB0aGlzLndvcmtzcGFjZURBTy5nZXRPckNyZWF0ZURlZmF1bHQodXNlci51aWQpO1xuXG4gICAgLy8g55Sf5oiQIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmdlbmVyYXRlVG9rZW4odXNlci51aWQsIHVzZXIudXVpZCk7XG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gdGhpcy5nZW5lcmF0ZVJlZnJlc2hUb2tlbih1c2VyLnVpZCk7XG5cbiAgICAvLyDkv53lrZjliLfmlrDku6TniYxcbiAgICBhd2FpdCB0aGlzLnJlZGlzLnNldChgcmVmcmVzaF90b2tlbjoke3JlZnJlc2hUb2tlbn1gLCB1c2VyLnVpZC50b1N0cmluZygpLCAzMCAqIDI0ICogNjAgKiA2MCk7XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gICAgY29uc3QgeyBwYXNzd29yZDogXywgLi4udXNlcldpdGhvdXRQYXNzd29yZCB9ID0gdXNlcjtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjogdXNlcldpdGhvdXRQYXNzd29yZCxcbiAgICAgIHRva2VuLFxuICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgZGVmYXVsdFdvcmtzcGFjZUlkOiBkZWZhdWx0V29ya3NwYWNlLndvcmtzcGFjZV9pZCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOWIt+aWsCB0b2tlblxuICAgKi9cbiAgYXN5bmMgcmVmcmVzaFRva2VuKHJlZnJlc2hUb2tlbjogc3RyaW5nKTogUHJvbWlzZTx7IHRva2VuOiBzdHJpbmc7IHJlZnJlc2hUb2tlbjogc3RyaW5nIH0+IHtcbiAgICBjb25zdCB1aWRTdHIgPSBhd2FpdCB0aGlzLnJlZGlzLmdldChgcmVmcmVzaF90b2tlbjoke3JlZnJlc2hUb2tlbn1gKTtcbiAgICBpZiAoIXVpZFN0cikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHJlZnJlc2ggdG9rZW4nKTtcbiAgICB9XG5cbiAgICBjb25zdCB1aWQgPSBwYXJzZUludCh1aWRTdHIsIDEwKTtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyREFPLmZpbmRCeVVpZCh1aWQpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIOeUn+aIkOaWsCB0b2tlblxuICAgIGNvbnN0IHRva2VuID0gdGhpcy5nZW5lcmF0ZVRva2VuKHVzZXIudWlkLCB1c2VyLnV1aWQpO1xuICAgIGNvbnN0IG5ld1JlZnJlc2hUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSZWZyZXNoVG9rZW4odXNlci51aWQpO1xuXG4gICAgLy8g5pu05paw5Yi35paw5Luk54mMXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5kZWwoYHJlZnJlc2hfdG9rZW46JHtyZWZyZXNoVG9rZW59YCk7XG4gICAgYXdhaXQgdGhpcy5yZWRpcy5zZXQoXG4gICAgICBgcmVmcmVzaF90b2tlbjoke25ld1JlZnJlc2hUb2tlbn1gLFxuICAgICAgdXNlci51aWQudG9TdHJpbmcoKSxcbiAgICAgIDMwICogMjQgKiA2MCAqIDYwXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICB0b2tlbixcbiAgICAgIHJlZnJlc2hUb2tlbjogbmV3UmVmcmVzaFRva2VuLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog6aqM6K+BIHRva2VuXG4gICAqL1xuICBhc3luYyB2ZXJpZnlUb2tlbih0b2tlbjogc3RyaW5nKTogUHJvbWlzZTx7IHVpZDogbnVtYmVyOyB1dWlkOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZWNyZXQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd5b3VyLXNlY3JldC1rZXknO1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHNlY3JldCkgYXMgeyB1aWQ6IG51bWJlcjsgdXVpZDogc3RyaW5nIH07XG4gICAgICByZXR1cm4gZGVjb2RlZDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0b2tlbicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDku47or7fmsYLkuK3ojrflj5blvZPliY3nlKjmiLfvvIjpqozor4EgdG9rZW7vvIlcbiAgICovXG4gIGFzeW5jIGdldEN1cnJlbnRVc2VyKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPHsgdWlkOiBudW1iZXI7IHV1aWQ6IHN0cmluZyB9PiB7XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpO1xuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnN1YnN0cmluZyg3KTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy52ZXJpZnlUb2tlbih0b2tlbik7XG4gIH1cblxuICAvKipcbiAgICog55Sf5oiQIEpXVCB0b2tlblxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVRva2VuKHVpZDogbnVtYmVyLCB1dWlkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG4gICAgY29uc3QgZXhwaXJlc0luID0gcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4gfHwgJzdkJztcbiAgICByZXR1cm4gand0LnNpZ24oeyB1aWQsIHV1aWQgfSwgc2VjcmV0LCB7IGV4cGlyZXNJbiB9IGFzIFNpZ25PcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnlJ/miJDliLfmlrAgdG9rZW5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVSZWZyZXNoVG9rZW4odWlkOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG4gICAgY29uc3QgZXhwaXJlc0luID0gcHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfRVhQSVJFU19JTiB8fCAnMzBkJztcbiAgICByZXR1cm4gand0LnNpZ24oeyB1aWQsIHR5cGU6ICdyZWZyZXNoJyB9LCBzZWNyZXQsIHsgZXhwaXJlc0luIH0gYXMgU2lnbk9wdGlvbnMpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiaW5qZWN0YWJsZSIsImluamVjdCIsImJjcnlwdCIsImp3dCIsIlVzZXJEQU8iLCJXb3Jrc3BhY2VEQU8iLCJSZWRpcyIsIkF1dGhTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJ1c2VyREFPIiwid29ya3NwYWNlREFPIiwicmVkaXMiLCJnZXRJbnN0YW5jZSIsInJlZ2lzdGVyIiwiZGF0YSIsImV4aXN0aW5nVXNlciIsImZpbmRCeUVtYWlsIiwiZW1haWwiLCJFcnJvciIsImhhc2hlZFBhc3N3b3JkIiwiaGFzaCIsInBhc3N3b3JkIiwidXNlciIsImNyZWF0ZSIsIm5hbWUiLCJkZWZhdWx0V29ya3NwYWNlIiwib3duZXJfdWlkIiwidWlkIiwidG9rZW4iLCJnZW5lcmF0ZVRva2VuIiwidXVpZCIsInJlZnJlc2hUb2tlbiIsImdlbmVyYXRlUmVmcmVzaFRva2VuIiwic2V0IiwidG9TdHJpbmciLCJ1c2VyV2l0aG91dFBhc3N3b3JkIiwiZGVmYXVsdFdvcmtzcGFjZUlkIiwid29ya3NwYWNlX2lkIiwibG9naW4iLCJpc1ZhbGlkIiwiY29tcGFyZSIsImdldE9yQ3JlYXRlRGVmYXVsdCIsIl8iLCJ1aWRTdHIiLCJnZXQiLCJwYXJzZUludCIsImZpbmRCeVVpZCIsIm5ld1JlZnJlc2hUb2tlbiIsImRlbCIsInZlcmlmeVRva2VuIiwic2VjcmV0IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJkZWNvZGVkIiwidmVyaWZ5IiwiZ2V0Q3VycmVudFVzZXIiLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsInN0YXJ0c1dpdGgiLCJzdWJzdHJpbmciLCJleHBpcmVzSW4iLCJKV1RfRVhQSVJFU19JTiIsInNpZ24iLCJKV1RfUkVGUkVTSF9FWFBJUkVTX0lOIiwidHlwZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/auth.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/document.service.ts":
/*!******************************************!*\
  !*** ./src/services/document.service.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentService: () => (/* binding */ DocumentService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/document-change.dao */ \"(rsc)/./src/dao/document-change.dao.ts\");\n/* harmony import */ var _core_redis__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/core/redis */ \"(rsc)/./src/core/redis.ts\");\n/* harmony import */ var _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./snapshot-scheduler.service */ \"(rsc)/./src/services/snapshot-scheduler.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__, _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__]);\n([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__, _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\nclass DocumentService {\n    constructor(documentDAO, redis, snapshotScheduler, changeDAO){\n        this.documentDAO = documentDAO;\n        this.redis = redis;\n        this.snapshotScheduler = snapshotScheduler;\n        this.changeDAO = changeDAO;\n        this.redis = _core_redis__WEBPACK_IMPORTED_MODULE_3__.Redis.getInstance();\n    }\n    /**\n   * 创建文档\n   */ async createDocument(data) {\n        const document = await this.documentDAO.create({\n            workspace_id: data.workspace_id,\n            title: data.title,\n            content: data.content,\n            content_length: data.content.length,\n            owner_uid: data.owner_uid,\n            metadata: data.metadata\n        });\n        // 创建初始快照（如果文档有内容）\n        if (data.content && data.content.length > 0 && this.snapshotScheduler) {\n            try {\n                // 创建初始快照（大版本）\n                await this.snapshotScheduler.createSnapshotManually(document.object_id, document.workspace_id, data.content, undefined, \"major\" // 初始快照作为大版本\n                );\n            } catch (error) {\n                // 快照创建失败不应该影响文档创建，只记录错误\n                console.error(\"Failed to create initial snapshot:\", error);\n            }\n        }\n        // 清除缓存\n        await this.redis.del(`document:${document.object_id}`);\n        await this.redis.del(`documents:workspace:${data.workspace_id}`);\n        return document;\n    }\n    /**\n   * 获取文档\n   */ async getDocument(object_id, includeContent = true) {\n        // 尝试从缓存获取\n        const cacheKey = `document:${object_id}`;\n        const cached = await this.redis.getJSON(cacheKey);\n        if (cached) {\n            return cached;\n        }\n        const document = await this.documentDAO.findById(object_id);\n        if (!document) {\n            return null;\n        }\n        // 缓存文档（不包含 content，减少内存占用）\n        if (!includeContent) {\n            const { content, ...docWithoutContent } = document;\n            await this.redis.setJSON(cacheKey, docWithoutContent, 300); // 5分钟缓存\n        }\n        return document;\n    }\n    /**\n   * 更新文档\n   */ async updateDocument(object_id, updates) {\n        // 如果更新了内容，先获取当前文档信息以便创建快照\n        const currentDoc = await this.documentDAO.findById(object_id);\n        if (!currentDoc) {\n            throw new Error(\"Document not found\");\n        }\n        const updateData = {};\n        if (updates.title) updateData.title = updates.title;\n        if (updates.content) {\n            updateData.content = updates.content;\n            updateData.content_length = updates.content.length;\n        }\n        if (updates.metadata) updateData.metadata = updates.metadata;\n        const document = await this.documentDAO.update(object_id, updateData);\n        // 如果更新了内容，记录变更日志和快照\n        if (updates.content && updates.content.length > 0) {\n            try {\n                // 1. 获取上一次的内容（用于计算变更）\n                const previousContent = currentDoc.content;\n                // 2. 计算变更（增量更新）\n                // 优先使用 change_data（增量更新），否则使用完整状态\n                const changeData = updates.change_data || (previousContent && previousContent.length > 0 ? this.calculateChange(previousContent, updates.content) : updates.content);\n                // 2. 记录变更日志（每次保存都记录）\n                let snapshotId = null;\n                if (this.changeDAO) {\n                    // 如果是手动保存，先创建小版本快照\n                    if (updates.forceSnapshot && this.snapshotScheduler) {\n                        const snapshot = await this.snapshotScheduler.createSnapshotManually(document.object_id, document.workspace_id, updates.content, updates.snapshot, \"minor\" // 小版本快照\n                        );\n                        snapshotId = snapshot.snapshot_id;\n                    }\n                    await this.changeDAO.create({\n                        object_id: document.object_id,\n                        workspace_id: document.workspace_id,\n                        snapshot_id: snapshotId,\n                        change_type: updates.forceSnapshot ? \"manual_save\" : \"auto_save\",\n                        change_data: changeData,\n                        before_state_vector: updates.snapshot || null,\n                        after_state_vector: updates.snapshot || null,\n                        metadata: {\n                            content_length: updates.content?.length || 0,\n                            change_length: changeData.length,\n                            is_incremental: !!updates.change_data\n                        }\n                    });\n                }\n                // 3. 处理快照（大版本）\n                if (this.snapshotScheduler) {\n                    if (updates.forceSnapshot) {\n                        // 手动保存时，如果还没创建快照，创建小版本快照\n                        if (!snapshotId) {\n                            await this.snapshotScheduler.createSnapshotManually(document.object_id, document.workspace_id, updates.content, updates.snapshot, \"minor\" // 小版本快照\n                            );\n                        }\n                    } else {\n                        // 自动保存，由调度器决定是否创建大版本快照\n                        await this.snapshotScheduler.recordEdit(document.object_id, document.workspace_id, updates.content, updates.snapshot);\n                    }\n                }\n            } catch (error) {\n                // 变更日志和快照创建失败不应该影响文档更新，只记录错误\n                console.error(\"Failed to create change log or snapshot:\", error);\n            }\n        }\n        // 清除缓存\n        await this.redis.del(`document:${object_id}`);\n        const doc = await this.documentDAO.findById(object_id);\n        if (doc) {\n            await this.redis.del(`documents:workspace:${doc.workspace_id}`);\n        }\n        return document;\n    }\n    /**\n   * 获取文档列表\n   */ async getDocuments(workspace_id, options = {}) {\n        // 尝试从缓存获取\n        const cacheKey = `documents:workspace:${workspace_id}:${JSON.stringify(options)}`;\n        const cached = await this.redis.getJSON(cacheKey);\n        if (cached) {\n            return {\n                ...cached,\n                page: options.page || 1,\n                page_size: options.page_size || 20\n            };\n        }\n        const result = await this.documentDAO.findByWorkspaceId(workspace_id, options);\n        // 缓存结果\n        await this.redis.setJSON(cacheKey, result, 60); // 1分钟缓存\n        return {\n            ...result,\n            page: options.page || 1,\n            page_size: options.page_size || 20\n        };\n    }\n    /**\n   * 删除文档\n   */ async deleteDocument(object_id) {\n        await this.documentDAO.delete(object_id);\n        // 清除缓存\n        await this.redis.del(`document:${object_id}`);\n        const doc = await this.documentDAO.findById(object_id);\n        if (doc) {\n            await this.redis.del(`documents:workspace:${doc.workspace_id}`);\n        }\n    }\n    /**\n   * 创建文档快照\n   */ async createSnapshot(data) {\n        return await this.documentDAO.createSnapshot({\n            object_id: data.object_id,\n            workspace_id: data.workspace_id,\n            snapshot_data: data.snapshot_data,\n            snapshot_version: data.snapshot_version || 1,\n            doc_state: data.doc_state,\n            doc_state_version: data.doc_state_version || 1,\n            metadata: data.metadata\n        });\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(object_id, options = {}) {\n        return await this.documentDAO.getSnapshots(object_id, options);\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(object_id) {\n        return await this.documentDAO.getLatestSnapshot(object_id);\n    }\n    /**\n   * 根据 snapshot_id 获取快照内容\n   */ async getSnapshotById(snapshot_id) {\n        return await this.documentDAO.getSnapshotById(snapshot_id);\n    }\n    /**\n   * 搜索文档（简化版，实际应该使用向量搜索）\n   */ async searchDocuments(workspace_id, query, options = {}) {\n        // 这里简化实现，实际应该使用向量嵌入搜索\n        // 暂时使用简单的文本搜索\n        // TODO: 实现向量搜索\n        // 这里返回空数组，实际应该查询 document_embeddings 表\n        return [];\n    }\n    /**\n   * 计算两个文档状态之间的变更（简化版）\n   * 实际应该使用 Yjs 的 diff 算法\n   * 注意：当前实现中，change_data 存储的是完整的文档状态\n   * TODO: 优化为真正的增量更新\n   */ calculateChange(previousContent, currentContent) {\n        // 简化实现：直接返回当前内容\n        // TODO: 使用 Yjs 的 diff 算法计算真正的增量变更\n        // 或者，前端应该发送增量更新（Yjs update 事件），而不是完整状态\n        return currentContent;\n    }\n    /**\n   * 获取文档变更列表\n   */ async getDocumentChanges(object_id, options = {}) {\n        if (!this.changeDAO) {\n            throw new Error(\"DocumentChangeDAO not initialized\");\n        }\n        return await this.changeDAO.findByObjectId(object_id, options);\n    }\n    /**\n   * 获取两个快照之间的变更\n   */ async getChangesBetweenSnapshots(object_id, from_snapshot_id, to_snapshot_id) {\n        if (!this.changeDAO) {\n            throw new Error(\"DocumentChangeDAO not initialized\");\n        }\n        return await this.changeDAO.getChangesBetweenSnapshots(object_id, from_snapshot_id, to_snapshot_id);\n    }\n}\nDocumentService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(2, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"SnapshotScheduler\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(3, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentChangeDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO === \"undefined\" ? Object : _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO,\n        typeof _core_redis__WEBPACK_IMPORTED_MODULE_3__.Redis === \"undefined\" ? Object : _core_redis__WEBPACK_IMPORTED_MODULE_3__.Redis,\n        typeof _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__.SnapshotScheduler === \"undefined\" ? Object : _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__.SnapshotScheduler,\n        typeof _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__.DocumentChangeDAO === \"undefined\" ? Object : _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__.DocumentChangeDAO\n    ])\n], DocumentService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvZG9jdW1lbnQuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQThDO0FBQ0c7QUFDYTtBQUV6QjtBQUM0QjtBQU0xRCxNQUFNTTtJQUNYQyxZQUNFLFdBQXVELEVBQ3ZELEtBQW9CLEVBQ3BCLGlCQUEwRSxFQUMxRSxTQUFrRSxDQUNsRTthQUorQkMsY0FBQUE7YUFDdkJDLFFBQUFBO2FBQzZCQyxvQkFBQUE7YUFDQUMsWUFBQUE7UUFFckMsSUFBSSxDQUFDRixLQUFLLEdBQUdMLDhDQUFLQSxDQUFDUSxXQUFXO0lBQ2hDO0lBRUE7O0dBRUMsR0FDRCxNQUFNQyxlQUFlQyxJQU1wQixFQUFxQjtRQUNwQixNQUFNQyxXQUFXLE1BQU0sSUFBSSxDQUFDUCxXQUFXLENBQUNRLE1BQU0sQ0FBQztZQUM3Q0MsY0FBY0gsS0FBS0csWUFBWTtZQUMvQkMsT0FBT0osS0FBS0ksS0FBSztZQUNqQkMsU0FBU0wsS0FBS0ssT0FBTztZQUNyQkMsZ0JBQWdCTixLQUFLSyxPQUFPLENBQUNFLE1BQU07WUFDbkNDLFdBQVdSLEtBQUtRLFNBQVM7WUFDekJDLFVBQVVULEtBQUtTLFFBQVE7UUFDekI7UUFFQSxrQkFBa0I7UUFDbEIsSUFBSVQsS0FBS0ssT0FBTyxJQUFJTCxLQUFLSyxPQUFPLENBQUNFLE1BQU0sR0FBRyxLQUFLLElBQUksQ0FBQ1gsaUJBQWlCLEVBQUU7WUFDckUsSUFBSTtnQkFDRixjQUFjO2dCQUNkLE1BQU0sSUFBSSxDQUFDQSxpQkFBaUIsQ0FBQ2Msc0JBQXNCLENBQ2pEVCxTQUFTVSxTQUFTLEVBQ2xCVixTQUFTRSxZQUFZLEVBQ3JCSCxLQUFLSyxPQUFPLEVBQ1pPLFdBQ0EsUUFBUSxZQUFZOztZQUV4QixFQUFFLE9BQU9DLE9BQU87Z0JBQ2Qsd0JBQXdCO2dCQUN4QkMsUUFBUUQsS0FBSyxDQUFDLHNDQUFzQ0E7WUFDdEQ7UUFDRjtRQUVBLE9BQU87UUFDUCxNQUFNLElBQUksQ0FBQ2xCLEtB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Y0FBYztRQUNkLGVBQWU7UUFDZix1Q0FBdUM7UUFDdkMsT0FBTyxFQUFFO0lBQ1g7SUFFQTs7Ozs7R0FLQyxHQUNELGdCQUF3QmhCLGVBQXVCLEVBQUVtQyxjQUFzQixFQUFVO1FBQy9FLGdCQUFnQjtRQUNoQixrQ0FBa0M7UUFDbEMsdUNBQXVDO1FBQ3ZDLE9BQU9BO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE1BQU1DLG1CQUNKdkQsU0FBaUIsRUFDakJtQyxVQUlJLENBQUMsQ0FBQyxFQUNpRDtRQUN2RCxJQUFJLENBQUMsSUFBSSxDQUFDakQsU0FBUyxFQUFFO1lBQ25CLE1BQU0sSUFBSThCLE1BQU07UUFDbEI7UUFDQSxPQUFPLE1BQU0sSUFBSSxDQUFDOUIsU0FBUyxDQUFDc0UsY0FBYyxDQUFDeEQsV0FBV21DO0lBQ3hEO0lBRUE7O0dBRUMsR0FDRCxNQUFNc0IsMkJBQ0p6RCxTQUFpQixFQUNqQjBELGdCQUF3QixFQUN4QkMsY0FBc0IsRUFDSztRQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDekUsU0FBUyxFQUFFO1lBQ25CLE1BQU0sSUFBSThCLE1BQU07UUFDbEI7UUFDQSxPQUFPLE1BQU0sSUFBSSxDQUFDOUIsU0FBUyxDQUFDdUUsMEJBQTBCLENBQ3BEekQsV0FDQTBELGtCQUNBQztJQUVKO0FBQ0Y7QUE3V2E5RSxrQkFBQUEsb0VBQUFBO0lBRFpOLG9EQUFVQTtJQUdOQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7SUFFUEEsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDO0lBQ1BBLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQzs7O2VBSG9DLDBEQUFXLDRCQUFYLDBEQUFXO2VBQ3hDLDhDQUFLLDRCQUFMLDhDQUFLO2VBQ3FDLDBFQUFpQiw0QkFBakIsMEVBQWlCO2VBQ3pCLHVFQUFpQiw0QkFBakIsdUVBQWlCOztHQUx6REsiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvc2VydmljZXMvZG9jdW1lbnQuc2VydmljZS50cz9jZDFjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ3RzeXJpbmdlJztcbmltcG9ydCB7IERvY3VtZW50REFPIH0gZnJvbSAnQC9kYW8vZG9jdW1lbnQuZGFvJztcbmltcG9ydCB7IERvY3VtZW50Q2hhbmdlREFPIH0gZnJvbSAnQC9kYW8vZG9jdW1lbnQtY2hhbmdlLmRhbyc7XG5pbXBvcnQgdHlwZSB7IERvY3VtZW50LCBEb2N1bWVudFNuYXBzaG90LCBEb2N1bWVudENoYW5nZSB9IGZyb20gJ0AvZW50aXRpZXMnO1xuaW1wb3J0IHsgUmVkaXMgfSBmcm9tICdAL2NvcmUvcmVkaXMnO1xuaW1wb3J0IHsgU25hcHNob3RTY2hlZHVsZXIgfSBmcm9tICcuL3NuYXBzaG90LXNjaGVkdWxlci5zZXJ2aWNlJztcblxuLyoqXG4gKiDmlofmoaPmnI3liqFcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIERvY3VtZW50U2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIEBpbmplY3QoJ0RvY3VtZW50REFPJykgcHJpdmF0ZSBkb2N1bWVudERBTzogRG9jdW1lbnREQU8sXG4gICAgcHJpdmF0ZSByZWRpczogUmVkaXMsXG4gICAgQGluamVjdCgnU25hcHNob3RTY2hlZHVsZXInKSBwcml2YXRlIHNuYXBzaG90U2NoZWR1bGVyPzogU25hcHNob3RTY2hlZHVsZXIsXG4gICAgQGluamVjdCgnRG9jdW1lbnRDaGFuZ2VEQU8nKSBwcml2YXRlIGNoYW5nZURBTz86IERvY3VtZW50Q2hhbmdlREFPXG4gICkge1xuICAgIHRoaXMucmVkaXMgPSBSZWRpcy5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuaWh+aho1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlRG9jdW1lbnQoZGF0YToge1xuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nO1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgY29udGVudDogQnVmZmVyO1xuICAgIG93bmVyX3VpZDogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8RG9jdW1lbnQ+IHtcbiAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uY3JlYXRlKHtcbiAgICAgIHdvcmtzcGFjZV9pZDogZGF0YS53b3Jrc3BhY2VfaWQsXG4gICAgICB0aXRsZTogZGF0YS50aXRsZSxcbiAgICAgIGNvbnRlbnQ6IGRhdGEuY29udGVudCxcbiAgICAgIGNvbnRlbnRfbGVuZ3RoOiBkYXRhLmNvbnRlbnQubGVuZ3RoLFxuICAgICAgb3duZXJfdWlkOiBkYXRhLm93bmVyX3VpZCxcbiAgICAgIG1ldGFkYXRhOiBkYXRhLm1ldGFkYXRhLFxuICAgIH0pO1xuXG4gICAgLy8g5Yib5bu65Yid5aeL5b+r54Wn77yI5aaC5p6c5paH5qGj5pyJ5YaF5a6577yJXG4gICAgaWYgKGRhdGEuY29udGVudCAmJiBkYXRhLmNvbnRlbnQubGVuZ3RoID4gMCAmJiB0aGlzLnNuYXBzaG90U2NoZWR1bGVyKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyDliJvlu7rliJ3lp4vlv6vnhafvvIjlpKfniYjmnKzvvIlcbiAgICAgICAgYXdhaXQgdGhpcy5zbmFwc2hvdFNjaGVkdWxlci5jcmVhdGVTbmFwc2hvdE1hbnVhbGx5KFxuICAgICAgICAgIGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgZGF0YS5jb250ZW50LFxuICAgICAgICAgIHVuZGVmaW5lZCwgLy8g5Yid5aeL5b+r54Wn5Y+v6IO95rKh5pyJIHNuYXBzaG90XG4gICAgICAgICAgJ21ham9yJyAvLyDliJ3lp4vlv6vnhafkvZzkuLrlpKfniYjmnKxcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIOW/q+eFp+WIm+W7uuWksei0peS4jeW6lOivpeW9seWTjeaWh+aho+WIm+W7uu+8jOWPquiusOW9lemUmeivr1xuICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIGluaXRpYWwgc25hcHNob3Q6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOa4hemZpOe8k+WtmFxuICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKGBkb2N1bWVudDoke2RvY3VtZW50Lm9iamVjdF9pZH1gKTtcbiAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChgZG9jdW1lbnRzOndvcmtzcGFjZToke2RhdGEud29ya3NwYWNlX2lkfWApO1xuXG4gICAgcmV0dXJuIGRvY3VtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho1xuICAgKi9cbiAgYXN5bmMgZ2V0RG9jdW1lbnQob2JqZWN0X2lkOiBzdHJpbmcsIGluY2x1ZGVDb250ZW50OiBib29sZWFuID0gdHJ1ZSk6IFByb21pc2U8RG9jdW1lbnQgfCBudWxsPiB7XG4gICAgLy8g5bCd6K+V5LuO57yT5a2Y6I635Y+WXG4gICAgY29uc3QgY2FjaGVLZXkgPSBgZG9jdW1lbnQ6JHtvYmplY3RfaWR9YDtcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCB0aGlzLnJlZGlzLmdldEpTT048RG9jdW1lbnQ+KGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkO1xuICAgIH1cblxuICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlJZChvYmplY3RfaWQpO1xuICAgIGlmICghZG9jdW1lbnQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIOe8k+WtmOaWh+aho++8iOS4jeWMheWQqyBjb250ZW5077yM5YeP5bCR5YaF5a2Y5Y2g55So77yJXG4gICAgaWYgKCFpbmNsdWRlQ29udGVudCkge1xuICAgICAgY29uc3QgeyBjb250ZW50LCAuLi5kb2NXaXRob3V0Q29udGVudCB9ID0gZG9jdW1lbnQ7XG4gICAgICBhd2FpdCB0aGlzLnJlZGlzLnNldEpTT04oY2FjaGVLZXksIGRvY1dpdGhvdXRDb250ZW50LCAzMDApOyAvLyA15YiG6ZKf57yT5a2YXG4gICAgfVxuXG4gICAgcmV0dXJuIGRvY3VtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOaWh+aho1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlRG9jdW1lbnQoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgdXBkYXRlczoge1xuICAgICAgdGl0bGU/OiBzdHJpbmc7XG4gICAgICBjb250ZW50PzogQnVmZmVyO1xuICAgICAgY2hhbmdlX2RhdGE/OiBCdWZmZXI7IC8vIOWinumHj+abtOaWsO+8iFlqcyBVcGRhdGXvvIlcbiAgICAgIHNuYXBzaG90PzogQnVmZmVyOyAvLyBZanMgU25hcHNob3TvvIjnirbmgIHlkJHph4/vvInvvIzlj6/pgIlcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICAgIGZvcmNlU25hcHNob3Q/OiBib29sZWFuOyAvLyDmmK/lkKblvLrliLbliJvlu7rlv6vnhafvvIjmiYvliqjkv53lrZjvvIlcbiAgICB9XG4gICk6IFByb21pc2U8RG9jdW1lbnQ+IHtcbiAgICAvLyDlpoLmnpzmm7TmlrDkuoblhoXlrrnvvIzlhYjojrflj5blvZPliY3mlofmoaPkv6Hmga/ku6Xkvr/liJvlu7rlv6vnhadcbiAgICBjb25zdCBjdXJyZW50RG9jID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlJZChvYmplY3RfaWQpO1xuICAgIGlmICghY3VycmVudERvYykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb2N1bWVudCBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7fTtcbiAgICBpZiAodXBkYXRlcy50aXRsZSkgdXBkYXRlRGF0YS50aXRsZSA9IHVwZGF0ZXMudGl0bGU7XG4gICAgaWYgKHVwZGF0ZXMuY29udGVudCkge1xuICAgICAgdXBkYXRlRGF0YS5jb250ZW50ID0gdXBkYXRlcy5jb250ZW50O1xuICAgICAgdXBkYXRlRGF0YS5jb250ZW50X2xlbmd0aCA9IHVwZGF0ZXMuY29udGVudC5sZW5ndGg7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLm1ldGFkYXRhKSB1cGRhdGVEYXRhLm1ldGFkYXRhID0gdXBkYXRlcy5tZXRhZGF0YTtcblxuICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy51cGRhdGUob2JqZWN0X2lkLCB1cGRhdGVEYXRhKTtcblxuICAgIC8vIOWmguaenOabtOaWsOS6huWGheWuue+8jOiusOW9leWPmOabtOaXpeW/l+WSjOW/q+eFp1xuICAgIGlmICh1cGRhdGVzLmNvbnRlbnQgJiYgdXBkYXRlcy5jb250ZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIDEuIOiOt+WPluS4iuS4gOasoeeahOWGheWuue+8iOeUqOS6juiuoeeul+WPmOabtO+8iVxuICAgICAgICBjb25zdCBwcmV2aW91c0NvbnRlbnQgPSBjdXJyZW50RG9jLmNvbnRlbnQ7XG5cbiAgICAgICAgLy8gMi4g6K6h566X5Y+Y5pu077yI5aKe6YeP5pu05paw77yJXG4gICAgICAgIC8vIOS8mOWFiOS9v+eUqCBjaGFuZ2VfZGF0Ye+8iOWinumHj+abtOaWsO+8ie+8jOWQpuWImeS9v+eUqOWujOaVtOeKtuaAgVxuICAgICAgICBjb25zdCBjaGFuZ2VEYXRhID1cbiAgICAgICAgICB1cGRhdGVzLmNoYW5nZV9kYXRhIHx8XG4gICAgICAgICAgKHByZXZpb3VzQ29udGVudCAmJiBwcmV2aW91c0NvbnRlbnQubGVuZ3RoID4gMFxuICAgICAgICAgICAgPyB0aGlzLmNhbGN1bGF0ZUNoYW5nZShwcmV2aW91c0NvbnRlbnQsIHVwZGF0ZXMuY29udGVudCEpXG4gICAgICAgICAgICA6IHVwZGF0ZXMuY29udGVudCEpO1xuXG4gICAgICAgIC8vIDIuIOiusOW9leWPmOabtOaXpeW/l++8iOavj+asoeS/neWtmOmDveiusOW9le+8iVxuICAgICAgICBsZXQgc25hcHNob3RJZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLmNoYW5nZURBTykge1xuICAgICAgICAgIC8vIOWmguaenOaYr+aJi+WKqOS/neWtmO+8jOWFiOWIm+W7uuWwj+eJiOacrOW/q+eFp1xuICAgICAgICAgIGlmICh1cGRhdGVzLmZvcmNlU25hcHNob3QgJiYgdGhpcy5zbmFwc2hvdFNjaGVkdWxlcikge1xuICAgICAgICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCB0aGlzLnNuYXBzaG90U2NoZWR1bGVyLmNyZWF0ZVNuYXBzaG90TWFudWFsbHkoXG4gICAgICAgICAgICAgIGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICAgICAgZG9jdW1lbnQud29ya3NwYWNlX2lkLFxuICAgICAgICAgICAgICB1cGRhdGVzLmNvbnRlbnQsXG4gICAgICAgICAgICAgIHVwZGF0ZXMuc25hcHNob3QsXG4gICAgICAgICAgICAgICdtaW5vcicgLy8g5bCP54mI5pys5b+r54WnXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgc25hcHNob3RJZCA9IHNuYXBzaG90LnNuYXBzaG90X2lkO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGF3YWl0IHRoaXMuY2hhbmdlREFPLmNyZWF0ZSh7XG4gICAgICAgICAgICBvYmplY3RfaWQ6IGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICAgIHdvcmtzcGFjZV9pZDogZG9jdW1lbnQud29ya3NwYWNlX2lkLFxuICAgICAgICAgICAgc25hcHNob3RfaWQ6IHNuYXBzaG90SWQsXG4gICAgICAgICAgICBjaGFuZ2VfdHlwZTogdXBkYXRlcy5mb3JjZVNuYXBzaG90ID8gJ21hbnVhbF9zYXZlJyA6ICdhdXRvX3NhdmUnLFxuICAgICAgICAgICAgY2hhbmdlX2RhdGE6IGNoYW5nZURhdGEsXG4gICAgICAgICAgICBiZWZvcmVfc3RhdGVfdmVjdG9yOiB1cGRhdGVzLnNuYXBzaG90IHx8IG51bGwsXG4gICAgICAgICAgICBhZnRlcl9zdGF0ZV92ZWN0b3I6IHVwZGF0ZXMuc25hcHNob3QgfHwgbnVsbCxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgIGNvbnRlbnRfbGVuZ3RoOiB1cGRhdGVzLmNvbnRlbnQ/Lmxlbmd0aCB8fCAwLFxuICAgICAgICAgICAgICBjaGFuZ2VfbGVuZ3RoOiBjaGFuZ2VEYXRhLmxlbmd0aCxcbiAgICAgICAgICAgICAgaXNfaW5jcmVtZW50YWw6ICEhdXBkYXRlcy5jaGFuZ2VfZGF0YSwgLy8g5qCH6K6w5piv5ZCm5Li65aKe6YeP5pu05pawXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMy4g5aSE55CG5b+r54Wn77yI5aSn54mI5pys77yJXG4gICAgICAgIGlmICh0aGlzLnNuYXBzaG90U2NoZWR1bGVyKSB7XG4gICAgICAgICAgaWYgKHVwZGF0ZXMuZm9yY2VTbmFwc2hvdCkge1xuICAgICAgICAgICAgLy8g5omL5Yqo5L+d5a2Y5pe277yM5aaC5p6c6L+Y5rKh5Yib5bu65b+r54Wn77yM5Yib5bu65bCP54mI5pys5b+r54WnXG4gICAgICAgICAgICBpZiAoIXNuYXBzaG90SWQpIHtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zbmFwc2hvdFNjaGVkdWxlci5jcmVhdGVTbmFwc2hvdE1hbnVhbGx5KFxuICAgICAgICAgICAgICAgIGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICAgICAgICBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICAgICAgdXBkYXRlcy5jb250ZW50LFxuICAgICAgICAgICAgICAgIHVwZGF0ZXMuc25hcHNob3QsXG4gICAgICAgICAgICAgICAgJ21pbm9yJyAvLyDlsI/niYjmnKzlv6vnhadcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8g6Ieq5Yqo5L+d5a2Y77yM55Sx6LCD5bqm5Zmo5Yaz5a6a5piv5ZCm5Yib5bu65aSn54mI5pys5b+r54WnXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNuYXBzaG90U2NoZWR1bGVyLnJlY29yZEVkaXQoXG4gICAgICAgICAgICAgIGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICAgICAgZG9jdW1lbnQud29ya3NwYWNlX2lkLFxuICAgICAgICAgICAgICB1cGRhdGVzLmNvbnRlbnQsXG4gICAgICAgICAgICAgIHVwZGF0ZXMuc25hcHNob3RcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyDlj5jmm7Tml6Xlv5flkozlv6vnhafliJvlu7rlpLHotKXkuI3lupTor6XlvbHlk43mlofmoaPmm7TmlrDvvIzlj6rorrDlvZXplJnor69cbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBjaGFuZ2UgbG9nIG9yIHNuYXBzaG90OicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmuIXpmaTnvJPlrZhcbiAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChgZG9jdW1lbnQ6JHtvYmplY3RfaWR9YCk7XG4gICAgY29uc3QgZG9jID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlJZChvYmplY3RfaWQpO1xuICAgIGlmIChkb2MpIHtcbiAgICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKGBkb2N1bWVudHM6d29ya3NwYWNlOiR7ZG9jLndvcmtzcGFjZV9pZH1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZG9jdW1lbnQ7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGj5YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXREb2N1bWVudHMoXG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmcsXG4gICAgb3B0aW9uczoge1xuICAgICAgcGFnZT86IG51bWJlcjtcbiAgICAgIHBhZ2Vfc2l6ZT86IG51bWJlcjtcbiAgICAgIHNvcnRfYnk/OiAnY3JlYXRlZF9hdCcgfCAndXBkYXRlZF9hdCcgfCAndGl0bGUnO1xuICAgICAgb3JkZXI/OiAnYXNjJyB8ICdkZXNjJztcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTx7IGRvY3VtZW50czogRG9jdW1lbnRbXTsgdG90YWw6IG51bWJlcjsgcGFnZTogbnVtYmVyOyBwYWdlX3NpemU6IG51bWJlciB9PiB7XG4gICAgLy8g5bCd6K+V5LuO57yT5a2Y6I635Y+WXG4gICAgY29uc3QgY2FjaGVLZXkgPSBgZG9jdW1lbnRzOndvcmtzcGFjZToke3dvcmtzcGFjZV9pZH06JHtKU09OLnN0cmluZ2lmeShvcHRpb25zKX1gO1xuICAgIGNvbnN0IGNhY2hlZCA9IGF3YWl0IHRoaXMucmVkaXMuZ2V0SlNPTjx7XG4gICAgICBkb2N1bWVudHM6IERvY3VtZW50W107XG4gICAgICB0b3RhbDogbnVtYmVyO1xuICAgIH0+KGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5jYWNoZWQsXG4gICAgICAgIHBhZ2U6IG9wdGlvbnMucGFnZSB8fCAxLFxuICAgICAgICBwYWdlX3NpemU6IG9wdGlvbnMucGFnZV9zaXplIHx8IDIwLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmZpbmRCeVdvcmtzcGFjZUlkKHdvcmtzcGFjZV9pZCwgb3B0aW9ucyk7XG5cbiAgICAvLyDnvJPlrZjnu5PmnpxcbiAgICBhd2FpdCB0aGlzLnJlZGlzLnNldEpTT04oY2FjaGVLZXksIHJlc3VsdCwgNjApOyAvLyAx5YiG6ZKf57yT5a2YXG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4ucmVzdWx0LFxuICAgICAgcGFnZTogb3B0aW9ucy5wYWdlIHx8IDEsXG4gICAgICBwYWdlX3NpemU6IG9wdGlvbnMucGFnZV9zaXplIHx8IDIwLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5paH5qGjXG4gICAqL1xuICBhc3luYyBkZWxldGVEb2N1bWVudChvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZGVsZXRlKG9iamVjdF9pZCk7XG5cbiAgICAvLyDmuIXpmaTnvJPlrZhcbiAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChgZG9jdW1lbnQ6JHtvYmplY3RfaWR9YCk7XG4gICAgY29uc3QgZG9jID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlJZChvYmplY3RfaWQpO1xuICAgIGlmIChkb2MpIHtcbiAgICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKGBkb2N1bWVudHM6d29ya3NwYWNlOiR7ZG9jLndvcmtzcGFjZV9pZH1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65paH5qGj5b+r54WnXG4gICAqL1xuICBhc3luYyBjcmVhdGVTbmFwc2hvdChkYXRhOiB7XG4gICAgb2JqZWN0X2lkOiBzdHJpbmc7XG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmc7XG4gICAgc25hcHNob3RfZGF0YTogQnVmZmVyO1xuICAgIHNuYXBzaG90X3ZlcnNpb24/OiBudW1iZXI7XG4gICAgZG9jX3N0YXRlPzogQnVmZmVyO1xuICAgIGRvY19zdGF0ZV92ZXJzaW9uPzogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8RG9jdW1lbnRTbmFwc2hvdD4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmNyZWF0ZVNuYXBzaG90KHtcbiAgICAgIG9iamVjdF9pZDogZGF0YS5vYmplY3RfaWQsXG4gICAgICB3b3Jrc3BhY2VfaWQ6IGRhdGEud29ya3NwYWNlX2lkLFxuICAgICAgc25hcHNob3RfZGF0YTogZGF0YS5zbmFwc2hvdF9kYXRhLFxuICAgICAgc25hcHNob3RfdmVyc2lvbjogZGF0YS5zbmFwc2hvdF92ZXJzaW9uIHx8IDEsXG4gICAgICBkb2Nfc3RhdGU6IGRhdGEuZG9jX3N0YXRlLFxuICAgICAgZG9jX3N0YXRlX3ZlcnNpb246IGRhdGEuZG9jX3N0YXRlX3ZlcnNpb24gfHwgMSxcbiAgICAgIG1ldGFkYXRhOiBkYXRhLm1ldGFkYXRhLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho+W/q+eFp+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0U25hcHNob3RzKFxuICAgIG9iamVjdF9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHsgbGltaXQ/OiBudW1iZXI7IG9mZnNldD86IG51bWJlciB9ID0ge31cbiAgKTogUHJvbWlzZTx7IHNuYXBzaG90czogRG9jdW1lbnRTbmFwc2hvdFtdOyB0b3RhbDogbnVtYmVyIH0+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5nZXRTbmFwc2hvdHMob2JqZWN0X2lkLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmnIDmlrDlv6vnhadcbiAgICovXG4gIGFzeW5jIGdldExhdGVzdFNuYXBzaG90KG9iamVjdF9pZDogc3RyaW5nKTogUHJvbWlzZTxEb2N1bWVudFNuYXBzaG90IHwgbnVsbD4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmdldExhdGVzdFNuYXBzaG90KG9iamVjdF9pZCk7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2uIHNuYXBzaG90X2lkIOiOt+WPluW/q+eFp+WGheWuuVxuICAgKi9cbiAgYXN5bmMgZ2V0U25hcHNob3RCeUlkKHNuYXBzaG90X2lkOiBzdHJpbmcpOiBQcm9taXNlPERvY3VtZW50U25hcHNob3QgfCBudWxsPiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZ2V0U25hcHNob3RCeUlkKHNuYXBzaG90X2lkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmkJzntKLmlofmoaPvvIjnroDljJbniYjvvIzlrp7pmYXlupTor6Xkvb/nlKjlkJHph4/mkJzntKLvvIlcbiAgICovXG4gIGFzeW5jIHNlYXJjaERvY3VtZW50cyhcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZyxcbiAgICBxdWVyeTogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIGxpbWl0PzogbnVtYmVyO1xuICAgICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgICAgdGhyZXNob2xkPzogbnVtYmVyO1xuICAgIH0gPSB7fVxuICApOiBQcm9taXNlPFxuICAgIEFycmF5PHtcbiAgICAgIG9iamVjdF9pZDogc3RyaW5nO1xuICAgICAgdGl0bGU6IHN0cmluZztcbiAgICAgIHByZXZpZXc6IHN0cmluZztcbiAgICAgIHNjb3JlOiBudW1iZXI7XG4gICAgICB1cGRhdGVkX2F0OiBEYXRlO1xuICAgIH0+XG4gID4ge1xuICAgIC8vIOi/memHjOeugOWMluWunueOsO+8jOWunumZheW6lOivpeS9v+eUqOWQkemHj+W1jOWFpeaQnOe0olxuICAgIC8vIOaaguaXtuS9v+eUqOeugOWNleeahOaWh+acrOaQnOe0olxuICAgIC8vIFRPRE86IOWunueOsOWQkemHj+aQnOe0olxuICAgIC8vIOi/memHjOi/lOWbnuepuuaVsOe7hO+8jOWunumZheW6lOivpeafpeivoiBkb2N1bWVudF9lbWJlZGRpbmdzIOihqFxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDorqHnrpfkuKTkuKrmlofmoaPnirbmgIHkuYvpl7TnmoTlj5jmm7TvvIjnroDljJbniYjvvIlcbiAgICog5a6e6ZmF5bqU6K+l5L2/55SoIFlqcyDnmoQgZGlmZiDnrpfms5VcbiAgICog5rOo5oSP77ya5b2T5YmN5a6e546w5Lit77yMY2hhbmdlX2RhdGEg5a2Y5YKo55qE5piv5a6M5pW055qE5paH5qGj54q25oCBXG4gICAqIFRPRE86IOS8mOWMluS4uuecn+ato+eahOWinumHj+abtOaWsFxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVDaGFuZ2UocHJldmlvdXNDb250ZW50OiBCdWZmZXIsIGN1cnJlbnRDb250ZW50OiBCdWZmZXIpOiBCdWZmZXIge1xuICAgIC8vIOeugOWMluWunueOsO+8muebtOaOpei/lOWbnuW9k+WJjeWGheWuuVxuICAgIC8vIFRPRE86IOS9v+eUqCBZanMg55qEIGRpZmYg566X5rOV6K6h566X55yf5q2j55qE5aKe6YeP5Y+Y5pu0XG4gICAgLy8g5oiW6ICF77yM5YmN56uv5bqU6K+l5Y+R6YCB5aKe6YeP5pu05paw77yIWWpzIHVwZGF0ZSDkuovku7bvvInvvIzogIzkuI3mmK/lrozmlbTnirbmgIFcbiAgICByZXR1cm4gY3VycmVudENvbnRlbnQ7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGj5Y+Y5pu05YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXREb2N1bWVudENoYW5nZXMoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgb3B0aW9uczoge1xuICAgICAgbGltaXQ/OiBudW1iZXI7XG4gICAgICBvZmZzZXQ/OiBudW1iZXI7XG4gICAgICBhZnRlcl9zbmFwc2hvdF9pZD86IHN0cmluZyB8IG51bGw7XG4gICAgfSA9IHt9XG4gICk6IFByb21pc2U8eyBjaGFuZ2VzOiBEb2N1bWVudENoYW5nZVtdOyB0b3RhbDogbnVtYmVyIH0+IHtcbiAgICBpZiAoIXRoaXMuY2hhbmdlREFPKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RvY3VtZW50Q2hhbmdlREFPIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jaGFuZ2VEQU8uZmluZEJ5T2JqZWN0SWQob2JqZWN0X2lkLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bkuKTkuKrlv6vnhafkuYvpl7TnmoTlj5jmm7RcbiAgICovXG4gIGFzeW5jIGdldENoYW5nZXNCZXR3ZWVuU25hcHNob3RzKFxuICAgIG9iamVjdF9pZDogc3RyaW5nLFxuICAgIGZyb21fc25hcHNob3RfaWQ6IHN0cmluZyxcbiAgICB0b19zbmFwc2hvdF9pZDogc3RyaW5nXG4gICk6IFByb21pc2U8RG9jdW1lbnRDaGFuZ2VbXT4ge1xuICAgIGlmICghdGhpcy5jaGFuZ2VEQU8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRG9jdW1lbnRDaGFuZ2VEQU8gbm90IGluaXRpYWxpemVkJyk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNoYW5nZURBTy5nZXRDaGFuZ2VzQmV0d2VlblNuYXBzaG90cyhcbiAgICAgIG9iamVjdF9pZCxcbiAgICAgIGZyb21fc25hcHNob3RfaWQsXG4gICAgICB0b19zbmFwc2hvdF9pZFxuICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJpbmplY3RhYmxlIiwiaW5qZWN0IiwiRG9jdW1lbnREQU8iLCJEb2N1bWVudENoYW5nZURBTyIsIlJlZGlzIiwiU25hcHNob3RTY2hlZHVsZXIiLCJEb2N1bWVudFNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImRvY3VtZW50REFPIiwicmVkaXMiLCJzbmFwc2hvdFNjaGVkdWxlciIsImNoYW5nZURBTyIsImdldEluc3RhbmNlIiwiY3JlYXRlRG9jdW1lbnQiLCJkYXRhIiwiZG9jdW1lbnQiLCJjcmVhdGUiLCJ3b3Jrc3BhY2VfaWQiLCJ0aXRsZSIsImNvbnRlbnQiLCJjb250ZW50X2xlbmd0aCIsImxlbmd0aCIsIm93bmVyX3VpZCIsIm1ldGFkYXRhIiwiY3JlYXRlU25hcHNob3RNYW51YWxseSIsIm9iamVjdF9pZCIsInVuZGVmaW5lZCIsImVycm9yIiwiY29uc29sZSIsImRlbCIsImdldERvY3VtZW50IiwiaW5jbHVkZUNvbnRlbnQiLCJjYWNoZUtleSIsImNhY2hlZCIsImdldEpTT04iLCJmaW5kQnlJZCIsImRvY1dpdGhvdXRDb250ZW50Iiwic2V0SlNPTiIsInVwZGF0ZURvY3VtZW50IiwidXBkYXRlcyIsImN1cnJlbnREb2MiLCJFcnJvciIsInVwZGF0ZURhdGEiLCJ1cGRhdGUiLCJwcmV2aW91c0NvbnRlbnQiLCJjaGFuZ2VEYXRhIiwiY2hhbmdlX2RhdGEiLCJjYWxjdWxhdGVDaGFuZ2UiLCJzbmFwc2hvdElkIiwiZm9yY2VTbmFwc2hvdCIsInNuYXBzaG90Iiwic25hcHNob3RfaWQiLCJjaGFuZ2VfdHlwZSIsImJlZm9yZV9zdGF0ZV92ZWN0b3IiLCJhZnRlcl9zdGF0ZV92ZWN0b3IiLCJjaGFuZ2VfbGVuZ3RoIiwiaXNfaW5jcmVtZW50YWwiLCJyZWNvcmRFZGl0IiwiZG9jIiwiZ2V0RG9jdW1lbnRzIiwib3B0aW9ucyIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYWdlIiwicGFnZV9zaXplIiwicmVzdWx0IiwiZmluZEJ5V29ya3NwYWNlSWQiLCJkZWxldGVEb2N1bWVudCIsImRlbGV0ZSIsImNyZWF0ZVNuYXBzaG90Iiwic25hcHNob3RfZGF0YSIsInNuYXBzaG90X3ZlcnNpb24iLCJkb2Nfc3RhdGUiLCJkb2Nfc3RhdGVfdmVyc2lvbiIsImdldFNuYXBzaG90cyIsImdldExhdGVzdFNuYXBzaG90IiwiZ2V0U25hcHNob3RCeUlkIiwic2VhcmNoRG9jdW1lbnRzIiwicXVlcnkiLCJjdXJyZW50Q29udGVudCIsImdldERvY3VtZW50Q2hhbmdlcyIsImZpbmRCeU9iamVjdElkIiwiZ2V0Q2hhbmdlc0JldHdlZW5TbmFwc2hvdHMiLCJmcm9tX3NuYXBzaG90X2lkIiwidG9fc25hcHNob3RfaWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/document.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/snapshot-scheduler.service.ts":
/*!****************************************************!*\
  !*** ./src/services/snapshot-scheduler.service.ts ***!
  \****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SnapshotScheduler: () => (/* binding */ SnapshotScheduler)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _services_snapshot_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/snapshot.service */ \"(rsc)/./src/services/snapshot.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__]);\n_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\nclass SnapshotScheduler {\n    constructor(documentDAO, snapshotService){\n        this.documentDAO = documentDAO;\n        this.snapshotService = snapshotService;\n        this.editCounts = new Map();\n        this.lastSnapshotTimes = new Map();\n        this.EDITS_THRESHOLD = parseInt(process.env.SNAPSHOT_EDITS_THRESHOLD || \"10\", 10);\n        this.TIME_THRESHOLD = parseInt(process.env.SNAPSHOT_TIME_THRESHOLD || \"300000\", 10);\n    }\n    /**\n   * 记录一次编辑\n   * @param objectId 文档 ID\n   * @param workspaceId 工作空间 ID\n   * @param docState 文档状态（Y.encodeStateAsUpdate）\n   * @param snapshot Yjs Snapshot（可选）\n   * @returns 如果创建了快照，返回快照信息；否则返回 null\n   */ async recordEdit(objectId, workspaceId, docState, snapshot) {\n        const key = objectId;\n        const editCount = (this.editCounts.get(key) || 0) + 1;\n        this.editCounts.set(key, editCount);\n        const now = Date.now();\n        let lastSnapshotTime = this.lastSnapshotTimes.get(key);\n        // 如果内存中没有记录，从数据库查询最后一个快照的时间\n        if (!lastSnapshotTime) {\n            try {\n                const latestSnapshot = await this.documentDAO.getLatestSnapshot(objectId);\n                if (latestSnapshot) {\n                    lastSnapshotTime = latestSnapshot.created_at;\n                    this.lastSnapshotTimes.set(key, lastSnapshotTime);\n                } else {\n                    // 如果没有快照，设置为0，这样第一次编辑就会创建快照\n                    lastSnapshotTime = 0;\n                    this.lastSnapshotTimes.set(key, 0);\n                }\n            } catch (error) {\n                console.error(`Failed to get latest snapshot for ${objectId}:`, error);\n                lastSnapshotTime = 0;\n                this.lastSnapshotTimes.set(key, 0);\n            }\n        }\n        const timeSinceLastSnapshot = now - lastSnapshotTime;\n        // 判断是否需要创建快照\n        const shouldCreateSnapshot = editCount >= this.EDITS_THRESHOLD || timeSinceLastSnapshot >= this.TIME_THRESHOLD;\n        if (shouldCreateSnapshot) {\n            const result = await this.createSnapshot(objectId, workspaceId, docState, snapshot, \"major\");\n            // 重置计数和时间\n            this.editCounts.set(key, 0);\n            this.lastSnapshotTimes.set(key, now);\n            return result;\n        }\n        return null;\n    }\n    /**\n   * 创建快照\n   */ async createSnapshot(objectId, workspaceId, docState, snapshot, versionType = \"major\") {\n        try {\n            // 使用 SnapshotService 创建快照\n            const result = await this.snapshotService.createSnapshot({\n                workspaceId,\n                objectId,\n                docState,\n                snapshot,\n                metadata: {\n                    auto_save: versionType === \"major\",\n                    doc_state_length: docState.length,\n                    version_type: versionType\n                }\n            });\n            // 在数据库中记录快照元数据\n            const snapshotRecord = await this.documentDAO.createSnapshot({\n                object_id: objectId,\n                workspace_id: workspaceId,\n                snapshot_data: snapshot || Buffer.alloc(0),\n                snapshot_version: 1,\n                doc_state: docState,\n                doc_state_version: 1,\n                version_type: versionType,\n                metadata: {\n                    snapshot_id: result.snapshotId,\n                    created_at: result.createdAt,\n                    stored_in: \"file\"\n                }\n            });\n            return {\n                snapshot_id: snapshotRecord.snapshot_id,\n                created_at: result.createdAt\n            };\n        } catch (error) {\n            console.error(`Failed to create snapshot for document ${objectId}:`, error);\n            throw error;\n        }\n    }\n    /**\n   * 手动触发快照创建（用于手动保存）\n   */ async createSnapshotManually(objectId, workspaceId, docState, snapshot, versionType = \"minor\") {\n        const result = await this.createSnapshot(objectId, workspaceId, docState, snapshot, versionType);\n        // 重置计数和时间\n        this.editCounts.set(objectId, 0);\n        this.lastSnapshotTimes.set(objectId, Date.now());\n        return result;\n    }\n    /**\n   * 重置文档的编辑计数（用于文档关闭等场景）\n   */ reset(objectId) {\n        this.editCounts.delete(objectId);\n        this.lastSnapshotTimes.delete(objectId);\n    }\n}\nSnapshotScheduler = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"SnapshotService\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO === \"undefined\" ? Object : _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO,\n        typeof _services_snapshot_service__WEBPACK_IMPORTED_MODULE_2__.SnapshotService === \"undefined\" ? Object : _services_snapshot_service__WEBPACK_IMPORTED_MODULE_2__.SnapshotService\n    ])\n], SnapshotScheduler);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvc25hcHNob3Qtc2NoZWR1bGVyLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBOEM7QUFDRztBQUNhO0FBT3ZELE1BQU1JO0lBTVhDLFlBQ0UsV0FBdUQsRUFDdkQsZUFBbUUsQ0FDbkU7YUFGK0JDLGNBQUFBO2FBQ0lDLGtCQUFBQTthQVA3QkMsYUFBa0MsSUFBSUM7YUFDdENDLG9CQUF5QyxJQUFJRDthQUNwQ0Usa0JBQWtCQyxTQUFTQyxRQUFRQyxHQUFHLENBQUNDLHdCQUF3QixJQUFJLE1BQU07YUFDekVDLGlCQUFpQkosU0FBU0MsUUFBUUMsR0FBRyxDQUFDRyx1QkFBdUIsSUFBSSxVQUFVO0lBS3pGO0lBRUg7Ozs7Ozs7R0FPQyxHQUNELE1BQU1DLFdBQ0pDLFFBQWdCLEVBQ2hCQyxXQUFtQixFQUNuQkMsUUFBZ0IsRUFDaEJDLFFBQWlCLEVBQzRDO1FBQzdELE1BQU1DLE1BQU1KO1FBQ1osTUFBTUssWUFBWSxDQUFDLElBQUksQ0FBQ2hCLFVBQVUsQ0FBQ2lCLEdBQUcsQ0FBQ0YsUUFBUSxLQUFLO1FBQ3BELElBQUksQ0FBQ2YsVUFBVSxDQUFDa0IsR0FBRyxDQUFDSCxLQUFLQztRQUV6QixNQUFNRyxNQUFNQyxLQUFLRCxHQUFHO1FBQ3BCLElBQUlFLG1CQUFtQixJQUFJLENBQUNuQixpQkFBaUIsQ0FBQ2UsR0FBRyxDQUFDRjtRQUVsRCw0QkFBNEI7UUFDNUIsSUFBSSxDQUFDTSxrQkFBa0I7WUFDckIsSUFBSTtnQkFDRixNQUFNQyxpQkFBaUIsTUFBTSxJQUFJLENBQUN4QixXQUFXLENBQUN5QixpQkFBaUIsQ0FBQ1o7Z0JBQ2hFLElBQUlXLGdCQUFnQjtvQkFDbEJELG1CQUFtQkMsZUFBZUUsVUFBVTtvQkFDNUMsSUFBSSxDQUFDdEIsaUJBQWlCLENBQUNnQixHQUFHLENBQUNILEtBQUtNO2dCQUNsQyxPQUFPO29CQUNMLDRCQUE0QjtvQkFDNUJBLG1CQUFtQjtvQkFDbkIsSUFBSSxD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QU1BLENBQUM7OztlQURvQywwREFBVyw0QkFBWCwwREFBVztlQUNILHVFQUFlLDRCQUFmLHVFQUFlOztHQVIxREciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvc2VydmljZXMvc25hcHNob3Qtc2NoZWR1bGVyLnNlcnZpY2UudHM/ZWJhNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgeyBEb2N1bWVudERBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LmRhbyc7XG5pbXBvcnQgeyBTbmFwc2hvdFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL3NuYXBzaG90LnNlcnZpY2UnO1xuXG4vKipcbiAqIOW/q+eFp+iwg+W6puWZqFxuICog6LSf6LSj5a6a5pyf5Yib5bu65paH5qGj5b+r54Wn77yM6ICM5LiN5piv5q+P5qyh5L+d5a2Y6YO95Yib5bu6XG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBTbmFwc2hvdFNjaGVkdWxlciB7XG4gIHByaXZhdGUgZWRpdENvdW50czogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTsgLy8gb2JqZWN0SWQgLT4gZWRpdENvdW50XG4gIHByaXZhdGUgbGFzdFNuYXBzaG90VGltZXM6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwKCk7IC8vIG9iamVjdElkIC0+IGxhc3RTbmFwc2hvdFRpbWVcbiAgcHJpdmF0ZSByZWFkb25seSBFRElUU19USFJFU0hPTEQgPSBwYXJzZUludChwcm9jZXNzLmVudi5TTkFQU0hPVF9FRElUU19USFJFU0hPTEQgfHwgJzEwJywgMTApO1xuICBwcml2YXRlIHJlYWRvbmx5IFRJTUVfVEhSRVNIT0xEID0gcGFyc2VJbnQocHJvY2Vzcy5lbnYuU05BUFNIT1RfVElNRV9USFJFU0hPTEQgfHwgJzMwMDAwMCcsIDEwKTsgLy8gNeWIhumSn++8iDMwMDAwMOavq+enku+8iVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBpbmplY3QoJ0RvY3VtZW50REFPJykgcHJpdmF0ZSBkb2N1bWVudERBTzogRG9jdW1lbnREQU8sXG4gICAgQGluamVjdCgnU25hcHNob3RTZXJ2aWNlJykgcHJpdmF0ZSBzbmFwc2hvdFNlcnZpY2U6IFNuYXBzaG90U2VydmljZVxuICApIHt9XG5cbiAgLyoqXG4gICAqIOiusOW9leS4gOasoee8lui+kVxuICAgKiBAcGFyYW0gb2JqZWN0SWQg5paH5qGjIElEXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2VJZCDlt6XkvZznqbrpl7QgSURcbiAgICogQHBhcmFtIGRvY1N0YXRlIOaWh+aho+eKtuaAge+8iFkuZW5jb2RlU3RhdGVBc1VwZGF0Ze+8iVxuICAgKiBAcGFyYW0gc25hcHNob3QgWWpzIFNuYXBzaG9077yI5Y+v6YCJ77yJXG4gICAqIEByZXR1cm5zIOWmguaenOWIm+W7uuS6huW/q+eFp++8jOi/lOWbnuW/q+eFp+S/oeaBr++8m+WQpuWImei/lOWbniBudWxsXG4gICAqL1xuICBhc3luYyByZWNvcmRFZGl0KFxuICAgIG9iamVjdElkOiBzdHJpbmcsXG4gICAgd29ya3NwYWNlSWQ6IHN0cmluZyxcbiAgICBkb2NTdGF0ZTogQnVmZmVyLFxuICAgIHNuYXBzaG90PzogQnVmZmVyXG4gICk6IFByb21pc2U8eyBzbmFwc2hvdF9pZDogc3RyaW5nOyBjcmVhdGVkX2F0OiBudW1iZXIgfSB8IG51bGw+IHtcbiAgICBjb25zdCBrZXkgPSBvYmplY3RJZDtcbiAgICBjb25zdCBlZGl0Q291bnQgPSAodGhpcy5lZGl0Q291bnRzLmdldChrZXkpIHx8IDApICsgMTtcbiAgICB0aGlzLmVkaXRDb3VudHMuc2V0KGtleSwgZWRpdENvdW50KTtcblxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgbGV0IGxhc3RTbmFwc2hvdFRpbWUgPSB0aGlzLmxhc3RTbmFwc2hvdFRpbWVzLmdldChrZXkpO1xuICAgIFxuICAgIC8vIOWmguaenOWGheWtmOS4reayoeacieiusOW9le+8jOS7juaVsOaNruW6k+afpeivouacgOWQjuS4gOS4quW/q+eFp+eahOaXtumXtFxuICAgIGlmICghbGFzdFNuYXBzaG90VGltZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbGF0ZXN0U25hcHNob3QgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmdldExhdGVzdFNuYXBzaG90KG9iamVjdElkKTtcbiAgICAgICAgaWYgKGxhdGVzdFNuYXBzaG90KSB7XG4gICAgICAgICAgbGFzdFNuYXBzaG90VGltZSA9IGxhdGVzdFNuYXBzaG90LmNyZWF0ZWRfYXQ7XG4gICAgICAgICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5zZXQoa2V5LCBsYXN0U25hcHNob3RUaW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyDlpoLmnpzmsqHmnInlv6vnhafvvIzorr7nva7kuLow77yM6L+Z5qC356ys5LiA5qyh57yW6L6R5bCx5Lya5Yib5bu65b+r54WnXG4gICAgICAgICAgbGFzdFNuYXBzaG90VGltZSA9IDA7XG4gICAgICAgICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5zZXQoa2V5LCAwKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGdldCBsYXRlc3Qgc25hcHNob3QgZm9yICR7b2JqZWN0SWR9OmAsIGVycm9yKTtcbiAgICAgICAgbGFzdFNuYXBzaG90VGltZSA9IDA7XG4gICAgICAgIHRoaXMubGFzdFNuYXBzaG90VGltZXMuc2V0KGtleSwgMCk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RTbmFwc2hvdCA9IG5vdyAtIGxhc3RTbmFwc2hvdFRpbWU7XG5cbiAgICAvLyDliKTmlq3mmK/lkKbpnIDopoHliJvlu7rlv6vnhadcbiAgICBjb25zdCBzaG91bGRDcmVhdGVTbmFwc2hvdCA9XG4gICAgICBlZGl0Q291bnQgPj0gdGhpcy5FRElUU19USFJFU0hPTEQgfHwgdGltZVNpbmNlTGFzdFNuYXBzaG90ID49IHRoaXMuVElNRV9USFJFU0hPTEQ7XG5cbiAgICBpZiAoc2hvdWxkQ3JlYXRlU25hcHNob3QpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY3JlYXRlU25hcHNob3Qob2JqZWN0SWQsIHdvcmtzcGFjZUlkLCBkb2NTdGF0ZSwgc25hcHNob3QsICdtYWpvcicpO1xuICAgICAgLy8g6YeN572u6K6h5pWw5ZKM5pe26Ze0XG4gICAgICB0aGlzLmVkaXRDb3VudHMuc2V0KGtleSwgMCk7XG4gICAgICB0aGlzLmxhc3RTbmFwc2hvdFRpbWVzLnNldChrZXksIG5vdyk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlv6vnhadcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlU25hcHNob3QoXG4gICAgb2JqZWN0SWQ6IHN0cmluZyxcbiAgICB3b3Jrc3BhY2VJZDogc3RyaW5nLFxuICAgIGRvY1N0YXRlOiBCdWZmZXIsXG4gICAgc25hcHNob3Q/OiBCdWZmZXIsXG4gICAgdmVyc2lvblR5cGU6ICdtYWpvcicgfCAnbWlub3InID0gJ21ham9yJ1xuICApOiBQcm9taXNlPHsgc25hcHNob3RfaWQ6IHN0cmluZzsgY3JlYXRlZF9hdDogbnVtYmVyIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8g5L2/55SoIFNuYXBzaG90U2VydmljZSDliJvlu7rlv6vnhadcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuc25hcHNob3RTZXJ2aWNlLmNyZWF0ZVNuYXBzaG90KHtcbiAgICAgICAgd29ya3NwYWNlSWQsXG4gICAgICAgIG9iamVjdElkLFxuICAgICAgICBkb2NTdGF0ZSxcbiAgICAgICAgc25hcHNob3QsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgYXV0b19zYXZlOiB2ZXJzaW9uVHlwZSA9PT0gJ21ham9yJyxcbiAgICAgICAgICBkb2Nfc3RhdGVfbGVuZ3RoOiBkb2NTdGF0ZS5sZW5ndGgsXG4gICAgICAgICAgdmVyc2lvbl90eXBlOiB2ZXJzaW9uVHlwZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyDlnKjmlbDmja7lupPkuK3orrDlvZXlv6vnhaflhYPmlbDmja5cbiAgICAgIGNvbnN0IHNuYXBzaG90UmVjb3JkID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5jcmVhdGVTbmFwc2hvdCh7XG4gICAgICAgIG9iamVjdF9pZDogb2JqZWN0SWQsXG4gICAgICAgIHdvcmtzcGFjZV9pZDogd29ya3NwYWNlSWQsXG4gICAgICAgIHNuYXBzaG90X2RhdGE6IHNuYXBzaG90IHx8IEJ1ZmZlci5hbGxvYygwKSwgLy8gU25hcHNob3TvvIjnirbmgIHlkJHph4/vvIlcbiAgICAgICAgc25hcHNob3RfdmVyc2lvbjogMSxcbiAgICAgICAgZG9jX3N0YXRlOiBkb2NTdGF0ZSwgLy8gRG9jIFN0YXRl77yI5a6M5pW054q25oCB77yJXG4gICAgICAgIGRvY19zdGF0ZV92ZXJzaW9uOiAxLFxuICAgICAgICB2ZXJzaW9uX3R5cGU6IHZlcnNpb25UeXBlLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHNuYXBzaG90X2lkOiByZXN1bHQuc25hcHNob3RJZCxcbiAgICAgICAgICBjcmVhdGVkX2F0OiByZXN1bHQuY3JlYXRlZEF0LFxuICAgICAgICAgIHN0b3JlZF9pbjogJ2ZpbGUnLCAvLyDlrZjlgqjlnKjmlofku7bns7vnu5/kuK1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzbmFwc2hvdF9pZDogc25hcHNob3RSZWNvcmQuc25hcHNob3RfaWQsXG4gICAgICAgIGNyZWF0ZWRfYXQ6IHJlc3VsdC5jcmVhdGVkQXQsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gY3JlYXRlIHNuYXBzaG90IGZvciBkb2N1bWVudCAke29iamVjdElkfTpgLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5omL5Yqo6Kem5Y+R5b+r54Wn5Yib5bu677yI55So5LqO5omL5Yqo5L+d5a2Y77yJXG4gICAqL1xuICBhc3luYyBjcmVhdGVTbmFwc2hvdE1hbnVhbGx5KFxuICAgIG9iamVjdElkOiBzdHJpbmcsXG4gICAgd29ya3NwYWNlSWQ6IHN0cmluZyxcbiAgICBkb2NTdGF0ZTogQnVmZmVyLFxuICAgIHNuYXBzaG90PzogQnVmZmVyLFxuICAgIHZlcnNpb25UeXBlOiAnbWFqb3InIHwgJ21pbm9yJyA9ICdtaW5vcidcbiAgKTogUHJvbWlzZTx7IHNuYXBzaG90X2lkOiBzdHJpbmc7IGNyZWF0ZWRfYXQ6IG51bWJlciB9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jcmVhdGVTbmFwc2hvdChcbiAgICAgIG9iamVjdElkLFxuICAgICAgd29ya3NwYWNlSWQsXG4gICAgICBkb2NTdGF0ZSxcbiAgICAgIHNuYXBzaG90LFxuICAgICAgdmVyc2lvblR5cGVcbiAgICApO1xuICAgIC8vIOmHjee9ruiuoeaVsOWSjOaXtumXtFxuICAgIHRoaXMuZWRpdENvdW50cy5zZXQob2JqZWN0SWQsIDApO1xuICAgIHRoaXMubGFzdFNuYXBzaG90VGltZXMuc2V0KG9iamVjdElkLCBEYXRlLm5vdygpKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIOmHjee9ruaWh+aho+eahOe8lui+keiuoeaVsO+8iOeUqOS6juaWh+aho+WFs+mXreetieWcuuaZr++8iVxuICAgKi9cbiAgcmVzZXQob2JqZWN0SWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuZWRpdENvdW50cy5kZWxldGUob2JqZWN0SWQpO1xuICAgIHRoaXMubGFzdFNuYXBzaG90VGltZXMuZGVsZXRlKG9iamVjdElkKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImluamVjdGFibGUiLCJpbmplY3QiLCJEb2N1bWVudERBTyIsIlNuYXBzaG90U2VydmljZSIsIlNuYXBzaG90U2NoZWR1bGVyIiwiY29uc3RydWN0b3IiLCJkb2N1bWVudERBTyIsInNuYXBzaG90U2VydmljZSIsImVkaXRDb3VudHMiLCJNYXAiLCJsYXN0U25hcHNob3RUaW1lcyIsIkVESVRTX1RIUkVTSE9MRCIsInBhcnNlSW50IiwicHJvY2VzcyIsImVudiIsIlNOQVBTSE9UX0VESVRTX1RIUkVTSE9MRCIsIlRJTUVfVEhSRVNIT0xEIiwiU05BUFNIT1RfVElNRV9USFJFU0hPTEQiLCJyZWNvcmRFZGl0Iiwib2JqZWN0SWQiLCJ3b3Jrc3BhY2VJZCIsImRvY1N0YXRlIiwic25hcHNob3QiLCJrZXkiLCJlZGl0Q291bnQiLCJnZXQiLCJzZXQiLCJub3ciLCJEYXRlIiwibGFzdFNuYXBzaG90VGltZSIsImxhdGVzdFNuYXBzaG90IiwiZ2V0TGF0ZXN0U25hcHNob3QiLCJjcmVhdGVkX2F0IiwiZXJyb3IiLCJjb25zb2xlIiwidGltZVNpbmNlTGFzdFNuYXBzaG90Iiwic2hvdWxkQ3JlYXRlU25hcHNob3QiLCJyZXN1bHQiLCJjcmVhdGVTbmFwc2hvdCIsInZlcnNpb25UeXBlIiwibWV0YWRhdGEiLCJhdXRvX3NhdmUiLCJkb2Nfc3RhdGVfbGVuZ3RoIiwibGVuZ3RoIiwidmVyc2lvbl90eXBlIiwic25hcHNob3RSZWNvcmQiLCJvYmplY3RfaWQiLCJ3b3Jrc3BhY2VfaWQiLCJzbmFwc2hvdF9kYXRhIiwiQnVmZmVyIiwiYWxsb2MiLCJzbmFwc2hvdF92ZXJzaW9uIiwiZG9jX3N0YXRlIiwiZG9jX3N0YXRlX3ZlcnNpb24iLCJzbmFwc2hvdF9pZCIsInNuYXBzaG90SWQiLCJjcmVhdGVkQXQiLCJzdG9yZWRfaW4iLCJjcmVhdGVTbmFwc2hvdE1hbnVhbGx5IiwicmVzZXQiLCJkZWxldGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/snapshot-scheduler.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/snapshot.service.ts":
/*!******************************************!*\
  !*** ./src/services/snapshot.service.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SnapshotService: () => (/* binding */ SnapshotService)\n/* harmony export */ });\n/* harmony import */ var _core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/storage/storage.factory */ \"(rsc)/./src/core/storage/storage.factory.ts\");\n/* harmony import */ var zlib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zlib */ \"zlib\");\n/* harmony import */ var zlib__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(zlib__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! util */ \"util\");\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nconst gzip = (0,util__WEBPACK_IMPORTED_MODULE_2__.promisify)(zlib__WEBPACK_IMPORTED_MODULE_1__.gzip);\nconst gunzip = (0,util__WEBPACK_IMPORTED_MODULE_2__.promisify)(zlib__WEBPACK_IMPORTED_MODULE_1__.gunzip);\n/**\n * 快照服务\n * 负责创建、存储和管理文档快照\n */ class SnapshotService {\n    constructor(){\n        this.SNAPSHOT_LIMIT = parseInt(process.env.SNAPSHOT_LIMIT || \"100\", 10);\n        this.storage = _core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.StorageFactory.getInstance();\n    }\n    /**\n   * 创建并存储快照\n   * @param params 快照参数\n   * @returns 快照元数据（包含 snapshot_id 和 created_at）\n   */ async createSnapshot(params) {\n        const timestamp = Date.now();\n        const snapshotId = timestamp; // 使用时间戳作为 snapshot_id\n        // 压缩 doc_state（使用 gzip，后续可以切换到 zstd）\n        const compressed = await gzip(params.docState);\n        // 生成存储键\n        const key = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotKey)(params.workspaceId, params.objectId, timestamp);\n        // 存储到文件系统\n        await this.storage.put(key, compressed, {\n            snapshot_id: snapshotId,\n            object_id: params.objectId,\n            workspace_id: params.workspaceId,\n            doc_state_length: params.docState.length,\n            compressed_length: compressed.length,\n            snapshot_length: params.snapshot?.length || 0,\n            ...params.metadata\n        });\n        // 清理旧快照（如果超过限制）\n        await this.cleanupOldSnapshots(params.workspaceId, params.objectId);\n        return {\n            snapshotId,\n            createdAt: timestamp\n        };\n    }\n    /**\n   * 获取快照数据\n   */ async getSnapshot(workspaceId, objectId, snapshotId) {\n        // 从数据库查询快照元数据，获取时间戳\n        // 这里简化处理，直接使用 snapshotId 作为时间戳\n        const timestamp = snapshotId;\n        const key = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotKey)(workspaceId, objectId, timestamp);\n        const compressed = await this.storage.get(key);\n        if (!compressed) {\n            return null;\n        }\n        // 解压缩\n        const docState = await gunzip(compressed);\n        return docState;\n    }\n    /**\n   * 获取快照列表\n   */ async listSnapshots(workspaceId, objectId, limit) {\n        const prefix = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotPrefix)(workspaceId, objectId);\n        const keys = await this.storage.list(prefix, limit);\n        return keys.map((key)=>{\n            const timestamp = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.extractTimestampFromKey)(key);\n            if (!timestamp) return null;\n            return {\n                snapshotId: timestamp,\n                createdAt: timestamp,\n                key\n            };\n        }).filter((item)=>item !== null).sort((a, b)=>b.createdAt - a.createdAt); // 按时间降序\n    }\n    /**\n   * 删除快照\n   */ async deleteSnapshot(workspaceId, objectId, snapshotId) {\n        const timestamp = snapshotId;\n        const key = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotKey)(workspaceId, objectId, timestamp);\n        await this.storage.delete(key);\n    }\n    /**\n   * 清理旧快照（保留最新的 N 个）\n   */ async cleanupOldSnapshots(workspaceId, objectId) {\n        const snapshots = await this.listSnapshots(workspaceId, objectId);\n        if (snapshots.length > this.SNAPSHOT_LIMIT) {\n            const toDelete = snapshots.slice(this.SNAPSHOT_LIMIT);\n            const keysToDelete = toDelete.map((s)=>s.key);\n            await this.storage.deleteMany(keysToDelete);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvc25hcHNob3Quc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFLeUM7QUFFWjtBQUNJO0FBRWpDLE1BQU1NLE9BQU9ELCtDQUFTQSxDQUFDRCxzQ0FBUztBQUNoQyxNQUFNRyxTQUFTRiwrQ0FBU0EsQ0FBQ0Qsd0NBQVc7QUFFcEM7OztDQUdDLEdBQ00sTUFBTUk7SUFJWEMsYUFBYzthQUZHQyxpQkFBaUJDLFNBQVNDLFFBQVFDLEdBQUcsQ0FBQ0gsY0FBYyxJQUFJLE9BQU87UUFHOUUsSUFBSSxDQUFDSSxPQUFPLEdBQUdkLHlFQUFjQSxDQUFDZSxXQUFXO0lBQzNDO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1DLGVBQWVDLE1BTXBCLEVBQXNEO1FBQ3JELE1BQU1DLFlBQVlDLEtBQUtDLEdBQUc7UUFDMUIsTUFBTUMsYUFBYUgsV0FBVyxzQkFBc0I7UUFFcEQscUNBQXFDO1FBQ3JDLE1BQU1JLGFBQWEsTUFBTWhCLEtBQUtXLE9BQU9NLFFBQVE7UUFFN0MsUUFBUTtRQUNSLE1BQU1DLE1BQU12Qiw2RUFBY0EsQ0FBQ2dCLE9BQU9RLFdBQVcsRUFBRVIsT0FBT1MsUUFBUSxFQUFFUjtRQUVoRSxVQUFVO1FBQ1YsTUFBTSxJQUFJLENBQUNKLE9BQU8sQ0FBQ2EsR0FBRyxDQUFDSCxLQUFLRixZQUFZO1lBQ3RDTSxhQUFhUDtZQUNiUSxXQUFXWixPQUFPUyxRQUFRO1lBQzFCSSxjQUFjYixPQUFPUSxXQUFXO1lBQ2hDTSxrQkFBa0JkLE9BQU9NLFFBQVEsQ0FBQ1MsTUFBTTtZQUN4Q0MsbUJBQW1CWCxXQUFXVSxNQUFNO1lBQ3BDRSxpQkFBaUJqQixPQUFPa0IsUUFBUSxFQUFFSCxVQUFVO1lBQzVDLEdBQUdmLE9BQU9tQixRQUFRO1FBQ3BCO1FBRUEsZ0JBQWdCO1FBQ2hCLE1BQU0sSUFBSSxDQUFDQyxtQkFBbUIsQ0FBQ3BCLE9BQU9RLFdBQVcsRUFBRVIsT0FBT1MsUUFBUTtRQUVsRSxPQUFPO1lBQ0xMO1lBQ0FpQixXQUFXcEI7UUFDYjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFNcUIsWUFDSmQsV0FBbUIsRUFDbkJDLFFBQWdCLEVBQ2hCTCxVQUFrQixFQUNNO1FBQ3hCLG9CQUFvQjtRQUNwQiwrQkFBK0I7UUFDL0IsTUFBTUgsWUFBWUc7UUFDbEIsTUFBTUcsTUFBTXZCLDZFQUFjQSxDQUFDd0IsYUFBYUMsVUFBVVI7UUFFbEQsTUFBTUksYUFBYSxNQUFNLElBQUksQ0FBQ1IsT0FBTyxDQUFDMEIsR0FBRyxDQUFDaEI7UUFDMUMsSUFBSSxDQUFDRixZQUFZO1lBQ2YsT0FBTztRQUNUO1FBRUEsTUFBTTtRQUNOLE1BQU1DLFdBQVcsTUFBTWhCLE9BQU9lO1FBQzlCLE9BQU9DO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE1BQU1rQixjQUNKaEIsV0FBbUIsRUFDbkJDLFFBQWdCLEVBQ2hCZ0IsS0FBYyxFQUMwRDtRQUN4RSxNQUFNQyxTQUFTekMsZ0ZBQWlCQSxDQUFDdUIsYUFBYUM7UUFDOUMsTUFBTWtCLE9BQU8sTUFBTSxJQUFJLENBQUM5QixPQUFPLENBQUMrQixJQUFJLENBQUNGLFFBQVFEO1FBRTdDLE9BQU9FLEtBQ0pFLEdBQUcsQ0FBQyxDQUFDdEI7WUFDSixNQUFNTixZQUFZZixzRkFBdUJBLENBQUNxQjtZQUMxQyxJQUFJLENBQUNOLFdBQVcsT0FBTztZQUV2QixPQUFPO2dCQUNMRyxZQUFZSDtnQkFDWm9CLFdBQVdwQjtnQkFDWE07WUFDRjtRQUNGLEdBQ0N1QixNQUFNLENBQUMsQ0FBQ0MsT0FBMkNBLFNBQVMsTUFDNURDLElBQUksQ0FBQyxDQUFDQyxHQUFHQyxJQUFNQSxFQUFFYixTQUFTLEdBQUdZLEVBQUVaLFNBQVMsR0FBRyxRQUFRO0lBQ3hEO0lBRUE7O0dBRUMsR0FDRCxNQUFNYyxlQUFlM0IsV0FBbUIsRUFBRUMsUUFBZ0IsRUFBRUwsVUFBa0IsRUFBaUI7UUFDN0YsTUFBTUgsWUFBWUc7UUFDbEIsTUFBTUcsTUFBTXZCLDZFQUFjQSxDQUFDd0IsYUFBYUMsVUFBVVI7UUFDbEQsTUFBTSxJQUFJLENBQUNKLE9BQU8sQ0FBQ3VDLE1BQU0sQ0FBQzdCO0lBQzVCO0lBRUE7O0dBRUMsR0FDRCxNQUFjYSxvQkFBb0JaLFdBQW1CLEVBQUVDLFFBQWdCLEVBQWlCO1FBQ3RGLE1BQU00QixZQUFZLE1BQU0sSUFBSSxDQUFDYixhQUFhLENBQUNoQixhQUFhQztRQUV4RCxJQUFJNEIsVUFBVXRCLE1BQU0sR0FBRyxJQUFJLENBQUN0QixjQUFjLEVBQUU7WUFDMUMsTUFBTTZDLFdBQVdELFVBQVVFLEtBQUssQ0FBQyxJQUFJLENBQUM5QyxjQUFjO1lBQ3BELE1BQU0rQyxlQUFlRixTQUFTVCxHQUFHLENBQUMsQ0FBQ1ksSUFBTUEsRUFBRWxDLEdBQUc7WUFDOUMsTUFBTSxJQUFJLENBQUNWLE9BQU8sQ0FBQzZDLFVBQVUsQ0FBQ0Y7UUFDaEM7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL3NlcnZpY2VzL3NuYXBzaG90LnNlcnZpY2UudHM/YWViMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBTdG9yYWdlRmFjdG9yeSxcbiAgZ2V0U25hcHNob3RLZXksXG4gIGdldFNuYXBzaG90UHJlZml4LFxuICBleHRyYWN0VGltZXN0YW1wRnJvbUtleSxcbn0gZnJvbSAnLi4vY29yZS9zdG9yYWdlL3N0b3JhZ2UuZmFjdG9yeSc7XG5pbXBvcnQgeyBTdG9yYWdlQWRhcHRlciB9IGZyb20gJy4uL2NvcmUvc3RvcmFnZS9zdG9yYWdlLmludGVyZmFjZSc7XG5pbXBvcnQgKiBhcyB6bGliIGZyb20gJ3psaWInO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSAndXRpbCc7XG5cbmNvbnN0IGd6aXAgPSBwcm9taXNpZnkoemxpYi5nemlwKTtcbmNvbnN0IGd1bnppcCA9IHByb21pc2lmeSh6bGliLmd1bnppcCk7XG5cbi8qKlxuICog5b+r54Wn5pyN5YqhXG4gKiDotJ/otKPliJvlu7rjgIHlrZjlgqjlkoznrqHnkIbmlofmoaPlv6vnhadcbiAqL1xuZXhwb3J0IGNsYXNzIFNuYXBzaG90U2VydmljZSB7XG4gIHByaXZhdGUgc3RvcmFnZTogU3RvcmFnZUFkYXB0ZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgU05BUFNIT1RfTElNSVQgPSBwYXJzZUludChwcm9jZXNzLmVudi5TTkFQU0hPVF9MSU1JVCB8fCAnMTAwJywgMTApO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc3RvcmFnZSA9IFN0b3JhZ2VGYWN0b3J5LmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65bm25a2Y5YKo5b+r54WnXG4gICAqIEBwYXJhbSBwYXJhbXMg5b+r54Wn5Y+C5pWwXG4gICAqIEByZXR1cm5zIOW/q+eFp+WFg+aVsOaNru+8iOWMheWQqyBzbmFwc2hvdF9pZCDlkowgY3JlYXRlZF9hdO+8iVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlU25hcHNob3QocGFyYW1zOiB7XG4gICAgd29ya3NwYWNlSWQ6IHN0cmluZztcbiAgICBvYmplY3RJZDogc3RyaW5nO1xuICAgIGRvY1N0YXRlOiBCdWZmZXI7IC8vIOWujOaVtOaWh+aho+eKtuaAge+8iFkuZW5jb2RlU3RhdGVBc1VwZGF0Ze+8iVxuICAgIHNuYXBzaG90PzogQnVmZmVyOyAvLyBZanMgU25hcHNob3TvvIjnirbmgIHlkJHph4/vvInvvIzlj6/pgIlcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPHsgc25hcHNob3RJZDogbnVtYmVyOyBjcmVhdGVkQXQ6IG51bWJlciB9PiB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCBzbmFwc2hvdElkID0gdGltZXN0YW1wOyAvLyDkvb/nlKjml7bpl7TmiLPkvZzkuLogc25hcHNob3RfaWRcblxuICAgIC8vIOWOi+e8qSBkb2Nfc3RhdGXvvIjkvb/nlKggZ3ppcO+8jOWQjue7reWPr+S7peWIh+aNouWIsCB6c3Rk77yJXG4gICAgY29uc3QgY29tcHJlc3NlZCA9IGF3YWl0IGd6aXAocGFyYW1zLmRvY1N0YXRlKTtcblxuICAgIC8vIOeUn+aIkOWtmOWCqOmUrlxuICAgIGNvbnN0IGtleSA9IGdldFNuYXBzaG90S2V5KHBhcmFtcy53b3Jrc3BhY2VJZCwgcGFyYW1zLm9iamVjdElkLCB0aW1lc3RhbXApO1xuXG4gICAgLy8g5a2Y5YKo5Yiw5paH5Lu257O757ufXG4gICAgYXdhaXQgdGhpcy5zdG9yYWdlLnB1dChrZXksIGNvbXByZXNzZWQsIHtcbiAgICAgIHNuYXBzaG90X2lkOiBzbmFwc2hvdElkLFxuICAgICAgb2JqZWN0X2lkOiBwYXJhbXMub2JqZWN0SWQsXG4gICAgICB3b3Jrc3BhY2VfaWQ6IHBhcmFtcy53b3Jrc3BhY2VJZCxcbiAgICAgIGRvY19zdGF0ZV9sZW5ndGg6IHBhcmFtcy5kb2NTdGF0ZS5sZW5ndGgsXG4gICAgICBjb21wcmVzc2VkX2xlbmd0aDogY29tcHJlc3NlZC5sZW5ndGgsXG4gICAgICBzbmFwc2hvdF9sZW5ndGg6IHBhcmFtcy5zbmFwc2hvdD8ubGVuZ3RoIHx8IDAsXG4gICAgICAuLi5wYXJhbXMubWV0YWRhdGEsXG4gICAgfSk7XG5cbiAgICAvLyDmuIXnkIbml6flv6vnhafvvIjlpoLmnpzotoXov4fpmZDliLbvvIlcbiAgICBhd2FpdCB0aGlzLmNsZWFudXBPbGRTbmFwc2hvdHMocGFyYW1zLndvcmtzcGFjZUlkLCBwYXJhbXMub2JqZWN0SWQpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHNuYXBzaG90SWQsXG4gICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluW/q+eFp+aVsOaNrlxuICAgKi9cbiAgYXN5bmMgZ2V0U25hcHNob3QoXG4gICAgd29ya3NwYWNlSWQ6IHN0cmluZyxcbiAgICBvYmplY3RJZDogc3RyaW5nLFxuICAgIHNuYXBzaG90SWQ6IG51bWJlclxuICApOiBQcm9taXNlPEJ1ZmZlciB8IG51bGw+IHtcbiAgICAvLyDku47mlbDmja7lupPmn6Xor6Llv6vnhaflhYPmlbDmja7vvIzojrflj5bml7bpl7TmiLNcbiAgICAvLyDov5nph4znroDljJblpITnkIbvvIznm7TmjqXkvb/nlKggc25hcHNob3RJZCDkvZzkuLrml7bpl7TmiLNcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBzbmFwc2hvdElkO1xuICAgIGNvbnN0IGtleSA9IGdldFNuYXBzaG90S2V5KHdvcmtzcGFjZUlkLCBvYmplY3RJZCwgdGltZXN0YW1wKTtcblxuICAgIGNvbnN0IGNvbXByZXNzZWQgPSBhd2FpdCB0aGlzLnN0b3JhZ2UuZ2V0KGtleSk7XG4gICAgaWYgKCFjb21wcmVzc2VkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyDop6PljovnvKlcbiAgICBjb25zdCBkb2NTdGF0ZSA9IGF3YWl0IGd1bnppcChjb21wcmVzc2VkKTtcbiAgICByZXR1cm4gZG9jU3RhdGU7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5b+r54Wn5YiX6KGoXG4gICAqL1xuICBhc3luYyBsaXN0U25hcHNob3RzKFxuICAgIHdvcmtzcGFjZUlkOiBzdHJpbmcsXG4gICAgb2JqZWN0SWQ6IHN0cmluZyxcbiAgICBsaW1pdD86IG51bWJlclxuICApOiBQcm9taXNlPEFycmF5PHsgc25hcHNob3RJZDogbnVtYmVyOyBjcmVhdGVkQXQ6IG51bWJlcjsga2V5OiBzdHJpbmcgfT4+IHtcbiAgICBjb25zdCBwcmVmaXggPSBnZXRTbmFwc2hvdFByZWZpeCh3b3Jrc3BhY2VJZCwgb2JqZWN0SWQpO1xuICAgIGNvbnN0IGtleXMgPSBhd2FpdCB0aGlzLnN0b3JhZ2UubGlzdChwcmVmaXgsIGxpbWl0KTtcblxuICAgIHJldHVybiBrZXlzXG4gICAgICAubWFwKChrZXkpID0+IHtcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gZXh0cmFjdFRpbWVzdGFtcEZyb21LZXkoa2V5KTtcbiAgICAgICAgaWYgKCF0aW1lc3RhbXApIHJldHVybiBudWxsO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc25hcHNob3RJZDogdGltZXN0YW1wLFxuICAgICAgICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wLFxuICAgICAgICAgIGtleSxcbiAgICAgICAgfTtcbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKChpdGVtKTogaXRlbSBpcyBOb25OdWxsYWJsZTx0eXBlb2YgaXRlbT4gPT4gaXRlbSAhPT0gbnVsbClcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmNyZWF0ZWRBdCAtIGEuY3JlYXRlZEF0KTsgLy8g5oyJ5pe26Ze06ZmN5bqPXG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5b+r54WnXG4gICAqL1xuICBhc3luYyBkZWxldGVTbmFwc2hvdCh3b3Jrc3BhY2VJZDogc3RyaW5nLCBvYmplY3RJZDogc3RyaW5nLCBzbmFwc2hvdElkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBzbmFwc2hvdElkO1xuICAgIGNvbnN0IGtleSA9IGdldFNuYXBzaG90S2V5KHdvcmtzcGFjZUlkLCBvYmplY3RJZCwgdGltZXN0YW1wKTtcbiAgICBhd2FpdCB0aGlzLnN0b3JhZ2UuZGVsZXRlKGtleSk7XG4gIH1cblxuICAvKipcbiAgICog5riF55CG5pen5b+r54Wn77yI5L+d55WZ5pyA5paw55qEIE4g5Liq77yJXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNsZWFudXBPbGRTbmFwc2hvdHMod29ya3NwYWNlSWQ6IHN0cmluZywgb2JqZWN0SWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHNuYXBzaG90cyA9IGF3YWl0IHRoaXMubGlzdFNuYXBzaG90cyh3b3Jrc3BhY2VJZCwgb2JqZWN0SWQpO1xuXG4gICAgaWYgKHNuYXBzaG90cy5sZW5ndGggPiB0aGlzLlNOQVBTSE9UX0xJTUlUKSB7XG4gICAgICBjb25zdCB0b0RlbGV0ZSA9IHNuYXBzaG90cy5zbGljZSh0aGlzLlNOQVBTSE9UX0xJTUlUKTtcbiAgICAgIGNvbnN0IGtleXNUb0RlbGV0ZSA9IHRvRGVsZXRlLm1hcCgocykgPT4gcy5rZXkpO1xuICAgICAgYXdhaXQgdGhpcy5zdG9yYWdlLmRlbGV0ZU1hbnkoa2V5c1RvRGVsZXRlKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJTdG9yYWdlRmFjdG9yeSIsImdldFNuYXBzaG90S2V5IiwiZ2V0U25hcHNob3RQcmVmaXgiLCJleHRyYWN0VGltZXN0YW1wRnJvbUtleSIsInpsaWIiLCJwcm9taXNpZnkiLCJnemlwIiwiZ3VuemlwIiwiU25hcHNob3RTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJTTkFQU0hPVF9MSU1JVCIsInBhcnNlSW50IiwicHJvY2VzcyIsImVudiIsInN0b3JhZ2UiLCJnZXRJbnN0YW5jZSIsImNyZWF0ZVNuYXBzaG90IiwicGFyYW1zIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsInNuYXBzaG90SWQiLCJjb21wcmVzc2VkIiwiZG9jU3RhdGUiLCJrZXkiLCJ3b3Jrc3BhY2VJZCIsIm9iamVjdElkIiwicHV0Iiwic25hcHNob3RfaWQiLCJvYmplY3RfaWQiLCJ3b3Jrc3BhY2VfaWQiLCJkb2Nfc3RhdGVfbGVuZ3RoIiwibGVuZ3RoIiwiY29tcHJlc3NlZF9sZW5ndGgiLCJzbmFwc2hvdF9sZW5ndGgiLCJzbmFwc2hvdCIsIm1ldGFkYXRhIiwiY2xlYW51cE9sZFNuYXBzaG90cyIsImNyZWF0ZWRBdCIsImdldFNuYXBzaG90IiwiZ2V0IiwibGlzdFNuYXBzaG90cyIsImxpbWl0IiwicHJlZml4Iiwia2V5cyIsImxpc3QiLCJtYXAiLCJmaWx0ZXIiLCJpdGVtIiwic29ydCIsImEiLCJiIiwiZGVsZXRlU25hcHNob3QiLCJkZWxldGUiLCJzbmFwc2hvdHMiLCJ0b0RlbGV0ZSIsInNsaWNlIiwia2V5c1RvRGVsZXRlIiwicyIsImRlbGV0ZU1hbnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/snapshot.service.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@redis","vendor-chunks/next","vendor-chunks/zod","vendor-chunks/semver","vendor-chunks/reflect-metadata","vendor-chunks/bcryptjs","vendor-chunks/tsyringe","vendor-chunks/generic-pool","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/tslib","vendor-chunks/jws","vendor-chunks/lodash.once","vendor-chunks/jwa","vendor-chunks/cluster-key-slot","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/uuid","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/redis","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();