"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/workspace/[workspace_id]/documents/route";
exports.ids = ["app/api/workspace/[workspace_id]/documents/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("string_decoder");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = import("pg");;

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/workspace/[workspace_id]/documents/route.ts */ \"(rsc)/./src/app/api/workspace/[workspace_id]/documents/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/workspace/[workspace_id]/documents/route\",\n        pathname: \"/api/workspace/[workspace_id]/documents\",\n        filename: \"route\",\n        bundlePath: \"app/api/workspace/[workspace_id]/documents/route\"\n    },\n    resolvedPagePath: \"/Users/kp/Documents/ai-works/pikun-editor-monorepo/apps/server/src/app/api/workspace/[workspace_id]/documents/route.ts\",\n    nextConfigOutput,\n    userland: _Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/workspace/[workspace_id]/documents/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGd29ya3NwYWNlJTJGJTVCd29ya3NwYWNlX2lkJTVEJTJGZG9jdW1lbnRzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZ3b3Jrc3BhY2UlMkYlNUJ3b3Jrc3BhY2VfaWQlNUQlMkZkb2N1bWVudHMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ3b3Jrc3BhY2UlMkYlNUJ3b3Jrc3BhY2VfaWQlNUQlMkZkb2N1bWVudHMlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZrcCUyRkRvY3VtZW50cyUyRmFpLXdvcmtzJTJGcGlrdW4tZWRpdG9yLW1vbm9yZXBvJTJGYXBwcyUyRnNlcnZlciUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZrcCUyRkRvY3VtZW50cyUyRmFpLXdvcmtzJTJGcGlrdW4tZWRpdG9yLW1vbm9yZXBvJTJGYXBwcyUyRnNlcnZlciZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDc0U7QUFDbko7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvPzBmMzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2twL0RvY3VtZW50cy9haS13b3Jrcy9waWt1bi1lZGl0b3ItbW9ub3JlcG8vYXBwcy9zZXJ2ZXIvc3JjL2FwcC9hcGkvd29ya3NwYWNlL1t3b3Jrc3BhY2VfaWRdL2RvY3VtZW50cy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvd29ya3NwYWNlL1t3b3Jrc3BhY2VfaWRdL2RvY3VtZW50cy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3dvcmtzcGFjZS9bd29ya3NwYWNlX2lkXS9kb2N1bWVudHNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3dvcmtzcGFjZS9bd29ya3NwYWNlX2lkXS9kb2N1bWVudHMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMva3AvRG9jdW1lbnRzL2FpLXdvcmtzL3Bpa3VuLWVkaXRvci1tb25vcmVwby9hcHBzL3NlcnZlci9zcmMvYXBwL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/api/auth/auth.controller.ts":
/*!*****************************************!*\
  !*** ./src/api/auth/auth.controller.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthController: () => (/* binding */ AuthController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_auth_service__WEBPACK_IMPORTED_MODULE_2__]);\n_services_auth_service__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nclass AuthController {\n    constructor(authService){\n        this.authService = authService;\n    }\n    /**\n   * 用户注册\n   */ async register(req) {\n        try {\n            const body = await req.json();\n            const registerSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                email: zod__WEBPACK_IMPORTED_MODULE_3__.string().email(),\n                password: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(6),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1)\n            });\n            const validatedData = registerSchema.parse(body);\n            const result = await this.authService.register(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Registration failed\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 用户登录\n   */ async login(req) {\n        try {\n            const body = await req.json();\n            const loginSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                email: zod__WEBPACK_IMPORTED_MODULE_3__.string().email(),\n                password: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1)\n            });\n            const validatedData = loginSchema.parse(body);\n            const result = await this.authService.login(validatedData.email, validatedData.password);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Login failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 刷新 token\n   */ async refreshToken(req) {\n        try {\n            const body = await req.json();\n            const refreshSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                refreshToken: zod__WEBPACK_IMPORTED_MODULE_3__.string()\n            });\n            const validatedData = refreshSchema.parse(body);\n            const result = await this.authService.refreshToken(validatedData.refreshToken);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Token refresh failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 验证 token\n   */ async verifyToken(req) {\n        try {\n            const authHeader = req.headers.get(\"authorization\");\n            if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"No token provided\"\n                }, {\n                    status: 401\n                });\n            }\n            const token = authHeader.substring(7);\n            const decoded = await this.authService.verifyToken(token);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    is_new: false,\n                    uid: decoded.uid,\n                    uuid: decoded.uuid\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Token verification failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n}\nAuthController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:paramtypes\", [\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService\n    ])\n], AuthController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTUUsT0FBTyxJQUFJO1lBQzVCLEdBQ0E7Z0JBQUVFLFFBQVE7WUFBSTtRQUVsQjtJQUNGO0FBQ0Y7QUFoS2F2QixpQkFBQUEsb0VBQUFBO0lBRFpILG9EQUFVQTtJQUVJQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUNDLCtEQUFXQTs7O2VBQXVCLCtEQUFXLDRCQUFYLCtEQUFXOztHQUR0REMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBpL2F1dGgvYXV0aC5jb250cm9sbGVyLnRzPzExNWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XG5cbi8qKlxuICog6K6k6K+B5o6n5Yi25ZmoXG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBdXRoQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKEBpbmplY3QoQXV0aFNlcnZpY2UpIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlKSB7fVxuXG4gIC8qKlxuICAgKiDnlKjmiLfms6jlhoxcbiAgICovXG4gIGFzeW5jIHJlZ2lzdGVyKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICAgIGNvbnN0IHJlZ2lzdGVyU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxuICAgICAgICBwYXNzd29yZDogei5zdHJpbmcoKS5taW4oNiksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSByZWdpc3RlclNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UucmVnaXN0ZXIodmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIC8vIOWkhOeQhiBab2Qg6aqM6K+B6ZSZ6K+vXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdSZWdpc3RyYXRpb24gZmFpbGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDnlKjmiLfnmbvlvZVcbiAgICovXG4gIGFzeW5jIGxvZ2luKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICAgIGNvbnN0IGxvZ2luU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxuICAgICAgICBwYXNzd29yZDogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGxvZ2luU2NoZW1hLnBhcnNlKGJvZHkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5sb2dpbih2YWxpZGF0ZWREYXRhLmVtYWlsLCB2YWxpZGF0ZWREYXRhLnBhc3N3b3JkKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8g5aSE55CGIFpvZCDpqozor4HplJnor69cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0xvZ2luIGZhaWxlZCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yi35pawIHRva2VuXG4gICAqL1xuICBhc3luYyByZWZyZXNoVG9rZW4ocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuICAgICAgY29uc3QgcmVmcmVzaFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgcmVmcmVzaFRva2VuOiB6LnN0cmluZygpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSByZWZyZXNoU2NoZW1hLnBhcnNlKGJvZHkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5yZWZyZXNoVG9rZW4odmFsaWRhdGVkRGF0YS5yZWZyZXNoVG9rZW4pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyDlpITnkIYgWm9kIOmqjOivgemUmeivr1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnVG9rZW4gcmVmcmVzaCBmYWlsZWQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOmqjOivgSB0b2tlblxuICAgKi9cbiAgYXN5bmMgdmVyaWZ5VG9rZW4ocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ05vIHRva2VuIHByb3ZpZGVkJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UudmVyaWZ5VG9rZW4odG9rZW4pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaXNfbmV3OiBmYWxzZSwgLy8g5Y+v5Lul5qC55o2u6ZyA6KaB5a6e546wXG4gICAgICAgICAgdWlkOiBkZWNvZGVkLnVpZCxcbiAgICAgICAgICB1dWlkOiBkZWNvZGVkLnV1aWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdUb2tlbiB2ZXJpZmljYXRpb24gZmFpbGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInoiLCJpbmplY3RhYmxlIiwiaW5qZWN0IiwiQXV0aFNlcnZpY2UiLCJBdXRoQ29udHJvbGxlciIsImNvbnN0cnVjdG9yIiwiYXV0aFNlcnZpY2UiLCJyZWdpc3RlciIsInJlcSIsImJvZHkiLCJqc29uIiwicmVnaXN0ZXJTY2hlbWEiLCJvYmplY3QiLCJlbWFpbCIsInN0cmluZyIsInBhc3N3b3JkIiwibWluIiwibmFtZSIsInZhbGlkYXRlZERhdGEiLCJwYXJzZSIsInJlc3VsdCIsInN1Y2Nlc3MiLCJkYXRhIiwiZXJyb3IiLCJab2RFcnJvciIsIm1lc3NhZ2UiLCJlcnJvcnMiLCJzdGF0dXMiLCJsb2dpbiIsImxvZ2luU2NoZW1hIiwicmVmcmVzaFRva2VuIiwicmVmcmVzaFNjaGVtYSIsInZlcmlmeVRva2VuIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJzdGFydHNXaXRoIiwidG9rZW4iLCJzdWJzdHJpbmciLCJkZWNvZGVkIiwiaXNfbmV3IiwidWlkIiwidXVpZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/api/auth/auth.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/documents/document.controller.ts":
/*!**************************************************!*\
  !*** ./src/api/documents/document.controller.ts ***!
  \**************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentController: () => (/* binding */ DocumentController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_document_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/document.service */ \"(rsc)/./src/services/document.service.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_document_service__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_services_document_service__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\nclass DocumentController {\n    constructor(documentService, authService){\n        this.documentService = documentService;\n        this.authService = authService;\n    }\n    /**\n   * 获取当前用户（从 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.authService.verifyToken(token);\n    }\n    /**\n   * 创建文档\n   */ async createDocument(req, context) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const body = await req.json();\n            const createSchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n                title: zod__WEBPACK_IMPORTED_MODULE_4__.string().min(1),\n                content: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_4__.record(zod__WEBPACK_IMPORTED_MODULE_4__.any()).optional().nullable()\n            });\n            const validatedData = createSchema.parse(body);\n            // 如果没有提供 content，创建一个空的 Buffer（空 Yjs 文档）\n            const contentBuffer = validatedData.content ? Buffer.from(validatedData.content, \"base64\") : Buffer.alloc(0);\n            const document = await this.documentService.createDocument({\n                workspace_id: context.params.workspace_id,\n                title: validatedData.title,\n                content: contentBuffer,\n                owner_uid: user.uid,\n                metadata: validatedData.metadata\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    workspace_id: document.workspace_id,\n                    created_at: document.created_at instanceof Date ? document.created_at.toISOString() : document.created_at\n                }\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_5__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 400\n            });\n        }\n    }\n    /**\n   * 获取文档\n   */ async getDocument(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const includeContent = req.nextUrl.searchParams.get(\"include_content\") === \"true\";\n            const document = await this.documentService.getDocument(context.params.object_id, includeContent);\n            if (!document) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Document not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    workspace_id: document.workspace_id,\n                    title: document.title,\n                    content: includeContent ? document.content.toString(\"base64\") : undefined,\n                    content_length: document.content_length,\n                    owner_uid: document.owner_uid,\n                    metadata: document.metadata,\n                    created_at: document.created_at instanceof Date ? document.created_at.toISOString() : document.created_at,\n                    updated_at: document.updated_at instanceof Date ? document.updated_at.toISOString() : document.updated_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 更新文档\n   */ async updateDocument(req, context) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const body = await req.json();\n            const updateSchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n                title: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                content: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_4__.record(zod__WEBPACK_IMPORTED_MODULE_4__.any()).optional().nullable()\n            });\n            const validatedData = updateSchema.parse(body);\n            const updates = {};\n            if (validatedData.title) updates.title = validatedData.title;\n            if (validatedData.content) {\n                updates.content = Buffer.from(validatedData.content, \"base64\");\n            }\n            if (validatedData.metadata) updates.metadata = validatedData.metadata;\n            const document = await this.documentService.updateDocument(context.params.object_id, updates);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    updated_at: document.updated_at instanceof Date ? document.updated_at.toISOString() : document.updated_at\n                }\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_5__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 400\n            });\n        }\n    }\n    /**\n   * 获取文档列表\n   */ async getDocuments(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const page = parseInt(req.nextUrl.searchParams.get(\"page\") || \"1\", 10);\n            const page_size = parseInt(req.nextUrl.searchParams.get(\"page_size\") || \"20\", 10);\n            const sort_by = req.nextUrl.searchParams.get(\"sort_by\") || \"updated_at\";\n            const order = req.nextUrl.searchParams.get(\"order\") || \"desc\";\n            const result = await this.documentService.getDocuments(context.params.workspace_id, {\n                page,\n                page_size,\n                sort_by,\n                order\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get documents\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 删除文档\n   */ async deleteDocument(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            await this.documentService.deleteDocument(context.params.object_id);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: \"Document deleted successfully\"\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const limit = parseInt(req.nextUrl.searchParams.get(\"limit\") || \"20\", 10);\n            const offset = parseInt(req.nextUrl.searchParams.get(\"offset\") || \"0\", 10);\n            const result = await this.documentService.getSnapshots(context.params.object_id, {\n                limit,\n                offset\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get snapshots\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const snapshot = await this.documentService.getLatestSnapshot(context.params.object_id);\n            if (!snapshot) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Snapshot not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    snapshot_id: snapshot.snapshot_id,\n                    doc_state: snapshot.doc_state?.toString(\"base64\"),\n                    snapshot: snapshot.snapshot_data.toString(\"base64\"),\n                    created_at: snapshot.created_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get latest snapshot\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 搜索文档\n   */ async searchDocuments(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const query = req.nextUrl.searchParams.get(\"query\");\n            if (!query) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Query parameter is required\"\n                }, {\n                    status: 400\n                });\n            }\n            const limit = parseInt(req.nextUrl.searchParams.get(\"limit\") || \"10\", 10);\n            const offset = parseInt(req.nextUrl.searchParams.get(\"offset\") || \"0\", 10);\n            const threshold = parseFloat(req.nextUrl.searchParams.get(\"threshold\") || \"0.5\");\n            const results = await this.documentService.searchDocuments(context.params.workspace_id, query, {\n                limit,\n                offset,\n                threshold\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: results\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to search documents\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n}\nDocumentController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService === \"undefined\" ? Object : _services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService,\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService\n    ])\n], DocumentController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL2RvY3VtZW50cy9kb2N1bWVudC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXdEO0FBQ2hDO0FBQ3NCO0FBQ2dCO0FBQ1I7QUFNL0MsTUFBTU07SUFDWEMsWUFDRSxlQUFpRSxFQUNqRSxXQUFxRCxDQUNyRDthQUZpQ0Msa0JBQUFBO2FBQ0pDLGNBQUFBO0lBQzVCO0lBRUg7O0dBRUMsR0FDRCxNQUFjQyxlQUFlQyxHQUFnQixFQUEwQztRQUNyRixNQUFNQyxhQUFhRCxJQUFJRSxPQUFPLENBQUNDLEdBQUcsQ0FBQztRQUNuQyxJQUFJLENBQUNGLGNBQWMsQ0FBQ0EsV0FBV0csVUFBVSxDQUFDLFlBQVk7WUFDcEQsTUFBTSxJQUFJQyxNQUFNO1FBQ2xCO1FBRUEsTUFBTUMsUUFBUUwsV0FBV00sU0FBUyxDQUFDO1FBQ25DLE9BQU8sTUFBTSxJQUFJLENBQUNULFdBQVcsQ0FBQ1UsV0FBVyxDQUFDRjtJQUM1QztJQUVBOztHQUVDLEdBQ0QsTUFBTUcsZUFDSlQsR0FBZ0IsRUFDaEJVLE9BQTZDLEVBQ3RCO1FBQ3ZCLElBQUk7WUFDRixNQUFNQyxPQUFPLE1BQU0sSUFBSSxDQUFDWixjQUFjLENBQUNDO1lBQ3ZDLE1BQU1ZLE9BQU8sTUFBTVosSUFBSWEsSUFBSTtZQUUzQixNQUFNQyxlQUFleEIsdUNBQVEsQ0FBQztnQkFDNUIwQixPQUFPMUIsdUNBQVEsR0FBRzRCLEdBQUcsQ0FBQztnQkFDdEJDLFNBQVM3Qix1Q0FBUSxHQUFHOEIsUUFBUSxHQUFHQyxRQUFRO2dCQUN2Q0MsVUFBVWhDLHVDQUFRLENBQUNBLG9DQUFLLElBQUk4QixRQUFRLEdBQUdDLFFBQVE7WUFDakQ7WUFFQSxNQUFNSSxnQkFBZ0JYLGFBQWFZLEtBQUssQ0FBQ2Q7WUFDekMseUNBQXlDO1lBQ3pDLE1BQU1lLGdCQUFnQkYsY0FBY04sT0FBTyxHQUN2Q1MsT0FBT0MsSUFBSSxDQUFDSixjQUFjTixPQUFPLEVBQUUsWUFDbkNT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QSxJQUFBQSxnREFBTUEsQ0FBQ0UsK0RBQVdBOzs7ZUFEK0IsdUVBQWUsNEJBQWYsdUVBQWU7ZUFDdkIsK0RBQVcsNEJBQVgsK0RBQVc7O0dBSDVDQyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9hcGkvZG9jdW1lbnRzL2RvY3VtZW50LmNvbnRyb2xsZXIudHM/MmVmOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgeyBEb2N1bWVudFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2RvY3VtZW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XG5cbi8qKlxuICog5paH5qGj5o6n5Yi25ZmoXG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEb2N1bWVudENvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KERvY3VtZW50U2VydmljZSkgcHJpdmF0ZSBkb2N1bWVudFNlcnZpY2U6IERvY3VtZW50U2VydmljZSxcbiAgICBAaW5qZWN0KEF1dGhTZXJ2aWNlKSBwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdXRoU2VydmljZVxuICApIHt9XG5cbiAgLyoqXG4gICAqIOiOt+WPluW9k+WJjeeUqOaIt++8iOS7jiB0b2tlbu+8iVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRDdXJyZW50VXNlcihyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTx7IHVpZDogbnVtYmVyOyB1dWlkOiBzdHJpbmcgfT4ge1xuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYXV0aG9yaXplZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zdWJzdHJpbmcoNyk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UudmVyaWZ5VG9rZW4odG9rZW4pO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuaWh+aho1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlRG9jdW1lbnQoXG4gICAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXIocmVxKTtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuXG4gICAgICBjb25zdCBjcmVhdGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigxKSxcbiAgICAgICAgY29udGVudDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksIC8vIEJhc2U2NCDnvJbnoIHnmoTlhoXlrrnvvIzlj6/pgIlcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY3JlYXRlU2NoZW1hLnBhcnNlKGJvZHkpO1xuICAgICAgLy8g5aaC5p6c5rKh5pyJ5o+Q5L6bIGNvbnRlbnTvvIzliJvlu7rkuIDkuKrnqbrnmoQgQnVmZmVy77yI56m6IFlqcyDmlofmoaPvvIlcbiAgICAgIGNvbnN0IGNvbnRlbnRCdWZmZXIgPSB2YWxpZGF0ZWREYXRhLmNvbnRlbnRcbiAgICAgICAgPyBCdWZmZXIuZnJvbSh2YWxpZGF0ZWREYXRhLmNvbnRlbnQsICdiYXNlNjQnKVxuICAgICAgICA6IEJ1ZmZlci5hbGxvYygwKTtcblxuICAgICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5jcmVhdGVEb2N1bWVudCh7XG4gICAgICAgIHdvcmtzcGFjZV9pZDogY29udGV4dC5wYXJhbXMud29ya3NwYWNlX2lkLFxuICAgICAgICB0aXRsZTogdmFsaWRhdGVkRGF0YS50aXRsZSxcbiAgICAgICAgY29udGVudDogY29udGVudEJ1ZmZlcixcbiAgICAgICAgb3duZXJfdWlkOiB1c2VyLnVpZCxcbiAgICAgICAgbWV0YWRhdGE6IHZhbGlkYXRlZERhdGEubWV0YWRhdGEsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG9iamVjdF9pZDogZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgIHdvcmtzcGFjZV9pZDogZG9jdW1lbnQud29ya3NwYWNlX2lkLFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IGRvY3VtZW50LmNyZWF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gZG9jdW1lbnQuY3JlYXRlZF9hdC50b0lTT1N0cmluZygpIDogZG9jdW1lbnQuY3JlYXRlZF9hdCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIC8vIOWkhOeQhiBab2Qg6aqM6K+B6ZSZ6K+vXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gY3JlYXRlIGRvY3VtZW50JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho1xuICAgKi9cbiAgYXN5bmMgZ2V0RG9jdW1lbnQoXG4gICAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZzsgb2JqZWN0X2lkOiBzdHJpbmcgfSB9XG4gICk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXIocmVxKTtcblxuICAgICAgY29uc3QgaW5jbHVkZUNvbnRlbnQgPSByZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdpbmNsdWRlX2NvbnRlbnQnKSA9PT0gJ3RydWUnO1xuICAgICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5nZXREb2N1bWVudChcbiAgICAgICAgY29udGV4dC5wYXJhbXMub2JqZWN0X2lkLFxuICAgICAgICBpbmNsdWRlQ29udGVudFxuICAgICAgKTtcblxuICAgICAgaWYgKCFkb2N1bWVudCkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnRG9jdW1lbnQgbm90IGZvdW5kJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgb2JqZWN0X2lkOiBkb2N1bWVudC5vYmplY3RfaWQsXG4gICAgICAgICAgd29ya3NwYWNlX2lkOiBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgdGl0bGU6IGRvY3VtZW50LnRpdGxlLFxuICAgICAgICAgIGNvbnRlbnQ6IGluY2x1ZGVDb250ZW50ID8gZG9jdW1lbnQuY29udGVudC50b1N0cmluZygnYmFzZTY0JykgOiB1bmRlZmluZWQsXG4gICAgICAgICAgY29udGVudF9sZW5ndGg6IGRvY3VtZW50LmNvbnRlbnRfbGVuZ3RoLFxuICAgICAgICAgIG93bmVyX3VpZDogZG9jdW1lbnQub3duZXJfdWlkLFxuICAgICAgICAgIG1ldGFkYXRhOiBkb2N1bWVudC5tZXRhZGF0YSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiBkb2N1bWVudC5jcmVhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZSA/IGRvY3VtZW50LmNyZWF0ZWRfYXQudG9JU09TdHJpbmcoKSA6IGRvY3VtZW50LmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogZG9jdW1lbnQudXBkYXRlZF9hdCBpbnN0YW5jZW9mIERhdGUgPyBkb2N1bWVudC51cGRhdGVkX2F0LnRvSVNPU3RyaW5nKCkgOiBkb2N1bWVudC51cGRhdGVkX2F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkb2N1bWVudCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrDmlofmoaNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZURvY3VtZW50KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgdGl0bGU6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuICAgICAgICBjb250ZW50OiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSwgLy8gQmFzZTY0IOe8lueggeeahOWGheWuuVxuICAgICAgICBtZXRhZGF0YTogei5yZWNvcmQoei5hbnkoKSkub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSB1cGRhdGVTY2hlbWEucGFyc2UoYm9keSk7XG4gICAgICBjb25zdCB1cGRhdGVzOiBhbnkgPSB7fTtcblxuICAgICAgaWYgKHZhbGlkYXRlZERhdGEudGl0bGUpIHVwZGF0ZXMudGl0bGUgPSB2YWxpZGF0ZWREYXRhLnRpdGxlO1xuICAgICAgaWYgKHZhbGlkYXRlZERhdGEuY29udGVudCkge1xuICAgICAgICB1cGRhdGVzLmNvbnRlbnQgPSBCdWZmZXIuZnJvbSh2YWxpZGF0ZWREYXRhLmNvbnRlbnQsICdiYXNlNjQnKTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWxpZGF0ZWREYXRhLm1ldGFkYXRhKSB1cGRhdGVzLm1ldGFkYXRhID0gdmFsaWRhdGVkRGF0YS5tZXRhZGF0YTtcblxuICAgICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS51cGRhdGVEb2N1bWVudChjb250ZXh0LnBhcmFtcy5vYmplY3RfaWQsIHVwZGF0ZXMpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgb2JqZWN0X2lkOiBkb2N1bWVudC5vYmplY3RfaWQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogZG9jdW1lbnQudXBkYXRlZF9hdCBpbnN0YW5jZW9mIERhdGUgPyBkb2N1bWVudC51cGRhdGVkX2F0LnRvSVNPU3RyaW5nKCkgOiBkb2N1bWVudC51cGRhdGVkX2F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8g5aSE55CGIFpvZCDpqozor4HplJnor69cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgZG9jdW1lbnQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGj5YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXREb2N1bWVudHMoXG4gICAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgncGFnZScpIHx8ICcxJywgMTApO1xuICAgICAgY29uc3QgcGFnZV9zaXplID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgncGFnZV9zaXplJykgfHwgJzIwJywgMTApO1xuICAgICAgY29uc3Qgc29ydF9ieSA9XG4gICAgICAgIChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdzb3J0X2J5JykgYXMgJ2NyZWF0ZWRfYXQnIHwgJ3VwZGF0ZWRfYXQnIHwgJ3RpdGxlJykgfHxcbiAgICAgICAgJ3VwZGF0ZWRfYXQnO1xuICAgICAgY29uc3Qgb3JkZXIgPSAocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnb3JkZXInKSBhcyAnYXNjJyB8ICdkZXNjJykgfHwgJ2Rlc2MnO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5nZXREb2N1bWVudHMoY29udGV4dC5wYXJhbXMud29ya3NwYWNlX2lkLCB7XG4gICAgICAgIHBhZ2UsXG4gICAgICAgIHBhZ2Vfc2l6ZSxcbiAgICAgICAgc29ydF9ieSxcbiAgICAgICAgb3JkZXIsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkb2N1bWVudHMnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5paH5qGjXG4gICAqL1xuICBhc3luYyBkZWxldGVEb2N1bWVudChcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5kZWxldGVEb2N1bWVudChjb250ZXh0LnBhcmFtcy5vYmplY3RfaWQpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnRG9jdW1lbnQgZGVsZXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGRlbGV0ZSBkb2N1bWVudCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPlv6vnhafliJfooahcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90cyhcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzIwJywgMTApO1xuICAgICAgY29uc3Qgb2Zmc2V0ID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnb2Zmc2V0JykgfHwgJzAnLCAxMCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmdldFNuYXBzaG90cyhjb250ZXh0LnBhcmFtcy5vYmplY3RfaWQsIHtcbiAgICAgICAgbGltaXQsXG4gICAgICAgIG9mZnNldCxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IHNuYXBzaG90cycsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmnIDmlrDlv6vnhadcbiAgICovXG4gIGFzeW5jIGdldExhdGVzdFNuYXBzaG90KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2UuZ2V0TGF0ZXN0U25hcHNob3QoY29udGV4dC5wYXJhbXMub2JqZWN0X2lkKTtcblxuICAgICAgaWYgKCFzbmFwc2hvdCkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnU25hcHNob3Qgbm90IGZvdW5kJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc25hcHNob3RfaWQ6IHNuYXBzaG90LnNuYXBzaG90X2lkLFxuICAgICAgICAgIGRvY19zdGF0ZTogc25hcHNob3QuZG9jX3N0YXRlPy50b1N0cmluZygnYmFzZTY0JyksXG4gICAgICAgICAgc25hcHNob3Q6IHNuYXBzaG90LnNuYXBzaG90X2RhdGEudG9TdHJpbmcoJ2Jhc2U2NCcpLFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IHNuYXBzaG90LmNyZWF0ZWRfYXQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGxhdGVzdCBzbmFwc2hvdCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmkJzntKLmlofmoaNcbiAgICovXG4gIGFzeW5jIHNlYXJjaERvY3VtZW50cyhcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGNvbnN0IHF1ZXJ5ID0gcmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgncXVlcnknKTtcbiAgICAgIGlmICghcXVlcnkpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1F1ZXJ5IHBhcmFtZXRlciBpcyByZXF1aXJlZCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdsaW1pdCcpIHx8ICcxMCcsIDEwKTtcbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhcnNlSW50KHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ29mZnNldCcpIHx8ICcwJywgMTApO1xuICAgICAgY29uc3QgdGhyZXNob2xkID0gcGFyc2VGbG9hdChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCd0aHJlc2hvbGQnKSB8fCAnMC41Jyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5zZWFyY2hEb2N1bWVudHMoXG4gICAgICAgIGNvbnRleHQucGFyYW1zLndvcmtzcGFjZV9pZCxcbiAgICAgICAgcXVlcnksXG4gICAgICAgIHtcbiAgICAgICAgICBsaW1pdCxcbiAgICAgICAgICBvZmZzZXQsXG4gICAgICAgICAgdGhyZXNob2xkLFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHRzLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHNlYXJjaCBkb2N1bWVudHMnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ6IiwiaW5qZWN0YWJsZSIsImluamVjdCIsIkRvY3VtZW50U2VydmljZSIsIkF1dGhTZXJ2aWNlIiwiRG9jdW1lbnRDb250cm9sbGVyIiwiY29uc3RydWN0b3IiLCJkb2N1bWVudFNlcnZpY2UiLCJhdXRoU2VydmljZSIsImdldEN1cnJlbnRVc2VyIiwicmVxIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJzdGFydHNXaXRoIiwiRXJyb3IiLCJ0b2tlbiIsInN1YnN0cmluZyIsInZlcmlmeVRva2VuIiwiY3JlYXRlRG9jdW1lbnQiLCJjb250ZXh0IiwidXNlciIsImJvZHkiLCJqc29uIiwiY3JlYXRlU2NoZW1hIiwib2JqZWN0IiwidGl0bGUiLCJzdHJpbmciLCJtaW4iLCJjb250ZW50Iiwib3B0aW9uYWwiLCJudWxsYWJsZSIsIm1ldGFkYXRhIiwicmVjb3JkIiwiYW55IiwidmFsaWRhdGVkRGF0YSIsInBhcnNlIiwiY29udGVudEJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJhbGxvYyIsImRvY3VtZW50Iiwid29ya3NwYWNlX2lkIiwicGFyYW1zIiwib3duZXJfdWlkIiwidWlkIiwic3VjY2VzcyIsImRhdGEiLCJvYmplY3RfaWQiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiZXJyb3IiLCJab2RFcnJvciIsIm1lc3NhZ2UiLCJlcnJvcnMiLCJzdGF0dXMiLCJnZXREb2N1bWVudCIsImluY2x1ZGVDb250ZW50IiwibmV4dFVybCIsInNlYXJjaFBhcmFtcyIsInRvU3RyaW5nIiwidW5kZWZpbmVkIiwiY29udGVudF9sZW5ndGgiLCJ1cGRhdGVkX2F0IiwidXBkYXRlRG9jdW1lbnQiLCJ1cGRhdGVTY2hlbWEiLCJ1cGRhdGVzIiwiZ2V0RG9jdW1lbnRzIiwicGFnZSIsInBhcnNlSW50IiwicGFnZV9zaXplIiwic29ydF9ieSIsIm9yZGVyIiwicmVzdWx0IiwiZGVsZXRlRG9jdW1lbnQiLCJnZXRTbmFwc2hvdHMiLCJsaW1pdCIsIm9mZnNldCIsImdldExhdGVzdFNuYXBzaG90Iiwic25hcHNob3QiLCJzbmFwc2hvdF9pZCIsImRvY19zdGF0ZSIsInNuYXBzaG90X2RhdGEiLCJzZWFyY2hEb2N1bWVudHMiLCJxdWVyeSIsInRocmVzaG9sZCIsInBhcnNlRmxvYXQiLCJyZXN1bHRzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/api/documents/document.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/workspace/workspace.controller.ts":
/*!***************************************************!*\
  !*** ./src/api/workspace/workspace.controller.ts ***!
  \***************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WorkspaceController: () => (/* binding */ WorkspaceController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\nclass WorkspaceController {\n    constructor(workspaceDAO, authService){\n        this.workspaceDAO = workspaceDAO;\n        this.authService = authService;\n    }\n    /**\n   * 获取当前用户（从 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.authService.verifyToken(token);\n    }\n    /**\n   * 获取用户的默认工作空间\n   */ async getDefaultWorkspace(req) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const workspace = await this.workspaceDAO.getOrCreateDefault(user.uid);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    workspace_id: workspace.workspace_id,\n                    name: workspace.name,\n                    owner_uid: workspace.owner_uid,\n                    icon: workspace.icon,\n                    metadata: workspace.metadata,\n                    created_at: workspace.created_at instanceof Date ? workspace.created_at.toISOString() : workspace.created_at,\n                    updated_at: workspace.updated_at instanceof Date ? workspace.updated_at.toISOString() : workspace.updated_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get default workspace\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取用户的所有工作空间\n   */ async getWorkspaces(req) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const workspaces = await this.workspaceDAO.findByOwnerUid(user.uid);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: workspaces.map((w)=>({\n                        workspace_id: w.workspace_id,\n                        name: w.name,\n                        owner_uid: w.owner_uid,\n                        icon: w.icon,\n                        metadata: w.metadata,\n                        created_at: w.created_at instanceof Date ? w.created_at.toISOString() : w.created_at,\n                        updated_at: w.updated_at instanceof Date ? w.updated_at.toISOString() : w.updated_at\n                    }))\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get workspaces\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n}\nWorkspaceController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(\"WorkspaceDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__.WorkspaceDAO === \"undefined\" ? Object : _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__.WorkspaceDAO,\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService\n    ])\n], WorkspaceController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL3dvcmtzcGFjZS93b3Jrc3BhY2UuY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDVjtBQUNLO0FBQ0c7QUFNL0MsTUFBTUs7SUFDWEMsWUFDRSxZQUEwRCxFQUMxRCxXQUFxRCxDQUNyRDthQUZnQ0MsZUFBQUE7YUFDSEMsY0FBQUE7SUFDNUI7SUFFSDs7R0FFQyxHQUNELE1BQWNDLGVBQWVDLEdBQWdCLEVBQTBDO1FBQ3JGLE1BQU1DLGFBQWFELElBQUlFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO1FBQ25DLElBQUksQ0FBQ0YsY0FBYyxDQUFDQSxXQUFXRyxVQUFVLENBQUMsWUFBWTtZQUNwRCxNQUFNLElBQUlDLE1BQU07UUFDbEI7UUFFQSxNQUFNQyxRQUFRTCxXQUFXTSxTQUFTLENBQUM7UUFDbkMsT0FBTyxNQUFNLElBQUksQ0FBQ1QsV0FBVyxDQUFDVSxXQUFXLENBQUNGO0lBQzVDO0lBRUE7O0dBRUMsR0FDRCxNQUFNRyxvQkFBb0JULEdBQWdCLEVBQXlCO1FBQ2pFLElBQUk7WUFDRixNQUFNVSxPQUFPLE1BQU0sSUFBSSxDQUFDWCxjQUFjLENBQUNDO1lBQ3ZDLE1BQU1XLFlBQVksTUFBTSxJQUFJLENBQUNkLFlBQVksQ0FBQ2Usa0JBQWtCLENBQUNGLEtBQUtHLEdBQUc7WUFFckUsT0FBT3ZCLHFEQUFZQSxDQUFDd0IsSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztnQkFDVEMsTUFBTTtvQkFDSkMsY0FBY04sVUFBVU0sWUFBWTtvQkFDcENDLE1BQU1QLFVBQVVPLElBQUk7b0JBQ3BCQyxXQUFXUixVQUFVUSxTQUFTO29CQUM5QkMsTUFBTVQsVUFBVVMsSUFBSTtvQkFDcEJDLFVBQVVWLFVBQVVVLFFBQVE7b0JBQzVCQyxZQUFZWCxVQUFVVyxVQUFVLFlBQVlDLE9BQU9aLFVBQVVXLFVBQVUsQ0FBQ0UsV0FBVyxLQUFLYixVQUFVVyxVQUFVO29CQUM1R0csWUFBWWQsVUFBVWMsVUFBVSxZQUFZRixPQUFPWixVQUFVYyxVQUFVLENBQUNELFdBQVcsS0FBS2IsVUFBVWMsVUFBVTtnQkFDOUc7WUFDRjtRQUNGLEVBQUUsT0FBT0MsT0FBWTtZQUNuQixPQUFPcEMscURBQVlBLENBQUN3QixJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNUWSxTQUFTRCxNQUFNQyxPQUFPLElBQUk7WUFDNUIsR0FDQTtnQkFBRUMsUUFBUUYsTUFBTUMsT0FBTyxLQUFLLGlCQUFpQixNQUFNO1lBQUk7UUFFM0Q7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTUUsY0FBYzdCLEdBQWdCLEVBQXlCO1FBQzNELElBQUk7WUFDRixNQUFNVSxPQUFPLE1BQU0sSUFBSSxDQUFDWCxjQUFjLENBQUNDO1lBQ3ZDLE1BQU04QixhQUFhLE1BQU0sSUFBSSxDQUFDakMsWUFBWSxDQUFDa0MsY0FBYyxDQUFDckIsS0FBS0csR0FBRztZQUVsRSxPQUFPdkIscURBQVlBLENBQUN3QixJQUFJLENBQUM7Z0JBQ3ZCQyxTQUFTO2dCQUNUQyxNQUFNYyxXQUFXRSxHQUFHLENBQUMsQ0FBQ0MsSUFBTzt3QkFDM0JoQixjQUFjZ0IsRUFBRWhCLFlBQVk7d0JBQzVCQyxNQUFNZSxFQUFFZixJQUFJO3dCQUNaQyxXQUFXYyxFQUFFZCxTQUFTO3dCQUN0QkMsTUFBTWEsRUFBRWIsSUFBSTt3QkFDWkMsVUFBVVksRUFBRVosUUFBUTt3QkFDcEJDLFlBQVlXLEVBQUVYLFVBQVUsWUFBWUMsT0FBT1UsRUFBRVgsVUFBVSxDQUFDRSxXQUFXLEtBQUtTLEVBQUVYLFVBQVU7d0JBQ3BGRyxZQUFZUSxFQUFFUixVQUFVLFlBQVlGLE9BQU9VLEVBQUVSLFVBQVUsQ0FBQ0QsV0FBVyxLQUFLUyxFQUFFUixVQUFVO29CQUN0RjtZQUNGO1FBQ0YsRUFBRSxPQUFPQyxPQUFZO1lBQ25CLE9BQU9wQyxxREFBWUEsQ0FBQ3dCLElBQUksQ0FDdEI7Z0JBQ0VDLFNBQVM7Z0JBQ1RZLFNBQVNELE1BQU1DLE9BQU8sSUFBSTtZQUM1QixHQUNBO2dCQUFFQyxRQUFRRixNQUFNQyxPQUFPLEtBQUssaUJBQWlCLE1BQU07WUFBSTtRQUUzRDtJQUNGO0FBQ0Y7QUFoRmFoQyxzQkFBQUEsb0VBQUFBO0lBRFpKLG9EQUFVQTtJQUdOQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7SUFDUEEsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDRSwrREFBV0E7OztlQUQyQiw0REFBWSw0QkFBWiw0REFBWTtlQUNoQiwrREFBVyw0QkFBWCwrREFBVzs7R0FINUNDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2FwaS93b3Jrc3BhY2Uvd29ya3NwYWNlLmNvbnRyb2xsZXIudHM/MDU0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgV29ya3NwYWNlREFPIH0gZnJvbSAnQC9kYW8vd29ya3NwYWNlLmRhbyc7XG5pbXBvcnQgeyBBdXRoU2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvYXV0aC5zZXJ2aWNlJztcblxuLyoqXG4gKiDlt6XkvZznqbrpl7TmjqfliLblmahcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFdvcmtzcGFjZUNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdXb3Jrc3BhY2VEQU8nKSBwcml2YXRlIHdvcmtzcGFjZURBTzogV29ya3NwYWNlREFPLFxuICAgIEBpbmplY3QoQXV0aFNlcnZpY2UpIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlXG4gICkge31cblxuICAvKipcbiAgICog6I635Y+W5b2T5YmN55So5oi377yI5LuOIHRva2Vu77yJXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEN1cnJlbnRVc2VyKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPHsgdWlkOiBudW1iZXI7IHV1aWQ6IHN0cmluZyB9PiB7XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpO1xuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnN1YnN0cmluZyg3KTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5hdXRoU2VydmljZS52ZXJpZnlUb2tlbih0b2tlbik7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE6buY6K6k5bel5L2c56m66Ze0XG4gICAqL1xuICBhc3luYyBnZXREZWZhdWx0V29ya3NwYWNlKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuICAgICAgY29uc3Qgd29ya3NwYWNlID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uZ2V0T3JDcmVhdGVEZWZhdWx0KHVzZXIudWlkKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHdvcmtzcGFjZV9pZDogd29ya3NwYWNlLndvcmtzcGFjZV9pZCxcbiAgICAgICAgICBuYW1lOiB3b3Jrc3BhY2UubmFtZSxcbiAgICAgICAgICBvd25lcl91aWQ6IHdvcmtzcGFjZS5vd25lcl91aWQsXG4gICAgICAgICAgaWNvbjogd29ya3NwYWNlLmljb24sXG4gICAgICAgICAgbWV0YWRhdGE6IHdvcmtzcGFjZS5tZXRhZGF0YSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiB3b3Jrc3BhY2UuY3JlYXRlZF9hdCBpbnN0YW5jZW9mIERhdGUgPyB3b3Jrc3BhY2UuY3JlYXRlZF9hdC50b0lTT1N0cmluZygpIDogd29ya3NwYWNlLmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogd29ya3NwYWNlLnVwZGF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gd29ya3NwYWNlLnVwZGF0ZWRfYXQudG9JU09TdHJpbmcoKSA6IHdvcmtzcGFjZS51cGRhdGVkX2F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkZWZhdWx0IHdvcmtzcGFjZScsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfnmoTmiYDmnInlt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGdldFdvcmtzcGFjZXMocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG4gICAgICBjb25zdCB3b3Jrc3BhY2VzID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uZmluZEJ5T3duZXJVaWQodXNlci51aWQpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB3b3Jrc3BhY2VzLm1hcCgodykgPT4gKHtcbiAgICAgICAgICB3b3Jrc3BhY2VfaWQ6IHcud29ya3NwYWNlX2lkLFxuICAgICAgICAgIG5hbWU6IHcubmFtZSxcbiAgICAgICAgICBvd25lcl91aWQ6IHcub3duZXJfdWlkLFxuICAgICAgICAgIGljb246IHcuaWNvbixcbiAgICAgICAgICBtZXRhZGF0YTogdy5tZXRhZGF0YSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiB3LmNyZWF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gdy5jcmVhdGVkX2F0LnRvSVNPU3RyaW5nKCkgOiB3LmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogdy51cGRhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZSA/IHcudXBkYXRlZF9hdC50b0lTT1N0cmluZygpIDogdy51cGRhdGVkX2F0LFxuICAgICAgICB9KSksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IHdvcmtzcGFjZXMnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImluamVjdGFibGUiLCJpbmplY3QiLCJXb3Jrc3BhY2VEQU8iLCJBdXRoU2VydmljZSIsIldvcmtzcGFjZUNvbnRyb2xsZXIiLCJjb25zdHJ1Y3RvciIsIndvcmtzcGFjZURBTyIsImF1dGhTZXJ2aWNlIiwiZ2V0Q3VycmVudFVzZXIiLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInN0YXJ0c1dpdGgiLCJFcnJvciIsInRva2VuIiwic3Vic3RyaW5nIiwidmVyaWZ5VG9rZW4iLCJnZXREZWZhdWx0V29ya3NwYWNlIiwidXNlciIsIndvcmtzcGFjZSIsImdldE9yQ3JlYXRlRGVmYXVsdCIsInVpZCIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsIndvcmtzcGFjZV9pZCIsIm5hbWUiLCJvd25lcl91aWQiLCJpY29uIiwibWV0YWRhdGEiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidXBkYXRlZF9hdCIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImdldFdvcmtzcGFjZXMiLCJ3b3Jrc3BhY2VzIiwiZmluZEJ5T3duZXJVaWQiLCJtYXAiLCJ3Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/api/workspace/workspace.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/workspace/[workspace_id]/documents/route.ts":
/*!*****************************************************************!*\
  !*** ./src/app/api/workspace/[workspace_id]/documents/route.ts ***!
  \*****************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var _core_init__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/init */ \"(rsc)/./src/core/init.ts\");\n/* harmony import */ var _core_container__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/core/container */ \"(rsc)/./src/core/container.ts\");\n/* harmony import */ var _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/api/documents/document.controller */ \"(rsc)/./src/api/documents/document.controller.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_init__WEBPACK_IMPORTED_MODULE_0__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__]);\n([_core_init__WEBPACK_IMPORTED_MODULE_0__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n/**\n * GET /api/workspace/[workspace_id]/documents - 获取文档列表\n * POST /api/workspace/[workspace_id]/documents - 创建文档\n */ async function GET(req, { params }) {\n    const controller = _core_container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__.DocumentController);\n    return controller.getDocuments(req, {\n        params\n    });\n}\nasync function POST(req, { params }) {\n    const controller = _core_container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__.DocumentController);\n    return controller.createDocument(req, {\n        params\n    });\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQ3FCO0FBQ3dCO0FBQzRCO0FBRXpFOzs7Q0FHQyxHQUNNLGVBQWVFLElBQ3BCQyxHQUFnQixFQUNoQixFQUFFQyxNQUFNLEVBQXdDO0lBRWhELE1BQU1DLGFBQWFMLHNEQUFTQSxDQUFDTSxPQUFPLENBQXFCTCxrRkFBa0JBO0lBQzNFLE9BQU9JLFdBQVdFLFlBQVksQ0FBQ0osS0FBSztRQUFFQztJQUFPO0FBQy9DO0FBRU8sZUFBZUksS0FDcEJMLEdBQWdCLEVBQ2hCLEVBQUVDLE1BQU0sRUFBd0M7SUFFaEQsTUFBTUMsYUFBYUwsc0RBQVNBLENBQUNNLE9BQU8sQ0FBcUJMLGtGQUFrQkE7SUFDM0UsT0FBT0ksV0FBV0ksY0FBYyxDQUFDTixLQUFLO1FBQUVDO0lBQU87QUFDakQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBwL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL3JvdXRlLnRzPzQxYzAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgJ0AvY29yZS9pbml0JztcbmltcG9ydCB7IENvbnRhaW5lciB9IGZyb20gJ0AvY29yZS9jb250YWluZXInO1xuaW1wb3J0IHsgRG9jdW1lbnRDb250cm9sbGVyIH0gZnJvbSAnQC9hcGkvZG9jdW1lbnRzL2RvY3VtZW50LmNvbnRyb2xsZXInO1xuXG4vKipcbiAqIEdFVCAvYXBpL3dvcmtzcGFjZS9bd29ya3NwYWNlX2lkXS9kb2N1bWVudHMgLSDojrflj5bmlofmoaPliJfooahcbiAqIFBPU1QgL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzIC0g5Yib5bu65paH5qGjXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoXG4gIHJlcTogTmV4dFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nIH0gfVxuKSB7XG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBDb250YWluZXIucmVzb2x2ZTxEb2N1bWVudENvbnRyb2xsZXI+KERvY3VtZW50Q29udHJvbGxlcik7XG4gIHJldHVybiBjb250cm9sbGVyLmdldERvY3VtZW50cyhyZXEsIHsgcGFyYW1zIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChcbiAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmcgfSB9XG4pIHtcbiAgY29uc3QgY29udHJvbGxlciA9IENvbnRhaW5lci5yZXNvbHZlPERvY3VtZW50Q29udHJvbGxlcj4oRG9jdW1lbnRDb250cm9sbGVyKTtcbiAgcmV0dXJuIGNvbnRyb2xsZXIuY3JlYXRlRG9jdW1lbnQocmVxLCB7IHBhcmFtcyB9KTtcbn1cblxuIl0sIm5hbWVzIjpbIkNvbnRhaW5lciIsIkRvY3VtZW50Q29udHJvbGxlciIsIkdFVCIsInJlcSIsInBhcmFtcyIsImNvbnRyb2xsZXIiLCJyZXNvbHZlIiwiZ2V0RG9jdW1lbnRzIiwiUE9TVCIsImNyZWF0ZURvY3VtZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/workspace/[workspace_id]/documents/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/container.ts":
/*!*******************************!*\
  !*** ./src/core/container.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Container: () => (/* binding */ Container)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n\n\n/**\n * 依赖注入容器单例\n */ class Container {\n    static getInstance() {\n        if (!Container.instance) {\n            Container.instance = tsyringe__WEBPACK_IMPORTED_MODULE_1__.container;\n        }\n        return Container.instance;\n    }\n    /**\n   * 注册服务\n   */ static register(token, factory) {\n        tsyringe__WEBPACK_IMPORTED_MODULE_1__.container.register(token, {\n            useFactory: factory\n        });\n    }\n    /**\n   * 解析服务\n   */ static resolve(token) {\n        return tsyringe__WEBPACK_IMPORTED_MODULE_1__.container.resolve(token);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9jb250YWluZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUEwQjtBQUNnQztBQUUxRDs7Q0FFQyxHQUNNLE1BQU1DO0lBR1gsT0FBY0MsY0FBbUM7UUFDL0MsSUFBSSxDQUFDRCxVQUFVRSxRQUFRLEVBQUU7WUFDdkJGLFVBQVVFLFFBQVEsR0FBR0gsK0NBQVNBO1FBQ2hDO1FBQ0EsT0FBT0MsVUFBVUUsUUFBUTtJQUMzQjtJQUVBOztHQUVDLEdBQ0QsT0FBY0MsU0FDWkMsS0FBaUMsRUFDakNDLE9BQWdCLEVBQ1Y7UUFDTk4sK0NBQVNBLENBQUNJLFFBQVEsQ0FBQ0MsT0FBTztZQUFFRSxZQUFZRDtRQUFRO0lBQ2xEO0lBRUE7O0dBRUMsR0FDRCxPQUFjRSxRQUFXSCxLQUFpQyxFQUFLO1FBQzdELE9BQU9MLCtDQUFTQSxDQUFDUSxPQUFPLENBQUlIO0lBQzlCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9jb250YWluZXIudHM/YjZhNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuaW1wb3J0IHsgY29udGFpbmVyLCBEZXBlbmRlbmN5Q29udGFpbmVyIH0gZnJvbSAndHN5cmluZ2UnO1xuXG4vKipcbiAqIOS+nei1luazqOWFpeWuueWZqOWNleS+i1xuICovXG5leHBvcnQgY2xhc3MgQ29udGFpbmVyIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IERlcGVuZGVuY3lDb250YWluZXI7XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBEZXBlbmRlbmN5Q29udGFpbmVyIHtcbiAgICBpZiAoIUNvbnRhaW5lci5pbnN0YW5jZSkge1xuICAgICAgQ29udGFpbmVyLmluc3RhbmNlID0gY29udGFpbmVyO1xuICAgIH1cbiAgICByZXR1cm4gQ29udGFpbmVyLmluc3RhbmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIOazqOWGjOacjeWKoVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyByZWdpc3RlcjxUPihcbiAgICB0b2tlbjogc3RyaW5nIHwgc3ltYm9sIHwgRnVuY3Rpb24sXG4gICAgZmFjdG9yeTogKCkgPT4gVFxuICApOiB2b2lkIHtcbiAgICBjb250YWluZXIucmVnaXN0ZXIodG9rZW4sIHsgdXNlRmFjdG9yeTogZmFjdG9yeSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDop6PmnpDmnI3liqFcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcmVzb2x2ZTxUPih0b2tlbjogc3RyaW5nIHwgc3ltYm9sIHwgRnVuY3Rpb24pOiBUIHtcbiAgICByZXR1cm4gY29udGFpbmVyLnJlc29sdmU8VD4odG9rZW4pO1xuICB9XG59XG5cblxuXG5cbiJdLCJuYW1lcyI6WyJjb250YWluZXIiLCJDb250YWluZXIiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwicmVnaXN0ZXIiLCJ0b2tlbiIsImZhY3RvcnkiLCJ1c2VGYWN0b3J5IiwicmVzb2x2ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/container.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/database.ts":
/*!******************************!*\
  !*** ./src/core/database.ts ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Database: () => (/* binding */ Database)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pg */ \"pg\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_1__]);\npg__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nclass Database {\n    constructor(){\n        const connectionString = \"postgresql://pikun@localhost:5432/postgres\";\n        console.log(\"connectionString\", connectionString);\n        if (!connectionString) {\n            throw new Error(\"DATABASE_URL environment variable is not set. \" + \"Please create a .env file in apps/server/ directory with DATABASE_URL=postgresql://pikun@localhost:5432/postgres\");\n        }\n        const config = {\n            connectionString,\n            min: parseInt(\"2\" || 0, 10),\n            max: parseInt(\"10\" || 0, 10),\n            idleTimeoutMillis: 30000,\n            connectionTimeoutMillis: 2000\n        };\n        this.pool = new pg__WEBPACK_IMPORTED_MODULE_1__.Pool(config);\n        // 处理连接错误\n        this.pool.on(\"error\", (err)=>{\n            console.error(\"Unexpected error on idle client\", err);\n        });\n    }\n    static getInstance() {\n        if (!Database.instance) {\n            Database.instance = new Database();\n        }\n        return Database.instance;\n    }\n    getPool() {\n        return this.pool;\n    }\n    /**\n   * 执行查询（使用参数化查询防止 SQL 注入）\n   */ async query(text, params) {\n        const start = Date.now();\n        try {\n            // 设置默认 schema\n            await this.pool.query(\"SET search_path TO pikun_db, public\");\n            const result = await this.pool.query(text, params);\n            const duration = Date.now() - start;\n            console.log(\"Executed query\", {\n                text,\n                duration,\n                rows: result.rowCount\n            });\n            return {\n                rows: result.rows,\n                rowCount: result.rowCount || 0\n            };\n        } catch (error) {\n            console.error(\"Database query error\", {\n                text,\n                error\n            });\n            throw error;\n        }\n    }\n    /**\n   * 执行事务\n   */ async transaction(callback) {\n        const client = await this.pool.connect();\n        try {\n            await client.query(\"SET search_path TO pikun_db, public\");\n            await client.query(\"BEGIN\");\n            const result = await callback(client);\n            await client.query(\"COMMIT\");\n            return result;\n        } catch (error) {\n            await client.query(\"ROLLBACK\");\n            throw error;\n        } finally{\n            client.release();\n        }\n    }\n    /**\n   * 关闭连接池\n   */ async close() {\n        await this.pool.end();\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9kYXRhYmFzZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQTBCO0FBQ1k7QUFFL0IsTUFBTUM7SUFJWCxhQUFzQjtRQUNwQixNQUFNQyxtQkFBbUJDLDRDQUF3QjtRQUNqREcsUUFBUUMsR0FBRyxDQUFDLG9CQUFvQkw7UUFFaEMsSUFBSSxDQUFDQSxrQkFBa0I7WUFDckIsTUFBTSxJQUFJTSxNQUNSLG1EQUNFO1FBRU47UUFFQSxNQUFNQyxTQUFxQjtZQUN6QlA7WUFDQVEsS0FBS0MsU0FBU1IsR0FBNkIsSUFBSSxHQUFLO1lBQ3BEVSxLQUFLRixTQUFTUixJQUE2QixJQUFJLEdBQU07WUFDckRZLG1CQUFtQjtZQUNuQkMseUJBQXlCO1FBQzNCO1FBRUEsSUFBSSxDQUFDQyxJQUFJLEdBQUcsSUFBSWpCLG9DQUFJQSxDQUFDUztRQUVyQixTQUFTO1FBQ1QsSUFBSSxDQUFDUSxJQUFJLENBQUNDLEVBQUUsQ0FBQyxTQUFTLENBQUNDO1lBQ3JCYixRQUFRYyxLQUFLLENBQUMsbUNBQW1DRDtRQUNuRDtJQUNGO0lBRUEsT0FBY0UsY0FBd0I7UUFDcEMsSUFBSSxDQUFDcEIsU0FBU3FCLFFBQVEsRUFBRTtZQUN0QnJCLFNBQVNxQixRQUFRLEdBQUcsSUFBSXJCO1FBQzFCO1FBQ0EsT0FBT0EsU0FBU3FCLFFBQVE7SUFDMUI7SUFFT0MsVUFBZ0I7UUFDckIsT0FBTyxJQUFJLENBQUNOLElBQUk7SUFDbEI7SUFFQTs7R0FFQyxHQUNELE1BQWFPLE1BQ1hDLElBQVksRUFDWkMsTUFBYyxFQUM0QjtRQUMxQyxNQUFNQyxRQUFRQyxLQUFLQyxHQUFHO1FBQ3RCLElBQUk7WUFDRixjQUFjO1lBQ2QsTUFBTSxJQUFJLENBQUNaLElBQUksQ0FBQ08sS0FBSyxDQUFDO1lBQ3RCLE1BQU1NLFNBQVMsTUFBTSxJQUFJLENBQUNiLElBQUksQ0FBQ08sS0FBSyxDQUFDQyxNQUFNQztZQUMzQyxNQUFNSyxXQUFXSCxLQUFLQyxHQUFHLEtBQUtGO1lBQzlCckIsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQjtnQkFBRWtCO2dCQUFNTTtnQkFBVUMsTUFBTUYsT0FBT0csUUFBUTtZQUFDO1lBQ3RFLE9BQU87Z0JBQ0xELE1BQU1GLE9BQU9FLElBQUk7Z0JBQ2pCQyxVQUFVSCxPQUFPRyxRQUFRLElBQUk7WUFDL0I7UUFDRixFQUFFLE9BQU9iLE9BQU87WUFDZGQsUUFBUWMsS0FBSyxDQUFDLHdCQUF3QjtnQkFBRUs7Z0JBQU1MO1lBQU07WUFDcEQsTUFBTUE7UUFDUjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFhYyxZQUFlQyxRQUFxQyxFQUFjO1FBQzdFLE1BQU1DLFNBQVMsTUFBTSxJQUFJLENBQUNuQixJQUFJLENBQUNvQixPQUFPO1FBQ3RDLElBQUk7WUFDRixNQUFNRCxPQUFPWixLQUFLLENBQUM7WUFDbkIsTUFBTVksT0FBT1osS0FBSyxDQUFDO1lBQ25CLE1BQU1NLFNBQVMsTUFBTUssU0FBU0M7WUFDOUIsTUFBTUEsT0FBT1osS0FBSyxDQUFDO1lBQ25CLE9BQU9NO1FBQ1QsRUFBRSxPQUFPVixPQUFPO1lBQ2QsTUFBTWdCLE9BQU9aLEtBQUssQ0FBQztZQUNuQixNQUFNSjtRQUNSLFNBQVU7WUFDUmdCLE9BQU9FLE9BQU87UUFDaEI7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBYUMsUUFBdUI7UUFDbEMsTUFBTSxJQUFJLENBQUN0QixJQUFJLENBQUN1QixHQUFHO0lBQ3JCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9kYXRhYmFzZS50cz85ZTE2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5pbXBvcnQgeyBQb29sLCBQb29sQ29uZmlnIH0gZnJvbSAncGcnO1xuXG5leHBvcnQgY2xhc3MgRGF0YWJhc2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogRGF0YWJhc2U7XG4gIHByaXZhdGUgcG9vbDogUG9vbDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IGNvbm5lY3Rpb25TdHJpbmcgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkw7XG4gICAgY29uc29sZS5sb2coJ2Nvbm5lY3Rpb25TdHJpbmcnLCBjb25uZWN0aW9uU3RyaW5nKTtcblxuICAgIGlmICghY29ubmVjdGlvblN0cmluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnREFUQUJBU0VfVVJMIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIG5vdCBzZXQuICcgK1xuICAgICAgICAgICdQbGVhc2UgY3JlYXRlIGEgLmVudiBmaWxlIGluIGFwcHMvc2VydmVyLyBkaXJlY3Rvcnkgd2l0aCBEQVRBQkFTRV9VUkw9cG9zdGdyZXNxbDovL3Bpa3VuQGxvY2FsaG9zdDo1NDMyL3Bvc3RncmVzJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb25maWc6IFBvb2xDb25maWcgPSB7XG4gICAgICBjb25uZWN0aW9uU3RyaW5nLFxuICAgICAgbWluOiBwYXJzZUludChwcm9jZXNzLmVudi5EQVRBQkFTRV9QT09MX01JTiB8fCAnMicsIDEwKSxcbiAgICAgIG1heDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuREFUQUJBU0VfUE9PTF9NQVggfHwgJzEwJywgMTApLFxuICAgICAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxuICAgICAgY29ubmVjdGlvblRpbWVvdXRNaWxsaXM6IDIwMDAsXG4gICAgfTtcblxuICAgIHRoaXMucG9vbCA9IG5ldyBQb29sKGNvbmZpZyk7XG5cbiAgICAvLyDlpITnkIbov57mjqXplJnor69cbiAgICB0aGlzLnBvb2wub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignVW5leHBlY3RlZCBlcnJvciBvbiBpZGxlIGNsaWVudCcsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IERhdGFiYXNlIHtcbiAgICBpZiAoIURhdGFiYXNlLmluc3RhbmNlKSB7XG4gICAgICBEYXRhYmFzZS5pbnN0YW5jZSA9IG5ldyBEYXRhYmFzZSgpO1xuICAgIH1cbiAgICByZXR1cm4gRGF0YWJhc2UuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgZ2V0UG9vbCgpOiBQb29sIHtcbiAgICByZXR1cm4gdGhpcy5wb29sO1xuICB9XG5cbiAgLyoqXG4gICAqIOaJp+ihjOafpeivou+8iOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWl77yJXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgcXVlcnk8VCA9IGFueT4oXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIHBhcmFtcz86IGFueVtdXG4gICk6IFByb21pc2U8eyByb3dzOiBUW107IHJvd0NvdW50OiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICB0cnkge1xuICAgICAgLy8g6K6+572u6buY6K6kIHNjaGVtYVxuICAgICAgYXdhaXQgdGhpcy5wb29sLnF1ZXJ5KCdTRVQgc2VhcmNoX3BhdGggVE8gcGlrdW5fZGIsIHB1YmxpYycpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wb29sLnF1ZXJ5KHRleHQsIHBhcmFtcyk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydDtcbiAgICAgIGNvbnNvbGUubG9nKCdFeGVjdXRlZCBxdWVyeScsIHsgdGV4dCwgZHVyYXRpb24sIHJvd3M6IHJlc3VsdC5yb3dDb3VudCB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJvd3M6IHJlc3VsdC5yb3dzIGFzIFRbXSxcbiAgICAgICAgcm93Q291bnQ6IHJlc3VsdC5yb3dDb3VudCB8fCAwLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgcXVlcnkgZXJyb3InLCB7IHRleHQsIGVycm9yIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOaJp+ihjOS6i+WKoVxuICAgKi9cbiAgcHVibGljIGFzeW5jIHRyYW5zYWN0aW9uPFQ+KGNhbGxiYWNrOiAoY2xpZW50OiBhbnkpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+IHtcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCB0aGlzLnBvb2wuY29ubmVjdCgpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoJ1NFVCBzZWFyY2hfcGF0aCBUTyBwaWt1bl9kYiwgcHVibGljJyk7XG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0JFR0lOJyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxsYmFjayhjbGllbnQpO1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdDT01NSVQnKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnUk9MTEJBQ0snKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBjbGllbnQucmVsZWFzZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlhbPpl63ov57mjqXmsaBcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnBvb2wuZW5kKCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJQb29sIiwiRGF0YWJhc2UiLCJjb25uZWN0aW9uU3RyaW5nIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsImNvbnNvbGUiLCJsb2ciLCJFcnJvciIsImNvbmZpZyIsIm1pbiIsInBhcnNlSW50IiwiREFUQUJBU0VfUE9PTF9NSU4iLCJtYXgiLCJEQVRBQkFTRV9QT09MX01BWCIsImlkbGVUaW1lb3V0TWlsbGlzIiwiY29ubmVjdGlvblRpbWVvdXRNaWxsaXMiLCJwb29sIiwib24iLCJlcnIiLCJlcnJvciIsImdldEluc3RhbmNlIiwiaW5zdGFuY2UiLCJnZXRQb29sIiwicXVlcnkiLCJ0ZXh0IiwicGFyYW1zIiwic3RhcnQiLCJEYXRlIiwibm93IiwicmVzdWx0IiwiZHVyYXRpb24iLCJyb3dzIiwicm93Q291bnQiLCJ0cmFuc2FjdGlvbiIsImNhbGxiYWNrIiwiY2xpZW50IiwiY29ubmVjdCIsInJlbGVhc2UiLCJjbG9zZSIsImVuZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/database.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/init.ts":
/*!**************************!*\
  !*** ./src/core/init.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initializeContainer: () => (/* binding */ initializeContainer)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _container__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./container */ \"(rsc)/./src/core/container.ts\");\n/* harmony import */ var _dao_user_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/user.dao */ \"(rsc)/./src/dao/user.dao.ts\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\n/* harmony import */ var _services_document_service__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/services/document.service */ \"(rsc)/./src/services/document.service.ts\");\n/* harmony import */ var _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/api/auth/auth.controller */ \"(rsc)/./src/api/auth/auth.controller.ts\");\n/* harmony import */ var _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @/api/documents/document.controller */ \"(rsc)/./src/api/documents/document.controller.ts\");\n/* harmony import */ var _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @/api/workspace/workspace.controller */ \"(rsc)/./src/api/workspace/workspace.controller.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__, _services_auth_service__WEBPACK_IMPORTED_MODULE_5__, _services_document_service__WEBPACK_IMPORTED_MODULE_6__, _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_7__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_8__, _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_9__]);\n([_dao_user_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__, _services_auth_service__WEBPACK_IMPORTED_MODULE_5__, _services_document_service__WEBPACK_IMPORTED_MODULE_6__, _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_7__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_8__, _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_9__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\n\n/**\n * 初始化依赖注入容器\n * 注册所有服务和控制器\n */ function initializeContainer() {\n    // 注册 DAO\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"UserDAO\", ()=>new _dao_user_dao__WEBPACK_IMPORTED_MODULE_2__.UserDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"DocumentDAO\", ()=>new _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__.DocumentDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"WorkspaceDAO\", ()=>new _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__.WorkspaceDAO());\n    // 注册 Service\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_auth_service__WEBPACK_IMPORTED_MODULE_5__.AuthService, ()=>{\n        const userDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"UserDAO\");\n        const workspaceDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"WorkspaceDAO\");\n        return new _services_auth_service__WEBPACK_IMPORTED_MODULE_5__.AuthService(userDAO, workspaceDAO, null);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_document_service__WEBPACK_IMPORTED_MODULE_6__.DocumentService, ()=>{\n        const documentDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentDAO\");\n        return new _services_document_service__WEBPACK_IMPORTED_MODULE_6__.DocumentService(documentDAO, null);\n    });\n    // 注册 Controller\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_7__.AuthController, ()=>{\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_5__.AuthService);\n        return new _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_7__.AuthController(authService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_8__.DocumentController, ()=>{\n        const documentService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_document_service__WEBPACK_IMPORTED_MODULE_6__.DocumentService);\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_5__.AuthService);\n        return new _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_8__.DocumentController(documentService, authService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_9__.WorkspaceController, ()=>{\n        const workspaceDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"WorkspaceDAO\");\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_5__.AuthService);\n        return new _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_9__.WorkspaceController(workspaceDAO, authService);\n    });\n}\n// 自动初始化\ninitializeContainer();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9pbml0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUEwQjtBQUNjO0FBQ0M7QUFDUTtBQUNFO0FBQ0c7QUFDUTtBQUNGO0FBQ2E7QUFDRTtBQUUzRTs7O0NBR0MsR0FDTSxTQUFTUztJQUNkLFNBQVM7SUFDVFQsaURBQVNBLENBQUNVLFFBQVEsQ0FBQyxXQUFXLElBQU0sSUFBSVQsa0RBQU9BO0lBQy9DRCxpREFBU0EsQ0FBQ1UsUUFBUSxDQUFDLGVBQWUsSUFBTSxJQUFJUiwwREFBV0E7SUFDdkRGLGlEQUFTQSxDQUFDVSxRQUFRLENBQUMsZ0JBQWdCLElBQU0sSUFBSVAsNERBQVlBO0lBRXpELGFBQWE7SUFDYkgsaURBQVNBLENBQUNVLFFBQVEsQ0FBQ04sK0RBQVdBLEVBQUU7UUFDOUIsTUFBTU8sVUFBVVgsaURBQVNBLENBQUNZLE9BQU8sQ0FBVTtRQUMzQyxNQUFNQyxlQUFlYixpREFBU0EsQ0FBQ1ksT0FBTyxDQUFlO1FBQ3JELE9BQU8sSUFBSVIsK0RBQVdBLENBQUNPLFNBQVNFLGNBQWM7SUFDaEQ7SUFFQWIsaURBQVNBLENBQUNVLFFBQVEsQ0FBQ0wsdUVBQWVBLEVBQUU7UUFDbEMsTUFBTVMsY0FBY2QsaURBQVNBLENBQUNZLE9BQU8sQ0FBYztRQUNuRCxPQUFPLElBQUlQLHVFQUFlQSxDQUFDUyxhQUFhO0lBQzFDO0lBRUEsZ0JBQWdCO0lBQ2hCZCxpREFBU0EsQ0FBQ1UsUUFBUSxDQUFDSixxRUFBY0EsRUFBRTtRQUNqQyxNQUFNUyxjQUFjZixpREFBU0EsQ0FBQ1ksT0FBTyxDQUFjUiwrREFBV0E7UUFDOUQsT0FBTyxJQUFJRSxxRUFBY0EsQ0FBQ1M7SUFDNUI7SUFFQWYsaURBQVNBLENBQUNVLFFBQVEsQ0FBQ0gsa0ZBQWtCQSxFQUFFO1FBQ3JDLE1BQU1TLGtCQUFrQmhCLGlEQUFTQSxDQUFDWSxPQUFPLENBQWtCUCx1RUFBZUE7UUFDMUUsTUFBTVUsY0FBY2YsaURBQVNBLENBQUNZLE9BQU8sQ0FBY1IsK0RBQVdBO1FBQzlELE9BQU8sSUFBSUcsa0ZBQWtCQSxDQUFDUyxpQkFBaUJEO0lBQ2pEO0lBRUFmLGlEQUFTQSxDQUFDVSxRQUFRLENBQUNGLG9GQUFtQkEsRUFBRTtRQUN0QyxNQUFNSyxlQUFlYixpREFBU0EsQ0FBQ1ksT0FBTyxDQUFlO1FBQ3JELE1BQU1HLGNBQWNmLGlEQUFTQSxDQUFDWSxPQUFPLENBQWNSLCtEQUFXQTtRQUM5RCxPQUFPLElBQUlJLG9GQUFtQkEsQ0FBQ0ssY0FBY0U7SUFDL0M7QUFDRjtBQUVBLFFBQVE7QUFDUk4iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9pbml0LnRzPzM1M2UiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcbmltcG9ydCB7IENvbnRhaW5lciB9IGZyb20gJy4vY29udGFpbmVyJztcbmltcG9ydCB7IFVzZXJEQU8gfSBmcm9tICdAL2Rhby91c2VyLmRhbyc7XG5pbXBvcnQgeyBEb2N1bWVudERBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LmRhbyc7XG5pbXBvcnQgeyBXb3Jrc3BhY2VEQU8gfSBmcm9tICdAL2Rhby93b3Jrc3BhY2UuZGFvJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xuaW1wb3J0IHsgRG9jdW1lbnRTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9kb2N1bWVudC5zZXJ2aWNlJztcbmltcG9ydCB7IEF1dGhDb250cm9sbGVyIH0gZnJvbSAnQC9hcGkvYXV0aC9hdXRoLmNvbnRyb2xsZXInO1xuaW1wb3J0IHsgRG9jdW1lbnRDb250cm9sbGVyIH0gZnJvbSAnQC9hcGkvZG9jdW1lbnRzL2RvY3VtZW50LmNvbnRyb2xsZXInO1xuaW1wb3J0IHsgV29ya3NwYWNlQ29udHJvbGxlciB9IGZyb20gJ0AvYXBpL3dvcmtzcGFjZS93b3Jrc3BhY2UuY29udHJvbGxlcic7XG5cbi8qKlxuICog5Yid5aeL5YyW5L6d6LWW5rOo5YWl5a655ZmoXG4gKiDms6jlhozmiYDmnInmnI3liqHlkozmjqfliLblmahcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVDb250YWluZXIoKSB7XG4gIC8vIOazqOWGjCBEQU9cbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdVc2VyREFPJywgKCkgPT4gbmV3IFVzZXJEQU8oKSk7XG4gIENvbnRhaW5lci5yZWdpc3RlcignRG9jdW1lbnREQU8nLCAoKSA9PiBuZXcgRG9jdW1lbnREQU8oKSk7XG4gIENvbnRhaW5lci5yZWdpc3RlcignV29ya3NwYWNlREFPJywgKCkgPT4gbmV3IFdvcmtzcGFjZURBTygpKTtcblxuICAvLyDms6jlhowgU2VydmljZVxuICBDb250YWluZXIucmVnaXN0ZXIoQXV0aFNlcnZpY2UsICgpID0+IHtcbiAgICBjb25zdCB1c2VyREFPID0gQ29udGFpbmVyLnJlc29sdmU8VXNlckRBTz4oJ1VzZXJEQU8nKTtcbiAgICBjb25zdCB3b3Jrc3BhY2VEQU8gPSBDb250YWluZXIucmVzb2x2ZTxXb3Jrc3BhY2VEQU8+KCdXb3Jrc3BhY2VEQU8nKTtcbiAgICByZXR1cm4gbmV3IEF1dGhTZXJ2aWNlKHVzZXJEQU8sIHdvcmtzcGFjZURBTywgbnVsbCBhcyBhbnkpO1xuICB9KTtcblxuICBDb250YWluZXIucmVnaXN0ZXIoRG9jdW1lbnRTZXJ2aWNlLCAoKSA9PiB7XG4gICAgY29uc3QgZG9jdW1lbnREQU8gPSBDb250YWluZXIucmVzb2x2ZTxEb2N1bWVudERBTz4oJ0RvY3VtZW50REFPJyk7XG4gICAgcmV0dXJuIG5ldyBEb2N1bWVudFNlcnZpY2UoZG9jdW1lbnREQU8sIG51bGwgYXMgYW55KTtcbiAgfSk7XG5cbiAgLy8g5rOo5YaMIENvbnRyb2xsZXJcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKEF1dGhDb250cm9sbGVyLCAoKSA9PiB7XG4gICAgY29uc3QgYXV0aFNlcnZpY2UgPSBDb250YWluZXIucmVzb2x2ZTxBdXRoU2VydmljZT4oQXV0aFNlcnZpY2UpO1xuICAgIHJldHVybiBuZXcgQXV0aENvbnRyb2xsZXIoYXV0aFNlcnZpY2UpO1xuICB9KTtcblxuICBDb250YWluZXIucmVnaXN0ZXIoRG9jdW1lbnRDb250cm9sbGVyLCAoKSA9PiB7XG4gICAgY29uc3QgZG9jdW1lbnRTZXJ2aWNlID0gQ29udGFpbmVyLnJlc29sdmU8RG9jdW1lbnRTZXJ2aWNlPihEb2N1bWVudFNlcnZpY2UpO1xuICAgIGNvbnN0IGF1dGhTZXJ2aWNlID0gQ29udGFpbmVyLnJlc29sdmU8QXV0aFNlcnZpY2U+KEF1dGhTZXJ2aWNlKTtcbiAgICByZXR1cm4gbmV3IERvY3VtZW50Q29udHJvbGxlcihkb2N1bWVudFNlcnZpY2UsIGF1dGhTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgQ29udGFpbmVyLnJlZ2lzdGVyKFdvcmtzcGFjZUNvbnRyb2xsZXIsICgpID0+IHtcbiAgICBjb25zdCB3b3Jrc3BhY2VEQU8gPSBDb250YWluZXIucmVzb2x2ZTxXb3Jrc3BhY2VEQU8+KCdXb3Jrc3BhY2VEQU8nKTtcbiAgICBjb25zdCBhdXRoU2VydmljZSA9IENvbnRhaW5lci5yZXNvbHZlPEF1dGhTZXJ2aWNlPihBdXRoU2VydmljZSk7XG4gICAgcmV0dXJuIG5ldyBXb3Jrc3BhY2VDb250cm9sbGVyKHdvcmtzcGFjZURBTywgYXV0aFNlcnZpY2UpO1xuICB9KTtcbn1cblxuLy8g6Ieq5Yqo5Yid5aeL5YyWXG5pbml0aWFsaXplQ29udGFpbmVyKCk7XG5cblxuXG5cbiJdLCJuYW1lcyI6WyJDb250YWluZXIiLCJVc2VyREFPIiwiRG9jdW1lbnREQU8iLCJXb3Jrc3BhY2VEQU8iLCJBdXRoU2VydmljZSIsIkRvY3VtZW50U2VydmljZSIsIkF1dGhDb250cm9sbGVyIiwiRG9jdW1lbnRDb250cm9sbGVyIiwiV29ya3NwYWNlQ29udHJvbGxlciIsImluaXRpYWxpemVDb250YWluZXIiLCJyZWdpc3RlciIsInVzZXJEQU8iLCJyZXNvbHZlIiwid29ya3NwYWNlREFPIiwiZG9jdW1lbnREQU8iLCJhdXRoU2VydmljZSIsImRvY3VtZW50U2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/init.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/redis.ts":
/*!***************************!*\
  !*** ./src/core/redis.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Redis: () => (/* binding */ Redis)\n/* harmony export */ });\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! redis */ \"(rsc)/../../node_modules/redis/dist/index.js\");\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(redis__WEBPACK_IMPORTED_MODULE_0__);\n\nclass Redis {\n    constructor(){\n        const url = process.env.REDIS_URL || \"redis://localhost:6379\";\n        this.client = (0,redis__WEBPACK_IMPORTED_MODULE_0__.createClient)({\n            url,\n            password:  false || undefined\n        });\n        this.client.on(\"error\", (err)=>{\n            console.error(\"Redis Client Error\", err);\n        });\n    }\n    static getInstance() {\n        if (!Redis.instance) {\n            Redis.instance = new Redis();\n        }\n        return Redis.instance;\n    }\n    async connect() {\n        if (!this.client.isOpen) {\n            await this.client.connect();\n        }\n    }\n    getClient() {\n        return this.client;\n    }\n    /**\n   * 设置缓存\n   */ async set(key, value, ttl) {\n        await this.connect();\n        if (ttl) {\n            await this.client.setEx(key, ttl, value);\n        } else {\n            await this.client.set(key, value);\n        }\n    }\n    /**\n   * 获取缓存\n   */ async get(key) {\n        await this.connect();\n        return await this.client.get(key);\n    }\n    /**\n   * 删除缓存\n   */ async del(key) {\n        await this.connect();\n        await this.client.del(key);\n    }\n    /**\n   * 设置 JSON 缓存\n   */ async setJSON(key, value, ttl) {\n        await this.set(key, JSON.stringify(value), ttl);\n    }\n    /**\n   * 获取 JSON 缓存\n   */ async getJSON(key) {\n        const value = await this.get(key);\n        if (!value) return null;\n        try {\n            return JSON.parse(value);\n        } catch  {\n            return null;\n        }\n    }\n    /**\n   * 关闭连接\n   */ async close() {\n        if (this.client.isOpen) {\n            await this.client.quit();\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9yZWRpcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBc0Q7QUFFL0MsTUFBTUM7SUFJWCxhQUFzQjtRQUNwQixNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFNBQVMsSUFBSTtRQUNyQyxJQUFJLENBQUNDLE1BQU0sR0FBR04sbURBQVlBLENBQUM7WUFDekJFO1lBQ0FLLFVBQVVKLE1BQTBCLElBQUlNO1FBQzFDO1FBRUEsSUFBSSxDQUFDSCxNQUFNLENBQUNJLEVBQUUsQ0FBQyxTQUFTLENBQUNDO1lBQ3ZCQyxRQUFRQyxLQUFLLENBQUMsc0JBQXNCRjtRQUN0QztJQUNGO0lBRUEsT0FBY0csY0FBcUI7UUFDakMsSUFBSSxDQUFDYixNQUFNYyxRQUFRLEVBQUU7WUFDbkJkLE1BQU1jLFFBQVEsR0FBRyxJQUFJZDtRQUN2QjtRQUNBLE9BQU9BLE1BQU1jLFFBQVE7SUFDdkI7SUFFQSxNQUFhQyxVQUF5QjtRQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDVixNQUFNLENBQUNXLE1BQU0sRUFBRTtZQUN2QixNQUFNLElBQUksQ0FBQ1gsTUFBTSxDQUFDVSxPQUFPO1FBQzNCO0lBQ0Y7SUFFT0UsWUFBNkI7UUFDbEMsT0FBTyxJQUFJLENBQUNaLE1BQU07SUFDcEI7SUFFQTs7R0FFQyxHQUNELE1BQWFhLElBQ1hDLEdBQVcsRUFDWEMsS0FBYSxFQUNiQyxHQUFZLEVBQ0c7UUFDZixNQUFNLElBQUksQ0FBQ04sT0FBTztRQUNsQixJQUFJTSxLQUFLO1lBQ1AsTUFBTSxJQUFJLENBQUNoQixNQUFNLENBQUNpQixLQUFLLENBQUNILEtBQUtFLEtBQUtEO1FBQ3BDLE9BQU87WUFDTCxNQUFNLElBQUksQ0FBQ2YsTUFBTSxDQUFDYSxHQUFHLENBQUNDLEtBQUtDO1FBQzdCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQWFHLElBQUlKLEdBQVcsRUFBMEI7UUFDcEQsTUFBTSxJQUFJLENBQUNKLE9BQU87UUFDbEIsT0FBTyxNQUFNLElBQUksQ0FBQ1YsTUFBTSxDQUFDa0IsR0FBRyxDQUFDSjtJQUMvQjtJQUVBOztHQUVDLEdBQ0QsTUFBYUssSUFBSUwsR0FBVyxFQUFpQjtRQUMzQyxNQUFNLElBQUksQ0FBQ0osT0FBTztRQUNsQixNQUFNLElBQUksQ0FBQ1YsTUFBTSxDQUFDbUIsR0FBRyxDQUFDTDtJQUN4QjtJQUVBOztHQUVDLEdBQ0QsTUFBYU0sUUFBV04sR0FBVyxFQUFFQyxLQUFRLEVBQUVDLEdBQVksRUFBaUI7UUFDMUUsTUFBTSxJQUFJLENBQUNILEdBQUcsQ0FBQ0MsS0FBS08sS0FBS0MsU0FBUyxDQUFDUCxRQUFRQztJQUM3QztJQUVBOztHQUVDLEdBQ0QsTUFBYU8sUUFBV1QsR0FBVyxFQUFxQjtRQUN0RCxNQUFNQyxRQUFRLE1BQU0sSUFBSSxDQUFDRyxHQUFHLENBQUNKO1FBQzdCLElBQUksQ0FBQ0MsT0FBTyxPQUFPO1FBQ25CLElBQUk7WUFDRixPQUFPTSxLQUFLRyxLQUFLLENBQUNUO1FBQ3BCLEVBQUUsT0FBTTtZQUNOLE9BQU87UUFDVDtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFhVSxRQUF1QjtRQUNsQyxJQUFJLElBQUksQ0FBQ3pCLE1BQU0sQ0FBQ1csTUFBTSxFQUFFO1lBQ3RCLE1BQU0sSUFBSSxDQUFDWCxNQUFNLENBQUMwQixJQUFJO1FBQ3hCO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9jb3JlL3JlZGlzLnRzPzFlMmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50LCBSZWRpc0NsaWVudFR5cGUgfSBmcm9tICdyZWRpcyc7XG5cbmV4cG9ydCBjbGFzcyBSZWRpcyB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBSZWRpcztcbiAgcHJpdmF0ZSBjbGllbnQ6IFJlZGlzQ2xpZW50VHlwZTtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IHVybCA9IHByb2Nlc3MuZW52LlJFRElTX1VSTCB8fCAncmVkaXM6Ly9sb2NhbGhvc3Q6NjM3OSc7XG4gICAgdGhpcy5jbGllbnQgPSBjcmVhdGVDbGllbnQoe1xuICAgICAgdXJsLFxuICAgICAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52LlJFRElTX1BBU1NXT1JEIHx8IHVuZGVmaW5lZCxcbiAgICB9KSBhcyBSZWRpc0NsaWVudFR5cGU7XG5cbiAgICB0aGlzLmNsaWVudC5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKCdSZWRpcyBDbGllbnQgRXJyb3InLCBlcnIpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBSZWRpcyB7XG4gICAgaWYgKCFSZWRpcy5pbnN0YW5jZSkge1xuICAgICAgUmVkaXMuaW5zdGFuY2UgPSBuZXcgUmVkaXMoKTtcbiAgICB9XG4gICAgcmV0dXJuIFJlZGlzLmluc3RhbmNlO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGNvbm5lY3QoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmNsaWVudC5pc09wZW4pIHtcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LmNvbm5lY3QoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0Q2xpZW50KCk6IFJlZGlzQ2xpZW50VHlwZSB7XG4gICAgcmV0dXJuIHRoaXMuY2xpZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOiuvue9rue8k+WtmFxuICAgKi9cbiAgcHVibGljIGFzeW5jIHNldChcbiAgICBrZXk6IHN0cmluZyxcbiAgICB2YWx1ZTogc3RyaW5nLFxuICAgIHR0bD86IG51bWJlclxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmNvbm5lY3QoKTtcbiAgICBpZiAodHRsKSB7XG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5zZXRFeChrZXksIHR0bCwgdmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlue8k+WtmFxuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldChrZXk6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNsaWVudC5nZXQoa2V5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTnvJPlrZhcbiAgICovXG4gIHB1YmxpYyBhc3luYyBkZWwoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmNvbm5lY3QoKTtcbiAgICBhd2FpdCB0aGlzLmNsaWVudC5kZWwoa2V5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDorr7nva4gSlNPTiDnvJPlrZhcbiAgICovXG4gIHB1YmxpYyBhc3luYyBzZXRKU09OPFQ+KGtleTogc3RyaW5nLCB2YWx1ZTogVCwgdHRsPzogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5zZXQoa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSksIHR0bCk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+WIEpTT04g57yT5a2YXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0SlNPTjxUPihrZXk6IHN0cmluZyk6IFByb21pc2U8VCB8IG51bGw+IHtcbiAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHRoaXMuZ2V0KGtleSk7XG4gICAgaWYgKCF2YWx1ZSkgcmV0dXJuIG51bGw7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKHZhbHVlKSBhcyBUO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWFs+mXrei/nuaOpVxuICAgKi9cbiAgcHVibGljIGFzeW5jIGNsb3NlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLmNsaWVudC5pc09wZW4pIHtcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnF1aXQoKTtcbiAgICB9XG4gIH1cbn1cblxuXG5cblxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsIlJlZGlzIiwidXJsIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsImNsaWVudCIsInBhc3N3b3JkIiwiUkVESVNfUEFTU1dPUkQiLCJ1bmRlZmluZWQiLCJvbiIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImdldEluc3RhbmNlIiwiaW5zdGFuY2UiLCJjb25uZWN0IiwiaXNPcGVuIiwiZ2V0Q2xpZW50Iiwic2V0Iiwia2V5IiwidmFsdWUiLCJ0dGwiLCJzZXRFeCIsImdldCIsImRlbCIsInNldEpTT04iLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0SlNPTiIsInBhcnNlIiwiY2xvc2UiLCJxdWl0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/core/redis.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/document.dao.ts":
/*!*********************************!*\
  !*** ./src/dao/document.dao.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentDAO: () => (/* binding */ DocumentDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass DocumentDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 创建文档\n   */ async create(document) {\n        const result = await this.db.query(`INSERT INTO pikun_db.documents (workspace_id, title, content, content_length, owner_uid, metadata)\n       VALUES ($1, $2, $3, $4, $5, $6)\n       RETURNING object_id, workspace_id, title, content, content_length, owner_uid, metadata, deleted_at, created_at, updated_at`, [\n            document.workspace_id,\n            document.title,\n            document.content,\n            document.content_length,\n            document.owner_uid,\n            JSON.stringify(document.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 根据 ID 查找文档\n   */ async findById(object_id) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.documents WHERE object_id = $1 AND deleted_at IS NULL\", [\n            object_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据工作空间 ID 查找文档列表\n   */ async findByWorkspaceId(workspace_id, options = {}) {\n        const page = options.page || 1;\n        const page_size = options.page_size || 20;\n        const sort_by = options.sort_by || \"updated_at\";\n        const order = options.order || \"desc\";\n        const offset = (page - 1) * page_size;\n        // 获取总数\n        const countResult = await this.db.query(\"SELECT COUNT(*) as count FROM pikun_db.documents WHERE workspace_id = $1 AND deleted_at IS NULL\", [\n            workspace_id\n        ]);\n        const total = parseInt(countResult.rows[0].count, 10);\n        // 获取文档列表（不包含 content，减少数据传输）\n        const result = await this.db.query(`SELECT object_id, workspace_id, title, content_length, owner_uid, metadata, deleted_at, created_at, updated_at\n       FROM pikun_db.documents\n       WHERE workspace_id = $1 AND deleted_at IS NULL\n       ORDER BY ${sort_by} ${order}\n       LIMIT $2 OFFSET $3`, [\n            workspace_id,\n            page_size,\n            offset\n        ]);\n        return {\n            documents: result.rows,\n            total\n        };\n    }\n    /**\n   * 更新文档\n   */ async update(object_id, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.title !== undefined) {\n            fields.push(`title = $${paramIndex++}`);\n            values.push(updates.title);\n        }\n        if (updates.content !== undefined) {\n            fields.push(`content = $${paramIndex++}`);\n            values.push(updates.content);\n        }\n        if (updates.content_length !== undefined) {\n            fields.push(`content_length = $${paramIndex++}`);\n            values.push(updates.content_length);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(object_id);\n        }\n        values.push(object_id);\n        const result = await this.db.query(`UPDATE pikun_db.documents SET ${fields.join(\", \")} WHERE object_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING object_id, workspace_id, title, content, content_length, owner_uid, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除文档（软删除）\n   */ async delete(object_id) {\n        await this.db.query(\"UPDATE pikun_db.documents SET deleted_at = CURRENT_TIMESTAMP WHERE object_id = $1\", [\n            object_id\n        ]);\n    }\n    /**\n   * 创建文档快照\n   */ async createSnapshot(snapshot) {\n        const created_at = Date.now();\n        const result = await this.db.query(`INSERT INTO pikun_db.document_snapshots (object_id, workspace_id, snapshot_data, snapshot_version, doc_state, doc_state_version, metadata, created_at)\n       VALUES ($1, $2, $3, $4, $5, $6, $7, $8)\n       RETURNING *`, [\n            snapshot.object_id,\n            snapshot.workspace_id,\n            snapshot.snapshot_data,\n            snapshot.snapshot_version,\n            snapshot.doc_state || null,\n            snapshot.doc_state_version || 1,\n            JSON.stringify(snapshot.metadata || {}),\n            created_at\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(object_id, options = {}) {\n        const limit = options.limit || 20;\n        const offset = options.offset || 0;\n        const countResult = await this.db.query(\"SELECT COUNT(*) as count FROM pikun_db.document_snapshots WHERE object_id = $1\", [\n            object_id\n        ]);\n        const total = parseInt(countResult.rows[0].count, 10);\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_snapshots\n       WHERE object_id = $1\n       ORDER BY created_at DESC\n       LIMIT $2 OFFSET $3`, [\n            object_id,\n            limit,\n            offset\n        ]);\n        return {\n            snapshots: result.rows,\n            total\n        };\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(object_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_snapshots\n       WHERE object_id = $1\n       ORDER BY created_at DESC\n       LIMIT 1`, [\n            object_id\n        ]);\n        return result.rows[0] || null;\n    }\n}\nDocumentDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"DocumentDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], DocumentDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGFvL2RvY3VtZW50LmRhby50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBMkM7QUFDb0I7QUFReEQsTUFBTUU7SUFHWEMsYUFBYztRQUNaLElBQUksQ0FBQ0MsRUFBRSxHQUFHSixvREFBUUEsQ0FBQ0ssV0FBVztJQUNoQztJQUVBOztHQUVDLEdBQ0QsTUFBTUMsT0FBT0MsUUFPWixFQUFxQjtRQUNwQixNQUFNQyxTQUFTLE1BQU0sSUFBSSxDQUFDSixFQUFFLENBQUNLLEtBQUssQ0FDaEMsQ0FBQzs7aUlBRTBILENBQUMsRUFDNUg7WUFDRUYsU0FBU0csWUFBWTtZQUNyQkgsU0FBU0ksS0FBSztZQUNkSixTQUFTSyxPQUFPO1lBQ2hCTCxTQUFTTSxjQUFjO1lBQ3ZCTixTQUFTTyxTQUFTO1lBQ2xCQyxLQUFLQyxTQUFTLENBQUNULFNBQVNVLFFBQVEsSUFBSSxDQUFDO1NBQ3RDO1FBRUgsT0FBT1QsT0FBT1UsSUFBSSxDQUFDLEVBQUU7SUFDdkI7SUFFQTs7R0FFQyxHQUNELE1BQU1DLFNBQVNDLFNBQWlCLEVBQTRCO1FBQzFELE1BQU1aLFNBQVMsTUFBTSxJQUFJLENBQUNKLEVBQUUsQ0FBQ0ssS0FBSyxDQUNoQyxnRkFDQTtZQUFDVztTQUFVO1FBRWIsT0FBT1osT0FBT1UsSUFBSSxDQUFDLEVBQUUsSUFBSTtJQUMzQjtJQUVBOztHQUVDLEdBQ0QsTUFBTUcsa0JBQ0pYLFlBQW9CLEVBQ3BCWSxVQUtJLENBQUMsQ0FBQyxFQUM2QztRQUNuRCxNQUFNQyxPQUFPRCxRQUFRQyxJQUFJLElBQUk7UUFDN0IsTUFBTUMsWUFBWUYsUUFBUUUsU0FBUyxJQUFJO1FBQ3ZDLE1BQU1DLFVBQVVILFFBQVFHLE9BQU8sSUFBSTtRQUNuQyxNQUFNQyxRQUFRSixRQUFRSSxLQUFLLElBQUk7UUFDL0IsTUFBTUMsU0FBUyxDQUFDSixPQUFPLEtBQUtDO1FBRTVCLE9BQU87UUFDUCxNQUFNSSxjQUFjLE1BQU0sSUFBSSxDQUFDeEIsRUFBRSxDQUFDSyxLQUFLLENBQ3JDLG1HQUNBO1lBQUNDO1NBQWE7UUFFaEIsTUFBTW1CLFFBQVFDLFNBQVNGLFlBQVlWLElBQUksQ0FBQyxFQUFFLENBQUNhLEtBQUssRUFBRTtRQUVsRCw2QkFBNkI7UUFDN0IsTUFBTXZCLFNBQVMsTUFBTSxJQUFJLENBQUNKLEVBQUUsQ0FBQ0ssS0FBSyxDQUNoQyxDQUFDOzs7Z0JBR1MsRUFBRWdCLFFBQVEsQ0FBQyxFQUFFQyxNQUFNO3lCQUNWLENBQUMsRUFDcEI7WUFBQ2hCO1lBQWNjO1lBQVdHO1NBQU87UUFHbkMsT0FBTztZQUNMSyxXQUFXeEIsT0FBT1UsSUFBSTtZQUN0Qlc7UUFDRjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFNSSxPQUNKYixTQUFpQixFQUNqQmMsT0FLQyxFQUNrQjtRQUNuQixNQUFNQyxTQUFtQixFQUFFO1FBQzNCLE1BQU1DLFNBQWdCLEVBQUU7UUFDeEIsSUFBSUMsYUFBYTtRQUVqQixJQUFJSCxRQUFRdkIsS0FBSyxLQUFLMkIsV0FBVztZQUMvQkgsT0FBT0ksSUFBSSxDQUFDLENBQUMsU0FBUyxFQUFFRixhQUFhLENBQUM7WUFDdENELE9BQU9HLElBQUksQ0FBQ0wsUUFBUXZCLEtBQUs7UUFDM0I7UUFDQSxJQUFJdUIsUUFBUXRCLE9BQU8sS0FBSzBCLFdBQVc7WUFDakNILE9BQU9JLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRUYsYUFBYSxDQUFDO1lBQ3hDRCxPQUFPRyxJQUFJLENBQUNMLFFBQVF0QixPQUFPO1FBQzdCO1FBQ0EsSUFBSXNCLFFBQVFyQixjQUFjLEtBQUt5QixXQUFXO1lBQ3hDSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxrQkFBa0IsRUFBRUYsYUFBYSxDQUFDO1lBQy9DRCxPQUFPRyxJQUFJLENBQUNMLFFBQVFyQixjQUFjO1FBQ3BDO1FBQ0EsSUFBSXFCLFFBQVFqQixRQUFRLEtBQUtxQixXQUFXO1lBQ2xDSCxPQUFPSSxJQUFJLENBQUMsQ0FBQyxZQUFZLEVBQUVGLGFBQWEsQ0FBQztZQUN6Q0QsT0FBT0csSUFBSSxDQUFDeEIsS0FBS0MsU0FBUyxDQUFDa0IsUUFBUWpCLFFBQVE7UUFDN0M7UUFFQSxJQUFJa0IsT0FBT0ssTUFBTSxLQUFLLEdBQUc7WUFDdkIsT0FBTyxJQUFJLENBQUNyQixRQUFRLENBQUNDO1FBQ3ZCO1FBRUFnQixPQUFPRyxJQUFJLENBQUNuQjtRQUNaLE1BQU1aLFNBQVMsTUFBTSxJQUFJLENBQUNKLEVBQUUsQ0FBQ0ssS0FBSyxDQUNoQyxDQUFDLDhCQUE4QixFQUFFMEIsT0FBT00sSUFBSSxDQUFDLE1BQU0sb0JBQW9CLEVBQUVKLFdBQVc7aUlBQ3VDLENBQUMsRUFDNUhEO1FBRUYsT0FBTzVCLE9BQU9VLElBQUksQ0FBQyxFQUFFO0lBQ3ZCO0lBRUE7O0dBRUMsR0FDRCxNQUFNd0IsT0FBT3RCLFNBQWlCLEVBQWlCO1FBQzdDLE1BQU0sSUFBSSxDQUFDaEIsRUFBRSxDQUFDSyxLQUFLLENBQ2pCLHFGQUNBO1lBQUNXO1NBQVU7SUFFZjtJQUVBOztHQUVDLEdBQ0QsTUFBTXVCLGVBQWVDLFFBUXBCLEVBQTZCO1FBQzVCLE1BQU1DLGFBQWFDLEtBQUtDLEdBQUc7UUFDM0IsTUFBTXZDLFNBQVMsTUFBTSxJQUFJLENBQUNKLEVBQUUsQ0FBQ0ssS0FBSyxDQUNoQyxDQUFDOztrQkFFVyxDQUFDLEVBQ2I7WUFDRW1DLFNBQVN4QixTQUFTO1lBQ2xCd0IsU0FBU2xDLFlBQVk7WUFDckJrQyxTQUFTSSxhQUFhO1lBQ3RCSixTQUFTSyxnQkFBZ0I7WUFDekJMLFNBQVNNLFNBQVMsSUFBSTtZQUN0Qk4sU0FBU08saUJBQWlCLElBQUk7WUFDOUJwQyxLQUFLQyxTQUFTLENBQUM0QixTQUFTM0IsUUFBUSxJQUFJLENBQUM7WUFDckM0QjtTQUNEO1FBRUgsT0FBT3JDLE9BQU9VLElBQUksQ0FBQyxFQUFFO0lBQ3ZCO0lBRUE7O0dBRUMsR0FDRCxNQUFNa0MsYUFDSmhDLFNBQWlCLEVBQ2pCRSxVQUErQyxDQUFDLENBQUMsRUFDVTtRQUMzRCxNQUFNK0IsUUFBUS9CLFFBQVErQixLQUFLLElBQUk7UUFDL0IsTUFBTTFCLFNBQVNMLFFBQVFLLE1BQU0sSUFBSTtRQUVqQyxNQUFNQyxjQUFjLE1BQU0sSUFBSSxDQUFDeEIsRUFBRSxDQUFDSyxLQUFLLENBQ3JDLGtGQUNBO1lBQUNXO1NBQVU7UUFFYixNQUFNUyxRQUFRQyxTQUFTRixZQUFZVixJQUFJLENBQUMsRUFBRSxDQUFDYSxLQUFLLEVBQUU7UUFFbEQsTUFBTXZCLFNBQVMsTUFBTSxJQUFJLENBQUNKLEVBQUUsQ0FBQ0ssS0FBSyxDQUNoQyxDQUFDOzs7eUJBR2tCLENBQUMsRUFDcEI7WUFBQ1c7WUFBV2lDO1lBQU8xQjtTQUFPO1FBRzVCLE9BQU87WUFDTDJCLFdBQVc5QyxPQUFPVSxJQUFJO1lBQ3RCVztRQUNGO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU0wQixrQkFBa0JuQyxTQUFpQixFQUFvQztRQUMzRSxNQUFNWixTQUFTLE1BQU0sSUFBSSxDQUFDSixFQUFFLENBQUNLLEtBQUssQ0FDaEMsQ0FBQzs7O2NBR08sQ0FBQyxFQUNUO1lBQUNXO1NBQVU7UUFFYixPQUFPWixPQUFPVSxJQUFJLENBQUMsRUFBRSxJQUFJO0lBQzNCO0FBQ0Y7QUF4TmFoQixjQUFBQSxvRUFBQUE7SUFEWkQsNEVBQVVBLENBQUM7OztHQUNDQyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9kYW8vZG9jdW1lbnQuZGFvLnRzPzQ2OTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IERvY3VtZW50LCBEb2N1bWVudFNuYXBzaG90IH0gZnJvbSAnQC9lbnRpdGllcyc7XG5cbi8qKlxuICog5paH5qGjIERBT1xuICog6LSf6LSj5paH5qGj55u45YWz55qE5pWw5o2u5bqT5pON5L2c77yM5L2/55So5Y+C5pWw5YyW5p+l6K+i6Ziy5q2iIFNRTCDms6jlhaVcbiAqL1xuQEluamVjdGFibGUoJ0RvY3VtZW50REFPJylcbmV4cG9ydCBjbGFzcyBEb2N1bWVudERBTyB7XG4gIHByaXZhdGUgZGI6IERhdGFiYXNlO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZGIgPSBEYXRhYmFzZS5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuaWh+aho1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlKGRvY3VtZW50OiB7XG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmc7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBjb250ZW50OiBCdWZmZXI7XG4gICAgY29udGVudF9sZW5ndGg6IG51bWJlcjtcbiAgICBvd25lcl91aWQ6IG51bWJlcjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPERvY3VtZW50PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudD4oXG4gICAgICBgSU5TRVJUIElOVE8gcGlrdW5fZGIuZG9jdW1lbnRzICh3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50LCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSlcbiAgICAgICBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYpXG4gICAgICAgUkVUVVJOSU5HIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCB0aXRsZSwgY29udGVudCwgY29udGVudF9sZW5ndGgsIG93bmVyX3VpZCwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRgLFxuICAgICAgW1xuICAgICAgICBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgIGRvY3VtZW50LnRpdGxlLFxuICAgICAgICBkb2N1bWVudC5jb250ZW50LFxuICAgICAgICBkb2N1bWVudC5jb250ZW50X2xlbmd0aCxcbiAgICAgICAgZG9jdW1lbnQub3duZXJfdWlkLFxuICAgICAgICBKU09OLnN0cmluZ2lmeShkb2N1bWVudC5tZXRhZGF0YSB8fCB7fSksXG4gICAgICBdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5qC55o2uIElEIOafpeaJvuaWh+aho1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5SWQob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPERvY3VtZW50IHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnQ+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIuZG9jdW1lbnRzIFdIRVJFIG9iamVjdF9pZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW29iamVjdF9pZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNruW3peS9nOepuumXtCBJRCDmn6Xmib7mlofmoaPliJfooahcbiAgICovXG4gIGFzeW5jIGZpbmRCeVdvcmtzcGFjZUlkKFxuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgICBwYWdlX3NpemU/OiBudW1iZXI7XG4gICAgICBzb3J0X2J5PzogJ2NyZWF0ZWRfYXQnIHwgJ3VwZGF0ZWRfYXQnIHwgJ3RpdGxlJztcbiAgICAgIG9yZGVyPzogJ2FzYycgfCAnZGVzYyc7XG4gICAgfSA9IHt9XG4gICk6IFByb21pc2U8eyBkb2N1bWVudHM6IERvY3VtZW50W107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IHBhZ2UgPSBvcHRpb25zLnBhZ2UgfHwgMTtcbiAgICBjb25zdCBwYWdlX3NpemUgPSBvcHRpb25zLnBhZ2Vfc2l6ZSB8fCAyMDtcbiAgICBjb25zdCBzb3J0X2J5ID0gb3B0aW9ucy5zb3J0X2J5IHx8ICd1cGRhdGVkX2F0JztcbiAgICBjb25zdCBvcmRlciA9IG9wdGlvbnMub3JkZXIgfHwgJ2Rlc2MnO1xuICAgIGNvbnN0IG9mZnNldCA9IChwYWdlIC0gMSkgKiBwYWdlX3NpemU7XG5cbiAgICAvLyDojrflj5bmgLvmlbBcbiAgICBjb25zdCBjb3VudFJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8eyBjb3VudDogc3RyaW5nIH0+KFxuICAgICAgJ1NFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NIHBpa3VuX2RiLmRvY3VtZW50cyBXSEVSRSB3b3Jrc3BhY2VfaWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt3b3Jrc3BhY2VfaWRdXG4gICAgKTtcbiAgICBjb25zdCB0b3RhbCA9IHBhcnNlSW50KGNvdW50UmVzdWx0LnJvd3NbMF0uY291bnQsIDEwKTtcblxuICAgIC8vIOiOt+WPluaWh+aho+WIl+ihqO+8iOS4jeWMheWQqyBjb250ZW5077yM5YeP5bCR5pWw5o2u5Lyg6L6T77yJXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudD4oXG4gICAgICBgU0VMRUNUIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCB0aXRsZSwgY29udGVudF9sZW5ndGgsIG93bmVyX3VpZCwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRcbiAgICAgICBGUk9NIHBpa3VuX2RiLmRvY3VtZW50c1xuICAgICAgIFdIRVJFIHdvcmtzcGFjZV9pZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBPUkRFUiBCWSAke3NvcnRfYnl9ICR7b3JkZXJ9XG4gICAgICAgTElNSVQgJDIgT0ZGU0VUICQzYCxcbiAgICAgIFt3b3Jrc3BhY2VfaWQsIHBhZ2Vfc2l6ZSwgb2Zmc2V0XVxuICAgICk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZG9jdW1lbnRzOiByZXN1bHQucm93cyxcbiAgICAgIHRvdGFsLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog5pu05paw5paH5qGjXG4gICAqL1xuICBhc3luYyB1cGRhdGUoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgdXBkYXRlczoge1xuICAgICAgdGl0bGU/OiBzdHJpbmc7XG4gICAgICBjb250ZW50PzogQnVmZmVyO1xuICAgICAgY29udGVudF9sZW5ndGg/OiBudW1iZXI7XG4gICAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gICAgfVxuICApOiBQcm9taXNlPERvY3VtZW50PiB7XG4gICAgY29uc3QgZmllbGRzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHZhbHVlczogYW55W10gPSBbXTtcbiAgICBsZXQgcGFyYW1JbmRleCA9IDE7XG5cbiAgICBpZiAodXBkYXRlcy50aXRsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgdGl0bGUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnRpdGxlKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuY29udGVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgY29udGVudCA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMuY29udGVudCk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLmNvbnRlbnRfbGVuZ3RoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBjb250ZW50X2xlbmd0aCA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMuY29udGVudF9sZW5ndGgpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5tZXRhZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgbWV0YWRhdGEgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaChKU09OLnN0cmluZ2lmeSh1cGRhdGVzLm1ldGFkYXRhKSk7XG4gICAgfVxuXG4gICAgaWYgKGZpZWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbmRCeUlkKG9iamVjdF9pZCkgYXMgUHJvbWlzZTxEb2N1bWVudD47XG4gICAgfVxuXG4gICAgdmFsdWVzLnB1c2gob2JqZWN0X2lkKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PERvY3VtZW50PihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIuZG9jdW1lbnRzIFNFVCAke2ZpZWxkcy5qb2luKCcsICcpfSBXSEVSRSBvYmplY3RfaWQgPSAkJHtwYXJhbUluZGV4fSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMXG4gICAgICAgUkVUVVJOSU5HIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCB0aXRsZSwgY29udGVudCwgY29udGVudF9sZW5ndGgsIG93bmVyX3VpZCwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5paH5qGj77yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi5kb2N1bWVudHMgU0VUIGRlbGV0ZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUCBXSEVSRSBvYmplY3RfaWQgPSAkMScsXG4gICAgICBbb2JqZWN0X2lkXVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65paH5qGj5b+r54WnXG4gICAqL1xuICBhc3luYyBjcmVhdGVTbmFwc2hvdChzbmFwc2hvdDoge1xuICAgIG9iamVjdF9pZDogc3RyaW5nO1xuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nO1xuICAgIHNuYXBzaG90X2RhdGE6IEJ1ZmZlcjtcbiAgICBzbmFwc2hvdF92ZXJzaW9uOiBudW1iZXI7XG4gICAgZG9jX3N0YXRlPzogQnVmZmVyO1xuICAgIGRvY19zdGF0ZV92ZXJzaW9uPzogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8RG9jdW1lbnRTbmFwc2hvdD4ge1xuICAgIGNvbnN0IGNyZWF0ZWRfYXQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRTbmFwc2hvdD4oXG4gICAgICBgSU5TRVJUIElOVE8gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIChvYmplY3RfaWQsIHdvcmtzcGFjZV9pZCwgc25hcHNob3RfZGF0YSwgc25hcHNob3RfdmVyc2lvbiwgZG9jX3N0YXRlLCBkb2Nfc3RhdGVfdmVyc2lvbiwgbWV0YWRhdGEsIGNyZWF0ZWRfYXQpXG4gICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgpXG4gICAgICAgUkVUVVJOSU5HICpgLFxuICAgICAgW1xuICAgICAgICBzbmFwc2hvdC5vYmplY3RfaWQsXG4gICAgICAgIHNuYXBzaG90LndvcmtzcGFjZV9pZCxcbiAgICAgICAgc25hcHNob3Quc25hcHNob3RfZGF0YSxcbiAgICAgICAgc25hcHNob3Quc25hcHNob3RfdmVyc2lvbixcbiAgICAgICAgc25hcHNob3QuZG9jX3N0YXRlIHx8IG51bGwsXG4gICAgICAgIHNuYXBzaG90LmRvY19zdGF0ZV92ZXJzaW9uIHx8IDEsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHNuYXBzaG90Lm1ldGFkYXRhIHx8IHt9KSxcbiAgICAgICAgY3JlYXRlZF9hdCxcbiAgICAgIF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPlv6vnhafliJfooahcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90cyhcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSA9IHt9XG4gICk6IFByb21pc2U8eyBzbmFwc2hvdHM6IERvY3VtZW50U25hcHNob3RbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgY29uc3QgbGltaXQgPSBvcHRpb25zLmxpbWl0IHx8IDIwO1xuICAgIGNvbnN0IG9mZnNldCA9IG9wdGlvbnMub2Zmc2V0IHx8IDA7XG5cbiAgICBjb25zdCBjb3VudFJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8eyBjb3VudDogc3RyaW5nIH0+KFxuICAgICAgJ1NFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X3NuYXBzaG90cyBXSEVSRSBvYmplY3RfaWQgPSAkMScsXG4gICAgICBbb2JqZWN0X2lkXVxuICAgICk7XG4gICAgY29uc3QgdG90YWwgPSBwYXJzZUludChjb3VudFJlc3VsdC5yb3dzWzBdLmNvdW50LCAxMCk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PERvY3VtZW50U25hcHNob3Q+KFxuICAgICAgYFNFTEVDVCAqIEZST00gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzXG4gICAgICAgV0hFUkUgb2JqZWN0X2lkID0gJDFcbiAgICAgICBPUkRFUiBCWSBjcmVhdGVkX2F0IERFU0NcbiAgICAgICBMSU1JVCAkMiBPRkZTRVQgJDNgLFxuICAgICAgW29iamVjdF9pZCwgbGltaXQsIG9mZnNldF1cbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHNuYXBzaG90czogcmVzdWx0LnJvd3MsXG4gICAgICB0b3RhbCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluacgOaWsOW/q+eFp1xuICAgKi9cbiAgYXN5bmMgZ2V0TGF0ZXN0U25hcHNob3Qob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPERvY3VtZW50U25hcHNob3QgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudFNuYXBzaG90PihcbiAgICAgIGBTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X3NuYXBzaG90c1xuICAgICAgIFdIRVJFIG9iamVjdF9pZCA9ICQxXG4gICAgICAgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDXG4gICAgICAgTElNSVQgMWAsXG4gICAgICBbb2JqZWN0X2lkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIkRhdGFiYXNlIiwiSW5qZWN0YWJsZSIsIkRvY3VtZW50REFPIiwiY29uc3RydWN0b3IiLCJkYiIsImdldEluc3RhbmNlIiwiY3JlYXRlIiwiZG9jdW1lbnQiLCJyZXN1bHQiLCJxdWVyeSIsIndvcmtzcGFjZV9pZCIsInRpdGxlIiwiY29udGVudCIsImNvbnRlbnRfbGVuZ3RoIiwib3duZXJfdWlkIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwicm93cyIsImZpbmRCeUlkIiwib2JqZWN0X2lkIiwiZmluZEJ5V29ya3NwYWNlSWQiLCJvcHRpb25zIiwicGFnZSIsInBhZ2Vfc2l6ZSIsInNvcnRfYnkiLCJvcmRlciIsIm9mZnNldCIsImNvdW50UmVzdWx0IiwidG90YWwiLCJwYXJzZUludCIsImNvdW50IiwiZG9jdW1lbnRzIiwidXBkYXRlIiwidXBkYXRlcyIsImZpZWxkcyIsInZhbHVlcyIsInBhcmFtSW5kZXgiLCJ1bmRlZmluZWQiLCJwdXNoIiwibGVuZ3RoIiwiam9pbiIsImRlbGV0ZSIsImNyZWF0ZVNuYXBzaG90Iiwic25hcHNob3QiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsIm5vdyIsInNuYXBzaG90X2RhdGEiLCJzbmFwc2hvdF92ZXJzaW9uIiwiZG9jX3N0YXRlIiwiZG9jX3N0YXRlX3ZlcnNpb24iLCJnZXRTbmFwc2hvdHMiLCJsaW1pdCIsInNuYXBzaG90cyIsImdldExhdGVzdFNuYXBzaG90Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/document.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/user.dao.ts":
/*!*****************************!*\
  !*** ./src/dao/user.dao.ts ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserDAO: () => (/* binding */ UserDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass UserDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 根据邮箱查找用户\n   */ async findByEmail(email) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.users WHERE email = $1 AND deleted_at IS NULL\", [\n            email\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 UUID 查找用户\n   */ async findByUuid(uuid) {\n        const result = await this.db.query(\"SELECT uid, uuid, email, name, metadata, deleted_at, created_at, updated_at FROM pikun_db.users WHERE uuid = $1 AND deleted_at IS NULL\", [\n            uuid\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 UID 查找用户\n   */ async findByUid(uid) {\n        const result = await this.db.query(\"SELECT uid, uuid, email, name, metadata, deleted_at, created_at, updated_at FROM pikun_db.users WHERE uid = $1 AND deleted_at IS NULL\", [\n            uid\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 创建用户\n   */ async create(user) {\n        const result = await this.db.query(`INSERT INTO pikun_db.users (email, password, name, metadata)\n       VALUES ($1, $2, $3, $4)\n       RETURNING uid, uuid, email, name, metadata, deleted_at, created_at, updated_at`, [\n            user.email,\n            user.password,\n            user.name,\n            JSON.stringify(user.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 更新用户信息\n   */ async update(uid, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.email !== undefined) {\n            fields.push(`email = $${paramIndex++}`);\n            values.push(updates.email);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findByUid(uid);\n        }\n        values.push(uid);\n        const result = await this.db.query(`UPDATE pikun_db.users SET ${fields.join(\", \")} WHERE uid = $${paramIndex} AND deleted_at IS NULL\n       RETURNING uid, uuid, email, name, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除用户（软删除）\n   */ async delete(uid) {\n        await this.db.query(\"UPDATE pikun_db.users SET deleted_at = CURRENT_TIMESTAMP WHERE uid = $1\", [\n            uid\n        ]);\n    }\n}\nUserDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"UserDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], UserDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvZGFvL3VzZXIuZGFvLnRzPzYyODQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IFVzZXIsIERvY3VtZW50LCBEb2N1bWVudFNuYXBzaG90LCBXb3Jrc3BhY2UgfSBmcm9tICdAL2VudGl0aWVzJztcblxuLyoqXG4gKiDnlKjmiLcgREFPXG4gKiDotJ/otKPnlKjmiLfnm7jlhbPnmoTmlbDmja7lupPmk43kvZzvvIzkvb/nlKjlj4LmlbDljJbmn6Xor6LpmLLmraIgU1FMIOazqOWFpVxuICovXG5ASW5qZWN0YWJsZSgnVXNlckRBTycpXG5leHBvcnQgY2xhc3MgVXNlckRBTyB7XG4gIHByaXZhdGUgZGI6IERhdGFiYXNlO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZGIgPSBEYXRhYmFzZS5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNrumCrueuseafpeaJvueUqOaIt1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXI+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIudXNlcnMgV0hFUkUgZW1haWwgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFtlbWFpbF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBVVUlEIOafpeaJvueUqOaIt1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5VXVpZCh1dWlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxVc2VyPihcbiAgICAgICdTRUxFQ1QgdWlkLCB1dWlkLCBlbWFpbCwgbmFtZSwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQgRlJPTSBwaWt1bl9kYi51c2VycyBXSEVSRSB1dWlkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbdXVpZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBVSUQg5p+l5om+55So5oi3XG4gICAqL1xuICBhc3luYyBmaW5kQnlVaWQodWlkOiBudW1iZXIpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxVc2VyPihcbiAgICAgICdTRUxFQ1QgdWlkLCB1dWlkLCBlbWFpbCwgbmFtZSwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQgRlJPTSBwaWt1bl9kYi51c2VycyBXSEVSRSB1aWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt1aWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rnlKjmiLdcbiAgICovXG4gIGFzeW5jIGNyZWF0ZSh1c2VyOiB7XG4gICAgZW1haWw6IHN0cmluZztcbiAgICBwYXNzd29yZDogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFVzZXI+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXI+KFxuICAgICAgYElOU0VSVCBJTlRPIHBpa3VuX2RiLnVzZXJzIChlbWFpbCwgcGFzc3dvcmQsIG5hbWUsIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQpXG4gICAgICAgUkVUVVJOSU5HIHVpZCwgdXVpZCwgZW1haWwsIG5hbWUsIG1ldGFkYXRhLCBkZWxldGVkX2F0LCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0YCxcbiAgICAgIFt1c2VyLmVtYWlsLCB1c2VyLnBhc3N3b3JkLCB1c2VyLm5hbWUsIEpTT04uc3RyaW5naWZ5KHVzZXIubWV0YWRhdGEgfHwge30pXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOeUqOaIt+S/oeaBr1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlKHVpZDogbnVtYmVyLCB1cGRhdGVzOiB7XG4gICAgbmFtZT86IHN0cmluZztcbiAgICBlbWFpbD86IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFVzZXI+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLm5hbWUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5lbWFpbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgZW1haWwgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmVtYWlsKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlVaWQodWlkKSBhcyBQcm9taXNlPFVzZXI+O1xuICAgIH1cblxuICAgIHZhbHVlcy5wdXNoKHVpZCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxVc2VyPihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIudXNlcnMgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIHVpZCA9ICQke3BhcmFtSW5kZXh9IEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBSRVRVUk5JTkcgdWlkLCB1dWlkLCBlbWFpbCwgbmFtZSwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk55So5oi377yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUodWlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi51c2VycyBTRVQgZGVsZXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QIFdIRVJFIHVpZCA9ICQxJyxcbiAgICAgIFt1aWRdXG4gICAgKTtcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiRGF0YWJhc2UiLCJJbmplY3RhYmxlIiwiVXNlckRBTyIsImNvbnN0cnVjdG9yIiwiZGIiLCJnZXRJbnN0YW5jZSIsImZpbmRCeUVtYWlsIiwiZW1haWwiLCJyZXN1bHQiLCJxdWVyeSIsInJvd3MiLCJmaW5kQnlVdWlkIiwidXVpZCIsImZpbmRCeVVpZCIsInVpZCIsImNyZWF0ZSIsInVzZXIiLCJwYXNzd29yZCIsIm5hbWUiLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YWRhdGEiLCJ1cGRhdGUiLCJ1cGRhdGVzIiwiZmllbGRzIiwidmFsdWVzIiwicGFyYW1JbmRleCIsInVuZGVmaW5lZCIsInB1c2giLCJsZW5ndGgiLCJqb2luIiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/user.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/workspace.dao.ts":
/*!**********************************!*\
  !*** ./src/dao/workspace.dao.ts ***!
  \**********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WorkspaceDAO: () => (/* binding */ WorkspaceDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass WorkspaceDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 创建工作空间\n   */ async create(workspace) {\n        const result = await this.db.query(`INSERT INTO pikun_db.workspaces (name, owner_uid, icon, metadata)\n       VALUES ($1, $2, $3, $4)\n       RETURNING workspace_id, name, owner_uid, icon, metadata, deleted_at, created_at, updated_at`, [\n            workspace.name,\n            workspace.owner_uid,\n            workspace.icon || null,\n            JSON.stringify(workspace.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 根据 ID 查找工作空间\n   */ async findById(workspace_id) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.workspaces WHERE workspace_id = $1 AND deleted_at IS NULL\", [\n            workspace_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据用户 ID 查找用户的所有工作空间\n   */ async findByOwnerUid(owner_uid) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.workspaces WHERE owner_uid = $1 AND deleted_at IS NULL ORDER BY created_at DESC\", [\n            owner_uid\n        ]);\n        return result.rows;\n    }\n    /**\n   * 获取用户的默认工作空间（第一个工作空间或创建新的）\n   */ async getOrCreateDefault(owner_uid) {\n        // 先查找用户的工作空间\n        const workspaces = await this.findByOwnerUid(owner_uid);\n        if (workspaces.length > 0) {\n            return workspaces[0];\n        }\n        // 如果没有，创建默认工作空间\n        return await this.create({\n            name: \"我的工作空间\",\n            owner_uid\n        });\n    }\n    /**\n   * 更新工作空间\n   */ async update(workspace_id, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.icon !== undefined) {\n            fields.push(`icon = $${paramIndex++}`);\n            values.push(updates.icon);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(workspace_id);\n        }\n        values.push(workspace_id);\n        const result = await this.db.query(`UPDATE pikun_db.workspaces SET ${fields.join(\", \")} WHERE workspace_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING workspace_id, name, owner_uid, icon, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除工作空间（软删除）\n   */ async delete(workspace_id) {\n        await this.db.query(\"UPDATE pikun_db.workspaces SET deleted_at = CURRENT_TIMESTAMP WHERE workspace_id = $1\", [\n            workspace_id\n        ]);\n    }\n}\nWorkspaceDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"WorkspaceDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], WorkspaceDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDSyxLQUFLLENBQ2pCLHlGQUNBO1lBQUNTO1NBQWE7SUFFbEI7QUFDRjtBQXZIYWhCLGVBQUFBLG9FQUFBQTtJQURaRCw0RUFBVUEsQ0FBQzs7O0dBQ0NDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2Rhby93b3Jrc3BhY2UuZGFvLnRzP2VlOGMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IFdvcmtzcGFjZSB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOW3peS9nOepuumXtCBEQU9cbiAqIOi0n+i0o+W3peS9nOepuumXtOebuOWFs+eahOaVsOaNruW6k+aTjeS9nFxuICovXG5ASW5qZWN0YWJsZSgnV29ya3NwYWNlREFPJylcbmV4cG9ydCBjbGFzcyBXb3Jrc3BhY2VEQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGNyZWF0ZSh3b3Jrc3BhY2U6IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgb3duZXJfdWlkOiBudW1iZXI7XG4gICAgaWNvbj86IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFdvcmtzcGFjZT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8V29ya3NwYWNlPihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi53b3Jrc3BhY2VzIChuYW1lLCBvd25lcl91aWQsIGljb24sIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQpXG4gICAgICAgUkVUVVJOSU5HIHdvcmtzcGFjZV9pZCwgbmFtZSwgb3duZXJfdWlkLCBpY29uLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICBbXG4gICAgICAgIHdvcmtzcGFjZS5uYW1lLFxuICAgICAgICB3b3Jrc3BhY2Uub3duZXJfdWlkLFxuICAgICAgICB3b3Jrc3BhY2UuaWNvbiB8fCBudWxsLFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh3b3Jrc3BhY2UubWV0YWRhdGEgfHwge30pLFxuICAgICAgXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBJRCDmn6Xmib7lt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGZpbmRCeUlkKHdvcmtzcGFjZV9pZDogc3RyaW5nKTogUHJvbWlzZTxXb3Jrc3BhY2UgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxXb3Jrc3BhY2U+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIud29ya3NwYWNlcyBXSEVSRSB3b3Jrc3BhY2VfaWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt3b3Jrc3BhY2VfaWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7nlKjmiLcgSUQg5p+l5om+55So5oi355qE5omA5pyJ5bel5L2c56m66Ze0XG4gICAqL1xuICBhc3luYyBmaW5kQnlPd25lclVpZChvd25lcl91aWQ6IG51bWJlcik6IFByb21pc2U8V29ya3NwYWNlW10+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFdvcmtzcGFjZT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi53b3Jrc3BhY2VzIFdIRVJFIG93bmVyX3VpZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDJyxcbiAgICAgIFtvd25lcl91aWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3M7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE6buY6K6k5bel5L2c56m66Ze077yI56ys5LiA5Liq5bel5L2c56m66Ze05oiW5Yib5bu65paw55qE77yJXG4gICAqL1xuICBhc3luYyBnZXRPckNyZWF0ZURlZmF1bHQob3duZXJfdWlkOiBudW1iZXIpOiBQcm9taXNlPFdvcmtzcGFjZT4ge1xuICAgIC8vIOWFiOafpeaJvueUqOaIt+eahOW3peS9nOepuumXtFxuICAgIGNvbnN0IHdvcmtzcGFjZXMgPSBhd2FpdCB0aGlzLmZpbmRCeU93bmVyVWlkKG93bmVyX3VpZCk7XG4gICAgaWYgKHdvcmtzcGFjZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHdvcmtzcGFjZXNbMF07XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5rKh5pyJ77yM5Yib5bu66buY6K6k5bel5L2c56m66Ze0XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY3JlYXRlKHtcbiAgICAgIG5hbWU6ICfmiJHnmoTlt6XkvZznqbrpl7QnLFxuICAgICAgb3duZXJfdWlkLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOW3peS9nOepuumXtFxuICAgKi9cbiAgYXN5bmMgdXBkYXRlKFxuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IHtcbiAgICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgICBpY29uPzogc3RyaW5nO1xuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIH1cbiAgKTogUHJvbWlzZTxXb3Jrc3BhY2U+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLm5hbWUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5pY29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBpY29uID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5pY29uKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlJZCh3b3Jrc3BhY2VfaWQpIGFzIFByb21pc2U8V29ya3NwYWNlPjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaCh3b3Jrc3BhY2VfaWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8V29ya3NwYWNlPihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIud29ya3NwYWNlcyBTRVQgJHtmaWVsZHMuam9pbignLCAnKX0gV0hFUkUgd29ya3NwYWNlX2lkID0gJCR7cGFyYW1JbmRleH0gQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTFxuICAgICAgIFJFVFVSTklORyB3b3Jrc3BhY2VfaWQsIG5hbWUsIG93bmVyX3VpZCwgaWNvbiwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5bel5L2c56m66Ze077yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUod29ya3NwYWNlX2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi53b3Jrc3BhY2VzIFNFVCBkZWxldGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgd29ya3NwYWNlX2lkID0gJDEnLFxuICAgICAgW3dvcmtzcGFjZV9pZF1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJEYXRhYmFzZSIsIkluamVjdGFibGUiLCJXb3Jrc3BhY2VEQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJjcmVhdGUiLCJ3b3Jrc3BhY2UiLCJyZXN1bHQiLCJxdWVyeSIsIm5hbWUiLCJvd25lcl91aWQiLCJpY29uIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwicm93cyIsImZpbmRCeUlkIiwid29ya3NwYWNlX2lkIiwiZmluZEJ5T3duZXJVaWQiLCJnZXRPckNyZWF0ZURlZmF1bHQiLCJ3b3Jrc3BhY2VzIiwibGVuZ3RoIiwidXBkYXRlIiwidXBkYXRlcyIsImZpZWxkcyIsInZhbHVlcyIsInBhcmFtSW5kZXgiLCJ1bmRlZmluZWQiLCJwdXNoIiwiam9pbiIsImRlbGV0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/workspace.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/decorators/injectable.decorator.ts":
/*!************************************************!*\
  !*** ./src/decorators/injectable.decorator.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Inject: () => (/* binding */ Inject),\n/* harmony export */   Injectable: () => (/* binding */ Injectable)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\n * 可注入装饰器\n * 标记类可以被依赖注入容器管理\n */ function Injectable(token) {\n    return function(target) {\n        Reflect.defineMetadata(\"injectable\", true, target);\n        if (token) {\n            Reflect.defineMetadata(\"injectionToken\", token, target);\n        }\n    };\n}\n/**\n * 注入依赖装饰器\n */ function Inject(token) {\n    return function(target, propertyKey, parameterIndex) {\n        const existingTokens = Reflect.getMetadata(\"injections\", target) || [];\n        existingTokens.push({\n            index: parameterIndex,\n            token\n        });\n        Reflect.defineMetadata(\"injections\", existingTokens, target);\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTBCO0FBRTFCOzs7Q0FHQyxHQUNNLFNBQVNBLFdBQVdDLEtBQXVCO0lBQ2hELE9BQU8sU0FBVUMsTUFBVztRQUMxQkMsUUFBUUMsY0FBYyxDQUFDLGNBQWMsTUFBTUY7UUFDM0MsSUFBSUQsT0FBTztZQUNURSxRQUFRQyxjQUFjLENBQUMsa0JBQWtCSCxPQUFPQztRQUNsRDtJQUNGO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLFNBQVNHLE9BQU9KLEtBQXNCO0lBQzNDLE9BQU8sU0FBVUMsTUFBVyxFQUFFSSxXQUF3QyxFQUFFQyxjQUFzQjtRQUM1RixNQUFNQyxpQkFBaUJMLFFBQVFNLFdBQVcsQ0FBQyxjQUFjUCxXQUFXLEVBQUU7UUFDdEVNLGVBQWVFLElBQUksQ0FBQztZQUFFQyxPQUFPSjtZQUFnQk47UUFBTTtRQUNuREUsUUFBUUMsY0FBYyxDQUFDLGNBQWNJLGdCQUFnQk47SUFDdkQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yLnRzPzZhMzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcblxuLyoqXG4gKiDlj6/ms6jlhaXoo4XppbDlmahcbiAqIOagh+iusOexu+WPr+S7peiiq+S+nei1luazqOWFpeWuueWZqOeuoeeQhlxuICovXG5leHBvcnQgZnVuY3Rpb24gSW5qZWN0YWJsZSh0b2tlbj86IHN0cmluZyB8IHN5bWJvbCk6IENsYXNzRGVjb3JhdG9yIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQ6IGFueSkge1xuICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoJ2luamVjdGFibGUnLCB0cnVlLCB0YXJnZXQpO1xuICAgIGlmICh0b2tlbikge1xuICAgICAgUmVmbGVjdC5kZWZpbmVNZXRhZGF0YSgnaW5qZWN0aW9uVG9rZW4nLCB0b2tlbiwgdGFyZ2V0KTtcbiAgICB9XG4gIH07XG59XG5cbi8qKlxuICog5rOo5YWl5L6d6LWW6KOF6aWw5ZmoXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBJbmplY3QodG9rZW46IHN0cmluZyB8IHN5bWJvbCk6IFBhcmFtZXRlckRlY29yYXRvciB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcgfCBzeW1ib2wgfCB1bmRlZmluZWQsIHBhcmFtZXRlckluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBleGlzdGluZ1Rva2VucyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ2luamVjdGlvbnMnLCB0YXJnZXQpIHx8IFtdO1xuICAgIGV4aXN0aW5nVG9rZW5zLnB1c2goeyBpbmRleDogcGFyYW1ldGVySW5kZXgsIHRva2VuIH0pO1xuICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoJ2luamVjdGlvbnMnLCBleGlzdGluZ1Rva2VucywgdGFyZ2V0KTtcbiAgfTtcbn1cblxuXG5cblxuIl0sIm5hbWVzIjpbIkluamVjdGFibGUiLCJ0b2tlbiIsInRhcmdldCIsIlJlZmxlY3QiLCJkZWZpbmVNZXRhZGF0YSIsIkluamVjdCIsInByb3BlcnR5S2V5IiwicGFyYW1ldGVySW5kZXgiLCJleGlzdGluZ1Rva2VucyIsImdldE1ldGFkYXRhIiwicHVzaCIsImluZGV4Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/decorators/injectable.decorator.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/auth.service.ts":
/*!**************************************!*\
  !*** ./src/services/auth.service.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthService: () => (/* binding */ AuthService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/../../node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/../../node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/user.dao */ \"(rsc)/./src/dao/user.dao.ts\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _core_redis__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/core/redis */ \"(rsc)/./src/core/redis.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__]);\n([_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\nclass AuthService {\n    constructor(userDAO, workspaceDAO, redis){\n        this.userDAO = userDAO;\n        this.workspaceDAO = workspaceDAO;\n        this.redis = redis;\n        this.redis = _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis.getInstance();\n    }\n    /**\n   * 用户注册\n   */ async register(data) {\n        // 检查邮箱是否已存在\n        const existingUser = await this.userDAO.findByEmail(data.email);\n        if (existingUser) {\n            throw new Error(\"Email already exists\");\n        }\n        // 加密密码\n        const hashedPassword = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().hash(data.password, 10);\n        // 创建用户\n        const user = await this.userDAO.create({\n            email: data.email,\n            password: hashedPassword,\n            name: data.name\n        });\n        // 创建默认工作空间\n        const defaultWorkspace = await this.workspaceDAO.create({\n            name: \"我的工作空间\",\n            owner_uid: user.uid\n        });\n        // 生成 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const refreshToken = this.generateRefreshToken(user.uid);\n        // 保存刷新令牌到数据库（这里简化处理，实际应该保存到数据库）\n        await this.redis.set(`refresh_token:${refreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60); // 30天\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { password, ...userWithoutPassword } = user;\n        return {\n            user: userWithoutPassword,\n            token,\n            refreshToken,\n            defaultWorkspaceId: defaultWorkspace.workspace_id\n        };\n    }\n    /**\n   * 用户登录\n   */ async login(email, password) {\n        const user = await this.userDAO.findByEmail(email);\n        if (!user) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 验证密码\n        const isValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(password, user.password);\n        if (!isValid) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 获取或创建默认工作空间\n        const defaultWorkspace = await this.workspaceDAO.getOrCreateDefault(user.uid);\n        // 生成 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const refreshToken = this.generateRefreshToken(user.uid);\n        // 保存刷新令牌\n        await this.redis.set(`refresh_token:${refreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60);\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { password: _, ...userWithoutPassword } = user;\n        return {\n            user: userWithoutPassword,\n            token,\n            refreshToken,\n            defaultWorkspaceId: defaultWorkspace.workspace_id\n        };\n    }\n    /**\n   * 刷新 token\n   */ async refreshToken(refreshToken) {\n        const uidStr = await this.redis.get(`refresh_token:${refreshToken}`);\n        if (!uidStr) {\n            throw new Error(\"Invalid refresh token\");\n        }\n        const uid = parseInt(uidStr, 10);\n        const user = await this.userDAO.findByUid(uid);\n        if (!user) {\n            throw new Error(\"User not found\");\n        }\n        // 生成新 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const newRefreshToken = this.generateRefreshToken(user.uid);\n        // 更新刷新令牌\n        await this.redis.del(`refresh_token:${refreshToken}`);\n        await this.redis.set(`refresh_token:${newRefreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60);\n        return {\n            token,\n            refreshToken: newRefreshToken\n        };\n    }\n    /**\n   * 验证 token\n   */ async verifyToken(token) {\n        try {\n            const secret = \"ef217e004bfb6ce72899d87b36166a48268747313d7dd1c9be293b3fd7ad557d\" || 0;\n            const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().verify(token, secret);\n            return decoded;\n        } catch  {\n            throw new Error(\"Invalid token\");\n        }\n    }\n    /**\n   * 生成 JWT token\n   */ generateToken(uid, uuid) {\n        const secret = \"ef217e004bfb6ce72899d87b36166a48268747313d7dd1c9be293b3fd7ad557d\" || 0;\n        const expiresIn = \"7d\" || 0;\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().sign({\n            uid,\n            uuid\n        }, secret, {\n            expiresIn\n        });\n    }\n    /**\n   * 生成刷新 token\n   */ generateRefreshToken(uid) {\n        const secret = \"ef217e004bfb6ce72899d87b36166a48268747313d7dd1c9be293b3fd7ad557d\" || 0;\n        const expiresIn = \"30d\" || 0;\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().sign({\n            uid,\n            type: \"refresh\"\n        }, secret, {\n            expiresIn\n        });\n    }\n}\nAuthService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"UserDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"WorkspaceDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO === \"undefined\" ? Object : _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO,\n        typeof _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__.WorkspaceDAO === \"undefined\" ? Object : _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__.WorkspaceDAO,\n        typeof _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis === \"undefined\" ? Object : _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis\n    ])\n], AuthService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VCxFQUFFLE9BQU07WUFDTixNQUFNLElBQUlwQyxNQUFNO1FBQ2xCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELGNBQXNCUyxHQUFXLEVBQUVHLElBQVksRUFBVTtRQUN2RCxNQUFNb0IsU0FBU0Msa0VBQXNCLElBQUk7UUFDekMsTUFBTUssWUFBWUwsSUFBMEIsSUFBSTtRQUNoRCxPQUFPaEQsd0RBQVEsQ0FBQztZQUFFd0I7WUFBS0c7UUFBSyxHQUFHb0IsUUFBUTtZQUFFTTtRQUFVO0lBQ3JEO0lBRUE7O0dBRUMsR0FDRCxxQkFBNkI3QixHQUFXLEVBQVU7UUFDaEQsTUFBTXVCLFNBQVNDLGtFQUFzQixJQUFJO1FBQ3pDLE1BQU1LLFlBQVlMLEtBQWtDLElBQUk7UUFDeEQsT0FBT2hELHdEQUFRLENBQUM7WUFBRXdCO1lBQUtpQyxNQUFNO1FBQVUsR0FBR1YsUUFBUTtZQUFFTTtRQUFVO0lBQ2hFO0FBQ0Y7QUFuS2FqRCxjQUFBQSxvRUFBQUE7SUFEWlAsb0RBQVVBO0lBR05DLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQztJQUNQQSxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7OztlQUQ0QixrREFBTyw0QkFBUCxrREFBTztlQUNHLDREQUFZLDRCQUFaLDREQUFZO2VBQzNDLDhDQUFLLDRCQUFMLDhDQUFLOztHQUpYTSIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UudHM/ZDZmYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJztcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcbmltcG9ydCB0eXBlIHsgU2lnbk9wdGlvbnMgfSBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IHsgVXNlckRBTyB9IGZyb20gJ0AvZGFvL3VzZXIuZGFvJztcbmltcG9ydCB7IFdvcmtzcGFjZURBTyB9IGZyb20gJ0AvZGFvL3dvcmtzcGFjZS5kYW8nO1xuaW1wb3J0IHR5cGUgeyBVc2VyIH0gZnJvbSAnQC9lbnRpdGllcyc7XG5pbXBvcnQgeyBSZWRpcyB9IGZyb20gJ0AvY29yZS9yZWRpcyc7XG5cbi8qKlxuICog6K6k6K+B5pyN5YqhXG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBdXRoU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIEBpbmplY3QoJ1VzZXJEQU8nKSBwcml2YXRlIHVzZXJEQU86IFVzZXJEQU8sXG4gICAgQGluamVjdCgnV29ya3NwYWNlREFPJykgcHJpdmF0ZSB3b3Jrc3BhY2VEQU86IFdvcmtzcGFjZURBTyxcbiAgICBwcml2YXRlIHJlZGlzOiBSZWRpc1xuICApIHtcbiAgICB0aGlzLnJlZGlzID0gUmVkaXMuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnlKjmiLfms6jlhoxcbiAgICovXG4gIGFzeW5jIHJlZ2lzdGVyKGRhdGE6IHsgZW1haWw6IHN0cmluZzsgcGFzc3dvcmQ6IHN0cmluZzsgbmFtZTogc3RyaW5nIH0pOiBQcm9taXNlPHtcbiAgICB1c2VyOiBPbWl0PFVzZXIsICdwYXNzd29yZCc+O1xuICAgIHRva2VuOiBzdHJpbmc7XG4gICAgcmVmcmVzaFRva2VuOiBzdHJpbmc7XG4gICAgZGVmYXVsdFdvcmtzcGFjZUlkOiBzdHJpbmc7XG4gIH0+IHtcbiAgICAvLyDmo4Dmn6Xpgq7nrrHmmK/lkKblt7LlrZjlnKhcbiAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCB0aGlzLnVzZXJEQU8uZmluZEJ5RW1haWwoZGF0YS5lbWFpbCk7XG4gICAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbWFpbCBhbHJlYWR5IGV4aXN0cycpO1xuICAgIH1cblxuICAgIC8vIOWKoOWvhuWvhueggVxuICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2goZGF0YS5wYXNzd29yZCwgMTApO1xuXG4gICAgLy8g5Yib5bu655So5oi3XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlckRBTy5jcmVhdGUoe1xuICAgICAgZW1haWw6IGRhdGEuZW1haWwsXG4gICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICBuYW1lOiBkYXRhLm5hbWUsXG4gICAgfSk7XG5cbiAgICAvLyDliJvlu7rpu5jorqTlt6XkvZznqbrpl7RcbiAgICBjb25zdCBkZWZhdWx0V29ya3NwYWNlID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uY3JlYXRlKHtcbiAgICAgIG5hbWU6ICfmiJHnmoTlt6XkvZznqbrpl7QnLFxuICAgICAgb3duZXJfdWlkOiB1c2VyLnVpZCxcbiAgICB9KTtcblxuICAgIC8vIOeUn+aIkCB0b2tlblxuICAgIGNvbnN0IHRva2VuID0gdGhpcy5nZW5lcmF0ZVRva2VuKHVzZXIudWlkLCB1c2VyLnV1aWQpO1xuICAgIGNvbnN0IHJlZnJlc2hUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSZWZyZXNoVG9rZW4odXNlci51aWQpO1xuXG4gICAgLy8g5L+d5a2Y5Yi35paw5Luk54mM5Yiw5pWw5o2u5bqT77yI6L+Z6YeM566A5YyW5aSE55CG77yM5a6e6ZmF5bqU6K+l5L+d5a2Y5Yiw5pWw5o2u5bqT77yJXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5zZXQoYHJlZnJlc2hfdG9rZW46JHtyZWZyZXNoVG9rZW59YCwgdXNlci51aWQudG9TdHJpbmcoKSwgMzAgKiAyNCAqIDYwICogNjApOyAvLyAzMOWkqVxuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLnVzZXJXaXRob3V0UGFzc3dvcmQgfSA9IHVzZXI7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXI6IHVzZXJXaXRob3V0UGFzc3dvcmQsXG4gICAgICB0b2tlbixcbiAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgIGRlZmF1bHRXb3Jrc3BhY2VJZDogZGVmYXVsdFdvcmtzcGFjZS53b3Jrc3BhY2VfaWQsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnlKjmiLfnmbvlvZVcbiAgICovXG4gIGFzeW5jIGxvZ2luKFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZ1xuICApOiBQcm9taXNlPHtcbiAgICB1c2VyOiBPbWl0PFVzZXIsICdwYXNzd29yZCc+O1xuICAgIHRva2VuOiBzdHJpbmc7XG4gICAgcmVmcmVzaFRva2VuOiBzdHJpbmc7XG4gICAgZGVmYXVsdFdvcmtzcGFjZUlkOiBzdHJpbmc7XG4gIH0+IHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyREFPLmZpbmRCeUVtYWlsKGVtYWlsKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcpO1xuICAgIH1cblxuICAgIC8vIOmqjOivgeWvhueggVxuICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgdXNlci5wYXNzd29yZCk7XG4gICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQnKTtcbiAgICB9XG5cbiAgICAvLyDojrflj5bmiJbliJvlu7rpu5jorqTlt6XkvZznqbrpl7RcbiAgICBjb25zdCBkZWZhdWx0V29ya3NwYWNlID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uZ2V0T3JDcmVhdGVEZWZhdWx0KHVzZXIudWlkKTtcblxuICAgIC8vIOeUn+aIkCB0b2tlblxuICAgIGNvbnN0IHRva2VuID0gdGhpcy5nZW5lcmF0ZVRva2VuKHVzZXIudWlkLCB1c2VyLnV1aWQpO1xuICAgIGNvbnN0IHJlZnJlc2hUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSZWZyZXNoVG9rZW4odXNlci51aWQpO1xuXG4gICAgLy8g5L+d5a2Y5Yi35paw5Luk54mMXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5zZXQoYHJlZnJlc2hfdG9rZW46JHtyZWZyZXNoVG9rZW59YCwgdXNlci51aWQudG9TdHJpbmcoKSwgMzAgKiAyNCAqIDYwICogNjApO1xuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuICAgIGNvbnN0IHsgcGFzc3dvcmQ6IF8sIC4uLnVzZXJXaXRob3V0UGFzc3dvcmQgfSA9IHVzZXI7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXI6IHVzZXJXaXRob3V0UGFzc3dvcmQsXG4gICAgICB0b2tlbixcbiAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgIGRlZmF1bHRXb3Jrc3BhY2VJZDogZGVmYXVsdFdvcmtzcGFjZS53b3Jrc3BhY2VfaWQsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliLfmlrAgdG9rZW5cbiAgICovXG4gIGFzeW5jIHJlZnJlc2hUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZyk6IFByb21pc2U8eyB0b2tlbjogc3RyaW5nOyByZWZyZXNoVG9rZW46IHN0cmluZyB9PiB7XG4gICAgY29uc3QgdWlkU3RyID0gYXdhaXQgdGhpcy5yZWRpcy5nZXQoYHJlZnJlc2hfdG9rZW46JHtyZWZyZXNoVG9rZW59YCk7XG4gICAgaWYgKCF1aWRTdHIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCByZWZyZXNoIHRva2VuJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdWlkID0gcGFyc2VJbnQodWlkU3RyLCAxMCk7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlckRBTy5maW5kQnlVaWQodWlkKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICAvLyDnlJ/miJDmlrAgdG9rZW5cbiAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2VuZXJhdGVUb2tlbih1c2VyLnVpZCwgdXNlci51dWlkKTtcbiAgICBjb25zdCBuZXdSZWZyZXNoVG9rZW4gPSB0aGlzLmdlbmVyYXRlUmVmcmVzaFRva2VuKHVzZXIudWlkKTtcblxuICAgIC8vIOabtOaWsOWIt+aWsOS7pOeJjFxuICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKGByZWZyZXNoX3Rva2VuOiR7cmVmcmVzaFRva2VufWApO1xuICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0KFxuICAgICAgYHJlZnJlc2hfdG9rZW46JHtuZXdSZWZyZXNoVG9rZW59YCxcbiAgICAgIHVzZXIudWlkLnRvU3RyaW5nKCksXG4gICAgICAzMCAqIDI0ICogNjAgKiA2MFxuICAgICk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG9rZW4sXG4gICAgICByZWZyZXNoVG9rZW46IG5ld1JlZnJlc2hUb2tlbixcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOmqjOivgSB0b2tlblxuICAgKi9cbiAgYXN5bmMgdmVyaWZ5VG9rZW4odG9rZW46IHN0cmluZyk6IFByb21pc2U8eyB1aWQ6IG51bWJlcjsgdXVpZDogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2VjcmV0ID0gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCAneW91ci1zZWNyZXQta2V5JztcbiAgICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBzZWNyZXQpIGFzIHsgdWlkOiBudW1iZXI7IHV1aWQ6IHN0cmluZyB9O1xuICAgICAgcmV0dXJuIGRlY29kZWQ7XG4gICAgfSBjYXRjaCB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgdG9rZW4nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog55Sf5oiQIEpXVCB0b2tlblxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVRva2VuKHVpZDogbnVtYmVyLCB1dWlkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG4gICAgY29uc3QgZXhwaXJlc0luID0gcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4gfHwgJzdkJztcbiAgICByZXR1cm4gand0LnNpZ24oeyB1aWQsIHV1aWQgfSwgc2VjcmV0LCB7IGV4cGlyZXNJbiB9IGFzIFNpZ25PcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnlJ/miJDliLfmlrAgdG9rZW5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVSZWZyZXNoVG9rZW4odWlkOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG4gICAgY29uc3QgZXhwaXJlc0luID0gcHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfRVhQSVJFU19JTiB8fCAnMzBkJztcbiAgICByZXR1cm4gand0LnNpZ24oeyB1aWQsIHR5cGU6ICdyZWZyZXNoJyB9LCBzZWNyZXQsIHsgZXhwaXJlc0luIH0gYXMgU2lnbk9wdGlvbnMpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiaW5qZWN0YWJsZSIsImluamVjdCIsImJjcnlwdCIsImp3dCIsIlVzZXJEQU8iLCJXb3Jrc3BhY2VEQU8iLCJSZWRpcyIsIkF1dGhTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJ1c2VyREFPIiwid29ya3NwYWNlREFPIiwicmVkaXMiLCJnZXRJbnN0YW5jZSIsInJlZ2lzdGVyIiwiZGF0YSIsImV4aXN0aW5nVXNlciIsImZpbmRCeUVtYWlsIiwiZW1haWwiLCJFcnJvciIsImhhc2hlZFBhc3N3b3JkIiwiaGFzaCIsInBhc3N3b3JkIiwidXNlciIsImNyZWF0ZSIsIm5hbWUiLCJkZWZhdWx0V29ya3NwYWNlIiwib3duZXJfdWlkIiwidWlkIiwidG9rZW4iLCJnZW5lcmF0ZVRva2VuIiwidXVpZCIsInJlZnJlc2hUb2tlbiIsImdlbmVyYXRlUmVmcmVzaFRva2VuIiwic2V0IiwidG9TdHJpbmciLCJ1c2VyV2l0aG91dFBhc3N3b3JkIiwiZGVmYXVsdFdvcmtzcGFjZUlkIiwid29ya3NwYWNlX2lkIiwibG9naW4iLCJpc1ZhbGlkIiwiY29tcGFyZSIsImdldE9yQ3JlYXRlRGVmYXVsdCIsIl8iLCJ1aWRTdHIiLCJnZXQiLCJwYXJzZUludCIsImZpbmRCeVVpZCIsIm5ld1JlZnJlc2hUb2tlbiIsImRlbCIsInZlcmlmeVRva2VuIiwic2VjcmV0IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJkZWNvZGVkIiwidmVyaWZ5IiwiZXhwaXJlc0luIiwiSldUX0VYUElSRVNfSU4iLCJzaWduIiwiSldUX1JFRlJFU0hfRVhQSVJFU19JTiIsInR5cGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/auth.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/document.service.ts":
/*!******************************************!*\
  !*** ./src/services/document.service.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentService: () => (/* binding */ DocumentService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _core_redis__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/core/redis */ \"(rsc)/./src/core/redis.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__]);\n_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\nclass DocumentService {\n    constructor(documentDAO, redis){\n        this.documentDAO = documentDAO;\n        this.redis = redis;\n        this.redis = _core_redis__WEBPACK_IMPORTED_MODULE_2__.Redis.getInstance();\n    }\n    /**\n   * 创建文档\n   */ async createDocument(data) {\n        const document = await this.documentDAO.create({\n            workspace_id: data.workspace_id,\n            title: data.title,\n            content: data.content,\n            content_length: data.content.length,\n            owner_uid: data.owner_uid,\n            metadata: data.metadata\n        });\n        // 清除缓存\n        await this.redis.del(`document:${document.object_id}`);\n        await this.redis.del(`documents:workspace:${data.workspace_id}`);\n        return document;\n    }\n    /**\n   * 获取文档\n   */ async getDocument(object_id, includeContent = true) {\n        // 尝试从缓存获取\n        const cacheKey = `document:${object_id}`;\n        const cached = await this.redis.getJSON(cacheKey);\n        if (cached) {\n            return cached;\n        }\n        const document = await this.documentDAO.findById(object_id);\n        if (!document) {\n            return null;\n        }\n        // 缓存文档（不包含 content，减少内存占用）\n        if (!includeContent) {\n            const { content, ...docWithoutContent } = document;\n            await this.redis.setJSON(cacheKey, docWithoutContent, 300); // 5分钟缓存\n        }\n        return document;\n    }\n    /**\n   * 更新文档\n   */ async updateDocument(object_id, updates) {\n        const updateData = {};\n        if (updates.title) updateData.title = updates.title;\n        if (updates.content) {\n            updateData.content = updates.content;\n            updateData.content_length = updates.content.length;\n        }\n        if (updates.metadata) updateData.metadata = updates.metadata;\n        const document = await this.documentDAO.update(object_id, updateData);\n        // 清除缓存\n        await this.redis.del(`document:${object_id}`);\n        const doc = await this.documentDAO.findById(object_id);\n        if (doc) {\n            await this.redis.del(`documents:workspace:${doc.workspace_id}`);\n        }\n        return document;\n    }\n    /**\n   * 获取文档列表\n   */ async getDocuments(workspace_id, options = {}) {\n        // 尝试从缓存获取\n        const cacheKey = `documents:workspace:${workspace_id}:${JSON.stringify(options)}`;\n        const cached = await this.redis.getJSON(cacheKey);\n        if (cached) {\n            return {\n                ...cached,\n                page: options.page || 1,\n                page_size: options.page_size || 20\n            };\n        }\n        const result = await this.documentDAO.findByWorkspaceId(workspace_id, options);\n        // 缓存结果\n        await this.redis.setJSON(cacheKey, result, 60); // 1分钟缓存\n        return {\n            ...result,\n            page: options.page || 1,\n            page_size: options.page_size || 20\n        };\n    }\n    /**\n   * 删除文档\n   */ async deleteDocument(object_id) {\n        await this.documentDAO.delete(object_id);\n        // 清除缓存\n        await this.redis.del(`document:${object_id}`);\n        const doc = await this.documentDAO.findById(object_id);\n        if (doc) {\n            await this.redis.del(`documents:workspace:${doc.workspace_id}`);\n        }\n    }\n    /**\n   * 创建文档快照\n   */ async createSnapshot(data) {\n        return await this.documentDAO.createSnapshot({\n            object_id: data.object_id,\n            workspace_id: data.workspace_id,\n            snapshot_data: data.snapshot_data,\n            snapshot_version: data.snapshot_version || 1,\n            doc_state: data.doc_state,\n            doc_state_version: data.doc_state_version || 1,\n            metadata: data.metadata\n        });\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(object_id, options = {}) {\n        return await this.documentDAO.getSnapshots(object_id, options);\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(object_id) {\n        return await this.documentDAO.getLatestSnapshot(object_id);\n    }\n    /**\n   * 搜索文档（简化版，实际应该使用向量搜索）\n   */ async searchDocuments(workspace_id, query, options = {}) {\n        // 这里简化实现，实际应该使用向量嵌入搜索\n        // 暂时使用简单的文本搜索\n        const limit = options.limit || 10;\n        const offset = options.offset || 0;\n        // TODO: 实现向量搜索\n        // 这里返回空数组，实际应该查询 document_embeddings 表\n        return [];\n    }\n}\nDocumentService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO === \"undefined\" ? Object : _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO,\n        typeof _core_redis__WEBPACK_IMPORTED_MODULE_2__.Redis === \"undefined\" ? Object : _core_redis__WEBPACK_IMPORTED_MODULE_2__.Redis\n    ])\n], DocumentService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZXJ2aWNlcy9kb2N1bWVudC5zZXJ2aWNlLnRzP2NkMWMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgRG9jdW1lbnREQU8gfSBmcm9tICdAL2Rhby9kb2N1bWVudC5kYW8nO1xuaW1wb3J0IHR5cGUgeyBEb2N1bWVudCwgRG9jdW1lbnRTbmFwc2hvdCB9IGZyb20gJ0AvZW50aXRpZXMnO1xuaW1wb3J0IHsgUmVkaXMgfSBmcm9tICdAL2NvcmUvcmVkaXMnO1xuXG4vKipcbiAqIOaWh+aho+acjeWKoVxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQGluamVjdCgnRG9jdW1lbnREQU8nKSBwcml2YXRlIGRvY3VtZW50REFPOiBEb2N1bWVudERBTyxcbiAgICBwcml2YXRlIHJlZGlzOiBSZWRpc1xuICApIHtcbiAgICB0aGlzLnJlZGlzID0gUmVkaXMuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlofmoaNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZURvY3VtZW50KGRhdGE6IHtcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IEJ1ZmZlcjtcbiAgICBvd25lcl91aWQ6IG51bWJlcjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPERvY3VtZW50PiB7XG4gICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmNyZWF0ZSh7XG4gICAgICB3b3Jrc3BhY2VfaWQ6IGRhdGEud29ya3NwYWNlX2lkLFxuICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICBjb250ZW50X2xlbmd0aDogZGF0YS5jb250ZW50Lmxlbmd0aCxcbiAgICAgIG93bmVyX3VpZDogZGF0YS5vd25lcl91aWQsXG4gICAgICBtZXRhZGF0YTogZGF0YS5tZXRhZGF0YSxcbiAgICB9KTtcblxuICAgIC8vIOa4hemZpOe8k+WtmFxuICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKGBkb2N1bWVudDoke2RvY3VtZW50Lm9iamVjdF9pZH1gKTtcbiAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChgZG9jdW1lbnRzOndvcmtzcGFjZToke2RhdGEud29ya3NwYWNlX2lkfWApO1xuXG4gICAgcmV0dXJuIGRvY3VtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho1xuICAgKi9cbiAgYXN5bmMgZ2V0RG9jdW1lbnQob2JqZWN0X2lkOiBzdHJpbmcsIGluY2x1ZGVDb250ZW50OiBib29sZWFuID0gdHJ1ZSk6IFByb21pc2U8RG9jdW1lbnQgfCBudWxsPiB7XG4gICAgLy8g5bCd6K+V5LuO57yT5a2Y6I635Y+WXG4gICAgY29uc3QgY2FjaGVLZXkgPSBgZG9jdW1lbnQ6JHtvYmplY3RfaWR9YDtcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCB0aGlzLnJlZGlzLmdldEpTT048RG9jdW1lbnQ+KGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkO1xuICAgIH1cblxuICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlJZChvYmplY3RfaWQpO1xuICAgIGlmICghZG9jdW1lbnQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIOe8k+WtmOaWh+aho++8iOS4jeWMheWQqyBjb250ZW5077yM5YeP5bCR5YaF5a2Y5Y2g55So77yJXG4gICAgaWYgKCFpbmNsdWRlQ29udGVudCkge1xuICAgICAgY29uc3QgeyBjb250ZW50LCAuLi5kb2NXaXRob3V0Q29udGVudCB9ID0gZG9jdW1lbnQ7XG4gICAgICBhd2FpdCB0aGlzLnJlZGlzLnNldEpTT04oY2FjaGVLZXksIGRvY1dpdGhvdXRDb250ZW50LCAzMDApOyAvLyA15YiG6ZKf57yT5a2YXG4gICAgfVxuXG4gICAgcmV0dXJuIGRvY3VtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOaWh+aho1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlRG9jdW1lbnQoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgdXBkYXRlczoge1xuICAgICAgdGl0bGU/OiBzdHJpbmc7XG4gICAgICBjb250ZW50PzogQnVmZmVyO1xuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIH1cbiAgKTogUHJvbWlzZTxEb2N1bWVudD4ge1xuICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHt9O1xuICAgIGlmICh1cGRhdGVzLnRpdGxlKSB1cGRhdGVEYXRhLnRpdGxlID0gdXBkYXRlcy50aXRsZTtcbiAgICBpZiAodXBkYXRlcy5jb250ZW50KSB7XG4gICAgICB1cGRhdGVEYXRhLmNvbnRlbnQgPSB1cGRhdGVzLmNvbnRlbnQ7XG4gICAgICB1cGRhdGVEYXRhLmNvbnRlbnRfbGVuZ3RoID0gdXBkYXRlcy5jb250ZW50Lmxlbmd0aDtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEpIHVwZGF0ZURhdGEubWV0YWRhdGEgPSB1cGRhdGVzLm1ldGFkYXRhO1xuXG4gICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLnVwZGF0ZShvYmplY3RfaWQsIHVwZGF0ZURhdGEpO1xuXG4gICAgLy8g5riF6Zmk57yT5a2YXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5kZWwoYGRvY3VtZW50OiR7b2JqZWN0X2lkfWApO1xuICAgIGNvbnN0IGRvYyA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZmluZEJ5SWQob2JqZWN0X2lkKTtcbiAgICBpZiAoZG9jKSB7XG4gICAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChgZG9jdW1lbnRzOndvcmtzcGFjZToke2RvYy53b3Jrc3BhY2VfaWR9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRvY3VtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0RG9jdW1lbnRzKFxuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgICBwYWdlX3NpemU/OiBudW1iZXI7XG4gICAgICBzb3J0X2J5PzogJ2NyZWF0ZWRfYXQnIHwgJ3VwZGF0ZWRfYXQnIHwgJ3RpdGxlJztcbiAgICAgIG9yZGVyPzogJ2FzYycgfCAnZGVzYyc7XG4gICAgfSA9IHt9XG4gICk6IFByb21pc2U8eyBkb2N1bWVudHM6IERvY3VtZW50W107IHRvdGFsOiBudW1iZXI7IHBhZ2U6IG51bWJlcjsgcGFnZV9zaXplOiBudW1iZXIgfT4ge1xuICAgIC8vIOWwneivleS7jue8k+WtmOiOt+WPllxuICAgIGNvbnN0IGNhY2hlS2V5ID0gYGRvY3VtZW50czp3b3Jrc3BhY2U6JHt3b3Jrc3BhY2VfaWR9OiR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucyl9YDtcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCB0aGlzLnJlZGlzLmdldEpTT048e1xuICAgICAgZG9jdW1lbnRzOiBEb2N1bWVudFtdO1xuICAgICAgdG90YWw6IG51bWJlcjtcbiAgICB9PihjYWNoZUtleSk7XG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uY2FjaGVkLFxuICAgICAgICBwYWdlOiBvcHRpb25zLnBhZ2UgfHwgMSxcbiAgICAgICAgcGFnZV9zaXplOiBvcHRpb25zLnBhZ2Vfc2l6ZSB8fCAyMCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlXb3Jrc3BhY2VJZCh3b3Jrc3BhY2VfaWQsIG9wdGlvbnMpO1xuXG4gICAgLy8g57yT5a2Y57uT5p6cXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5zZXRKU09OKGNhY2hlS2V5LCByZXN1bHQsIDYwKTsgLy8gMeWIhumSn+e8k+WtmFxuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnJlc3VsdCxcbiAgICAgIHBhZ2U6IG9wdGlvbnMucGFnZSB8fCAxLFxuICAgICAgcGFnZV9zaXplOiBvcHRpb25zLnBhZ2Vfc2l6ZSB8fCAyMCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOaWh+aho1xuICAgKi9cbiAgYXN5bmMgZGVsZXRlRG9jdW1lbnQob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmRlbGV0ZShvYmplY3RfaWQpO1xuXG4gICAgLy8g5riF6Zmk57yT5a2YXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5kZWwoYGRvY3VtZW50OiR7b2JqZWN0X2lkfWApO1xuICAgIGNvbnN0IGRvYyA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZmluZEJ5SWQob2JqZWN0X2lkKTtcbiAgICBpZiAoZG9jKSB7XG4gICAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChgZG9jdW1lbnRzOndvcmtzcGFjZToke2RvYy53b3Jrc3BhY2VfaWR9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuaWh+aho+W/q+eFp1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlU25hcHNob3QoZGF0YToge1xuICAgIG9iamVjdF9pZDogc3RyaW5nO1xuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nO1xuICAgIHNuYXBzaG90X2RhdGE6IEJ1ZmZlcjtcbiAgICBzbmFwc2hvdF92ZXJzaW9uPzogbnVtYmVyO1xuICAgIGRvY19zdGF0ZT86IEJ1ZmZlcjtcbiAgICBkb2Nfc3RhdGVfdmVyc2lvbj86IG51bWJlcjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPERvY3VtZW50U25hcHNob3Q+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5jcmVhdGVTbmFwc2hvdCh7XG4gICAgICBvYmplY3RfaWQ6IGRhdGEub2JqZWN0X2lkLFxuICAgICAgd29ya3NwYWNlX2lkOiBkYXRhLndvcmtzcGFjZV9pZCxcbiAgICAgIHNuYXBzaG90X2RhdGE6IGRhdGEuc25hcHNob3RfZGF0YSxcbiAgICAgIHNuYXBzaG90X3ZlcnNpb246IGRhdGEuc25hcHNob3RfdmVyc2lvbiB8fCAxLFxuICAgICAgZG9jX3N0YXRlOiBkYXRhLmRvY19zdGF0ZSxcbiAgICAgIGRvY19zdGF0ZV92ZXJzaW9uOiBkYXRhLmRvY19zdGF0ZV92ZXJzaW9uIHx8IDEsXG4gICAgICBtZXRhZGF0YTogZGF0YS5tZXRhZGF0YSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPlv6vnhafliJfooahcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90cyhcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSA9IHt9XG4gICk6IFByb21pc2U8eyBzbmFwc2hvdHM6IERvY3VtZW50U25hcHNob3RbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZ2V0U25hcHNob3RzKG9iamVjdF9pZCwgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5pyA5paw5b+r54WnXG4gICAqL1xuICBhc3luYyBnZXRMYXRlc3RTbmFwc2hvdChvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8RG9jdW1lbnRTbmFwc2hvdCB8IG51bGw+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5nZXRMYXRlc3RTbmFwc2hvdChvYmplY3RfaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIOaQnOe0ouaWh+aho++8iOeugOWMlueJiO+8jOWunumZheW6lOivpeS9v+eUqOWQkemHj+aQnOe0ou+8iVxuICAgKi9cbiAgYXN5bmMgc2VhcmNoRG9jdW1lbnRzKFxuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nLFxuICAgIHF1ZXJ5OiBzdHJpbmcsXG4gICAgb3B0aW9uczoge1xuICAgICAgbGltaXQ/OiBudW1iZXI7XG4gICAgICBvZmZzZXQ/OiBudW1iZXI7XG4gICAgICB0aHJlc2hvbGQ/OiBudW1iZXI7XG4gICAgfSA9IHt9XG4gICk6IFByb21pc2U8QXJyYXk8e1xuICAgIG9iamVjdF9pZDogc3RyaW5nO1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgcHJldmlldzogc3RyaW5nO1xuICAgIHNjb3JlOiBudW1iZXI7XG4gICAgdXBkYXRlZF9hdDogRGF0ZTtcbiAgfT4+IHtcbiAgICAvLyDov5nph4znroDljJblrp7njrDvvIzlrp7pmYXlupTor6Xkvb/nlKjlkJHph4/ltYzlhaXmkJzntKJcbiAgICAvLyDmmoLml7bkvb/nlKjnroDljZXnmoTmlofmnKzmkJzntKJcbiAgICBjb25zdCBsaW1pdCA9IG9wdGlvbnMubGltaXQgfHwgMTA7XG4gICAgY29uc3Qgb2Zmc2V0ID0gb3B0aW9ucy5vZmZzZXQgfHwgMDtcblxuICAgIC8vIFRPRE86IOWunueOsOWQkemHj+aQnOe0olxuICAgIC8vIOi/memHjOi/lOWbnuepuuaVsOe7hO+8jOWunumZheW6lOivpeafpeivoiBkb2N1bWVudF9lbWJlZGRpbmdzIOihqFxuICAgIHJldHVybiBbXTtcbiAgfVxufVxuXG5cblxuXG4iXSwibmFtZXMiOlsiaW5qZWN0YWJsZSIsImluamVjdCIsIkRvY3VtZW50REFPIiwiUmVkaXMiLCJEb2N1bWVudFNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImRvY3VtZW50REFPIiwicmVkaXMiLCJnZXRJbnN0YW5jZSIsImNyZWF0ZURvY3VtZW50IiwiZGF0YSIsImRvY3VtZW50IiwiY3JlYXRlIiwid29ya3NwYWNlX2lkIiwidGl0bGUiLCJjb250ZW50IiwiY29udGVudF9sZW5ndGgiLCJsZW5ndGgiLCJvd25lcl91aWQiLCJtZXRhZGF0YSIsImRlbCIsIm9iamVjdF9pZCIsImdldERvY3VtZW50IiwiaW5jbHVkZUNvbnRlbnQiLCJjYWNoZUtleSIsImNhY2hlZCIsImdldEpTT04iLCJmaW5kQnlJZCIsImRvY1dpdGhvdXRDb250ZW50Iiwic2V0SlNPTiIsInVwZGF0ZURvY3VtZW50IiwidXBkYXRlcyIsInVwZGF0ZURhdGEiLCJ1cGRhdGUiLCJkb2MiLCJnZXREb2N1bWVudHMiLCJvcHRpb25zIiwiSlNPTiIsInN0cmluZ2lmeSIsInBhZ2UiLCJwYWdlX3NpemUiLCJyZXN1bHQiLCJmaW5kQnlXb3Jrc3BhY2VJZCIsImRlbGV0ZURvY3VtZW50IiwiZGVsZXRlIiwiY3JlYXRlU25hcHNob3QiLCJzbmFwc2hvdF9kYXRhIiwic25hcHNob3RfdmVyc2lvbiIsImRvY19zdGF0ZSIsImRvY19zdGF0ZV92ZXJzaW9uIiwiZ2V0U25hcHNob3RzIiwiZ2V0TGF0ZXN0U25hcHNob3QiLCJzZWFyY2hEb2N1bWVudHMiLCJxdWVyeSIsImxpbWl0Iiwib2Zmc2V0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/services/document.service.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@redis","vendor-chunks/semver","vendor-chunks/next","vendor-chunks/tsyringe","vendor-chunks/generic-pool","vendor-chunks/jsonwebtoken","vendor-chunks/zod","vendor-chunks/jws","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/bcryptjs","vendor-chunks/tslib","vendor-chunks/reflect-metadata","vendor-chunks/safe-buffer","vendor-chunks/redis","vendor-chunks/ms","vendor-chunks/lodash.once","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isplainobject","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isinteger","vendor-chunks/lodash.isboolean","vendor-chunks/lodash.includes","vendor-chunks/jwa","vendor-chunks/cluster-key-slot","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();