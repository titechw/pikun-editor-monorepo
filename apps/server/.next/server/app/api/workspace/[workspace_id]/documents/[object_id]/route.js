"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/workspace/[workspace_id]/documents/[object_id]/route";
exports.ids = ["app/api/workspace/[workspace_id]/documents/[object_id]/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("string_decoder");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = import("pg");;

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_object_id_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/workspace/[workspace_id]/documents/[object_id]/route.ts */ \"(rsc)/./src/app/api/workspace/[workspace_id]/documents/[object_id]/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_object_id_route_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_object_id_route_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/workspace/[workspace_id]/documents/[object_id]/route\",\n        pathname: \"/api/workspace/[workspace_id]/documents/[object_id]\",\n        filename: \"route\",\n        bundlePath: \"app/api/workspace/[workspace_id]/documents/[object_id]/route\"\n    },\n    resolvedPagePath: \"/Users/kp/Documents/ai-works/pikun-editor-monorepo/apps/server/src/app/api/workspace/[workspace_id]/documents/[object_id]/route.ts\",\n    nextConfigOutput,\n    userland: _Users_kp_Documents_ai_works_pikun_editor_monorepo_apps_server_src_app_api_workspace_workspace_id_documents_object_id_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/workspace/[workspace_id]/documents/[object_id]/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGd29ya3NwYWNlJTJGJTVCd29ya3NwYWNlX2lkJTVEJTJGZG9jdW1lbnRzJTJGJTVCb2JqZWN0X2lkJTVEJTJGcm91dGUmcGFnZT0lMkZhcGklMkZ3b3Jrc3BhY2UlMkYlNUJ3b3Jrc3BhY2VfaWQlNUQlMkZkb2N1bWVudHMlMkYlNUJvYmplY3RfaWQlNUQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ3b3Jrc3BhY2UlMkYlNUJ3b3Jrc3BhY2VfaWQlNUQlMkZkb2N1bWVudHMlMkYlNUJvYmplY3RfaWQlNUQlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZrcCUyRkRvY3VtZW50cyUyRmFpLXdvcmtzJTJGcGlrdW4tZWRpdG9yLW1vbm9yZXBvJTJGYXBwcyUyRnNlcnZlciUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZrcCUyRkRvY3VtZW50cyUyRmFpLXdvcmtzJTJGcGlrdW4tZWRpdG9yLW1vbm9yZXBvJTJGYXBwcyUyRnNlcnZlciZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDa0Y7QUFDL0o7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvP2IyNWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2twL0RvY3VtZW50cy9haS13b3Jrcy9waWt1bi1lZGl0b3ItbW9ub3JlcG8vYXBwcy9zZXJ2ZXIvc3JjL2FwcC9hcGkvd29ya3NwYWNlL1t3b3Jrc3BhY2VfaWRdL2RvY3VtZW50cy9bb2JqZWN0X2lkXS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvd29ya3NwYWNlL1t3b3Jrc3BhY2VfaWRdL2RvY3VtZW50cy9bb2JqZWN0X2lkXS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3dvcmtzcGFjZS9bd29ya3NwYWNlX2lkXS9kb2N1bWVudHMvW29iamVjdF9pZF1cIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3dvcmtzcGFjZS9bd29ya3NwYWNlX2lkXS9kb2N1bWVudHMvW29iamVjdF9pZF0vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMva3AvRG9jdW1lbnRzL2FpLXdvcmtzL3Bpa3VuLWVkaXRvci1tb25vcmVwby9hcHBzL3NlcnZlci9zcmMvYXBwL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL1tvYmplY3RfaWRdL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL1tvYmplY3RfaWRdL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/api/auth/auth.controller.ts":
/*!*****************************************!*\
  !*** ./src/api/auth/auth.controller.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthController: () => (/* binding */ AuthController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_auth_service__WEBPACK_IMPORTED_MODULE_2__]);\n_services_auth_service__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nclass AuthController {\n    constructor(authService){\n        this.authService = authService;\n    }\n    /**\n   * 用户注册\n   */ async register(req) {\n        try {\n            const body = await req.json();\n            const registerSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                email: zod__WEBPACK_IMPORTED_MODULE_3__.string().email(),\n                password: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(6),\n                name: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1)\n            });\n            const validatedData = registerSchema.parse(body);\n            const result = await this.authService.register(validatedData);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Registration failed\"\n            }, {\n                status: 400\n            });\n        }\n    }\n    /**\n   * 用户登录\n   */ async login(req) {\n        try {\n            const body = await req.json();\n            const loginSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                email: zod__WEBPACK_IMPORTED_MODULE_3__.string().email(),\n                password: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1)\n            });\n            const validatedData = loginSchema.parse(body);\n            const result = await this.authService.login(validatedData.email, validatedData.password);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Login failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 刷新 token\n   */ async refreshToken(req) {\n        try {\n            const body = await req.json();\n            const refreshSchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n                refreshToken: zod__WEBPACK_IMPORTED_MODULE_3__.string()\n            });\n            const validatedData = refreshSchema.parse(body);\n            const result = await this.authService.refreshToken(validatedData.refreshToken);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Token refresh failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n    /**\n   * 验证 token\n   */ async verifyToken(req) {\n        try {\n            const authHeader = req.headers.get(\"authorization\");\n            if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"No token provided\"\n                }, {\n                    status: 401\n                });\n            }\n            const token = authHeader.substring(7);\n            const decoded = await this.authService.verifyToken(token);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    is_new: false,\n                    uid: decoded.uid,\n                    uuid: decoded.uuid\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Token verification failed\"\n            }, {\n                status: 401\n            });\n        }\n    }\n}\nAuthController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_5__.__metadata)(\"design:paramtypes\", [\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_2__.AuthService\n    ])\n], AuthController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTUUsT0FBTyxJQUFJO1lBQzVCLEdBQ0E7Z0JBQUVFLFFBQVE7WUFBSTtRQUVsQjtJQUNGO0FBQ0Y7QUFoS2F2QixpQkFBQUEsb0VBQUFBO0lBRFpILG9EQUFVQTtJQUVJQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUNDLCtEQUFXQTs7O2VBQXVCLCtEQUFXLDRCQUFYLCtEQUFXOztHQUR0REMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBpL2F1dGgvYXV0aC5jb250cm9sbGVyLnRzPzExNWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XG5cbi8qKlxuICog6K6k6K+B5o6n5Yi25ZmoXG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBdXRoQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKEBpbmplY3QoQXV0aFNlcnZpY2UpIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlKSB7fVxuXG4gIC8qKlxuICAgKiDnlKjmiLfms6jlhoxcbiAgICovXG4gIGFzeW5jIHJlZ2lzdGVyKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICAgIGNvbnN0IHJlZ2lzdGVyU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxuICAgICAgICBwYXNzd29yZDogei5zdHJpbmcoKS5taW4oNiksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSByZWdpc3RlclNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UucmVnaXN0ZXIodmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIC8vIOWkhOeQhiBab2Qg6aqM6K+B6ZSZ6K+vXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdSZWdpc3RyYXRpb24gZmFpbGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDnlKjmiLfnmbvlvZVcbiAgICovXG4gIGFzeW5jIGxvZ2luKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICAgIGNvbnN0IGxvZ2luU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxuICAgICAgICBwYXNzd29yZDogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGxvZ2luU2NoZW1hLnBhcnNlKGJvZHkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5sb2dpbih2YWxpZGF0ZWREYXRhLmVtYWlsLCB2YWxpZGF0ZWREYXRhLnBhc3N3b3JkKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8g5aSE55CGIFpvZCDpqozor4HplJnor69cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0xvZ2luIGZhaWxlZCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yi35pawIHRva2VuXG4gICAqL1xuICBhc3luYyByZWZyZXNoVG9rZW4ocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuICAgICAgY29uc3QgcmVmcmVzaFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgcmVmcmVzaFRva2VuOiB6LnN0cmluZygpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSByZWZyZXNoU2NoZW1hLnBhcnNlKGJvZHkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5yZWZyZXNoVG9rZW4odmFsaWRhdGVkRGF0YS5yZWZyZXNoVG9rZW4pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyDlpITnkIYgWm9kIOmqjOivgemUmeivr1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnVG9rZW4gcmVmcmVzaCBmYWlsZWQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOmqjOivgSB0b2tlblxuICAgKi9cbiAgYXN5bmMgdmVyaWZ5VG9rZW4ocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ05vIHRva2VuIHByb3ZpZGVkJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UudmVyaWZ5VG9rZW4odG9rZW4pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaXNfbmV3OiBmYWxzZSwgLy8g5Y+v5Lul5qC55o2u6ZyA6KaB5a6e546wXG4gICAgICAgICAgdWlkOiBkZWNvZGVkLnVpZCxcbiAgICAgICAgICB1dWlkOiBkZWNvZGVkLnV1aWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdUb2tlbiB2ZXJpZmljYXRpb24gZmFpbGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInoiLCJpbmplY3RhYmxlIiwiaW5qZWN0IiwiQXV0aFNlcnZpY2UiLCJBdXRoQ29udHJvbGxlciIsImNvbnN0cnVjdG9yIiwiYXV0aFNlcnZpY2UiLCJyZWdpc3RlciIsInJlcSIsImJvZHkiLCJqc29uIiwicmVnaXN0ZXJTY2hlbWEiLCJvYmplY3QiLCJlbWFpbCIsInN0cmluZyIsInBhc3N3b3JkIiwibWluIiwibmFtZSIsInZhbGlkYXRlZERhdGEiLCJwYXJzZSIsInJlc3VsdCIsInN1Y2Nlc3MiLCJkYXRhIiwiZXJyb3IiLCJab2RFcnJvciIsIm1lc3NhZ2UiLCJlcnJvcnMiLCJzdGF0dXMiLCJsb2dpbiIsImxvZ2luU2NoZW1hIiwicmVmcmVzaFRva2VuIiwicmVmcmVzaFNjaGVtYSIsInZlcmlmeVRva2VuIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJzdGFydHNXaXRoIiwidG9rZW4iLCJzdWJzdHJpbmciLCJkZWNvZGVkIiwiaXNfbmV3IiwidWlkIiwidXVpZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/api/auth/auth.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/documents/document.controller.ts":
/*!**************************************************!*\
  !*** ./src/api/documents/document.controller.ts ***!
  \**************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentController: () => (/* binding */ DocumentController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _services_document_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/document.service */ \"(rsc)/./src/services/document.service.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_document_service__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_services_document_service__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\nclass DocumentController {\n    constructor(documentService, authService){\n        this.documentService = documentService;\n        this.authService = authService;\n    }\n    /**\n   * 获取当前用户（从 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.authService.verifyToken(token);\n    }\n    /**\n   * 创建文档\n   */ async createDocument(req, context) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const body = await req.json();\n            const createSchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n                title: zod__WEBPACK_IMPORTED_MODULE_4__.string().min(1),\n                content: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_4__.record(zod__WEBPACK_IMPORTED_MODULE_4__.any()).optional().nullable()\n            });\n            const validatedData = createSchema.parse(body);\n            // 如果没有提供 content，创建一个空的 Buffer（空 Yjs 文档）\n            const contentBuffer = validatedData.content ? Buffer.from(validatedData.content, \"base64\") : Buffer.alloc(0);\n            const document = await this.documentService.createDocument({\n                workspace_id: context.params.workspace_id,\n                title: validatedData.title,\n                content: contentBuffer,\n                owner_uid: user.uid,\n                metadata: validatedData.metadata\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    workspace_id: document.workspace_id,\n                    created_at: document.created_at instanceof Date ? document.created_at.toISOString() : document.created_at\n                }\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_5__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to create document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 400\n            });\n        }\n    }\n    /**\n   * 获取文档\n   */ async getDocument(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const includeContent = req.nextUrl.searchParams.get(\"include_content\") === \"true\";\n            const document = await this.documentService.getDocument(context.params.object_id, includeContent);\n            if (!document) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Document not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    workspace_id: document.workspace_id,\n                    title: document.title,\n                    content: includeContent ? document.content.toString(\"base64\") : undefined,\n                    content_length: document.content_length,\n                    owner_uid: document.owner_uid,\n                    metadata: document.metadata,\n                    created_at: document.created_at instanceof Date ? document.created_at.toISOString() : document.created_at,\n                    updated_at: document.updated_at instanceof Date ? document.updated_at.toISOString() : document.updated_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 更新文档\n   */ async updateDocument(req, context) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const body = await req.json();\n            const updateSchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n                title: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                content: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                change_data: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                snapshot: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional().nullable(),\n                metadata: zod__WEBPACK_IMPORTED_MODULE_4__.record(zod__WEBPACK_IMPORTED_MODULE_4__.any()).optional().nullable(),\n                forceSnapshot: zod__WEBPACK_IMPORTED_MODULE_4__.boolean().optional().default(false)\n            });\n            const validatedData = updateSchema.parse(body);\n            const updates = {};\n            if (validatedData.title) updates.title = validatedData.title;\n            if (validatedData.content) {\n                updates.content = Buffer.from(validatedData.content, \"base64\");\n            }\n            if (validatedData.change_data) {\n                updates.change_data = Buffer.from(validatedData.change_data, \"base64\");\n            }\n            if (validatedData.snapshot) {\n                updates.snapshot = Buffer.from(validatedData.snapshot, \"base64\");\n            }\n            if (validatedData.metadata) updates.metadata = validatedData.metadata;\n            if (validatedData.forceSnapshot !== undefined) {\n                updates.forceSnapshot = validatedData.forceSnapshot;\n            }\n            const document = await this.documentService.updateDocument(context.params.object_id, updates);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    object_id: document.object_id,\n                    updated_at: document.updated_at instanceof Date ? document.updated_at.toISOString() : document.updated_at\n                }\n            });\n        } catch (error) {\n            // 处理 Zod 验证错误\n            if (error instanceof zod__WEBPACK_IMPORTED_MODULE_5__.ZodError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Validation error\",\n                    errors: error.errors\n                }, {\n                    status: 400\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to update document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 400\n            });\n        }\n    }\n    /**\n   * 获取文档列表\n   */ async getDocuments(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const page = parseInt(req.nextUrl.searchParams.get(\"page\") || \"1\", 10);\n            const page_size = parseInt(req.nextUrl.searchParams.get(\"page_size\") || \"20\", 10);\n            const sort_by = req.nextUrl.searchParams.get(\"sort_by\") || \"updated_at\";\n            const order = req.nextUrl.searchParams.get(\"order\") || \"desc\";\n            const result = await this.documentService.getDocuments(context.params.workspace_id, {\n                page,\n                page_size,\n                sort_by,\n                order\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get documents\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 删除文档\n   */ async deleteDocument(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            await this.documentService.deleteDocument(context.params.object_id);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: \"Document deleted successfully\"\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to delete document\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const limit = parseInt(req.nextUrl.searchParams.get(\"limit\") || \"20\", 10);\n            const offset = parseInt(req.nextUrl.searchParams.get(\"offset\") || \"0\", 10);\n            const result = await this.documentService.getSnapshots(context.params.object_id, {\n                limit,\n                offset\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: result\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get snapshots\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const snapshot = await this.documentService.getLatestSnapshot(context.params.object_id);\n            if (!snapshot) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Snapshot not found\"\n                }, {\n                    status: 404\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    snapshot_id: snapshot.snapshot_id,\n                    doc_state: snapshot.doc_state?.toString(\"base64\"),\n                    snapshot: snapshot.snapshot_data.toString(\"base64\"),\n                    created_at: snapshot.created_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get latest snapshot\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 根据 snapshot_id 获取快照内容\n   */ async getSnapshotById(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const snapshot = await this.documentService.getSnapshotById(context.params.snapshot_id);\n            if (!snapshot) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Snapshot not found\"\n                }, {\n                    status: 404\n                });\n            }\n            // 从数据库获取快照内容\n            let docStateBase64 = null;\n            if (snapshot.doc_state) {\n                docStateBase64 = snapshot.doc_state.toString(\"base64\");\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    snapshot_id: snapshot.snapshot_id,\n                    doc_state: docStateBase64,\n                    snapshot: snapshot.snapshot_data?.toString(\"base64\") || null,\n                    created_at: snapshot.created_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get snapshot\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 搜索文档\n   */ async searchDocuments(req, context) {\n        try {\n            await this.getCurrentUser(req);\n            const query = req.nextUrl.searchParams.get(\"query\");\n            if (!query) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Query parameter is required\"\n                }, {\n                    status: 400\n                });\n            }\n            const limit = parseInt(req.nextUrl.searchParams.get(\"limit\") || \"10\", 10);\n            const offset = parseInt(req.nextUrl.searchParams.get(\"offset\") || \"0\", 10);\n            const threshold = parseFloat(req.nextUrl.searchParams.get(\"threshold\") || \"0.5\");\n            const results = await this.documentService.searchDocuments(context.params.workspace_id, query, {\n                limit,\n                offset,\n                threshold\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: results\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to search documents\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n}\nDocumentController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService === \"undefined\" ? Object : _services_document_service__WEBPACK_IMPORTED_MODULE_2__.DocumentService,\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService\n    ])\n], DocumentController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL2RvY3VtZW50cy9kb2N1bWVudC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXdEO0FBQ2hDO0FBQ3NCO0FBQ2dCO0FBQ1I7QUFNL0MsTUFBTU07SUFDWEMsWUFDRSxlQUFpRSxFQUNqRSxXQUFxRCxDQUNyRDthQUZpQ0Msa0JBQUFBO2FBQ0pDLGNBQUFBO0lBQzVCO0lBRUg7O0dBRUMsR0FDRCxNQUFjQyxlQUFlQyxHQUFnQixFQUEwQztRQUNyRixNQUFNQyxhQUFhRCxJQUFJRSxPQUFPLENBQUNDLEdBQUcsQ0FBQztRQUNuQyxJQUFJLENBQUNGLGNBQWMsQ0FBQ0EsV0FBV0csVUFBVSxDQUFDLFlBQVk7WUFDcEQsTUFBTSxJQUFJQyxNQUFNO1FBQ2xCO1FBRUEsTUFBTUMsUUFBUUwsV0FBV00sU0FBUyxDQUFDO1FBQ25DLE9BQU8sTUFBTSxJQUFJLENBQUNULFdBQVcsQ0FBQ1UsV0FBVyxDQUFDRjtJQUM1QztJQUVBOztHQUVDLEdBQ0QsTUFBTUcsZUFDSlQsR0FBZ0IsRUFDaEJVLE9BQTZDLEVBQ3RCO1FBQ3ZCLElBQUk7WUFDRixNQUFNQyxPQUFPLE1BQU0sSUFBSSxDQUFDWixjQUFjLENBQUNDO1lBQ3ZDLE1BQU1ZLE9BQU8sTUFBTVosSUFBSWEsSUFBSTtZQUUzQixNQUFNQyxlQUFleEIsdUNBQVEsQ0FBQztnQkFDNUIwQixPQUFPMUIsdUNBQVEsR0FBRzRCLEdBQUcsQ0FBQztnQkFDdEJDLFNBQVM3Qix1Q0FBUSxHQUFHOEIsUUFBUSxHQUFHQyxRQUFRO2dCQUN2Q0MsVUFBVWhDLHVDQUFRLENBQUNBLG9DQUFLLElBQUk4QixRQUFRLEdBQUdDLFFBQVE7WUFDakQ7WUFFQSxNQUFNSSxnQkFBZ0JYLGFBQWFZLEtBQUssQ0FBQ2Q7WUFDekMseUNBQXlDO1lBQ3pDLE1BQU1lLGdCQUFnQkYsY0FBY04sT0FBTyxHQUN2Q1MsT0FBT0MsSUFBSSxDQUFDSixjQUFjTixPQUFPLEVBQUUsWUFDbkNT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LFNBQVM7Z0JBQ1RDLE1BQU0rQztZQUNSO1FBQ0YsRUFBRSxPQUFPMUMsT0FBWTtZQUNuQixPQUFPckQscURBQVlBLENBQUN3QixJQUFJLENBQ3RCO2dCQUNFdUIsU0FBUztnQkFDVFEsU0FBU0YsTUFBTUUsT0FBTyxJQUFJO1lBQzVCLEdBQ0E7Z0JBQUVFLFFBQVFKLE1BQU1FLE9BQU8sS0FBSyxpQkFBaUIsTUFBTTtZQUFJO1FBRTNEO0lBQ0Y7QUFDRjtBQXRiYWpELHFCQUFBQSxvRUFBQUE7SUFEWkosb0RBQVVBO0lBR05DLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQ0MsdUVBQWVBO0lBQ3RCRCxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUNFLCtEQUFXQTs7O2VBRCtCLHVFQUFlLDRCQUFmLHVFQUFlO2VBQ3ZCLCtEQUFXLDRCQUFYLCtEQUFXOztHQUg1Q0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvYXBpL2RvY3VtZW50cy9kb2N1bWVudC5jb250cm9sbGVyLnRzPzJlZjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgRG9jdW1lbnRTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9kb2N1bWVudC5zZXJ2aWNlJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xuXG4vKipcbiAqIOaWh+aho+aOp+WItuWZqFxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQGluamVjdChEb2N1bWVudFNlcnZpY2UpIHByaXZhdGUgZG9jdW1lbnRTZXJ2aWNlOiBEb2N1bWVudFNlcnZpY2UsXG4gICAgQGluamVjdChBdXRoU2VydmljZSkgcHJpdmF0ZSBhdXRoU2VydmljZTogQXV0aFNlcnZpY2VcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiDojrflj5blvZPliY3nlKjmiLfvvIjku44gdG9rZW7vvIlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q3VycmVudFVzZXIocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8eyB1aWQ6IG51bWJlcjsgdXVpZDogc3RyaW5nIH0+IHtcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJyk7XG4gICAgaWYgKCFhdXRoSGVhZGVyIHx8ICFhdXRoSGVhZGVyLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmF1dGhvcml6ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLnZlcmlmeVRva2VuKHRva2VuKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlofmoaNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZURvY3VtZW50KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmcgfSB9XG4gICk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcblxuICAgICAgY29uc3QgY3JlYXRlU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICB0aXRsZTogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICAgIGNvbnRlbnQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5udWxsYWJsZSgpLCAvLyBCYXNlNjQg57yW56CB55qE5YaF5a6577yM5Y+v6YCJXG4gICAgICAgIG1ldGFkYXRhOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNyZWF0ZVNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIC8vIOWmguaenOayoeacieaPkOS+myBjb250ZW5077yM5Yib5bu65LiA5Liq56m655qEIEJ1ZmZlcu+8iOepuiBZanMg5paH5qGj77yJXG4gICAgICBjb25zdCBjb250ZW50QnVmZmVyID0gdmFsaWRhdGVkRGF0YS5jb250ZW50XG4gICAgICAgID8gQnVmZmVyLmZyb20odmFsaWRhdGVkRGF0YS5jb250ZW50LCAnYmFzZTY0JylcbiAgICAgICAgOiBCdWZmZXIuYWxsb2MoMCk7XG5cbiAgICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2UuY3JlYXRlRG9jdW1lbnQoe1xuICAgICAgICB3b3Jrc3BhY2VfaWQ6IGNvbnRleHQucGFyYW1zLndvcmtzcGFjZV9pZCxcbiAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRCdWZmZXIsXG4gICAgICAgIG93bmVyX3VpZDogdXNlci51aWQsXG4gICAgICAgIG1ldGFkYXRhOiB2YWxpZGF0ZWREYXRhLm1ldGFkYXRhLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBvYmplY3RfaWQ6IGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICB3b3Jrc3BhY2VfaWQ6IGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgICBjcmVhdGVkX2F0OiBkb2N1bWVudC5jcmVhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZSA/IGRvY3VtZW50LmNyZWF0ZWRfYXQudG9JU09TdHJpbmcoKSA6IGRvY3VtZW50LmNyZWF0ZWRfYXQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyDlpITnkIYgWm9kIOmqjOivgemUmeivr1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGNyZWF0ZSBkb2N1bWVudCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaNcbiAgICovXG4gIGFzeW5jIGdldERvY3VtZW50KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGNvbnN0IGluY2x1ZGVDb250ZW50ID0gcmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnaW5jbHVkZV9jb250ZW50JykgPT09ICd0cnVlJztcbiAgICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2UuZ2V0RG9jdW1lbnQoXG4gICAgICAgIGNvbnRleHQucGFyYW1zLm9iamVjdF9pZCxcbiAgICAgICAgaW5jbHVkZUNvbnRlbnRcbiAgICAgICk7XG5cbiAgICAgIGlmICghZG9jdW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0RvY3VtZW50IG5vdCBmb3VuZCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG9iamVjdF9pZDogZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgIHdvcmtzcGFjZV9pZDogZG9jdW1lbnQud29ya3NwYWNlX2lkLFxuICAgICAgICAgIHRpdGxlOiBkb2N1bWVudC50aXRsZSxcbiAgICAgICAgICBjb250ZW50OiBpbmNsdWRlQ29udGVudCA/IGRvY3VtZW50LmNvbnRlbnQudG9TdHJpbmcoJ2Jhc2U2NCcpIDogdW5kZWZpbmVkLFxuICAgICAgICAgIGNvbnRlbnRfbGVuZ3RoOiBkb2N1bWVudC5jb250ZW50X2xlbmd0aCxcbiAgICAgICAgICBvd25lcl91aWQ6IGRvY3VtZW50Lm93bmVyX3VpZCxcbiAgICAgICAgICBtZXRhZGF0YTogZG9jdW1lbnQubWV0YWRhdGEsXG4gICAgICAgICAgY3JlYXRlZF9hdDogZG9jdW1lbnQuY3JlYXRlZF9hdCBpbnN0YW5jZW9mIERhdGUgPyBkb2N1bWVudC5jcmVhdGVkX2F0LnRvSVNPU3RyaW5nKCkgOiBkb2N1bWVudC5jcmVhdGVkX2F0LFxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IGRvY3VtZW50LnVwZGF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gZG9jdW1lbnQudXBkYXRlZF9hdC50b0lTT1N0cmluZygpIDogZG9jdW1lbnQudXBkYXRlZF9hdCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgZG9jdW1lbnQnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5pu05paw5paH5qGjXG4gICAqL1xuICBhc3luYyB1cGRhdGVEb2N1bWVudChcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXIocmVxKTtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuXG4gICAgICBjb25zdCB1cGRhdGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICAgIHRpdGxlOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICAgICAgY29udGVudDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksIC8vIEJhc2U2NCDnvJbnoIHnmoTlhoXlrrnvvIhEb2MgU3RhdGXvvIlcbiAgICAgICAgY2hhbmdlX2RhdGE6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5udWxsYWJsZSgpLCAvLyBCYXNlNjQg57yW56CB55qE5aKe6YeP5pu05paw77yIWWpzIFVwZGF0Ze+8iVxuICAgICAgICBzbmFwc2hvdDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksIC8vIEJhc2U2NCDnvJbnoIHnmoQgU25hcHNob3TvvIjnirbmgIHlkJHph4/vvIlcbiAgICAgICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICAgICAgZm9yY2VTbmFwc2hvdDogei5ib29sZWFuKCkub3B0aW9uYWwoKS5kZWZhdWx0KGZhbHNlKSwgLy8g5piv5ZCm5by65Yi25Yib5bu65b+r54WnXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHVwZGF0ZVNjaGVtYS5wYXJzZShib2R5KTtcbiAgICAgIGNvbnN0IHVwZGF0ZXM6IGFueSA9IHt9O1xuXG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS50aXRsZSkgdXBkYXRlcy50aXRsZSA9IHZhbGlkYXRlZERhdGEudGl0bGU7XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5jb250ZW50KSB7XG4gICAgICAgIHVwZGF0ZXMuY29udGVudCA9IEJ1ZmZlci5mcm9tKHZhbGlkYXRlZERhdGEuY29udGVudCwgJ2Jhc2U2NCcpO1xuICAgICAgfVxuICAgICAgaWYgKHZhbGlkYXRlZERhdGEuY2hhbmdlX2RhdGEpIHtcbiAgICAgICAgdXBkYXRlcy5jaGFuZ2VfZGF0YSA9IEJ1ZmZlci5mcm9tKHZhbGlkYXRlZERhdGEuY2hhbmdlX2RhdGEsICdiYXNlNjQnKTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWxpZGF0ZWREYXRhLnNuYXBzaG90KSB7XG4gICAgICAgIHVwZGF0ZXMuc25hcHNob3QgPSBCdWZmZXIuZnJvbSh2YWxpZGF0ZWREYXRhLnNuYXBzaG90LCAnYmFzZTY0Jyk7XG4gICAgICB9XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5tZXRhZGF0YSkgdXBkYXRlcy5tZXRhZGF0YSA9IHZhbGlkYXRlZERhdGEubWV0YWRhdGE7XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5mb3JjZVNuYXBzaG90ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXBkYXRlcy5mb3JjZVNuYXBzaG90ID0gdmFsaWRhdGVkRGF0YS5mb3JjZVNuYXBzaG90O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLnVwZGF0ZURvY3VtZW50KGNvbnRleHQucGFyYW1zLm9iamVjdF9pZCwgdXBkYXRlcyk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBvYmplY3RfaWQ6IGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICB1cGRhdGVkX2F0OiBkb2N1bWVudC51cGRhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZSA/IGRvY3VtZW50LnVwZGF0ZWRfYXQudG9JU09TdHJpbmcoKSA6IGRvY3VtZW50LnVwZGF0ZWRfYXQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyDlpITnkIYgWm9kIOmqjOivgemUmeivr1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBlcnJvcnM6IGVycm9yLmVycm9ycyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHVwZGF0ZSBkb2N1bWVudCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDQwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPliJfooahcbiAgICovXG4gIGFzeW5jIGdldERvY3VtZW50cyhcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGNvbnN0IHBhZ2UgPSBwYXJzZUludChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdwYWdlJykgfHwgJzEnLCAxMCk7XG4gICAgICBjb25zdCBwYWdlX3NpemUgPSBwYXJzZUludChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdwYWdlX3NpemUnKSB8fCAnMjAnLCAxMCk7XG4gICAgICBjb25zdCBzb3J0X2J5ID1cbiAgICAgICAgKHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ3NvcnRfYnknKSBhcyAnY3JlYXRlZF9hdCcgfCAndXBkYXRlZF9hdCcgfCAndGl0bGUnKSB8fFxuICAgICAgICAndXBkYXRlZF9hdCc7XG4gICAgICBjb25zdCBvcmRlciA9IChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdvcmRlcicpIGFzICdhc2MnIHwgJ2Rlc2MnKSB8fCAnZGVzYyc7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmdldERvY3VtZW50cyhjb250ZXh0LnBhcmFtcy53b3Jrc3BhY2VfaWQsIHtcbiAgICAgICAgcGFnZSxcbiAgICAgICAgcGFnZV9zaXplLFxuICAgICAgICBzb3J0X2J5LFxuICAgICAgICBvcmRlcixcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IGRvY3VtZW50cycsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTmlofmoaNcbiAgICovXG4gIGFzeW5jIGRlbGV0ZURvY3VtZW50KFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmRlbGV0ZURvY3VtZW50KGNvbnRleHQucGFyYW1zLm9iamVjdF9pZCk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdEb2N1bWVudCBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZGVsZXRlIGRvY3VtZW50JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho+W/q+eFp+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0U25hcHNob3RzKFxuICAgIHJlcTogTmV4dFJlcXVlc3QsXG4gICAgY29udGV4dDogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuICApOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG5cbiAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSB8fCAnMjAnLCAxMCk7XG4gICAgICBjb25zdCBvZmZzZXQgPSBwYXJzZUludChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdvZmZzZXQnKSB8fCAnMCcsIDEwKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2UuZ2V0U25hcHNob3RzKGNvbnRleHQucGFyYW1zLm9iamVjdF9pZCwge1xuICAgICAgICBsaW1pdCxcbiAgICAgICAgb2Zmc2V0LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgc25hcHNob3RzJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluacgOaWsOW/q+eFp1xuICAgKi9cbiAgYXN5bmMgZ2V0TGF0ZXN0U25hcHNob3QoXG4gICAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZzsgb2JqZWN0X2lkOiBzdHJpbmcgfSB9XG4gICk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZ2V0Q3VycmVudFVzZXIocmVxKTtcblxuICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCB0aGlzLmRvY3VtZW50U2VydmljZS5nZXRMYXRlc3RTbmFwc2hvdChjb250ZXh0LnBhcmFtcy5vYmplY3RfaWQpO1xuXG4gICAgICBpZiAoIXNuYXBzaG90KSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTbmFwc2hvdCBub3QgZm91bmQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBzbmFwc2hvdF9pZDogc25hcHNob3Quc25hcHNob3RfaWQsXG4gICAgICAgICAgZG9jX3N0YXRlOiBzbmFwc2hvdC5kb2Nfc3RhdGU/LnRvU3RyaW5nKCdiYXNlNjQnKSxcbiAgICAgICAgICBzbmFwc2hvdDogc25hcHNob3Quc25hcHNob3RfZGF0YS50b1N0cmluZygnYmFzZTY0JyksXG4gICAgICAgICAgY3JlYXRlZF9hdDogc25hcHNob3QuY3JlYXRlZF9hdCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgbGF0ZXN0IHNuYXBzaG90JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBzbmFwc2hvdF9pZCDojrflj5blv6vnhaflhoXlrrlcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90QnlJZChcbiAgICByZXE6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZzsgc25hcHNob3RfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmdldFNuYXBzaG90QnlJZChjb250ZXh0LnBhcmFtcy5zbmFwc2hvdF9pZCk7XG5cbiAgICAgIGlmICghc25hcHNob3QpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1NuYXBzaG90IG5vdCBmb3VuZCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8g5LuO5pWw5o2u5bqT6I635Y+W5b+r54Wn5YaF5a65XG4gICAgICBsZXQgZG9jU3RhdGVCYXNlNjQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgICAgaWYgKHNuYXBzaG90LmRvY19zdGF0ZSkge1xuICAgICAgICBkb2NTdGF0ZUJhc2U2NCA9IHNuYXBzaG90LmRvY19zdGF0ZS50b1N0cmluZygnYmFzZTY0Jyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBzbmFwc2hvdF9pZDogc25hcHNob3Quc25hcHNob3RfaWQsXG4gICAgICAgICAgZG9jX3N0YXRlOiBkb2NTdGF0ZUJhc2U2NCxcbiAgICAgICAgICBzbmFwc2hvdDogc25hcHNob3Quc25hcHNob3RfZGF0YT8udG9TdHJpbmcoJ2Jhc2U2NCcpIHx8IG51bGwsXG4gICAgICAgICAgY3JlYXRlZF9hdDogc25hcHNob3QuY3JlYXRlZF9hdCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgc25hcHNob3QnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5pCc57Si5paH5qGjXG4gICAqL1xuICBhc3luYyBzZWFyY2hEb2N1bWVudHMoXG4gICAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZyB9IH1cbiAgKTogUHJvbWlzZTxOZXh0UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuXG4gICAgICBjb25zdCBxdWVyeSA9IHJlcS5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ3F1ZXJ5Jyk7XG4gICAgICBpZiAoIXF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdRdWVyeSBwYXJhbWV0ZXIgaXMgcmVxdWlyZWQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSB8fCAnMTAnLCAxMCk7XG4gICAgICBjb25zdCBvZmZzZXQgPSBwYXJzZUludChyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdvZmZzZXQnKSB8fCAnMCcsIDEwKTtcbiAgICAgIGNvbnN0IHRocmVzaG9sZCA9IHBhcnNlRmxvYXQocmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgndGhyZXNob2xkJykgfHwgJzAuNScpO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5kb2N1bWVudFNlcnZpY2Uuc2VhcmNoRG9jdW1lbnRzKFxuICAgICAgICBjb250ZXh0LnBhcmFtcy53b3Jrc3BhY2VfaWQsXG4gICAgICAgIHF1ZXJ5LFxuICAgICAgICB7XG4gICAgICAgICAgbGltaXQsXG4gICAgICAgICAgb2Zmc2V0LFxuICAgICAgICAgIHRocmVzaG9sZCxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0cyxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBzZWFyY2ggZG9jdW1lbnRzJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IGVycm9yLm1lc3NhZ2UgPT09ICdVbmF1dGhvcml6ZWQnID8gNDAxIDogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwieiIsImluamVjdGFibGUiLCJpbmplY3QiLCJEb2N1bWVudFNlcnZpY2UiLCJBdXRoU2VydmljZSIsIkRvY3VtZW50Q29udHJvbGxlciIsImNvbnN0cnVjdG9yIiwiZG9jdW1lbnRTZXJ2aWNlIiwiYXV0aFNlcnZpY2UiLCJnZXRDdXJyZW50VXNlciIsInJlcSIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwiZ2V0Iiwic3RhcnRzV2l0aCIsIkVycm9yIiwidG9rZW4iLCJzdWJzdHJpbmciLCJ2ZXJpZnlUb2tlbiIsImNyZWF0ZURvY3VtZW50IiwiY29udGV4dCIsInVzZXIiLCJib2R5IiwianNvbiIsImNyZWF0ZVNjaGVtYSIsIm9iamVjdCIsInRpdGxlIiwic3RyaW5nIiwibWluIiwiY29udGVudCIsIm9wdGlvbmFsIiwibnVsbGFibGUiLCJtZXRhZGF0YSIsInJlY29yZCIsImFueSIsInZhbGlkYXRlZERhdGEiLCJwYXJzZSIsImNvbnRlbnRCdWZmZXIiLCJCdWZmZXIiLCJmcm9tIiwiYWxsb2MiLCJkb2N1bWVudCIsIndvcmtzcGFjZV9pZCIsInBhcmFtcyIsIm93bmVyX3VpZCIsInVpZCIsInN1Y2Nlc3MiLCJkYXRhIiwib2JqZWN0X2lkIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImVycm9yIiwiWm9kRXJyb3IiLCJtZXNzYWdlIiwiZXJyb3JzIiwic3RhdHVzIiwiZ2V0RG9jdW1lbnQiLCJpbmNsdWRlQ29udGVudCIsIm5leHRVcmwiLCJzZWFyY2hQYXJhbXMiLCJ0b1N0cmluZyIsInVuZGVmaW5lZCIsImNvbnRlbnRfbGVuZ3RoIiwidXBkYXRlZF9hdCIsInVwZGF0ZURvY3VtZW50IiwidXBkYXRlU2NoZW1hIiwiY2hhbmdlX2RhdGEiLCJzbmFwc2hvdCIsImZvcmNlU25hcHNob3QiLCJib29sZWFuIiwiZGVmYXVsdCIsInVwZGF0ZXMiLCJnZXREb2N1bWVudHMiLCJwYWdlIiwicGFyc2VJbnQiLCJwYWdlX3NpemUiLCJzb3J0X2J5Iiwib3JkZXIiLCJyZXN1bHQiLCJkZWxldGVEb2N1bWVudCIsImdldFNuYXBzaG90cyIsImxpbWl0Iiwib2Zmc2V0IiwiZ2V0TGF0ZXN0U25hcHNob3QiLCJzbmFwc2hvdF9pZCIsImRvY19zdGF0ZSIsInNuYXBzaG90X2RhdGEiLCJnZXRTbmFwc2hvdEJ5SWQiLCJkb2NTdGF0ZUJhc2U2NCIsInNlYXJjaERvY3VtZW50cyIsInF1ZXJ5IiwidGhyZXNob2xkIiwicGFyc2VGbG9hdCIsInJlc3VsdHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/api/documents/document.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/api/workspace/workspace.controller.ts":
/*!***************************************************!*\
  !*** ./src/api/workspace/workspace.controller.ts ***!
  \***************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WorkspaceController: () => (/* binding */ WorkspaceController)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__]);\n([_dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__, _services_auth_service__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\nclass WorkspaceController {\n    constructor(workspaceDAO, authService){\n        this.workspaceDAO = workspaceDAO;\n        this.authService = authService;\n    }\n    /**\n   * 获取当前用户（从 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.authService.verifyToken(token);\n    }\n    /**\n   * 获取用户的默认工作空间\n   */ async getDefaultWorkspace(req) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const workspace = await this.workspaceDAO.getOrCreateDefault(user.uid);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    workspace_id: workspace.workspace_id,\n                    name: workspace.name,\n                    owner_uid: workspace.owner_uid,\n                    icon: workspace.icon,\n                    metadata: workspace.metadata,\n                    created_at: workspace.created_at instanceof Date ? workspace.created_at.toISOString() : workspace.created_at,\n                    updated_at: workspace.updated_at instanceof Date ? workspace.updated_at.toISOString() : workspace.updated_at\n                }\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get default workspace\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n    /**\n   * 获取用户的所有工作空间\n   */ async getWorkspaces(req) {\n        try {\n            const user = await this.getCurrentUser(req);\n            const workspaces = await this.workspaceDAO.findByOwnerUid(user.uid);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: workspaces.map((w)=>({\n                        workspace_id: w.workspace_id,\n                        name: w.name,\n                        owner_uid: w.owner_uid,\n                        icon: w.icon,\n                        metadata: w.metadata,\n                        created_at: w.created_at instanceof Date ? w.created_at.toISOString() : w.created_at,\n                        updated_at: w.updated_at instanceof Date ? w.updated_at.toISOString() : w.updated_at\n                    }))\n            });\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: error.message || \"Failed to get workspaces\"\n            }, {\n                status: error.message === \"Unauthorized\" ? 401 : 500\n            });\n        }\n    }\n}\nWorkspaceController = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(\"WorkspaceDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_1__.inject)(_services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService)),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_4__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__.WorkspaceDAO === \"undefined\" ? Object : _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_2__.WorkspaceDAO,\n        typeof _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService === \"undefined\" ? Object : _services_auth_service__WEBPACK_IMPORTED_MODULE_3__.AuthService\n    ])\n], WorkspaceController);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBpL3dvcmtzcGFjZS93b3Jrc3BhY2UuY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDVjtBQUNLO0FBQ0c7QUFNL0MsTUFBTUs7SUFDWEMsWUFDRSxZQUEwRCxFQUMxRCxXQUFxRCxDQUNyRDthQUZnQ0MsZUFBQUE7YUFDSEMsY0FBQUE7SUFDNUI7SUFFSDs7R0FFQyxHQUNELE1BQWNDLGVBQWVDLEdBQWdCLEVBQTBDO1FBQ3JGLE1BQU1DLGFBQWFELElBQUlFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO1FBQ25DLElBQUksQ0FBQ0YsY0FBYyxDQUFDQSxXQUFXRyxVQUFVLENBQUMsWUFBWTtZQUNwRCxNQUFNLElBQUlDLE1BQU07UUFDbEI7UUFFQSxNQUFNQyxRQUFRTCxXQUFXTSxTQUFTLENBQUM7UUFDbkMsT0FBTyxNQUFNLElBQUksQ0FBQ1QsV0FBVyxDQUFDVSxXQUFXLENBQUNGO0lBQzVDO0lBRUE7O0dBRUMsR0FDRCxNQUFNRyxvQkFBb0JULEdBQWdCLEVBQXlCO1FBQ2pFLElBQUk7WUFDRixNQUFNVSxPQUFPLE1BQU0sSUFBSSxDQUFDWCxjQUFjLENBQUNDO1lBQ3ZDLE1BQU1XLFlBQVksTUFBTSxJQUFJLENBQUNkLFlBQVksQ0FBQ2Usa0JBQWtCLENBQUNGLEtBQUtHLEdBQUc7WUFFckUsT0FBT3ZCLHFEQUFZQSxDQUFDd0IsSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztnQkFDVEMsTUFBTTtvQkFDSkMsY0FBY04sVUFBVU0sWUFBWTtvQkFDcENDLE1BQU1QLFVBQVVPLElBQUk7b0JBQ3BCQyxXQUFXUixVQUFVUSxTQUFTO29CQUM5QkMsTUFBTVQsVUFBVVMsSUFBSTtvQkFDcEJDLFVBQVVWLFVBQVVVLFFBQVE7b0JBQzVCQyxZQUFZWCxVQUFVVyxVQUFVLFlBQVlDLE9BQU9aLFVBQVVXLFVBQVUsQ0FBQ0UsV0FBVyxLQUFLYixVQUFVVyxVQUFVO29CQUM1R0csWUFBWWQsVUFBVWMsVUFBVSxZQUFZRixPQUFPWixVQUFVYyxVQUFVLENBQUNELFdBQVcsS0FBS2IsVUFBVWMsVUFBVTtnQkFDOUc7WUFDRjtRQUNGLEVBQUUsT0FBT0MsT0FBWTtZQUNuQixPQUFPcEMscURBQVlBLENBQUN3QixJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNUWSxTQUFTRCxNQUFNQyxPQUFPLElBQUk7WUFDNUIsR0FDQTtnQkFBRUMsUUFBUUYsTUFBTUMsT0FBTyxLQUFLLGlCQUFpQixNQUFNO1lBQUk7UUFFM0Q7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTUUsY0FBYzdCLEdBQWdCLEVBQXlCO1FBQzNELElBQUk7WUFDRixNQUFNVSxPQUFPLE1BQU0sSUFBSSxDQUFDWCxjQUFjLENBQUNDO1lBQ3ZDLE1BQU04QixhQUFhLE1BQU0sSUFBSSxDQUFDakMsWUFBWSxDQUFDa0MsY0FBYyxDQUFDckIsS0FBS0csR0FBRztZQUVsRSxPQUFPdkIscURBQVlBLENBQUN3QixJQUFJLENBQUM7Z0JBQ3ZCQyxTQUFTO2dCQUNUQyxNQUFNYyxXQUFXRSxHQUFHLENBQUMsQ0FBQ0MsSUFBTzt3QkFDM0JoQixjQUFjZ0IsRUFBRWhCLFlBQVk7d0JBQzVCQyxNQUFNZSxFQUFFZixJQUFJO3dCQUNaQyxXQUFXYyxFQUFFZCxTQUFTO3dCQUN0QkMsTUFBTWEsRUFBRWIsSUFBSTt3QkFDWkMsVUFBVVksRUFBRVosUUFBUTt3QkFDcEJDLFlBQVlXLEVBQUVYLFVBQVUsWUFBWUMsT0FBT1UsRUFBRVgsVUFBVSxDQUFDRSxXQUFXLEtBQUtTLEVBQUVYLFVBQVU7d0JBQ3BGRyxZQUFZUSxFQUFFUixVQUFVLFlBQVlGLE9BQU9VLEVBQUVSLFVBQVUsQ0FBQ0QsV0FBVyxLQUFLUyxFQUFFUixVQUFVO29CQUN0RjtZQUNGO1FBQ0YsRUFBRSxPQUFPQyxPQUFZO1lBQ25CLE9BQU9wQyxxREFBWUEsQ0FBQ3dCLElBQUksQ0FDdEI7Z0JBQ0VDLFNBQVM7Z0JBQ1RZLFNBQVNELE1BQU1DLE9BQU8sSUFBSTtZQUM1QixHQUNBO2dCQUFFQyxRQUFRRixNQUFNQyxPQUFPLEtBQUssaUJBQWlCLE1BQU07WUFBSTtRQUUzRDtJQUNGO0FBQ0Y7QUFoRmFoQyxzQkFBQUEsb0VBQUFBO0lBRFpKLG9EQUFVQTtJQUdOQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7SUFDUEEsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDRSwrREFBV0E7OztlQUQyQiw0REFBWSw0QkFBWiw0REFBWTtlQUNoQiwrREFBVyw0QkFBWCwrREFBVzs7R0FINUNDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2FwaS93b3Jrc3BhY2Uvd29ya3NwYWNlLmNvbnRyb2xsZXIudHM/MDU0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IHsgV29ya3NwYWNlREFPIH0gZnJvbSAnQC9kYW8vd29ya3NwYWNlLmRhbyc7XG5pbXBvcnQgeyBBdXRoU2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvYXV0aC5zZXJ2aWNlJztcblxuLyoqXG4gKiDlt6XkvZznqbrpl7TmjqfliLblmahcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFdvcmtzcGFjZUNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdXb3Jrc3BhY2VEQU8nKSBwcml2YXRlIHdvcmtzcGFjZURBTzogV29ya3NwYWNlREFPLFxuICAgIEBpbmplY3QoQXV0aFNlcnZpY2UpIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlXG4gICkge31cblxuICAvKipcbiAgICog6I635Y+W5b2T5YmN55So5oi377yI5LuOIHRva2Vu77yJXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEN1cnJlbnRVc2VyKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPHsgdWlkOiBudW1iZXI7IHV1aWQ6IHN0cmluZyB9PiB7XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpO1xuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnN1YnN0cmluZyg3KTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5hdXRoU2VydmljZS52ZXJpZnlUb2tlbih0b2tlbik7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE6buY6K6k5bel5L2c56m66Ze0XG4gICAqL1xuICBhc3luYyBnZXREZWZhdWx0V29ya3NwYWNlKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcihyZXEpO1xuICAgICAgY29uc3Qgd29ya3NwYWNlID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uZ2V0T3JDcmVhdGVEZWZhdWx0KHVzZXIudWlkKTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHdvcmtzcGFjZV9pZDogd29ya3NwYWNlLndvcmtzcGFjZV9pZCxcbiAgICAgICAgICBuYW1lOiB3b3Jrc3BhY2UubmFtZSxcbiAgICAgICAgICBvd25lcl91aWQ6IHdvcmtzcGFjZS5vd25lcl91aWQsXG4gICAgICAgICAgaWNvbjogd29ya3NwYWNlLmljb24sXG4gICAgICAgICAgbWV0YWRhdGE6IHdvcmtzcGFjZS5tZXRhZGF0YSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiB3b3Jrc3BhY2UuY3JlYXRlZF9hdCBpbnN0YW5jZW9mIERhdGUgPyB3b3Jrc3BhY2UuY3JlYXRlZF9hdC50b0lTT1N0cmluZygpIDogd29ya3NwYWNlLmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogd29ya3NwYWNlLnVwZGF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gd29ya3NwYWNlLnVwZGF0ZWRfYXQudG9JU09TdHJpbmcoKSA6IHdvcmtzcGFjZS51cGRhdGVkX2F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkZWZhdWx0IHdvcmtzcGFjZScsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBlcnJvci5tZXNzYWdlID09PSAnVW5hdXRob3JpemVkJyA/IDQwMSA6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfnmoTmiYDmnInlt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGdldFdvcmtzcGFjZXMocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKHJlcSk7XG4gICAgICBjb25zdCB3b3Jrc3BhY2VzID0gYXdhaXQgdGhpcy53b3Jrc3BhY2VEQU8uZmluZEJ5T3duZXJVaWQodXNlci51aWQpO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB3b3Jrc3BhY2VzLm1hcCgodykgPT4gKHtcbiAgICAgICAgICB3b3Jrc3BhY2VfaWQ6IHcud29ya3NwYWNlX2lkLFxuICAgICAgICAgIG5hbWU6IHcubmFtZSxcbiAgICAgICAgICBvd25lcl91aWQ6IHcub3duZXJfdWlkLFxuICAgICAgICAgIGljb246IHcuaWNvbixcbiAgICAgICAgICBtZXRhZGF0YTogdy5tZXRhZGF0YSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiB3LmNyZWF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gdy5jcmVhdGVkX2F0LnRvSVNPU3RyaW5nKCkgOiB3LmNyZWF0ZWRfYXQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogdy51cGRhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZSA/IHcudXBkYXRlZF9hdC50b0lTT1N0cmluZygpIDogdy51cGRhdGVkX2F0LFxuICAgICAgICB9KSksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZ2V0IHdvcmtzcGFjZXMnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogZXJyb3IubWVzc2FnZSA9PT0gJ1VuYXV0aG9yaXplZCcgPyA0MDEgOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImluamVjdGFibGUiLCJpbmplY3QiLCJXb3Jrc3BhY2VEQU8iLCJBdXRoU2VydmljZSIsIldvcmtzcGFjZUNvbnRyb2xsZXIiLCJjb25zdHJ1Y3RvciIsIndvcmtzcGFjZURBTyIsImF1dGhTZXJ2aWNlIiwiZ2V0Q3VycmVudFVzZXIiLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInN0YXJ0c1dpdGgiLCJFcnJvciIsInRva2VuIiwic3Vic3RyaW5nIiwidmVyaWZ5VG9rZW4iLCJnZXREZWZhdWx0V29ya3NwYWNlIiwidXNlciIsIndvcmtzcGFjZSIsImdldE9yQ3JlYXRlRGVmYXVsdCIsInVpZCIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsIndvcmtzcGFjZV9pZCIsIm5hbWUiLCJvd25lcl91aWQiLCJpY29uIiwibWV0YWRhdGEiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidXBkYXRlZF9hdCIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImdldFdvcmtzcGFjZXMiLCJ3b3Jrc3BhY2VzIiwiZmluZEJ5T3duZXJVaWQiLCJtYXAiLCJ3Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/api/workspace/workspace.controller.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/workspace/[workspace_id]/documents/[object_id]/route.ts":
/*!*****************************************************************************!*\
  !*** ./src/app/api/workspace/[workspace_id]/documents/[object_id]/route.ts ***!
  \*****************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   PUT: () => (/* binding */ PUT)\n/* harmony export */ });\n/* harmony import */ var _core_init__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/init */ \"(rsc)/./src/core/init.ts\");\n/* harmony import */ var _core_container__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/core/container */ \"(rsc)/./src/core/container.ts\");\n/* harmony import */ var _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/api/documents/document.controller */ \"(rsc)/./src/api/documents/document.controller.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_init__WEBPACK_IMPORTED_MODULE_0__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__]);\n([_core_init__WEBPACK_IMPORTED_MODULE_0__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n/**\n * GET /api/workspace/[workspace_id]/documents/[object_id] - 获取文档\n * PUT /api/workspace/[workspace_id]/documents/[object_id] - 更新文档\n * DELETE /api/workspace/[workspace_id]/documents/[object_id] - 删除文档\n */ async function GET(req, { params }) {\n    const controller = _core_container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__.DocumentController);\n    return controller.getDocument(req, {\n        params\n    });\n}\nasync function PUT(req, { params }) {\n    const controller = _core_container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__.DocumentController);\n    return controller.updateDocument(req, {\n        params\n    });\n}\nasync function DELETE(req, { params }) {\n    const controller = _core_container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_2__.DocumentController);\n    return controller.deleteDocument(req, {\n        params\n    });\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL1tvYmplY3RfaWRdL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUNxQjtBQUN3QjtBQUM0QjtBQUV6RTs7OztDQUlDLEdBQ00sZUFBZUUsSUFDcEJDLEdBQWdCLEVBQ2hCLEVBQUVDLE1BQU0sRUFBMkQ7SUFFbkUsTUFBTUMsYUFBYUwsc0RBQVNBLENBQUNNLE9BQU8sQ0FBcUJMLGtGQUFrQkE7SUFDM0UsT0FBT0ksV0FBV0UsV0FBVyxDQUFDSixLQUFLO1FBQUVDO0lBQU87QUFDOUM7QUFFTyxlQUFlSSxJQUNwQkwsR0FBZ0IsRUFDaEIsRUFBRUMsTUFBTSxFQUEyRDtJQUVuRSxNQUFNQyxhQUFhTCxzREFBU0EsQ0FBQ00sT0FBTyxDQUFxQkwsa0ZBQWtCQTtJQUMzRSxPQUFPSSxXQUFXSSxjQUFjLENBQUNOLEtBQUs7UUFBRUM7SUFBTztBQUNqRDtBQUVPLGVBQWVNLE9BQ3BCUCxHQUFnQixFQUNoQixFQUFFQyxNQUFNLEVBQTJEO0lBRW5FLE1BQU1DLGFBQWFMLHNEQUFTQSxDQUFDTSxPQUFPLENBQXFCTCxrRkFBa0JBO0lBQzNFLE9BQU9JLFdBQVdNLGNBQWMsQ0FBQ1IsS0FBSztRQUFFQztJQUFPO0FBQ2pEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2FwcC9hcGkvd29ya3NwYWNlL1t3b3Jrc3BhY2VfaWRdL2RvY3VtZW50cy9bb2JqZWN0X2lkXS9yb3V0ZS50cz8yMjhlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0ICdAL2NvcmUvaW5pdCc7XG5pbXBvcnQgeyBDb250YWluZXIgfSBmcm9tICdAL2NvcmUvY29udGFpbmVyJztcbmltcG9ydCB7IERvY3VtZW50Q29udHJvbGxlciB9IGZyb20gJ0AvYXBpL2RvY3VtZW50cy9kb2N1bWVudC5jb250cm9sbGVyJztcblxuLyoqXG4gKiBHRVQgL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL1tvYmplY3RfaWRdIC0g6I635Y+W5paH5qGjXG4gKiBQVVQgL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL1tvYmplY3RfaWRdIC0g5pu05paw5paH5qGjXG4gKiBERUxFVEUgL2FwaS93b3Jrc3BhY2UvW3dvcmtzcGFjZV9pZF0vZG9jdW1lbnRzL1tvYmplY3RfaWRdIC0g5Yig6Zmk5paH5qGjXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoXG4gIHJlcTogTmV4dFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiB7IHdvcmtzcGFjZV9pZDogc3RyaW5nOyBvYmplY3RfaWQ6IHN0cmluZyB9IH1cbikge1xuICBjb25zdCBjb250cm9sbGVyID0gQ29udGFpbmVyLnJlc29sdmU8RG9jdW1lbnRDb250cm9sbGVyPihEb2N1bWVudENvbnRyb2xsZXIpO1xuICByZXR1cm4gY29udHJvbGxlci5nZXREb2N1bWVudChyZXEsIHsgcGFyYW1zIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUFVUKFxuICByZXE6IE5leHRSZXF1ZXN0LFxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogeyB3b3Jrc3BhY2VfaWQ6IHN0cmluZzsgb2JqZWN0X2lkOiBzdHJpbmcgfSB9XG4pIHtcbiAgY29uc3QgY29udHJvbGxlciA9IENvbnRhaW5lci5yZXNvbHZlPERvY3VtZW50Q29udHJvbGxlcj4oRG9jdW1lbnRDb250cm9sbGVyKTtcbiAgcmV0dXJuIGNvbnRyb2xsZXIudXBkYXRlRG9jdW1lbnQocmVxLCB7IHBhcmFtcyB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIERFTEVURShcbiAgcmVxOiBOZXh0UmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgd29ya3NwYWNlX2lkOiBzdHJpbmc7IG9iamVjdF9pZDogc3RyaW5nIH0gfVxuKSB7XG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBDb250YWluZXIucmVzb2x2ZTxEb2N1bWVudENvbnRyb2xsZXI+KERvY3VtZW50Q29udHJvbGxlcik7XG4gIHJldHVybiBjb250cm9sbGVyLmRlbGV0ZURvY3VtZW50KHJlcSwgeyBwYXJhbXMgfSk7XG59XG5cbiJdLCJuYW1lcyI6WyJDb250YWluZXIiLCJEb2N1bWVudENvbnRyb2xsZXIiLCJHRVQiLCJyZXEiLCJwYXJhbXMiLCJjb250cm9sbGVyIiwicmVzb2x2ZSIsImdldERvY3VtZW50IiwiUFVUIiwidXBkYXRlRG9jdW1lbnQiLCJERUxFVEUiLCJkZWxldGVEb2N1bWVudCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/workspace/[workspace_id]/documents/[object_id]/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/container.ts":
/*!*******************************!*\
  !*** ./src/core/container.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Container: () => (/* binding */ Container)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n\n\n/**\n * 依赖注入容器单例\n */ class Container {\n    static getInstance() {\n        if (!Container.instance) {\n            Container.instance = tsyringe__WEBPACK_IMPORTED_MODULE_1__.container;\n        }\n        return Container.instance;\n    }\n    /**\n   * 注册服务\n   */ static register(token, factory) {\n        tsyringe__WEBPACK_IMPORTED_MODULE_1__.container.register(token, {\n            useFactory: factory\n        });\n    }\n    /**\n   * 解析服务\n   */ static resolve(token) {\n        return tsyringe__WEBPACK_IMPORTED_MODULE_1__.container.resolve(token);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9jb250YWluZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUEwQjtBQUNnQztBQUUxRDs7Q0FFQyxHQUNNLE1BQU1DO0lBR1gsT0FBY0MsY0FBbUM7UUFDL0MsSUFBSSxDQUFDRCxVQUFVRSxRQUFRLEVBQUU7WUFDdkJGLFVBQVVFLFFBQVEsR0FBR0gsK0NBQVNBO1FBQ2hDO1FBQ0EsT0FBT0MsVUFBVUUsUUFBUTtJQUMzQjtJQUVBOztHQUVDLEdBQ0QsT0FBY0MsU0FDWkMsS0FBaUMsRUFDakNDLE9BQWdCLEVBQ1Y7UUFDTk4sK0NBQVNBLENBQUNJLFFBQVEsQ0FBQ0MsT0FBTztZQUFFRSxZQUFZRDtRQUFRO0lBQ2xEO0lBRUE7O0dBRUMsR0FDRCxPQUFjRSxRQUFXSCxLQUFpQyxFQUFLO1FBQzdELE9BQU9MLCtDQUFTQSxDQUFDUSxPQUFPLENBQUlIO0lBQzlCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9jb250YWluZXIudHM/YjZhNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuaW1wb3J0IHsgY29udGFpbmVyLCBEZXBlbmRlbmN5Q29udGFpbmVyIH0gZnJvbSAndHN5cmluZ2UnO1xuXG4vKipcbiAqIOS+nei1luazqOWFpeWuueWZqOWNleS+i1xuICovXG5leHBvcnQgY2xhc3MgQ29udGFpbmVyIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IERlcGVuZGVuY3lDb250YWluZXI7XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBEZXBlbmRlbmN5Q29udGFpbmVyIHtcbiAgICBpZiAoIUNvbnRhaW5lci5pbnN0YW5jZSkge1xuICAgICAgQ29udGFpbmVyLmluc3RhbmNlID0gY29udGFpbmVyO1xuICAgIH1cbiAgICByZXR1cm4gQ29udGFpbmVyLmluc3RhbmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIOazqOWGjOacjeWKoVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyByZWdpc3RlcjxUPihcbiAgICB0b2tlbjogc3RyaW5nIHwgc3ltYm9sIHwgRnVuY3Rpb24sXG4gICAgZmFjdG9yeTogKCkgPT4gVFxuICApOiB2b2lkIHtcbiAgICBjb250YWluZXIucmVnaXN0ZXIodG9rZW4sIHsgdXNlRmFjdG9yeTogZmFjdG9yeSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDop6PmnpDmnI3liqFcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcmVzb2x2ZTxUPih0b2tlbjogc3RyaW5nIHwgc3ltYm9sIHwgRnVuY3Rpb24pOiBUIHtcbiAgICByZXR1cm4gY29udGFpbmVyLnJlc29sdmU8VD4odG9rZW4pO1xuICB9XG59XG5cblxuXG5cbiJdLCJuYW1lcyI6WyJjb250YWluZXIiLCJDb250YWluZXIiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwicmVnaXN0ZXIiLCJ0b2tlbiIsImZhY3RvcnkiLCJ1c2VGYWN0b3J5IiwicmVzb2x2ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/container.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/database.ts":
/*!******************************!*\
  !*** ./src/core/database.ts ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Database: () => (/* binding */ Database)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pg */ \"pg\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_1__]);\npg__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nclass Database {\n    constructor(){\n        const connectionString = \"postgresql://pikun@localhost:5432/postgres\";\n        console.log(\"connectionString\", connectionString);\n        if (!connectionString) {\n            throw new Error(\"DATABASE_URL environment variable is not set. \" + \"Please create a .env file in apps/server/ directory with DATABASE_URL=postgresql://pikun@localhost:5432/postgres\");\n        }\n        const config = {\n            connectionString,\n            min: parseInt(\"2\" || 0, 10),\n            max: parseInt(\"10\" || 0, 10),\n            idleTimeoutMillis: 30000,\n            connectionTimeoutMillis: 2000\n        };\n        this.pool = new pg__WEBPACK_IMPORTED_MODULE_1__.Pool(config);\n        // 处理连接错误\n        this.pool.on(\"error\", (err)=>{\n            console.error(\"Unexpected error on idle client\", err);\n        });\n    }\n    static getInstance() {\n        if (!Database.instance) {\n            Database.instance = new Database();\n        }\n        return Database.instance;\n    }\n    getPool() {\n        return this.pool;\n    }\n    /**\n   * 执行查询（使用参数化查询防止 SQL 注入）\n   */ async query(text, params) {\n        const start = Date.now();\n        try {\n            // 设置默认 schema\n            await this.pool.query(\"SET search_path TO pikun_db, public\");\n            const result = await this.pool.query(text, params);\n            const duration = Date.now() - start;\n            console.log(\"Executed query\", {\n                text,\n                duration,\n                rows: result.rowCount\n            });\n            return {\n                rows: result.rows,\n                rowCount: result.rowCount || 0\n            };\n        } catch (error) {\n            console.error(\"Database query error\", {\n                text,\n                error\n            });\n            throw error;\n        }\n    }\n    /**\n   * 执行事务\n   */ async transaction(callback) {\n        const client = await this.pool.connect();\n        try {\n            await client.query(\"SET search_path TO pikun_db, public\");\n            await client.query(\"BEGIN\");\n            const result = await callback(client);\n            await client.query(\"COMMIT\");\n            return result;\n        } catch (error) {\n            await client.query(\"ROLLBACK\");\n            throw error;\n        } finally{\n            client.release();\n        }\n    }\n    /**\n   * 关闭连接池\n   */ async close() {\n        await this.pool.end();\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9kYXRhYmFzZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQTBCO0FBQ1k7QUFFL0IsTUFBTUM7SUFJWCxhQUFzQjtRQUNwQixNQUFNQyxtQkFBbUJDLDRDQUF3QjtRQUNqREcsUUFBUUMsR0FBRyxDQUFDLG9CQUFvQkw7UUFFaEMsSUFBSSxDQUFDQSxrQkFBa0I7WUFDckIsTUFBTSxJQUFJTSxNQUNSLG1EQUNFO1FBRU47UUFFQSxNQUFNQyxTQUFxQjtZQUN6QlA7WUFDQVEsS0FBS0MsU0FBU1IsR0FBNkIsSUFBSSxHQUFLO1lBQ3BEVSxLQUFLRixTQUFTUixJQUE2QixJQUFJLEdBQU07WUFDckRZLG1CQUFtQjtZQUNuQkMseUJBQXlCO1FBQzNCO1FBRUEsSUFBSSxDQUFDQyxJQUFJLEdBQUcsSUFBSWpCLG9DQUFJQSxDQUFDUztRQUVyQixTQUFTO1FBQ1QsSUFBSSxDQUFDUSxJQUFJLENBQUNDLEVBQUUsQ0FBQyxTQUFTLENBQUNDO1lBQ3JCYixRQUFRYyxLQUFLLENBQUMsbUNBQW1DRDtRQUNuRDtJQUNGO0lBRUEsT0FBY0UsY0FBd0I7UUFDcEMsSUFBSSxDQUFDcEIsU0FBU3FCLFFBQVEsRUFBRTtZQUN0QnJCLFNBQVNxQixRQUFRLEdBQUcsSUFBSXJCO1FBQzFCO1FBQ0EsT0FBT0EsU0FBU3FCLFFBQVE7SUFDMUI7SUFFT0MsVUFBZ0I7UUFDckIsT0FBTyxJQUFJLENBQUNOLElBQUk7SUFDbEI7SUFFQTs7R0FFQyxHQUNELE1BQWFPLE1BQ1hDLElBQVksRUFDWkMsTUFBYyxFQUM0QjtRQUMxQyxNQUFNQyxRQUFRQyxLQUFLQyxHQUFHO1FBQ3RCLElBQUk7WUFDRixjQUFjO1lBQ2QsTUFBTSxJQUFJLENBQUNaLElBQUksQ0FBQ08sS0FBSyxDQUFDO1lBQ3RCLE1BQU1NLFNBQVMsTUFBTSxJQUFJLENBQUNiLElBQUksQ0FBQ08sS0FBSyxDQUFDQyxNQUFNQztZQUMzQyxNQUFNSyxXQUFXSCxLQUFLQyxHQUFHLEtBQUtGO1lBQzlCckIsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQjtnQkFBRWtCO2dCQUFNTTtnQkFBVUMsTUFBTUYsT0FBT0csUUFBUTtZQUFDO1lBQ3RFLE9BQU87Z0JBQ0xELE1BQU1GLE9BQU9FLElBQUk7Z0JBQ2pCQyxVQUFVSCxPQUFPRyxRQUFRLElBQUk7WUFDL0I7UUFDRixFQUFFLE9BQU9iLE9BQU87WUFDZGQsUUFBUWMsS0FBSyxDQUFDLHdCQUF3QjtnQkFBRUs7Z0JBQU1MO1lBQU07WUFDcEQsTUFBTUE7UUFDUjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFhYyxZQUFlQyxRQUFxQyxFQUFjO1FBQzdFLE1BQU1DLFNBQVMsTUFBTSxJQUFJLENBQUNuQixJQUFJLENBQUNvQixPQUFPO1FBQ3RDLElBQUk7WUFDRixNQUFNRCxPQUFPWixLQUFLLENBQUM7WUFDbkIsTUFBTVksT0FBT1osS0FBSyxDQUFDO1lBQ25CLE1BQU1NLFNBQVMsTUFBTUssU0FBU0M7WUFDOUIsTUFBTUEsT0FBT1osS0FBSyxDQUFDO1lBQ25CLE9BQU9NO1FBQ1QsRUFBRSxPQUFPVixPQUFPO1lBQ2QsTUFBTWdCLE9BQU9aLEtBQUssQ0FBQztZQUNuQixNQUFNSjtRQUNSLFNBQVU7WUFDUmdCLE9BQU9FLE9BQU87UUFDaEI7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBYUMsUUFBdUI7UUFDbEMsTUFBTSxJQUFJLENBQUN0QixJQUFJLENBQUN1QixHQUFHO0lBQ3JCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvY29yZS9kYXRhYmFzZS50cz85ZTE2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5pbXBvcnQgeyBQb29sLCBQb29sQ29uZmlnIH0gZnJvbSAncGcnO1xuXG5leHBvcnQgY2xhc3MgRGF0YWJhc2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogRGF0YWJhc2U7XG4gIHByaXZhdGUgcG9vbDogUG9vbDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IGNvbm5lY3Rpb25TdHJpbmcgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkw7XG4gICAgY29uc29sZS5sb2coJ2Nvbm5lY3Rpb25TdHJpbmcnLCBjb25uZWN0aW9uU3RyaW5nKTtcblxuICAgIGlmICghY29ubmVjdGlvblN0cmluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnREFUQUJBU0VfVVJMIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIG5vdCBzZXQuICcgK1xuICAgICAgICAgICdQbGVhc2UgY3JlYXRlIGEgLmVudiBmaWxlIGluIGFwcHMvc2VydmVyLyBkaXJlY3Rvcnkgd2l0aCBEQVRBQkFTRV9VUkw9cG9zdGdyZXNxbDovL3Bpa3VuQGxvY2FsaG9zdDo1NDMyL3Bvc3RncmVzJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb25maWc6IFBvb2xDb25maWcgPSB7XG4gICAgICBjb25uZWN0aW9uU3RyaW5nLFxuICAgICAgbWluOiBwYXJzZUludChwcm9jZXNzLmVudi5EQVRBQkFTRV9QT09MX01JTiB8fCAnMicsIDEwKSxcbiAgICAgIG1heDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuREFUQUJBU0VfUE9PTF9NQVggfHwgJzEwJywgMTApLFxuICAgICAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxuICAgICAgY29ubmVjdGlvblRpbWVvdXRNaWxsaXM6IDIwMDAsXG4gICAgfTtcblxuICAgIHRoaXMucG9vbCA9IG5ldyBQb29sKGNvbmZpZyk7XG5cbiAgICAvLyDlpITnkIbov57mjqXplJnor69cbiAgICB0aGlzLnBvb2wub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignVW5leHBlY3RlZCBlcnJvciBvbiBpZGxlIGNsaWVudCcsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IERhdGFiYXNlIHtcbiAgICBpZiAoIURhdGFiYXNlLmluc3RhbmNlKSB7XG4gICAgICBEYXRhYmFzZS5pbnN0YW5jZSA9IG5ldyBEYXRhYmFzZSgpO1xuICAgIH1cbiAgICByZXR1cm4gRGF0YWJhc2UuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgZ2V0UG9vbCgpOiBQb29sIHtcbiAgICByZXR1cm4gdGhpcy5wb29sO1xuICB9XG5cbiAgLyoqXG4gICAqIOaJp+ihjOafpeivou+8iOS9v+eUqOWPguaVsOWMluafpeivoumYsuatoiBTUUwg5rOo5YWl77yJXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgcXVlcnk8VCA9IGFueT4oXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIHBhcmFtcz86IGFueVtdXG4gICk6IFByb21pc2U8eyByb3dzOiBUW107IHJvd0NvdW50OiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICB0cnkge1xuICAgICAgLy8g6K6+572u6buY6K6kIHNjaGVtYVxuICAgICAgYXdhaXQgdGhpcy5wb29sLnF1ZXJ5KCdTRVQgc2VhcmNoX3BhdGggVE8gcGlrdW5fZGIsIHB1YmxpYycpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wb29sLnF1ZXJ5KHRleHQsIHBhcmFtcyk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydDtcbiAgICAgIGNvbnNvbGUubG9nKCdFeGVjdXRlZCBxdWVyeScsIHsgdGV4dCwgZHVyYXRpb24sIHJvd3M6IHJlc3VsdC5yb3dDb3VudCB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJvd3M6IHJlc3VsdC5yb3dzIGFzIFRbXSxcbiAgICAgICAgcm93Q291bnQ6IHJlc3VsdC5yb3dDb3VudCB8fCAwLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgcXVlcnkgZXJyb3InLCB7IHRleHQsIGVycm9yIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOaJp+ihjOS6i+WKoVxuICAgKi9cbiAgcHVibGljIGFzeW5jIHRyYW5zYWN0aW9uPFQ+KGNhbGxiYWNrOiAoY2xpZW50OiBhbnkpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+IHtcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCB0aGlzLnBvb2wuY29ubmVjdCgpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoJ1NFVCBzZWFyY2hfcGF0aCBUTyBwaWt1bl9kYiwgcHVibGljJyk7XG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0JFR0lOJyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxsYmFjayhjbGllbnQpO1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdDT01NSVQnKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnUk9MTEJBQ0snKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBjbGllbnQucmVsZWFzZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlhbPpl63ov57mjqXmsaBcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnBvb2wuZW5kKCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJQb29sIiwiRGF0YWJhc2UiLCJjb25uZWN0aW9uU3RyaW5nIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsImNvbnNvbGUiLCJsb2ciLCJFcnJvciIsImNvbmZpZyIsIm1pbiIsInBhcnNlSW50IiwiREFUQUJBU0VfUE9PTF9NSU4iLCJtYXgiLCJEQVRBQkFTRV9QT09MX01BWCIsImlkbGVUaW1lb3V0TWlsbGlzIiwiY29ubmVjdGlvblRpbWVvdXRNaWxsaXMiLCJwb29sIiwib24iLCJlcnIiLCJlcnJvciIsImdldEluc3RhbmNlIiwiaW5zdGFuY2UiLCJnZXRQb29sIiwicXVlcnkiLCJ0ZXh0IiwicGFyYW1zIiwic3RhcnQiLCJEYXRlIiwibm93IiwicmVzdWx0IiwiZHVyYXRpb24iLCJyb3dzIiwicm93Q291bnQiLCJ0cmFuc2FjdGlvbiIsImNhbGxiYWNrIiwiY2xpZW50IiwiY29ubmVjdCIsInJlbGVhc2UiLCJjbG9zZSIsImVuZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/database.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/init.ts":
/*!**************************!*\
  !*** ./src/core/init.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initializeContainer: () => (/* binding */ initializeContainer)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _container__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./container */ \"(rsc)/./src/core/container.ts\");\n/* harmony import */ var _dao_user_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/user.dao */ \"(rsc)/./src/dao/user.dao.ts\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/dao/document-change.dao */ \"(rsc)/./src/dao/document-change.dao.ts\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _services_auth_service__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/services/auth.service */ \"(rsc)/./src/services/auth.service.ts\");\n/* harmony import */ var _services_document_service__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/services/document.service */ \"(rsc)/./src/services/document.service.ts\");\n/* harmony import */ var _services_snapshot_service__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @/services/snapshot.service */ \"(rsc)/./src/services/snapshot.service.ts\");\n/* harmony import */ var _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @/services/snapshot-scheduler.service */ \"(rsc)/./src/services/snapshot-scheduler.service.ts\");\n/* harmony import */ var _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @/api/auth/auth.controller */ \"(rsc)/./src/api/auth/auth.controller.ts\");\n/* harmony import */ var _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @/api/documents/document.controller */ \"(rsc)/./src/api/documents/document.controller.ts\");\n/* harmony import */ var _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @/api/workspace/workspace.controller */ \"(rsc)/./src/api/workspace/workspace.controller.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__, _services_auth_service__WEBPACK_IMPORTED_MODULE_6__, _services_document_service__WEBPACK_IMPORTED_MODULE_7__, _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_9__, _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__, _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__]);\n([_dao_user_dao__WEBPACK_IMPORTED_MODULE_2__, _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__, _services_auth_service__WEBPACK_IMPORTED_MODULE_6__, _services_document_service__WEBPACK_IMPORTED_MODULE_7__, _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_9__, _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__, _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__, _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * 初始化依赖注入容器\n * 注册所有服务和控制器\n */ function initializeContainer() {\n    // 注册 DAO\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"UserDAO\", ()=>new _dao_user_dao__WEBPACK_IMPORTED_MODULE_2__.UserDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"DocumentDAO\", ()=>new _dao_document_dao__WEBPACK_IMPORTED_MODULE_3__.DocumentDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"WorkspaceDAO\", ()=>new _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_5__.WorkspaceDAO());\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"DocumentChangeDAO\", ()=>new _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_4__.DocumentChangeDAO());\n    // 注册 Service\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService, ()=>{\n        const userDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"UserDAO\");\n        const workspaceDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"WorkspaceDAO\");\n        return new _services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService(userDAO, workspaceDAO, null);\n    });\n    // 注册 SnapshotService\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"SnapshotService\", ()=>new _services_snapshot_service__WEBPACK_IMPORTED_MODULE_8__.SnapshotService());\n    // 注册 SnapshotScheduler（需要在 DocumentService 之前注册）\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(\"SnapshotScheduler\", ()=>{\n        const documentDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentDAO\");\n        const snapshotService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"SnapshotService\");\n        return new _services_snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_9__.SnapshotScheduler(documentDAO, snapshotService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_services_document_service__WEBPACK_IMPORTED_MODULE_7__.DocumentService, ()=>{\n        const documentDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentDAO\");\n        const snapshotScheduler = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"SnapshotScheduler\");\n        const changeDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"DocumentChangeDAO\");\n        return new _services_document_service__WEBPACK_IMPORTED_MODULE_7__.DocumentService(documentDAO, null, snapshotScheduler, changeDAO);\n    });\n    // 注册 Controller\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__.AuthController, ()=>{\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService);\n        return new _api_auth_auth_controller__WEBPACK_IMPORTED_MODULE_10__.AuthController(authService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__.DocumentController, ()=>{\n        const documentService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_document_service__WEBPACK_IMPORTED_MODULE_7__.DocumentService);\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService);\n        return new _api_documents_document_controller__WEBPACK_IMPORTED_MODULE_11__.DocumentController(documentService, authService);\n    });\n    _container__WEBPACK_IMPORTED_MODULE_1__.Container.register(_api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__.WorkspaceController, ()=>{\n        const workspaceDAO = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(\"WorkspaceDAO\");\n        const authService = _container__WEBPACK_IMPORTED_MODULE_1__.Container.resolve(_services_auth_service__WEBPACK_IMPORTED_MODULE_6__.AuthService);\n        return new _api_workspace_workspace_controller__WEBPACK_IMPORTED_MODULE_12__.WorkspaceController(workspaceDAO, authService);\n    });\n}\n// 自动初始化\ninitializeContainer();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9pbml0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUEwQjtBQUNjO0FBQ0M7QUFDUTtBQUNhO0FBQ1g7QUFDRztBQUNRO0FBQ0E7QUFDWTtBQUNkO0FBQ2E7QUFDRTtBQUUzRTs7O0NBR0MsR0FDTSxTQUFTWTtJQUNkLFNBQVM7SUFDVFosaURBQVNBLENBQUNhLFFBQVEsQ0FBQyxXQUFXLElBQU0sSUFBSVosa0RBQU9BO0lBQy9DRCxpREFBU0EsQ0FBQ2EsUUFBUSxDQUFDLGVBQWUsSUFBTSxJQUFJWCwwREFBV0E7SUFDdkRGLGlEQUFTQSxDQUFDYSxRQUFRLENBQUMsZ0JBQWdCLElBQU0sSUFBSVQsNERBQVlBO0lBQ3pESixpREFBU0EsQ0FBQ2EsUUFBUSxDQUFDLHFCQUFxQixJQUFNLElBQUlWLHVFQUFpQkE7SUFFbkUsYUFBYTtJQUNiSCxpREFBU0EsQ0FBQ2EsUUFBUSxDQUFDUiwrREFBV0EsRUFBRTtRQUM5QixNQUFNUyxVQUFVZCxpREFBU0EsQ0FBQ2UsT0FBTyxDQUFVO1FBQzNDLE1BQU1DLGVBQWVoQixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFlO1FBQ3JELE9BQU8sSUFBSVYsK0RBQVdBLENBQUNTLFNBQVNFLGNBQWM7SUFDaEQ7SUFFQSxxQkFBcUI7SUFDckJoQixpREFBU0EsQ0FBQ2EsUUFBUSxDQUFDLG1CQUFtQixJQUFNLElBQUlOLHVFQUFlQTtJQUUvRCxpREFBaUQ7SUFDakRQLGlEQUFTQSxDQUFDYSxRQUFRLENBQUMscUJBQXFCO1FBQ3RDLE1BQU1JLGNBQWNqQixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFjO1FBQ25ELE1BQU1HLGtCQUFrQmxCLGlEQUFTQSxDQUFDZSxPQUFPLENBQWtCO1FBQzNELE9BQU8sSUFBSVAsbUZBQWlCQSxDQUFDUyxhQUFhQztJQUM1QztJQUVBbEIsaURBQVNBLENBQUNhLFFBQVEsQ0FBQ1AsdUVBQWVBLEVBQUU7UUFDbEMsTUFBTVcsY0FBY2pCLGlEQUFTQSxDQUFDZSxPQUFPLENBQWM7UUFDbkQsTUFBTUksb0JBQW9CbkIsaURBQVNBLENBQUNlLE9BQU8sQ0FBb0I7UUFDL0QsTUFBTUssWUFBWXBCLGlEQUFTQSxDQUFDZSxPQUFPLENBQW9CO1FBQ3ZELE9BQU8sSUFBSVQsdUVBQWVBLENBQUNXLGFBQWEsTUFBYUUsbUJBQW1CQztJQUMxRTtJQUVBLGdCQUFnQjtJQUNoQnBCLGlEQUFTQSxDQUFDYSxRQUFRLENBQUNKLHNFQUFjQSxFQUFFO1FBQ2pDLE1BQU1ZLGNBQWNyQixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFjViwrREFBV0E7UUFDOUQsT0FBTyxJQUFJSSxzRUFBY0EsQ0FBQ1k7SUFDNUI7SUFFQXJCLGlEQUFTQSxDQUFDYSxRQUFRLENBQUNILG1GQUFrQkEsRUFBRTtRQUNyQyxNQUFNWSxrQkFBa0J0QixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFrQlQsdUVBQWVBO1FBQzFFLE1BQU1lLGNBQWNyQixpREFBU0EsQ0FBQ2UsT0FBTyxDQUFjViwrREFBV0E7UUFDOUQsT0FBTyxJQUFJSyxtRkFBa0JBLENBQUNZLGlCQUFpQkQ7SUFDakQ7SUFFQXJCLGlEQUFTQSxDQUFDYSxRQUFRLENBQUNGLHFGQUFtQkEsRUFBRTtRQUN0QyxNQUFNSyxlQUFlaEIsaURBQVNBLENBQUNlLE9BQU8sQ0FBZTtRQUNyRCxNQUFNTSxjQUFjckIsaURBQVNBLENBQUNlLE9BQU8sQ0FBY1YsK0RBQVdBO1FBQzlELE9BQU8sSUFBSU0scUZBQW1CQSxDQUFDSyxjQUFjSztJQUMvQztBQUNGO0FBRUEsUUFBUTtBQUNSVCIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9jb3JlL2luaXQudHM/MzUzZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuaW1wb3J0IHsgQ29udGFpbmVyIH0gZnJvbSAnLi9jb250YWluZXInO1xuaW1wb3J0IHsgVXNlckRBTyB9IGZyb20gJ0AvZGFvL3VzZXIuZGFvJztcbmltcG9ydCB7IERvY3VtZW50REFPIH0gZnJvbSAnQC9kYW8vZG9jdW1lbnQuZGFvJztcbmltcG9ydCB7IERvY3VtZW50Q2hhbmdlREFPIH0gZnJvbSAnQC9kYW8vZG9jdW1lbnQtY2hhbmdlLmRhbyc7XG5pbXBvcnQgeyBXb3Jrc3BhY2VEQU8gfSBmcm9tICdAL2Rhby93b3Jrc3BhY2UuZGFvJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xuaW1wb3J0IHsgRG9jdW1lbnRTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9kb2N1bWVudC5zZXJ2aWNlJztcbmltcG9ydCB7IFNuYXBzaG90U2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvc25hcHNob3Quc2VydmljZSc7XG5pbXBvcnQgeyBTbmFwc2hvdFNjaGVkdWxlciB9IGZyb20gJ0Avc2VydmljZXMvc25hcHNob3Qtc2NoZWR1bGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXV0aENvbnRyb2xsZXIgfSBmcm9tICdAL2FwaS9hdXRoL2F1dGguY29udHJvbGxlcic7XG5pbXBvcnQgeyBEb2N1bWVudENvbnRyb2xsZXIgfSBmcm9tICdAL2FwaS9kb2N1bWVudHMvZG9jdW1lbnQuY29udHJvbGxlcic7XG5pbXBvcnQgeyBXb3Jrc3BhY2VDb250cm9sbGVyIH0gZnJvbSAnQC9hcGkvd29ya3NwYWNlL3dvcmtzcGFjZS5jb250cm9sbGVyJztcblxuLyoqXG4gKiDliJ3lp4vljJbkvp3otZbms6jlhaXlrrnlmahcbiAqIOazqOWGjOaJgOacieacjeWKoeWSjOaOp+WItuWZqFxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZUNvbnRhaW5lcigpIHtcbiAgLy8g5rOo5YaMIERBT1xuICBDb250YWluZXIucmVnaXN0ZXIoJ1VzZXJEQU8nLCAoKSA9PiBuZXcgVXNlckRBTygpKTtcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdEb2N1bWVudERBTycsICgpID0+IG5ldyBEb2N1bWVudERBTygpKTtcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdXb3Jrc3BhY2VEQU8nLCAoKSA9PiBuZXcgV29ya3NwYWNlREFPKCkpO1xuICBDb250YWluZXIucmVnaXN0ZXIoJ0RvY3VtZW50Q2hhbmdlREFPJywgKCkgPT4gbmV3IERvY3VtZW50Q2hhbmdlREFPKCkpO1xuXG4gIC8vIOazqOWGjCBTZXJ2aWNlXG4gIENvbnRhaW5lci5yZWdpc3RlcihBdXRoU2VydmljZSwgKCkgPT4ge1xuICAgIGNvbnN0IHVzZXJEQU8gPSBDb250YWluZXIucmVzb2x2ZTxVc2VyREFPPignVXNlckRBTycpO1xuICAgIGNvbnN0IHdvcmtzcGFjZURBTyA9IENvbnRhaW5lci5yZXNvbHZlPFdvcmtzcGFjZURBTz4oJ1dvcmtzcGFjZURBTycpO1xuICAgIHJldHVybiBuZXcgQXV0aFNlcnZpY2UodXNlckRBTywgd29ya3NwYWNlREFPLCBudWxsIGFzIGFueSk7XG4gIH0pO1xuXG4gIC8vIOazqOWGjCBTbmFwc2hvdFNlcnZpY2VcbiAgQ29udGFpbmVyLnJlZ2lzdGVyKCdTbmFwc2hvdFNlcnZpY2UnLCAoKSA9PiBuZXcgU25hcHNob3RTZXJ2aWNlKCkpO1xuXG4gIC8vIOazqOWGjCBTbmFwc2hvdFNjaGVkdWxlcu+8iOmcgOimgeWcqCBEb2N1bWVudFNlcnZpY2Ug5LmL5YmN5rOo5YaM77yJXG4gIENvbnRhaW5lci5yZWdpc3RlcignU25hcHNob3RTY2hlZHVsZXInLCAoKSA9PiB7XG4gICAgY29uc3QgZG9jdW1lbnREQU8gPSBDb250YWluZXIucmVzb2x2ZTxEb2N1bWVudERBTz4oJ0RvY3VtZW50REFPJyk7XG4gICAgY29uc3Qgc25hcHNob3RTZXJ2aWNlID0gQ29udGFpbmVyLnJlc29sdmU8U25hcHNob3RTZXJ2aWNlPignU25hcHNob3RTZXJ2aWNlJyk7XG4gICAgcmV0dXJuIG5ldyBTbmFwc2hvdFNjaGVkdWxlcihkb2N1bWVudERBTywgc25hcHNob3RTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgQ29udGFpbmVyLnJlZ2lzdGVyKERvY3VtZW50U2VydmljZSwgKCkgPT4ge1xuICAgIGNvbnN0IGRvY3VtZW50REFPID0gQ29udGFpbmVyLnJlc29sdmU8RG9jdW1lbnREQU8+KCdEb2N1bWVudERBTycpO1xuICAgIGNvbnN0IHNuYXBzaG90U2NoZWR1bGVyID0gQ29udGFpbmVyLnJlc29sdmU8U25hcHNob3RTY2hlZHVsZXI+KCdTbmFwc2hvdFNjaGVkdWxlcicpO1xuICAgIGNvbnN0IGNoYW5nZURBTyA9IENvbnRhaW5lci5yZXNvbHZlPERvY3VtZW50Q2hhbmdlREFPPignRG9jdW1lbnRDaGFuZ2VEQU8nKTtcbiAgICByZXR1cm4gbmV3IERvY3VtZW50U2VydmljZShkb2N1bWVudERBTywgbnVsbCBhcyBhbnksIHNuYXBzaG90U2NoZWR1bGVyLCBjaGFuZ2VEQU8pO1xuICB9KTtcblxuICAvLyDms6jlhowgQ29udHJvbGxlclxuICBDb250YWluZXIucmVnaXN0ZXIoQXV0aENvbnRyb2xsZXIsICgpID0+IHtcbiAgICBjb25zdCBhdXRoU2VydmljZSA9IENvbnRhaW5lci5yZXNvbHZlPEF1dGhTZXJ2aWNlPihBdXRoU2VydmljZSk7XG4gICAgcmV0dXJuIG5ldyBBdXRoQ29udHJvbGxlcihhdXRoU2VydmljZSk7XG4gIH0pO1xuXG4gIENvbnRhaW5lci5yZWdpc3RlcihEb2N1bWVudENvbnRyb2xsZXIsICgpID0+IHtcbiAgICBjb25zdCBkb2N1bWVudFNlcnZpY2UgPSBDb250YWluZXIucmVzb2x2ZTxEb2N1bWVudFNlcnZpY2U+KERvY3VtZW50U2VydmljZSk7XG4gICAgY29uc3QgYXV0aFNlcnZpY2UgPSBDb250YWluZXIucmVzb2x2ZTxBdXRoU2VydmljZT4oQXV0aFNlcnZpY2UpO1xuICAgIHJldHVybiBuZXcgRG9jdW1lbnRDb250cm9sbGVyKGRvY3VtZW50U2VydmljZSwgYXV0aFNlcnZpY2UpO1xuICB9KTtcblxuICBDb250YWluZXIucmVnaXN0ZXIoV29ya3NwYWNlQ29udHJvbGxlciwgKCkgPT4ge1xuICAgIGNvbnN0IHdvcmtzcGFjZURBTyA9IENvbnRhaW5lci5yZXNvbHZlPFdvcmtzcGFjZURBTz4oJ1dvcmtzcGFjZURBTycpO1xuICAgIGNvbnN0IGF1dGhTZXJ2aWNlID0gQ29udGFpbmVyLnJlc29sdmU8QXV0aFNlcnZpY2U+KEF1dGhTZXJ2aWNlKTtcbiAgICByZXR1cm4gbmV3IFdvcmtzcGFjZUNvbnRyb2xsZXIod29ya3NwYWNlREFPLCBhdXRoU2VydmljZSk7XG4gIH0pO1xufVxuXG4vLyDoh6rliqjliJ3lp4vljJZcbmluaXRpYWxpemVDb250YWluZXIoKTtcbiJdLCJuYW1lcyI6WyJDb250YWluZXIiLCJVc2VyREFPIiwiRG9jdW1lbnREQU8iLCJEb2N1bWVudENoYW5nZURBTyIsIldvcmtzcGFjZURBTyIsIkF1dGhTZXJ2aWNlIiwiRG9jdW1lbnRTZXJ2aWNlIiwiU25hcHNob3RTZXJ2aWNlIiwiU25hcHNob3RTY2hlZHVsZXIiLCJBdXRoQ29udHJvbGxlciIsIkRvY3VtZW50Q29udHJvbGxlciIsIldvcmtzcGFjZUNvbnRyb2xsZXIiLCJpbml0aWFsaXplQ29udGFpbmVyIiwicmVnaXN0ZXIiLCJ1c2VyREFPIiwicmVzb2x2ZSIsIndvcmtzcGFjZURBTyIsImRvY3VtZW50REFPIiwic25hcHNob3RTZXJ2aWNlIiwic25hcHNob3RTY2hlZHVsZXIiLCJjaGFuZ2VEQU8iLCJhdXRoU2VydmljZSIsImRvY3VtZW50U2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/init.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/redis.ts":
/*!***************************!*\
  !*** ./src/core/redis.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Redis: () => (/* binding */ Redis)\n/* harmony export */ });\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! redis */ \"(rsc)/../../node_modules/redis/dist/index.js\");\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(redis__WEBPACK_IMPORTED_MODULE_0__);\n\nclass Redis {\n    constructor(){\n        const url = process.env.REDIS_URL || \"redis://localhost:6379\";\n        this.client = (0,redis__WEBPACK_IMPORTED_MODULE_0__.createClient)({\n            url,\n            password: process.env.REDIS_PASSWORD || undefined\n        });\n        this.client.on(\"error\", (err)=>{\n            console.error(\"Redis Client Error\", err);\n        });\n    }\n    static getInstance() {\n        if (!Redis.instance) {\n            Redis.instance = new Redis();\n        }\n        return Redis.instance;\n    }\n    async connect() {\n        if (!this.client.isOpen) {\n            await this.client.connect();\n        }\n    }\n    getClient() {\n        return this.client;\n    }\n    /**\n   * 设置缓存\n   */ async set(key, value, ttl) {\n        await this.connect();\n        if (ttl) {\n            await this.client.setEx(key, ttl, value);\n        } else {\n            await this.client.set(key, value);\n        }\n    }\n    /**\n   * 获取缓存\n   */ async get(key) {\n        await this.connect();\n        return await this.client.get(key);\n    }\n    /**\n   * 删除缓存\n   */ async del(key) {\n        await this.connect();\n        await this.client.del(key);\n    }\n    /**\n   * 删除匹配模式的所有键（使用 SCAN 避免阻塞）\n   * @param pattern 匹配模式，例如 \"documents:workspace:*\"\n   */ async delByPattern(pattern) {\n        await this.connect();\n        let deletedCount = 0;\n        let cursor = 0;\n        do {\n            const result = await this.client.scan(cursor, {\n                MATCH: pattern,\n                COUNT: 100\n            });\n            cursor = result.cursor;\n            if (result.keys.length > 0) {\n                await this.client.del(result.keys);\n                deletedCount += result.keys.length;\n            }\n        }while (cursor !== 0);\n        return deletedCount;\n    }\n    /**\n   * 设置 JSON 缓存\n   */ async setJSON(key, value, ttl) {\n        await this.set(key, JSON.stringify(value), ttl);\n    }\n    /**\n   * 获取 JSON 缓存\n   */ async getJSON(key) {\n        const value = await this.get(key);\n        if (!value) return null;\n        try {\n            return JSON.parse(value);\n        } catch  {\n            return null;\n        }\n    }\n    /**\n   * 关闭连接\n   */ async close() {\n        if (this.client.isOpen) {\n            await this.client.quit();\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9yZWRpcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBc0Q7QUFFL0MsTUFBTUM7SUFJWCxhQUFzQjtRQUNwQixNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFNBQVMsSUFBSTtRQUNyQyxJQUFJLENBQUNDLE1BQU0sR0FBR04sbURBQVlBLENBQUM7WUFDekJFO1lBQ0FLLFVBQVVKLFFBQVFDLEdBQUcsQ0FBQ0ksY0FBYyxJQUFJQztRQUMxQztRQUVBLElBQUksQ0FBQ0gsTUFBTSxDQUFDSSxFQUFFLENBQUMsU0FBUyxDQUFDQztZQUN2QkMsUUFBUUMsS0FBSyxDQUFDLHNCQUFzQkY7UUFDdEM7SUFDRjtJQUVBLE9BQWNHLGNBQXFCO1FBQ2pDLElBQUksQ0FBQ2IsTUFBTWMsUUFBUSxFQUFFO1lBQ25CZCxNQUFNYyxRQUFRLEdBQUcsSUFBSWQ7UUFDdkI7UUFDQSxPQUFPQSxNQUFNYyxRQUFRO0lBQ3ZCO0lBRUEsTUFBYUMsVUFBeUI7UUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQ1YsTUFBTSxDQUFDVyxNQUFNLEVBQUU7WUFDdkIsTUFBTSxJQUFJLENBQUNYLE1BQU0sQ0FBQ1UsT0FBTztRQUMzQjtJQUNGO0lBRU9FLFlBQTZCO1FBQ2xDLE9BQU8sSUFBSSxDQUFDWixNQUFNO0lBQ3BCO0lBRUE7O0dBRUMsR0FDRCxNQUFhYSxJQUNYQyxHQUFXLEVBQ1hDLEtBQWEsRUFDYkMsR0FBWSxFQUNHO1FBQ2YsTUFBTSxJQUFJLENBQUNOLE9BQU87UUFDbEIsSUFBSU0sS0FBSztZQUNQLE1BQU0sSUFBSSxDQUFDaEIsTUFBTSxDQUFDaUIsS0FBSyxDQUFDSCxLQUFLRSxLQUFLRDtRQUNwQyxPQUFPO1lBQ0wsTUFBTSxJQUFJLENBQUNmLE1BQU0sQ0FBQ2EsR0FBRyxDQUFDQyxLQUFLQztRQUM3QjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFhRyxJQUFJSixHQUFXLEVBQTBCO1FBQ3BELE1BQU0sSUFBSSxDQUFDSixPQUFPO1FBQ2xCLE9BQU8sTUFBTSxJQUFJLENBQUNWLE1BQU0sQ0FBQ2tCLEdBQUcsQ0FBQ0o7SUFDL0I7SUFFQTs7R0FFQyxHQUNELE1BQWFLLElBQUlMLEdBQVcsRUFBaUI7UUFDM0MsTUFBTSxJQUFJLENBQUNKLE9BQU87UUFDbEIsTUFBTSxJQUFJLENBQUNWLE1BQU0sQ0FBQ21CLEdBQUcsQ0FBQ0w7SUFDeEI7SUFFQTs7O0dBR0MsR0FDRCxNQUFhTSxhQUFhQyxPQUFlLEVBQW1CO1FBQzFELE1BQU0sSUFBSSxDQUFDWCxPQUFPO1FBQ2xCLElBQUlZLGVBQWU7UUFDbkIsSUFBSUMsU0FBUztRQUViLEdBQUc7WUFDRCxNQUFNQyxTQUFTLE1BQU0sSUFBSSxDQUFDeEIsTUFBTSxDQUFDeUIsSUFBSSxDQUFDRixRQUFRO2dCQUM1Q0csT0FBT0w7Z0JBQ1BNLE9BQU87WUFDVDtZQUNBSixTQUFTQyxPQUFPRCxNQUFNO1lBRXRCLElBQUlDLE9BQU9JLElBQUksQ0FBQ0MsTUFBTSxHQUFHLEdBQUc7Z0JBQzFCLE1BQU0sSUFBSSxDQUFDN0IsTUFBTSxDQUFDbUIsR0FBRyxDQUFDSyxPQUFPSSxJQUFJO2dCQUNqQ04sZ0JBQWdCRSxPQUFPSSxJQUFJLENBQUNDLE1BQU07WUFDcEM7UUFDRixRQUFTTixXQUFXLEdBQUc7UUFFdkIsT0FBT0Q7SUFDVDtJQUVBOztHQUVDLEdBQ0QsTUFBYVEsUUFBV2hCLEdBQVcsRUFBRUMsS0FBUSxFQUFFQyxHQUFZLEVBQWlCO1FBQzFFLE1BQU0sSUFBSSxDQUFDSCxHQUFHLENBQUNDLEtBQUtpQixLQUFLQyxTQUFTLENBQUNqQixRQUFRQztJQUM3QztJQUVBOztHQUVDLEdBQ0QsTUFBYWlCLFFBQVduQixHQUFXLEVBQXFCO1FBQ3RELE1BQU1DLFFBQVEsTUFBTSxJQUFJLENBQUNHLEdBQUcsQ0FBQ0o7UUFDN0IsSUFBSSxDQUFDQyxPQUFPLE9BQU87UUFDbkIsSUFBSTtZQUNGLE9BQU9nQixLQUFLRyxLQUFLLENBQUNuQjtRQUNwQixFQUFFLE9BQU07WUFDTixPQUFPO1FBQ1Q7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBYW9CLFFBQXVCO1FBQ2xDLElBQUksSUFBSSxDQUFDbkMsTUFBTSxDQUFDVyxNQUFNLEVBQUU7WUFDdEIsTUFBTSxJQUFJLENBQUNYLE1BQU0sQ0FBQ29DLElBQUk7UUFDeEI7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2NvcmUvcmVkaXMudHM/MWUyYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQsIFJlZGlzQ2xpZW50VHlwZSB9IGZyb20gJ3JlZGlzJztcblxuZXhwb3J0IGNsYXNzIFJlZGlzIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFJlZGlzO1xuICBwcml2YXRlIGNsaWVudDogUmVkaXNDbGllbnRUeXBlO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuUkVESVNfVVJMIHx8ICdyZWRpczovL2xvY2FsaG9zdDo2Mzc5JztcbiAgICB0aGlzLmNsaWVudCA9IGNyZWF0ZUNsaWVudCh7XG4gICAgICB1cmwsXG4gICAgICBwYXNzd29yZDogcHJvY2Vzcy5lbnYuUkVESVNfUEFTU1dPUkQgfHwgdW5kZWZpbmVkLFxuICAgIH0pIGFzIFJlZGlzQ2xpZW50VHlwZTtcblxuICAgIHRoaXMuY2xpZW50Lm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlZGlzIENsaWVudCBFcnJvcicsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IFJlZGlzIHtcbiAgICBpZiAoIVJlZGlzLmluc3RhbmNlKSB7XG4gICAgICBSZWRpcy5pbnN0YW5jZSA9IG5ldyBSZWRpcygpO1xuICAgIH1cbiAgICByZXR1cm4gUmVkaXMuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgY29ubmVjdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuY2xpZW50LmlzT3Blbikge1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuY29ubmVjdCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRDbGllbnQoKTogUmVkaXNDbGllbnRUeXBlIHtcbiAgICByZXR1cm4gdGhpcy5jbGllbnQ7XG4gIH1cblxuICAvKipcbiAgICog6K6+572u57yT5a2YXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc2V0KFxuICAgIGtleTogc3RyaW5nLFxuICAgIHZhbHVlOiBzdHJpbmcsXG4gICAgdHRsPzogbnVtYmVyXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpO1xuICAgIGlmICh0dGwpIHtcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnNldEV4KGtleSwgdHRsLCB2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnNldChrZXksIHZhbHVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W57yT5a2YXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0KGtleTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgYXdhaXQgdGhpcy5jb25uZWN0KCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2xpZW50LmdldChrZXkpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOe8k+WtmFxuICAgKi9cbiAgcHVibGljIGFzeW5jIGRlbChrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpO1xuICAgIGF3YWl0IHRoaXMuY2xpZW50LmRlbChrZXkpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOWMuemFjeaooeW8j+eahOaJgOaciemUru+8iOS9v+eUqCBTQ0FOIOmBv+WFjemYu+Whnu+8iVxuICAgKiBAcGFyYW0gcGF0dGVybiDljLnphY3mqKHlvI/vvIzkvovlpoIgXCJkb2N1bWVudHM6d29ya3NwYWNlOipcIlxuICAgKi9cbiAgcHVibGljIGFzeW5jIGRlbEJ5UGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpO1xuICAgIGxldCBkZWxldGVkQ291bnQgPSAwO1xuICAgIGxldCBjdXJzb3IgPSAwO1xuXG4gICAgZG8ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jbGllbnQuc2NhbihjdXJzb3IsIHtcbiAgICAgICAgTUFUQ0g6IHBhdHRlcm4sXG4gICAgICAgIENPVU5UOiAxMDAsXG4gICAgICB9KTtcbiAgICAgIGN1cnNvciA9IHJlc3VsdC5jdXJzb3I7XG5cbiAgICAgIGlmIChyZXN1bHQua2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LmRlbChyZXN1bHQua2V5cyk7XG4gICAgICAgIGRlbGV0ZWRDb3VudCArPSByZXN1bHQua2V5cy5sZW5ndGg7XG4gICAgICB9XG4gICAgfSB3aGlsZSAoY3Vyc29yICE9PSAwKTtcblxuICAgIHJldHVybiBkZWxldGVkQ291bnQ7XG4gIH1cblxuICAvKipcbiAgICog6K6+572uIEpTT04g57yT5a2YXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc2V0SlNPTjxUPihrZXk6IHN0cmluZywgdmFsdWU6IFQsIHR0bD86IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuc2V0KGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpLCB0dGwpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPliBKU09OIOe8k+WtmFxuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldEpTT048VD4oa2V5OiBzdHJpbmcpOiBQcm9taXNlPFQgfCBudWxsPiB7XG4gICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLmdldChrZXkpO1xuICAgIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSkgYXMgVDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlhbPpl63ov57mjqVcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5jbGllbnQuaXNPcGVuKSB7XG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5xdWl0KCk7XG4gICAgfVxuICB9XG59XG5cblxuXG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJSZWRpcyIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19VUkwiLCJjbGllbnQiLCJwYXNzd29yZCIsIlJFRElTX1BBU1NXT1JEIiwidW5kZWZpbmVkIiwib24iLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiY29ubmVjdCIsImlzT3BlbiIsImdldENsaWVudCIsInNldCIsImtleSIsInZhbHVlIiwidHRsIiwic2V0RXgiLCJnZXQiLCJkZWwiLCJkZWxCeVBhdHRlcm4iLCJwYXR0ZXJuIiwiZGVsZXRlZENvdW50IiwiY3Vyc29yIiwicmVzdWx0Iiwic2NhbiIsIk1BVENIIiwiQ09VTlQiLCJrZXlzIiwibGVuZ3RoIiwic2V0SlNPTiIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRKU09OIiwicGFyc2UiLCJjbG9zZSIsInF1aXQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/core/redis.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/storage/local-file-storage.ts":
/*!************************************************!*\
  !*** ./src/core/storage/local-file-storage.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LocalFileStorage: () => (/* binding */ LocalFileStorage)\n/* harmony export */ });\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n\n\n/**\n * 本地文件存储实现\n * 存储路径：{basePath}/{workspaceId}/{objectId}/snapshot_{timestamp}.gz\n */ class LocalFileStorage {\n    constructor(basePath = \"./storage/snapshots\"){\n        this.basePath = basePath;\n    }\n    /**\n   * 确保目录存在\n   */ async ensureDir(dirPath) {\n        try {\n            await fs_promises__WEBPACK_IMPORTED_MODULE_0__.mkdir(dirPath, {\n                recursive: true\n            });\n        } catch (error) {\n            if (error.code !== \"EEXIST\") {\n                throw error;\n            }\n        }\n    }\n    /**\n   * 获取完整文件路径\n   */ getFilePath(key) {\n        return path__WEBPACK_IMPORTED_MODULE_1__.join(this.basePath, key);\n    }\n    /**\n   * 存储快照数据\n   */ async put(key, data, metadata) {\n        const filePath = this.getFilePath(key);\n        const dirPath = path__WEBPACK_IMPORTED_MODULE_1__.dirname(filePath);\n        // 确保目录存在\n        await this.ensureDir(dirPath);\n        // 写入文件\n        await fs_promises__WEBPACK_IMPORTED_MODULE_0__.writeFile(filePath, data);\n        // 如果有元数据，写入元数据文件\n        if (metadata) {\n            const metaPath = filePath + \".meta.json\";\n            await fs_promises__WEBPACK_IMPORTED_MODULE_0__.writeFile(metaPath, JSON.stringify(metadata, null, 2));\n        }\n    }\n    /**\n   * 获取快照数据\n   */ async get(key) {\n        const filePath = this.getFilePath(key);\n        try {\n            const data = await fs_promises__WEBPACK_IMPORTED_MODULE_0__.readFile(filePath);\n            return data;\n        } catch (error) {\n            if (error.code === \"ENOENT\") {\n                return null;\n            }\n            throw error;\n        }\n    }\n    /**\n   * 删除快照数据\n   */ async delete(key) {\n        const filePath = this.getFilePath(key);\n        try {\n            await fs_promises__WEBPACK_IMPORTED_MODULE_0__.unlink(filePath);\n            // 同时删除元数据文件\n            const metaPath = filePath + \".meta.json\";\n            try {\n                await fs_promises__WEBPACK_IMPORTED_MODULE_0__.unlink(metaPath);\n            } catch  {\n            // 忽略元数据文件不存在的错误\n            }\n        } catch (error) {\n            if (error.code !== \"ENOENT\") {\n                throw error;\n            }\n        }\n    }\n    /**\n   * 列出指定前缀的所有键\n   */ async list(prefix, limit) {\n        const dirPath = this.getFilePath(prefix);\n        const keys = [];\n        try {\n            // 递归读取目录\n            const readDirRecursive = async (dir, baseDir)=>{\n                const entries = await fs_promises__WEBPACK_IMPORTED_MODULE_0__.readdir(dir, {\n                    withFileTypes: true\n                });\n                const files = [];\n                for (const entry of entries){\n                    const fullPath = path__WEBPACK_IMPORTED_MODULE_1__.join(dir, entry.name);\n                    const relativePath = path__WEBPACK_IMPORTED_MODULE_1__.relative(baseDir, fullPath);\n                    if (entry.isDirectory()) {\n                        const subFiles = await readDirRecursive(fullPath, baseDir);\n                        files.push(...subFiles);\n                    } else if (entry.isFile() && !entry.name.endsWith(\".meta.json\")) {\n                        files.push(relativePath);\n                    }\n                }\n                return files;\n            };\n            const allFiles = await readDirRecursive(dirPath, this.basePath);\n            // 按文件名排序（时间戳降序）\n            allFiles.sort((a, b)=>{\n                const aName = path__WEBPACK_IMPORTED_MODULE_1__.basename(a);\n                const bName = path__WEBPACK_IMPORTED_MODULE_1__.basename(b);\n                return bName.localeCompare(aName);\n            });\n            // 应用限制\n            if (limit) {\n                return allFiles.slice(0, limit);\n            }\n            return allFiles;\n        } catch (error) {\n            if (error.code === \"ENOENT\") {\n                return [];\n            }\n            throw error;\n        }\n    }\n    /**\n   * 批量删除\n   */ async deleteMany(keys) {\n        await Promise.all(keys.map((key)=>this.delete(key)));\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9zdG9yYWdlL2xvY2FsLWZpbGUtc3RvcmFnZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFrQztBQUNMO0FBRzdCOzs7Q0FHQyxHQUNNLE1BQU1FO0lBR1hDLFlBQVlDLFdBQW1CLHFCQUFxQixDQUFFO1FBQ3BELElBQUksQ0FBQ0EsUUFBUSxHQUFHQTtJQUNsQjtJQUVBOztHQUVDLEdBQ0QsTUFBY0MsVUFBVUMsT0FBZSxFQUFpQjtRQUN0RCxJQUFJO1lBQ0YsTUFBTU4sOENBQVEsQ0FBQ00sU0FBUztnQkFBRUUsV0FBVztZQUFLO1FBQzVDLEVBQUUsT0FBT0MsT0FBWTtZQUNuQixJQUFJQSxNQUFNQyxJQUFJLEtBQUssVUFBVTtnQkFDM0IsTUFBTUQ7WUFDUjtRQUNGO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELFlBQW9CRyxHQUFXLEVBQVU7UUFDdkMsT0FBT1gsc0NBQVMsQ0FBQyxJQUFJLENBQUNHLFFBQVEsRUFBRVE7SUFDbEM7SUFFQTs7R0FFQyxHQUNELE1BQU1FLElBQUlGLEdBQVcsRUFBRUcsSUFBWSxFQUFFQyxRQUE4QixFQUFpQjtRQUNsRixNQUFNQyxXQUFXLElBQUksQ0FBQ04sV0FBVyxDQUFDQztRQUNsQyxNQUFNTixVQUFVTCx5Q0FBWSxDQUFDZ0I7UUFFN0IsU0FBUztRQUNULE1BQU0sSUFBSSxDQUFDWixTQUFTLENBQUNDO1FBRXJCLE9BQU87UUFDUCxNQUFNTixrREFBWSxDQUFDaUIsVUFBVUY7UUFFN0IsaUJBQWlCO1FBQ2pCLElBQUlDLFVBQVU7WUFDWixNQUFNSSxXQUFXSCxXQUFXO1lBQzVCLE1BQU1qQixrREFBWSxDQUFDb0IsVUFBVUMsS0FBS0MsU0FBUyxDQUFDTixVQUFVLE1BQU07UUFDOUQ7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTU8sSUFBSVgsR0FBVyxFQUEwQjtRQUM3QyxNQUFNSyxXQUFXLElBQUksQ0FBQ04sV0FBVyxDQUFDQztRQUNsQyxJQUFJO1lBQ0YsTUFBTUcsT0FBTyxNQUFNZixpREFBVyxDQUFDaUI7WUFDL0IsT0FBT0Y7UUFDVCxFQUFFLE9BQU9OLE9BQVk7WUFDbkIsSUFBSUEsTUFBTUMsSUFBSSxLQUFLLFVBQVU7Z0JBQzNCLE9BQU87WUFDVDtZQUNBLE1BQU1EO1FBQ1I7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTWdCLE9BQU9iLEdBQVcsRUFBaUI7UUFDdkMsTUFBTUssV0FBVyxJQUFJLENBQUNOLFdBQVcsQ0FBQ0M7UUFDbEMsSUFBSTtZQUNGLE1BQU1aLCtDQUFTLENBQUNpQjtZQUNoQixZQUFZO1lBQ1osTUFBTUcsV0FBV0gsV0FBVztZQUM1QixJQUFJO2dCQUNGLE1BQU1qQiwrQ0FBUyxDQUFDb0I7WUFDbEIsRUFBRSxPQUFNO1lBQ04sZ0JBQWdCO1lBQ2xCO1FBQ0YsRUFBRSxPQUFPWCxPQUFZO1lBQ25CLElBQUlBLE1BQU1DLElBQUksS0FBSyxVQUFVO2dCQUMzQixNQUFNRDtZQUNSO1FBQ0Y7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTWtCLEtBQUtDLE1BQWMsRUFBRUMsS0FBYyxFQUFxQjtRQUM1RCxNQUFNdkIsVUFBVSxJQUFJLENBQUNLLFdBQVcsQ0FBQ2lCO1FBQ2pDLE1BQU1FLE9BQWlCLEVBQUU7UUFFekIsSUFBSTtZQUNGLFNBQVM7WUFDVCxNQUFNQyxtQkFBbUIsT0FBT0MsS0FBYUM7Z0JBQzNDLE1BQU1DLFVBQVUsTUFBTWxDLGdEQUFVLENBQUNnQyxLQUFLO29CQUFFSSxlQUFlO2dCQUFLO2dCQUM1RCxNQUFNQyxRQUFrQixFQUFFO2dCQUUxQixLQUFLLE1BQU1DLFNBQVNKLFFBQVM7b0JBQzNCLE1BQU1LLFdBQVd0QyxzQ0FBUyxDQUFDK0IsS0FBS00sTUFBTUUsSUFBSTtvQkFDMUMsTUFBTUMsZUFBZXhDLDBDQUFhLENBQUNnQyxTQUFTTTtvQkFFNUMsSUFBSUQsTUFBTUssV0FBVyxJQUFJO3dCQUN2QixNQUFNQyxXQUFXLE1BQU1iLGlCQUFpQlEsVUFBVU47d0JBQ2xESSxNQUFNUSxJQUFJLElBQUlEO29CQUNoQixPQUFPLElBQUlOLE1BQU1RLE1BQU0sTUFBTSxDQUFDUixNQUFNRSxJQUFJLENBQUNPLFFBQVEsQ0FBQyxlQUFlO3dCQUMvRFYsTUFBTVEsSUFBSSxDQUFDSjtvQkFDYjtnQkFDRjtnQkFFQSxPQUFPSjtZQUNUO1lBRUEsTUFBTVcsV0FBVyxNQUFNakIsaUJBQWlCekIsU0FBUyxJQUFJLENBQUNGLFFBQVE7WUFFOUQsZ0JBQWdCO1lBQ2hCNEMsU0FBU0MsSUFBSSxDQUFDLENBQUNDLEdBQUdDO2dCQUNoQixNQUFNQyxRQUFRbkQsMENBQWEsQ0FBQ2lEO2dCQUM1QixNQUFNSSxRQUFRckQsMENBQWEsQ0FBQ2tEO2dCQUM1QixPQUFPRyxNQUFNQyxhQUFhLENBQUNIO1lBQzdCO1lBRUEsT0FBTztZQUNQLElBQUl2QixPQUFPO2dCQUNULE9BQU9tQixTQUFTUSxLQUFLLENBQUMsR0FBRzNCO1lBQzNCO1lBRUEsT0FBT21CO1FBQ1QsRUFBRSxPQUFPdkMsT0FBWTtZQUNuQixJQUFJQSxNQUFNQyxJQUFJLEtBQUssVUFBVTtnQkFDM0IsT0FBTyxFQUFFO1lBQ1g7WUFDQSxNQUFNRDtRQUNSO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1nRCxXQUFXM0IsSUFBYyxFQUFpQjtRQUM5QyxNQUFNNEIsUUFBUUMsR0FBRyxDQUFDN0IsS0FBSzhCLEdBQUcsQ0FBQyxDQUFDaEQsTUFBUSxJQUFJLENBQUNhLE1BQU0sQ0FBQ2I7SUFDbEQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9jb3JlL3N0b3JhZ2UvbG9jYWwtZmlsZS1zdG9yYWdlLnRzPzYzMmMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFN0b3JhZ2VBZGFwdGVyIH0gZnJvbSAnLi9zdG9yYWdlLmludGVyZmFjZSc7XG5cbi8qKlxuICog5pys5Zyw5paH5Lu25a2Y5YKo5a6e546wXG4gKiDlrZjlgqjot6/lvoTvvJp7YmFzZVBhdGh9L3t3b3Jrc3BhY2VJZH0ve29iamVjdElkfS9zbmFwc2hvdF97dGltZXN0YW1wfS5nelxuICovXG5leHBvcnQgY2xhc3MgTG9jYWxGaWxlU3RvcmFnZSBpbXBsZW1lbnRzIFN0b3JhZ2VBZGFwdGVyIHtcbiAgcHJpdmF0ZSBiYXNlUGF0aDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGJhc2VQYXRoOiBzdHJpbmcgPSAnLi9zdG9yYWdlL3NuYXBzaG90cycpIHtcbiAgICB0aGlzLmJhc2VQYXRoID0gYmFzZVBhdGg7XG4gIH1cblxuICAvKipcbiAgICog56Gu5L+d55uu5b2V5a2Y5ZyoXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGVuc3VyZURpcihkaXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMubWtkaXIoZGlyUGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yLmNvZGUgIT09ICdFRVhJU1QnKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blrozmlbTmlofku7bot6/lvoRcbiAgICovXG4gIHByaXZhdGUgZ2V0RmlsZVBhdGgoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBwYXRoLmpvaW4odGhpcy5iYXNlUGF0aCwga2V5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlrZjlgqjlv6vnhafmlbDmja5cbiAgICovXG4gIGFzeW5jIHB1dChrZXk6IHN0cmluZywgZGF0YTogQnVmZmVyLCBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBmaWxlUGF0aCA9IHRoaXMuZ2V0RmlsZVBhdGgoa2V5KTtcbiAgICBjb25zdCBkaXJQYXRoID0gcGF0aC5kaXJuYW1lKGZpbGVQYXRoKTtcblxuICAgIC8vIOehruS/neebruW9leWtmOWcqFxuICAgIGF3YWl0IHRoaXMuZW5zdXJlRGlyKGRpclBhdGgpO1xuXG4gICAgLy8g5YaZ5YWl5paH5Lu2XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKGZpbGVQYXRoLCBkYXRhKTtcblxuICAgIC8vIOWmguaenOacieWFg+aVsOaNru+8jOWGmeWFpeWFg+aVsOaNruaWh+S7tlxuICAgIGlmIChtZXRhZGF0YSkge1xuICAgICAgY29uc3QgbWV0YVBhdGggPSBmaWxlUGF0aCArICcubWV0YS5qc29uJztcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZShtZXRhUGF0aCwgSlNPTi5zdHJpbmdpZnkobWV0YWRhdGEsIG51bGwsIDIpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5b+r54Wn5pWw5o2uXG4gICAqL1xuICBhc3luYyBnZXQoa2V5OiBzdHJpbmcpOiBQcm9taXNlPEJ1ZmZlciB8IG51bGw+IHtcbiAgICBjb25zdCBmaWxlUGF0aCA9IHRoaXMuZ2V0RmlsZVBhdGgoa2V5KTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKGZpbGVQYXRoKTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnRU5PRU5UJykge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTlv6vnhafmlbDmja5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZShrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGZpbGVQYXRoID0gdGhpcy5nZXRGaWxlUGF0aChrZXkpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsoZmlsZVBhdGgpO1xuICAgICAgLy8g5ZCM5pe25Yig6Zmk5YWD5pWw5o2u5paH5Lu2XG4gICAgICBjb25zdCBtZXRhUGF0aCA9IGZpbGVQYXRoICsgJy5tZXRhLmpzb24nO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZnMudW5saW5rKG1ldGFQYXRoKTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICAvLyDlv73nlaXlhYPmlbDmja7mlofku7bkuI3lrZjlnKjnmoTplJnor69cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSAhPT0gJ0VOT0VOVCcpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIl+WHuuaMh+WumuWJjee8gOeahOaJgOaciemUrlxuICAgKi9cbiAgYXN5bmMgbGlzdChwcmVmaXg6IHN0cmluZywgbGltaXQ/OiBudW1iZXIpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgZGlyUGF0aCA9IHRoaXMuZ2V0RmlsZVBhdGgocHJlZml4KTtcbiAgICBjb25zdCBrZXlzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIOmAkuW9kuivu+WPluebruW9lVxuICAgICAgY29uc3QgcmVhZERpclJlY3Vyc2l2ZSA9IGFzeW5jIChkaXI6IHN0cmluZywgYmFzZURpcjogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmdbXT4gPT4ge1xuICAgICAgICBjb25zdCBlbnRyaWVzID0gYXdhaXQgZnMucmVhZGRpcihkaXIsIHsgd2l0aEZpbGVUeXBlczogdHJ1ZSB9KTtcbiAgICAgICAgY29uc3QgZmlsZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgICAgY29uc3QgZnVsbFBhdGggPSBwYXRoLmpvaW4oZGlyLCBlbnRyeS5uYW1lKTtcbiAgICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBwYXRoLnJlbGF0aXZlKGJhc2VEaXIsIGZ1bGxQYXRoKTtcblxuICAgICAgICAgIGlmIChlbnRyeS5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICBjb25zdCBzdWJGaWxlcyA9IGF3YWl0IHJlYWREaXJSZWN1cnNpdmUoZnVsbFBhdGgsIGJhc2VEaXIpO1xuICAgICAgICAgICAgZmlsZXMucHVzaCguLi5zdWJGaWxlcyk7XG4gICAgICAgICAgfSBlbHNlIGlmIChlbnRyeS5pc0ZpbGUoKSAmJiAhZW50cnkubmFtZS5lbmRzV2l0aCgnLm1ldGEuanNvbicpKSB7XG4gICAgICAgICAgICBmaWxlcy5wdXNoKHJlbGF0aXZlUGF0aCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZpbGVzO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgYWxsRmlsZXMgPSBhd2FpdCByZWFkRGlyUmVjdXJzaXZlKGRpclBhdGgsIHRoaXMuYmFzZVBhdGgpO1xuXG4gICAgICAvLyDmjInmlofku7blkI3mjpLluo/vvIjml7bpl7TmiLPpmY3luo/vvIlcbiAgICAgIGFsbEZpbGVzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgY29uc3QgYU5hbWUgPSBwYXRoLmJhc2VuYW1lKGEpO1xuICAgICAgICBjb25zdCBiTmFtZSA9IHBhdGguYmFzZW5hbWUoYik7XG4gICAgICAgIHJldHVybiBiTmFtZS5sb2NhbGVDb21wYXJlKGFOYW1lKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyDlupTnlKjpmZDliLZcbiAgICAgIGlmIChsaW1pdCkge1xuICAgICAgICByZXR1cm4gYWxsRmlsZXMuc2xpY2UoMCwgbGltaXQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYWxsRmlsZXM7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdFTk9FTlQnKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmibnph4/liKDpmaRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZU1hbnkoa2V5czogc3RyaW5nW10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChrZXlzLm1hcCgoa2V5KSA9PiB0aGlzLmRlbGV0ZShrZXkpKSk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbImZzIiwicGF0aCIsIkxvY2FsRmlsZVN0b3JhZ2UiLCJjb25zdHJ1Y3RvciIsImJhc2VQYXRoIiwiZW5zdXJlRGlyIiwiZGlyUGF0aCIsIm1rZGlyIiwicmVjdXJzaXZlIiwiZXJyb3IiLCJjb2RlIiwiZ2V0RmlsZVBhdGgiLCJrZXkiLCJqb2luIiwicHV0IiwiZGF0YSIsIm1ldGFkYXRhIiwiZmlsZVBhdGgiLCJkaXJuYW1lIiwid3JpdGVGaWxlIiwibWV0YVBhdGgiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0IiwicmVhZEZpbGUiLCJkZWxldGUiLCJ1bmxpbmsiLCJsaXN0IiwicHJlZml4IiwibGltaXQiLCJrZXlzIiwicmVhZERpclJlY3Vyc2l2ZSIsImRpciIsImJhc2VEaXIiLCJlbnRyaWVzIiwicmVhZGRpciIsIndpdGhGaWxlVHlwZXMiLCJmaWxlcyIsImVudHJ5IiwiZnVsbFBhdGgiLCJuYW1lIiwicmVsYXRpdmVQYXRoIiwicmVsYXRpdmUiLCJpc0RpcmVjdG9yeSIsInN1YkZpbGVzIiwicHVzaCIsImlzRmlsZSIsImVuZHNXaXRoIiwiYWxsRmlsZXMiLCJzb3J0IiwiYSIsImIiLCJhTmFtZSIsImJhc2VuYW1lIiwiYk5hbWUiLCJsb2NhbGVDb21wYXJlIiwic2xpY2UiLCJkZWxldGVNYW55IiwiUHJvbWlzZSIsImFsbCIsIm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/storage/local-file-storage.ts\n");

/***/ }),

/***/ "(rsc)/./src/core/storage/storage.factory.ts":
/*!*********************************************!*\
  !*** ./src/core/storage/storage.factory.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   StorageFactory: () => (/* binding */ StorageFactory),\n/* harmony export */   extractTimestampFromKey: () => (/* binding */ extractTimestampFromKey),\n/* harmony export */   getSnapshotKey: () => (/* binding */ getSnapshotKey),\n/* harmony export */   getSnapshotPrefix: () => (/* binding */ getSnapshotPrefix)\n/* harmony export */ });\n/* harmony import */ var _local_file_storage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./local-file-storage */ \"(rsc)/./src/core/storage/local-file-storage.ts\");\n\n/**\n * 存储工厂\n * 根据配置创建不同的存储实现\n */ class StorageFactory {\n    static{\n        this.instance = null;\n    }\n    /**\n   * 获取存储实例（单例）\n   */ static getInstance() {\n        if (!StorageFactory.instance) {\n            const storageType = process.env.STORAGE_TYPE || \"local\";\n            const basePath = process.env.STORAGE_BASE_PATH || \"./storage/snapshots\";\n            switch(storageType){\n                case \"local\":\n                    StorageFactory.instance = new _local_file_storage__WEBPACK_IMPORTED_MODULE_0__.LocalFileStorage(basePath);\n                    break;\n                case \"s3\":\n                    // TODO: 实现 S3 存储\n                    // StorageFactory.instance = new S3Storage(...);\n                    throw new Error(\"S3 storage not implemented yet\");\n                default:\n                    throw new Error(`Unknown storage type: ${storageType}`);\n            }\n        }\n        return StorageFactory.instance;\n    }\n    /**\n   * 重置实例（用于测试）\n   */ static reset() {\n        StorageFactory.instance = null;\n    }\n}\n/**\n * 生成快照存储键\n * 格式：{workspaceId}/{objectId}/snapshot_{timestamp}.gz\n */ function getSnapshotKey(workspaceId, objectId, timestamp) {\n    // 使用倒序时间戳作为文件名的一部分，便于排序\n    const reversedTimestamp = Number.MAX_SAFE_INTEGER - timestamp;\n    return `${workspaceId}/${objectId}/snapshot_${reversedTimestamp.toString(16).padStart(16, \"0\")}.gz`;\n}\n/**\n * 生成快照前缀（用于列出某个文档的所有快照）\n */ function getSnapshotPrefix(workspaceId, objectId) {\n    return `${workspaceId}/${objectId}/snapshot_`;\n}\n/**\n * 从键中提取时间戳\n */ function extractTimestampFromKey(key) {\n    const match = key.match(/snapshot_([0-9a-f]+)\\.gz$/);\n    if (!match) return null;\n    const reversedTimestamp = parseInt(match[1], 16);\n    return Number.MAX_SAFE_INTEGER - reversedTimestamp;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvY29yZS9zdG9yYWdlL3N0b3JhZ2UuZmFjdG9yeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUN3RDtBQUV4RDs7O0NBR0MsR0FDTSxNQUFNQzs7YUFDSUMsV0FBa0M7O0lBRWpEOztHQUVDLEdBQ0QsT0FBT0MsY0FBOEI7UUFDbkMsSUFBSSxDQUFDRixlQUFlQyxRQUFRLEVBQUU7WUFDNUIsTUFBTUUsY0FBY0MsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLElBQUk7WUFDaEQsTUFBTUMsV0FBV0gsUUFBUUMsR0FBRyxDQUFDRyxpQkFBaUIsSUFBSTtZQUVsRCxPQUFRTDtnQkFDTixLQUFLO29CQUNISCxlQUFlQyxRQUFRLEdBQUcsSUFBSUYsaUVBQWdCQSxDQUFDUTtvQkFDL0M7Z0JBQ0YsS0FBSztvQkFDSCxpQkFBaUI7b0JBQ2pCLGdEQUFnRDtvQkFDaEQsTUFBTSxJQUFJRSxNQUFNO2dCQUNsQjtvQkFDRSxNQUFNLElBQUlBLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRU4sWUFBWSxDQUFDO1lBQzFEO1FBQ0Y7UUFFQSxPQUFPSCxlQUFlQyxRQUFRO0lBQ2hDO0lBRUE7O0dBRUMsR0FDRCxPQUFPUyxRQUFjO1FBQ25CVixlQUFlQyxRQUFRLEdBQUc7SUFDNUI7QUFDRjtBQUVBOzs7Q0FHQyxHQUNNLFNBQVNVLGVBQ2RDLFdBQW1CLEVBQ25CQyxRQUFnQixFQUNoQkMsU0FBaUI7SUFFakIsd0JBQXdCO0lBQ3hCLE1BQU1DLG9CQUFvQkMsT0FBT0MsZ0JBQWdCLEdBQUdIO0lBQ3BELE9BQU8sQ0FBQyxFQUFFRixZQUFZLENBQUMsRUFBRUMsU0FBUyxVQUFVLEVBQUVFLGtCQUFrQkcsUUFBUSxDQUFDLElBQUlDLFFBQVEsQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDO0FBQ3JHO0FBRUE7O0NBRUMsR0FDTSxTQUFTQyxrQkFBa0JSLFdBQW1CLEVBQUVDLFFBQWdCO0lBQ3JFLE9BQU8sQ0FBQyxFQUFFRCxZQUFZLENBQUMsRUFBRUMsU0FBUyxVQUFVLENBQUM7QUFDL0M7QUFFQTs7Q0FFQyxHQUNNLFNBQVNRLHdCQUF3QkMsR0FBVztJQUNqRCxNQUFNQyxRQUFRRCxJQUFJQyxLQUFLLENBQUM7SUFDeEIsSUFBSSxDQUFDQSxPQUFPLE9BQU87SUFFbkIsTUFBTVIsb0JBQW9CUyxTQUFTRCxLQUFLLENBQUMsRUFBRSxFQUFFO0lBQzdDLE9BQU9QLE9BQU9DLGdCQUFnQixHQUFHRjtBQUNuQyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9jb3JlL3N0b3JhZ2Uvc3RvcmFnZS5mYWN0b3J5LnRzPzM5ZjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RvcmFnZUFkYXB0ZXIgfSBmcm9tICcuL3N0b3JhZ2UuaW50ZXJmYWNlJztcbmltcG9ydCB7IExvY2FsRmlsZVN0b3JhZ2UgfSBmcm9tICcuL2xvY2FsLWZpbGUtc3RvcmFnZSc7XG5cbi8qKlxuICog5a2Y5YKo5bel5Y6CXG4gKiDmoLnmja7phY3nva7liJvlu7rkuI3lkIznmoTlrZjlgqjlrp7njrBcbiAqL1xuZXhwb3J0IGNsYXNzIFN0b3JhZ2VGYWN0b3J5IHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFN0b3JhZ2VBZGFwdGVyIHwgbnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIOiOt+WPluWtmOWCqOWunuS+i++8iOWNleS+i++8iVxuICAgKi9cbiAgc3RhdGljIGdldEluc3RhbmNlKCk6IFN0b3JhZ2VBZGFwdGVyIHtcbiAgICBpZiAoIVN0b3JhZ2VGYWN0b3J5Lmluc3RhbmNlKSB7XG4gICAgICBjb25zdCBzdG9yYWdlVHlwZSA9IHByb2Nlc3MuZW52LlNUT1JBR0VfVFlQRSB8fCAnbG9jYWwnO1xuICAgICAgY29uc3QgYmFzZVBhdGggPSBwcm9jZXNzLmVudi5TVE9SQUdFX0JBU0VfUEFUSCB8fCAnLi9zdG9yYWdlL3NuYXBzaG90cyc7XG5cbiAgICAgIHN3aXRjaCAoc3RvcmFnZVR5cGUpIHtcbiAgICAgICAgY2FzZSAnbG9jYWwnOlxuICAgICAgICAgIFN0b3JhZ2VGYWN0b3J5Lmluc3RhbmNlID0gbmV3IExvY2FsRmlsZVN0b3JhZ2UoYmFzZVBhdGgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdzMyc6XG4gICAgICAgICAgLy8gVE9ETzog5a6e546wIFMzIOWtmOWCqFxuICAgICAgICAgIC8vIFN0b3JhZ2VGYWN0b3J5Lmluc3RhbmNlID0gbmV3IFMzU3RvcmFnZSguLi4pO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUzMgc3RvcmFnZSBub3QgaW1wbGVtZW50ZWQgeWV0Jyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHN0b3JhZ2UgdHlwZTogJHtzdG9yYWdlVHlwZX1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gU3RvcmFnZUZhY3RvcnkuaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICog6YeN572u5a6e5L6L77yI55So5LqO5rWL6K+V77yJXG4gICAqL1xuICBzdGF0aWMgcmVzZXQoKTogdm9pZCB7XG4gICAgU3RvcmFnZUZhY3RvcnkuaW5zdGFuY2UgPSBudWxsO1xuICB9XG59XG5cbi8qKlxuICog55Sf5oiQ5b+r54Wn5a2Y5YKo6ZSuXG4gKiDmoLzlvI/vvJp7d29ya3NwYWNlSWR9L3tvYmplY3RJZH0vc25hcHNob3Rfe3RpbWVzdGFtcH0uZ3pcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNuYXBzaG90S2V5KFxuICB3b3Jrc3BhY2VJZDogc3RyaW5nLFxuICBvYmplY3RJZDogc3RyaW5nLFxuICB0aW1lc3RhbXA6IG51bWJlclxuKTogc3RyaW5nIHtcbiAgLy8g5L2/55So5YCS5bqP5pe26Ze05oiz5L2c5Li65paH5Lu25ZCN55qE5LiA6YOo5YiG77yM5L6/5LqO5o6S5bqPXG4gIGNvbnN0IHJldmVyc2VkVGltZXN0YW1wID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgLSB0aW1lc3RhbXA7XG4gIHJldHVybiBgJHt3b3Jrc3BhY2VJZH0vJHtvYmplY3RJZH0vc25hcHNob3RfJHtyZXZlcnNlZFRpbWVzdGFtcC50b1N0cmluZygxNikucGFkU3RhcnQoMTYsICcwJyl9Lmd6YDtcbn1cblxuLyoqXG4gKiDnlJ/miJDlv6vnhafliY3nvIDvvIjnlKjkuo7liJflh7rmn5DkuKrmlofmoaPnmoTmiYDmnInlv6vnhafvvIlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNuYXBzaG90UHJlZml4KHdvcmtzcGFjZUlkOiBzdHJpbmcsIG9iamVjdElkOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gYCR7d29ya3NwYWNlSWR9LyR7b2JqZWN0SWR9L3NuYXBzaG90X2A7XG59XG5cbi8qKlxuICog5LuO6ZSu5Lit5o+Q5Y+W5pe26Ze05oizXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0VGltZXN0YW1wRnJvbUtleShrZXk6IHN0cmluZyk6IG51bWJlciB8IG51bGwge1xuICBjb25zdCBtYXRjaCA9IGtleS5tYXRjaCgvc25hcHNob3RfKFswLTlhLWZdKylcXC5neiQvKTtcbiAgaWYgKCFtYXRjaCkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgcmV2ZXJzZWRUaW1lc3RhbXAgPSBwYXJzZUludChtYXRjaFsxXSwgMTYpO1xuICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgLSByZXZlcnNlZFRpbWVzdGFtcDtcbn1cblxuIl0sIm5hbWVzIjpbIkxvY2FsRmlsZVN0b3JhZ2UiLCJTdG9yYWdlRmFjdG9yeSIsImluc3RhbmNlIiwiZ2V0SW5zdGFuY2UiLCJzdG9yYWdlVHlwZSIsInByb2Nlc3MiLCJlbnYiLCJTVE9SQUdFX1RZUEUiLCJiYXNlUGF0aCIsIlNUT1JBR0VfQkFTRV9QQVRIIiwiRXJyb3IiLCJyZXNldCIsImdldFNuYXBzaG90S2V5Iiwid29ya3NwYWNlSWQiLCJvYmplY3RJZCIsInRpbWVzdGFtcCIsInJldmVyc2VkVGltZXN0YW1wIiwiTnVtYmVyIiwiTUFYX1NBRkVfSU5URUdFUiIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJnZXRTbmFwc2hvdFByZWZpeCIsImV4dHJhY3RUaW1lc3RhbXBGcm9tS2V5Iiwia2V5IiwibWF0Y2giLCJwYXJzZUludCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/core/storage/storage.factory.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/document-change.dao.ts":
/*!****************************************!*\
  !*** ./src/dao/document-change.dao.ts ***!
  \****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentChangeDAO: () => (/* binding */ DocumentChangeDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! uuid */ \"(rsc)/../../node_modules/uuid/dist/esm-node/v4.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_1__]);\n_core_database__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nclass DocumentChangeDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_1__.Database.getInstance();\n    }\n    /**\n   * 创建变更记录\n   */ async create(change) {\n        const created_at = Date.now();\n        const result = await this.db.query(`INSERT INTO pikun_db.document_changes (\n        change_id, object_id, workspace_id, snapshot_id, change_type, \n        change_data, before_state_vector, after_state_vector, change_size, metadata, created_at\n      )\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\n      RETURNING *`, [\n            (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(),\n            change.object_id,\n            change.workspace_id,\n            change.snapshot_id || null,\n            change.change_type,\n            change.change_data,\n            change.before_state_vector || null,\n            change.after_state_vector || null,\n            change.change_data.length,\n            JSON.stringify(change.metadata || {}),\n            created_at\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 获取文档的变更列表\n   */ async findByObjectId(object_id, options = {}) {\n        const { limit = 100, offset = 0, after_snapshot_id } = options;\n        let query = `\n      SELECT COUNT(*) as count \n      FROM pikun_db.document_changes \n      WHERE object_id = $1\n    `;\n        const countParams = [\n            object_id\n        ];\n        if (after_snapshot_id) {\n            query += ` AND created_at > (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $2)`;\n            countParams.push(after_snapshot_id);\n        }\n        const countResult = await this.db.query(query, countParams);\n        const total = parseInt(countResult.rows[0].count, 10);\n        let listQuery = `\n      SELECT * FROM pikun_db.document_changes\n      WHERE object_id = $1\n    `;\n        const listParams = [\n            object_id\n        ];\n        if (after_snapshot_id) {\n            listQuery += ` AND created_at > (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $2)`;\n            listParams.push(after_snapshot_id);\n        }\n        listQuery += ` ORDER BY created_at ASC LIMIT $${listParams.length + 1} OFFSET $${listParams.length + 2}`;\n        listParams.push(limit, offset);\n        const result = await this.db.query(listQuery, listParams);\n        return {\n            changes: result.rows,\n            total\n        };\n    }\n    /**\n   * 获取两个快照之间的变更\n   */ async getChangesBetweenSnapshots(object_id, from_snapshot_id, to_snapshot_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_changes\n       WHERE object_id = $1\n         AND created_at > (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $2)\n         AND created_at <= (SELECT created_at FROM pikun_db.document_snapshots WHERE snapshot_id = $3)\n       ORDER BY created_at ASC`, [\n            object_id,\n            from_snapshot_id,\n            to_snapshot_id\n        ]);\n        return result.rows;\n    }\n    /**\n   * 删除文档的所有变更记录\n   */ async deleteByObjectId(object_id) {\n        await this.db.query(\"DELETE FROM pikun_db.document_changes WHERE object_id = $1\", [\n            object_id\n        ]);\n    }\n}\nDocumentChangeDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_0__.Injectable)(\"DocumentChangeDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [])\n], DocumentChangeDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cmMvZGFvL2RvY3VtZW50LWNoYW5nZS5kYW8udHM/ZjVlNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQC9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yJztcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSAnQC9jb3JlL2RhdGFiYXNlJztcbmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gJ3V1aWQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIERvY3VtZW50Q2hhbmdlIHtcbiAgY2hhbmdlX2lkOiBzdHJpbmc7XG4gIG9iamVjdF9pZDogc3RyaW5nO1xuICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgc25hcHNob3RfaWQ6IHN0cmluZyB8IG51bGw7XG4gIGNoYW5nZV90eXBlOiAnYXV0b19zYXZlJyB8ICdtYW51YWxfc2F2ZSc7XG4gIGNoYW5nZV9kYXRhOiBCdWZmZXI7XG4gIGJlZm9yZV9zdGF0ZV92ZWN0b3I6IEJ1ZmZlciB8IG51bGw7XG4gIGFmdGVyX3N0YXRlX3ZlY3RvcjogQnVmZmVyIHwgbnVsbDtcbiAgY2hhbmdlX3NpemU6IG51bWJlcjtcbiAgbWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIGNyZWF0ZWRfYXQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiDmlofmoaPlj5jmm7Tml6Xlv5cgREFPXG4gKi9cbkBJbmplY3RhYmxlKCdEb2N1bWVudENoYW5nZURBTycpXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRDaGFuZ2VEQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlj5jmm7TorrDlvZVcbiAgICovXG4gIGFzeW5jIGNyZWF0ZShjaGFuZ2U6IHtcbiAgICBvYmplY3RfaWQ6IHN0cmluZztcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgICBzbmFwc2hvdF9pZD86IHN0cmluZyB8IG51bGw7XG4gICAgY2hhbmdlX3R5cGU6ICdhdXRvX3NhdmUnIHwgJ21hbnVhbF9zYXZlJztcbiAgICBjaGFuZ2VfZGF0YTogQnVmZmVyO1xuICAgIGJlZm9yZV9zdGF0ZV92ZWN0b3I/OiBCdWZmZXIgfCBudWxsO1xuICAgIGFmdGVyX3N0YXRlX3ZlY3Rvcj86IEJ1ZmZlciB8IG51bGw7XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB9KTogUHJvbWlzZTxEb2N1bWVudENoYW5nZT4ge1xuICAgIGNvbnN0IGNyZWF0ZWRfYXQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRDaGFuZ2U+KFxuICAgICAgYElOU0VSVCBJTlRPIHBpa3VuX2RiLmRvY3VtZW50X2NoYW5nZXMgKFxuICAgICAgICBjaGFuZ2VfaWQsIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCBzbmFwc2hvdF9pZCwgY2hhbmdlX3R5cGUsIFxuICAgICAgICBjaGFuZ2VfZGF0YSwgYmVmb3JlX3N0YXRlX3ZlY3RvciwgYWZ0ZXJfc3RhdGVfdmVjdG9yLCBjaGFuZ2Vfc2l6ZSwgbWV0YWRhdGEsIGNyZWF0ZWRfYXRcbiAgICAgIClcbiAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4LCAkOSwgJDEwLCAkMTEpXG4gICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICBbXG4gICAgICAgIHV1aWR2NCgpLFxuICAgICAgICBjaGFuZ2Uub2JqZWN0X2lkLFxuICAgICAgICBjaGFuZ2Uud29ya3NwYWNlX2lkLFxuICAgICAgICBjaGFuZ2Uuc25hcHNob3RfaWQgfHwgbnVsbCxcbiAgICAgICAgY2hhbmdlLmNoYW5nZV90eXBlLFxuICAgICAgICBjaGFuZ2UuY2hhbmdlX2RhdGEsXG4gICAgICAgIGNoYW5nZS5iZWZvcmVfc3RhdGVfdmVjdG9yIHx8IG51bGwsXG4gICAgICAgIGNoYW5nZS5hZnRlcl9zdGF0ZV92ZWN0b3IgfHwgbnVsbCxcbiAgICAgICAgY2hhbmdlLmNoYW5nZV9kYXRhLmxlbmd0aCxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoY2hhbmdlLm1ldGFkYXRhIHx8IHt9KSxcbiAgICAgICAgY3JlYXRlZF9hdCxcbiAgICAgIF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPnmoTlj5jmm7TliJfooahcbiAgICovXG4gIGFzeW5jIGZpbmRCeU9iamVjdElkKFxuICAgIG9iamVjdF9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIGxpbWl0PzogbnVtYmVyO1xuICAgICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgICAgYWZ0ZXJfc25hcHNob3RfaWQ/OiBzdHJpbmcgfCBudWxsOyAvLyDojrflj5bmn5DkuKrlv6vnhafkuYvlkI7nmoTlj5jmm7RcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTx7IGNoYW5nZXM6IERvY3VtZW50Q2hhbmdlW107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IHsgbGltaXQgPSAxMDAsIG9mZnNldCA9IDAsIGFmdGVyX3NuYXBzaG90X2lkIH0gPSBvcHRpb25zO1xuXG4gICAgbGV0IHF1ZXJ5ID0gYFxuICAgICAgU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IFxuICAgICAgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9jaGFuZ2VzIFxuICAgICAgV0hFUkUgb2JqZWN0X2lkID0gJDFcbiAgICBgO1xuICAgIGNvbnN0IGNvdW50UGFyYW1zOiBhbnlbXSA9IFtvYmplY3RfaWRdO1xuXG4gICAgaWYgKGFmdGVyX3NuYXBzaG90X2lkKSB7XG4gICAgICBxdWVyeSArPSBgIEFORCBjcmVhdGVkX2F0ID4gKFNFTEVDVCBjcmVhdGVkX2F0IEZST00gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIFdIRVJFIHNuYXBzaG90X2lkID0gJDIpYDtcbiAgICAgIGNvdW50UGFyYW1zLnB1c2goYWZ0ZXJfc25hcHNob3RfaWQpO1xuICAgIH1cblxuICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTx7IGNvdW50OiBzdHJpbmcgfT4ocXVlcnksIGNvdW50UGFyYW1zKTtcbiAgICBjb25zdCB0b3RhbCA9IHBhcnNlSW50KGNvdW50UmVzdWx0LnJvd3NbMF0uY291bnQsIDEwKTtcblxuICAgIGxldCBsaXN0UXVlcnkgPSBgXG4gICAgICBTRUxFQ1QgKiBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X2NoYW5nZXNcbiAgICAgIFdIRVJFIG9iamVjdF9pZCA9ICQxXG4gICAgYDtcbiAgICBjb25zdCBsaXN0UGFyYW1zOiBhbnlbXSA9IFtvYmplY3RfaWRdO1xuXG4gICAgaWYgKGFmdGVyX3NuYXBzaG90X2lkKSB7XG4gICAgICBsaXN0UXVlcnkgKz0gYCBBTkQgY3JlYXRlZF9hdCA+IChTRUxFQ1QgY3JlYXRlZF9hdCBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X3NuYXBzaG90cyBXSEVSRSBzbmFwc2hvdF9pZCA9ICQyKWA7XG4gICAgICBsaXN0UGFyYW1zLnB1c2goYWZ0ZXJfc25hcHNob3RfaWQpO1xuICAgIH1cblxuICAgIGxpc3RRdWVyeSArPSBgIE9SREVSIEJZIGNyZWF0ZWRfYXQgQVNDIExJTUlUICQke2xpc3RQYXJhbXMubGVuZ3RoICsgMX0gT0ZGU0VUICQke2xpc3RQYXJhbXMubGVuZ3RoICsgMn1gO1xuICAgIGxpc3RQYXJhbXMucHVzaChsaW1pdCwgb2Zmc2V0KTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRDaGFuZ2U+KGxpc3RRdWVyeSwgbGlzdFBhcmFtcyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY2hhbmdlczogcmVzdWx0LnJvd3MsXG4gICAgICB0b3RhbCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluS4pOS4quW/q+eFp+S5i+mXtOeahOWPmOabtFxuICAgKi9cbiAgYXN5bmMgZ2V0Q2hhbmdlc0JldHdlZW5TbmFwc2hvdHMoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgZnJvbV9zbmFwc2hvdF9pZDogc3RyaW5nLFxuICAgIHRvX3NuYXBzaG90X2lkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxEb2N1bWVudENoYW5nZVtdPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudENoYW5nZT4oXG4gICAgICBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9jaGFuZ2VzXG4gICAgICAgV0hFUkUgb2JqZWN0X2lkID0gJDFcbiAgICAgICAgIEFORCBjcmVhdGVkX2F0ID4gKFNFTEVDVCBjcmVhdGVkX2F0IEZST00gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIFdIRVJFIHNuYXBzaG90X2lkID0gJDIpXG4gICAgICAgICBBTkQgY3JlYXRlZF9hdCA8PSAoU0VMRUNUIGNyZWF0ZWRfYXQgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHMgV0hFUkUgc25hcHNob3RfaWQgPSAkMylcbiAgICAgICBPUkRFUiBCWSBjcmVhdGVkX2F0IEFTQ2AsXG4gICAgICBbb2JqZWN0X2lkLCBmcm9tX3NuYXBzaG90X2lkLCB0b19zbmFwc2hvdF9pZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93cztcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTmlofmoaPnmoTmiYDmnInlj5jmm7TorrDlvZVcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUJ5T2JqZWN0SWQob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ0RFTEVURSBGUk9NIHBpa3VuX2RiLmRvY3VtZW50X2NoYW5nZXMgV0hFUkUgb2JqZWN0X2lkID0gJDEnLFxuICAgICAgW29iamVjdF9pZF1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJJbmplY3RhYmxlIiwiRGF0YWJhc2UiLCJ2NCIsInV1aWR2NCIsIkRvY3VtZW50Q2hhbmdlREFPIiwiY29uc3RydWN0b3IiLCJkYiIsImdldEluc3RhbmNlIiwiY3JlYXRlIiwiY2hhbmdlIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJub3ciLCJyZXN1bHQiLCJxdWVyeSIsIm9iamVjdF9pZCIsIndvcmtzcGFjZV9pZCIsInNuYXBzaG90X2lkIiwiY2hhbmdlX3R5cGUiLCJjaGFuZ2VfZGF0YSIsImJlZm9yZV9zdGF0ZV92ZWN0b3IiLCJhZnRlcl9zdGF0ZV92ZWN0b3IiLCJsZW5ndGgiLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YWRhdGEiLCJyb3dzIiwiZmluZEJ5T2JqZWN0SWQiLCJvcHRpb25zIiwibGltaXQiLCJvZmZzZXQiLCJhZnRlcl9zbmFwc2hvdF9pZCIsImNvdW50UGFyYW1zIiwicHVzaCIsImNvdW50UmVzdWx0IiwidG90YWwiLCJwYXJzZUludCIsImNvdW50IiwibGlzdFF1ZXJ5IiwibGlzdFBhcmFtcyIsImNoYW5nZXMiLCJnZXRDaGFuZ2VzQmV0d2VlblNuYXBzaG90cyIsImZyb21fc25hcHNob3RfaWQiLCJ0b19zbmFwc2hvdF9pZCIsImRlbGV0ZUJ5T2JqZWN0SWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/document-change.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/document.dao.ts":
/*!*********************************!*\
  !*** ./src/dao/document.dao.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentDAO: () => (/* binding */ DocumentDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! uuid */ \"(rsc)/../../node_modules/uuid/dist/esm-node/v4.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nclass DocumentDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 创建文档\n   */ async create(document) {\n        const result = await this.db.query(`INSERT INTO pikun_db.documents (workspace_id, title, content, content_length, owner_uid, metadata)\n       VALUES ($1, $2, $3, $4, $5, $6)\n       RETURNING object_id, workspace_id, title, content, content_length, owner_uid, metadata, deleted_at, created_at, updated_at`, [\n            document.workspace_id,\n            document.title,\n            document.content,\n            document.content_length,\n            document.owner_uid,\n            JSON.stringify(document.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 根据 ID 查找文档\n   */ async findById(object_id) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.documents WHERE object_id = $1 AND deleted_at IS NULL\", [\n            object_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据工作空间 ID 查找文档列表\n   */ async findByWorkspaceId(workspace_id, options = {}) {\n        const page = options.page || 1;\n        const page_size = options.page_size || 20;\n        const sort_by = options.sort_by || \"updated_at\";\n        const order = options.order || \"desc\";\n        const offset = (page - 1) * page_size;\n        // 获取总数\n        const countResult = await this.db.query(\"SELECT COUNT(*) as count FROM pikun_db.documents WHERE workspace_id = $1 AND deleted_at IS NULL\", [\n            workspace_id\n        ]);\n        const total = parseInt(countResult.rows[0].count, 10);\n        // 获取文档列表（不包含 content，减少数据传输）\n        const result = await this.db.query(`SELECT object_id, workspace_id, title, content_length, owner_uid, metadata, deleted_at, created_at, updated_at\n       FROM pikun_db.documents\n       WHERE workspace_id = $1 AND deleted_at IS NULL\n       ORDER BY ${sort_by} ${order}\n       LIMIT $2 OFFSET $3`, [\n            workspace_id,\n            page_size,\n            offset\n        ]);\n        return {\n            documents: result.rows,\n            total\n        };\n    }\n    /**\n   * 更新文档\n   */ async update(object_id, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.title !== undefined) {\n            fields.push(`title = $${paramIndex++}`);\n            values.push(updates.title);\n        }\n        if (updates.content !== undefined) {\n            fields.push(`content = $${paramIndex++}`);\n            values.push(updates.content);\n        }\n        if (updates.content_length !== undefined) {\n            fields.push(`content_length = $${paramIndex++}`);\n            values.push(updates.content_length);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(object_id);\n        }\n        values.push(object_id);\n        const result = await this.db.query(`UPDATE pikun_db.documents SET ${fields.join(\", \")} WHERE object_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING object_id, workspace_id, title, content, content_length, owner_uid, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除文档（软删除）\n   */ async delete(object_id) {\n        await this.db.query(\"UPDATE pikun_db.documents SET deleted_at = CURRENT_TIMESTAMP WHERE object_id = $1\", [\n            object_id\n        ]);\n    }\n    /**\n   * 创建文档快照\n   */ async createSnapshot(snapshot) {\n        const created_at = Date.now();\n        const result = await this.db.query(`INSERT INTO pikun_db.document_snapshots (\n        snapshot_id, object_id, workspace_id, snapshot_data, snapshot_version, \n        doc_state, doc_state_version, version_type, metadata, created_at\n      )\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)\n      RETURNING *`, [\n            (0,uuid__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(),\n            snapshot.object_id,\n            snapshot.workspace_id,\n            snapshot.snapshot_data,\n            snapshot.snapshot_version,\n            snapshot.doc_state || null,\n            snapshot.doc_state_version || 1,\n            snapshot.version_type || \"major\",\n            JSON.stringify(snapshot.metadata || {}),\n            created_at\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(object_id, options = {}) {\n        const limit = options.limit || 20;\n        const offset = options.offset || 0;\n        console.log(`[DocumentDAO] getSnapshots for object_id: ${object_id}, limit: ${limit}, offset: ${offset}`);\n        const countResult = await this.db.query(\"SELECT COUNT(*) as count FROM pikun_db.document_snapshots WHERE object_id = $1\", [\n            object_id\n        ]);\n        const total = parseInt(countResult.rows[0].count, 10);\n        console.log(`[DocumentDAO] Total snapshots count: ${total}`);\n        // 只返回必要的字段，不返回 snapshot_data 和 doc_state（这些是大字段）\n        // 注意：返回的数据结构需要匹配 DocumentSnapshot，但 snapshot_data 和 doc_state 可以为空\n        const result = await this.db.query(`SELECT snapshot_id, object_id, workspace_id, snapshot_version, doc_state_version, version_type, metadata, created_at\n       FROM pikun_db.document_snapshots\n       WHERE object_id = $1\n       ORDER BY created_at DESC\n       LIMIT $2 OFFSET $3`, [\n            object_id,\n            limit,\n            offset\n        ]);\n        console.log(`[DocumentDAO] Query returned ${result.rows.length} snapshots`);\n        // 转换为 DocumentSnapshot 格式，将缺失的字段设为空 Buffer\n        const snapshots = result.rows.map((row)=>({\n                ...row,\n                snapshot_data: Buffer.alloc(0),\n                doc_state: null\n            }));\n        return {\n            snapshots,\n            total\n        };\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(object_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_snapshots\n       WHERE object_id = $1\n       ORDER BY created_at DESC\n       LIMIT 1`, [\n            object_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 snapshot_id 获取快照\n   */ async getSnapshotById(snapshot_id) {\n        const result = await this.db.query(`SELECT * FROM pikun_db.document_snapshots\n       WHERE snapshot_id = $1`, [\n            snapshot_id\n        ]);\n        return result.rows[0] || null;\n    }\n}\nDocumentDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"DocumentDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [])\n], DocumentDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFDM0I7SUFFQTs7R0FFQyxHQUNELE1BQU02QyxnQkFBZ0JDLFdBQW1CLEVBQW9DO1FBQzNFLE1BQU14RCxTQUFTLE1BQU0sSUFBSSxDQUFDSixFQUFFLENBQUNLLEtBQUssQ0FDaEMsQ0FBQzs2QkFDc0IsQ0FBQyxFQUN4QjtZQUFDdUQ7U0FBWTtRQUVmLE9BQU94RCxPQUFPVSxJQUFJLENBQUMsRUFBRSxJQUFJO0lBQzNCO0FBQ0Y7QUF6UGFoQixjQUFBQSxvRUFBQUE7SUFEWkgsNEVBQVVBLENBQUM7OztHQUNDRyIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9kYW8vZG9jdW1lbnQuZGFvLnRzPzQ2OTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IERvY3VtZW50LCBEb2N1bWVudFNuYXBzaG90IH0gZnJvbSAnQC9lbnRpdGllcyc7XG5pbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJztcblxuLyoqXG4gKiDmlofmoaMgREFPXG4gKiDotJ/otKPmlofmoaPnm7jlhbPnmoTmlbDmja7lupPmk43kvZzvvIzkvb/nlKjlj4LmlbDljJbmn6Xor6LpmLLmraIgU1FMIOazqOWFpVxuICovXG5ASW5qZWN0YWJsZSgnRG9jdW1lbnREQU8nKVxuZXhwb3J0IGNsYXNzIERvY3VtZW50REFPIHtcbiAgcHJpdmF0ZSBkYjogRGF0YWJhc2U7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5kYiA9IERhdGFiYXNlLmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65paH5qGjXG4gICAqL1xuICBhc3luYyBjcmVhdGUoZG9jdW1lbnQ6IHtcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IEJ1ZmZlcjtcbiAgICBjb250ZW50X2xlbmd0aDogbnVtYmVyO1xuICAgIG93bmVyX3VpZDogbnVtYmVyO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8RG9jdW1lbnQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PERvY3VtZW50PihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi5kb2N1bWVudHMgKHdvcmtzcGFjZV9pZCwgdGl0bGUsIGNvbnRlbnQsIGNvbnRlbnRfbGVuZ3RoLCBvd25lcl91aWQsIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNilcbiAgICAgICBSRVRVUk5JTkcgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50LCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICBbXG4gICAgICAgIGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgZG9jdW1lbnQudGl0bGUsXG4gICAgICAgIGRvY3VtZW50LmNvbnRlbnQsXG4gICAgICAgIGRvY3VtZW50LmNvbnRlbnRfbGVuZ3RoLFxuICAgICAgICBkb2N1bWVudC5vd25lcl91aWQsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGRvY3VtZW50Lm1ldGFkYXRhIHx8IHt9KSxcbiAgICAgIF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja4gSUQg5p+l5om+5paH5qGjXG4gICAqL1xuICBhc3luYyBmaW5kQnlJZChvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8RG9jdW1lbnQgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxEb2N1bWVudD4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudHMgV0hFUkUgb2JqZWN0X2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbb2JqZWN0X2lkXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u5bel5L2c56m66Ze0IElEIOafpeaJvuaWh+aho+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZmluZEJ5V29ya3NwYWNlSWQoXG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmcsXG4gICAgb3B0aW9uczoge1xuICAgICAgcGFnZT86IG51bWJlcjtcbiAgICAgIHBhZ2Vfc2l6ZT86IG51bWJlcjtcbiAgICAgIHNvcnRfYnk/OiAnY3JlYXRlZF9hdCcgfCAndXBkYXRlZF9hdCcgfCAndGl0bGUnO1xuICAgICAgb3JkZXI/OiAnYXNjJyB8ICdkZXNjJztcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTx7IGRvY3VtZW50czogRG9jdW1lbnRbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgY29uc3QgcGFnZSA9IG9wdGlvbnMucGFnZSB8fCAxO1xuICAgIGNvbnN0IHBhZ2Vfc2l6ZSA9IG9wdGlvbnMucGFnZV9zaXplIHx8IDIwO1xuICAgIGNvbnN0IHNvcnRfYnkgPSBvcHRpb25zLnNvcnRfYnkgfHwgJ3VwZGF0ZWRfYXQnO1xuICAgIGNvbnN0IG9yZGVyID0gb3B0aW9ucy5vcmRlciB8fCAnZGVzYyc7XG4gICAgY29uc3Qgb2Zmc2V0ID0gKHBhZ2UgLSAxKSAqIHBhZ2Vfc2l6ZTtcblxuICAgIC8vIOiOt+WPluaAu+aVsFxuICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTx7IGNvdW50OiBzdHJpbmcgfT4oXG4gICAgICAnU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gcGlrdW5fZGIuZG9jdW1lbnRzIFdIRVJFIHdvcmtzcGFjZV9pZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwnLFxuICAgICAgW3dvcmtzcGFjZV9pZF1cbiAgICApO1xuICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY291bnRSZXN1bHQucm93c1swXS5jb3VudCwgMTApO1xuXG4gICAgLy8g6I635Y+W5paH5qGj5YiX6KGo77yI5LiN5YyF5ZCrIGNvbnRlbnTvvIzlh4/lsJHmlbDmja7kvKDovpPvvIlcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PERvY3VtZW50PihcbiAgICAgIGBTRUxFQ1Qgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdFxuICAgICAgIEZST00gcGlrdW5fZGIuZG9jdW1lbnRzXG4gICAgICAgV0hFUkUgd29ya3NwYWNlX2lkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTFxuICAgICAgIE9SREVSIEJZICR7c29ydF9ieX0gJHtvcmRlcn1cbiAgICAgICBMSU1JVCAkMiBPRkZTRVQgJDNgLFxuICAgICAgW3dvcmtzcGFjZV9pZCwgcGFnZV9zaXplLCBvZmZzZXRdXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBkb2N1bWVudHM6IHJlc3VsdC5yb3dzLFxuICAgICAgdG90YWwsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrDmlofmoaNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZShcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICB0aXRsZT86IHN0cmluZztcbiAgICAgIGNvbnRlbnQ/OiBCdWZmZXI7XG4gICAgICBjb250ZW50X2xlbmd0aD86IG51bWJlcjtcbiAgICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICB9XG4gICk6IFByb21pc2U8RG9jdW1lbnQ+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGB0aXRsZSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMudGl0bGUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5jb250ZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBjb250ZW50ID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jb250ZW50KTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMuY29udGVudF9sZW5ndGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYGNvbnRlbnRfbGVuZ3RoID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5jb250ZW50X2xlbmd0aCk7XG4gICAgfVxuICAgIGlmICh1cGRhdGVzLm1ldGFkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBtZXRhZGF0YSA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICAgIHZhbHVlcy5wdXNoKEpTT04uc3RyaW5naWZ5KHVwZGF0ZXMubWV0YWRhdGEpKTtcbiAgICB9XG5cbiAgICBpZiAoZmllbGRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuZmluZEJ5SWQob2JqZWN0X2lkKSBhcyBQcm9taXNlPERvY3VtZW50PjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaChvYmplY3RfaWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnQ+KFxuICAgICAgYFVQREFURSBwaWt1bl9kYi5kb2N1bWVudHMgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIG9iamVjdF9pZCA9ICQke3BhcmFtSW5kZXh9IEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBSRVRVUk5JTkcgb2JqZWN0X2lkLCB3b3Jrc3BhY2VfaWQsIHRpdGxlLCBjb250ZW50LCBjb250ZW50X2xlbmd0aCwgb3duZXJfdWlkLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICB2YWx1ZXNcbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTmlofmoaPvvIjova/liKDpmaTvvIlcbiAgICovXG4gIGFzeW5jIGRlbGV0ZShvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuZGIucXVlcnkoXG4gICAgICAnVVBEQVRFIHBpa3VuX2RiLmRvY3VtZW50cyBTRVQgZGVsZXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QIFdIRVJFIG9iamVjdF9pZCA9ICQxJyxcbiAgICAgIFtvYmplY3RfaWRdXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlofmoaPlv6vnhadcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVNuYXBzaG90KHNuYXBzaG90OiB7XG4gICAgb2JqZWN0X2lkOiBzdHJpbmc7XG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmc7XG4gICAgc25hcHNob3RfZGF0YTogQnVmZmVyO1xuICAgIHNuYXBzaG90X3ZlcnNpb246IG51bWJlcjtcbiAgICBkb2Nfc3RhdGU/OiBCdWZmZXI7XG4gICAgZG9jX3N0YXRlX3ZlcnNpb24/OiBudW1iZXI7XG4gICAgdmVyc2lvbl90eXBlPzogJ21ham9yJyB8ICdtaW5vcic7IC8vIOeJiOacrOexu+Wei1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgfSk6IFByb21pc2U8RG9jdW1lbnRTbmFwc2hvdD4ge1xuICAgIGNvbnN0IGNyZWF0ZWRfYXQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRTbmFwc2hvdD4oXG4gICAgICBgSU5TRVJUIElOVE8gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzIChcbiAgICAgICAgc25hcHNob3RfaWQsIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCBzbmFwc2hvdF9kYXRhLCBzbmFwc2hvdF92ZXJzaW9uLCBcbiAgICAgICAgZG9jX3N0YXRlLCBkb2Nfc3RhdGVfdmVyc2lvbiwgdmVyc2lvbl90eXBlLCBtZXRhZGF0YSwgY3JlYXRlZF9hdFxuICAgICAgKVxuICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgsICQ5LCAkMTApXG4gICAgICBSRVRVUk5JTkcgKmAsXG4gICAgICBbXG4gICAgICAgIHV1aWR2NCgpLFxuICAgICAgICBzbmFwc2hvdC5vYmplY3RfaWQsXG4gICAgICAgIHNuYXBzaG90LndvcmtzcGFjZV9pZCxcbiAgICAgICAgc25hcHNob3Quc25hcHNob3RfZGF0YSxcbiAgICAgICAgc25hcHNob3Quc25hcHNob3RfdmVyc2lvbixcbiAgICAgICAgc25hcHNob3QuZG9jX3N0YXRlIHx8IG51bGwsXG4gICAgICAgIHNuYXBzaG90LmRvY19zdGF0ZV92ZXJzaW9uIHx8IDEsXG4gICAgICAgIHNuYXBzaG90LnZlcnNpb25fdHlwZSB8fCAnbWFqb3InLFxuICAgICAgICBKU09OLnN0cmluZ2lmeShzbmFwc2hvdC5tZXRhZGF0YSB8fCB7fSksXG4gICAgICAgIGNyZWF0ZWRfYXQsXG4gICAgICBdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGj5b+r54Wn5YiX6KGoXG4gICAqL1xuICBhc3luYyBnZXRTbmFwc2hvdHMoXG4gICAgb2JqZWN0X2lkOiBzdHJpbmcsXG4gICAgb3B0aW9uczogeyBsaW1pdD86IG51bWJlcjsgb2Zmc2V0PzogbnVtYmVyIH0gPSB7fVxuICApOiBQcm9taXNlPHsgc25hcHNob3RzOiBEb2N1bWVudFNuYXBzaG90W107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IGxpbWl0ID0gb3B0aW9ucy5saW1pdCB8fCAyMDtcbiAgICBjb25zdCBvZmZzZXQgPSBvcHRpb25zLm9mZnNldCB8fCAwO1xuXG4gICAgY29uc29sZS5sb2coYFtEb2N1bWVudERBT10gZ2V0U25hcHNob3RzIGZvciBvYmplY3RfaWQ6ICR7b2JqZWN0X2lkfSwgbGltaXQ6ICR7bGltaXR9LCBvZmZzZXQ6ICR7b2Zmc2V0fWApO1xuXG4gICAgY29uc3QgY291bnRSZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PHsgY291bnQ6IHN0cmluZyB9PihcbiAgICAgICdTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHMgV0hFUkUgb2JqZWN0X2lkID0gJDEnLFxuICAgICAgW29iamVjdF9pZF1cbiAgICApO1xuICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY291bnRSZXN1bHQucm93c1swXS5jb3VudCwgMTApO1xuICAgIGNvbnNvbGUubG9nKGBbRG9jdW1lbnREQU9dIFRvdGFsIHNuYXBzaG90cyBjb3VudDogJHt0b3RhbH1gKTtcblxuICAgIC8vIOWPqui/lOWbnuW/heimgeeahOWtl+aute+8jOS4jei/lOWbniBzbmFwc2hvdF9kYXRhIOWSjCBkb2Nfc3RhdGXvvIjov5nkupvmmK/lpKflrZfmrrXvvIlcbiAgICAvLyDms6jmhI/vvJrov5Tlm57nmoTmlbDmja7nu5PmnoTpnIDopoHljLnphY0gRG9jdW1lbnRTbmFwc2hvdO+8jOS9hiBzbmFwc2hvdF9kYXRhIOWSjCBkb2Nfc3RhdGUg5Y+v5Lul5Li656m6XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxPbWl0PERvY3VtZW50U25hcHNob3QsICdzbmFwc2hvdF9kYXRhJyB8ICdkb2Nfc3RhdGUnPiAmIHsgc25hcHNob3RfZGF0YT86IEJ1ZmZlcjsgZG9jX3N0YXRlPzogQnVmZmVyIHwgbnVsbCB9PihcbiAgICAgIGBTRUxFQ1Qgc25hcHNob3RfaWQsIG9iamVjdF9pZCwgd29ya3NwYWNlX2lkLCBzbmFwc2hvdF92ZXJzaW9uLCBkb2Nfc3RhdGVfdmVyc2lvbiwgdmVyc2lvbl90eXBlLCBtZXRhZGF0YSwgY3JlYXRlZF9hdFxuICAgICAgIEZST00gcGlrdW5fZGIuZG9jdW1lbnRfc25hcHNob3RzXG4gICAgICAgV0hFUkUgb2JqZWN0X2lkID0gJDFcbiAgICAgICBPUkRFUiBCWSBjcmVhdGVkX2F0IERFU0NcbiAgICAgICBMSU1JVCAkMiBPRkZTRVQgJDNgLFxuICAgICAgW29iamVjdF9pZCwgbGltaXQsIG9mZnNldF1cbiAgICApO1xuXG4gICAgY29uc29sZS5sb2coYFtEb2N1bWVudERBT10gUXVlcnkgcmV0dXJuZWQgJHtyZXN1bHQucm93cy5sZW5ndGh9IHNuYXBzaG90c2ApO1xuXG4gICAgLy8g6L2s5o2i5Li6IERvY3VtZW50U25hcHNob3Qg5qC85byP77yM5bCG57y65aSx55qE5a2X5q616K6+5Li656m6IEJ1ZmZlclxuICAgIGNvbnN0IHNuYXBzaG90czogRG9jdW1lbnRTbmFwc2hvdFtdID0gcmVzdWx0LnJvd3MubWFwKHJvdyA9PiAoe1xuICAgICAgLi4ucm93LFxuICAgICAgc25hcHNob3RfZGF0YTogQnVmZmVyLmFsbG9jKDApLCAvLyDliJfooajmn6Xor6LkuI3pnIDopoHlrp7pmYXmlbDmja5cbiAgICAgIGRvY19zdGF0ZTogbnVsbCxcbiAgICB9KSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc25hcHNob3RzLFxuICAgICAgdG90YWwsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmnIDmlrDlv6vnhadcbiAgICovXG4gIGFzeW5jIGdldExhdGVzdFNuYXBzaG90KG9iamVjdF9pZDogc3RyaW5nKTogUHJvbWlzZTxEb2N1bWVudFNuYXBzaG90IHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRTbmFwc2hvdD4oXG4gICAgICBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHNcbiAgICAgICBXSEVSRSBvYmplY3RfaWQgPSAkMVxuICAgICAgIE9SREVSIEJZIGNyZWF0ZWRfYXQgREVTQ1xuICAgICAgIExJTUlUIDFgLFxuICAgICAgW29iamVjdF9pZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBzbmFwc2hvdF9pZCDojrflj5blv6vnhadcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90QnlJZChzbmFwc2hvdF9pZDogc3RyaW5nKTogUHJvbWlzZTxEb2N1bWVudFNuYXBzaG90IHwgbnVsbD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8RG9jdW1lbnRTbmFwc2hvdD4oXG4gICAgICBgU0VMRUNUICogRlJPTSBwaWt1bl9kYi5kb2N1bWVudF9zbmFwc2hvdHNcbiAgICAgICBXSEVSRSBzbmFwc2hvdF9pZCA9ICQxYCxcbiAgICAgIFtzbmFwc2hvdF9pZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJEYXRhYmFzZSIsIkluamVjdGFibGUiLCJ2NCIsInV1aWR2NCIsIkRvY3VtZW50REFPIiwiY29uc3RydWN0b3IiLCJkYiIsImdldEluc3RhbmNlIiwiY3JlYXRlIiwiZG9jdW1lbnQiLCJyZXN1bHQiLCJxdWVyeSIsIndvcmtzcGFjZV9pZCIsInRpdGxlIiwiY29udGVudCIsImNvbnRlbnRfbGVuZ3RoIiwib3duZXJfdWlkIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwicm93cyIsImZpbmRCeUlkIiwib2JqZWN0X2lkIiwiZmluZEJ5V29ya3NwYWNlSWQiLCJvcHRpb25zIiwicGFnZSIsInBhZ2Vfc2l6ZSIsInNvcnRfYnkiLCJvcmRlciIsIm9mZnNldCIsImNvdW50UmVzdWx0IiwidG90YWwiLCJwYXJzZUludCIsImNvdW50IiwiZG9jdW1lbnRzIiwidXBkYXRlIiwidXBkYXRlcyIsImZpZWxkcyIsInZhbHVlcyIsInBhcmFtSW5kZXgiLCJ1bmRlZmluZWQiLCJwdXNoIiwibGVuZ3RoIiwiam9pbiIsImRlbGV0ZSIsImNyZWF0ZVNuYXBzaG90Iiwic25hcHNob3QiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsIm5vdyIsInNuYXBzaG90X2RhdGEiLCJzbmFwc2hvdF92ZXJzaW9uIiwiZG9jX3N0YXRlIiwiZG9jX3N0YXRlX3ZlcnNpb24iLCJ2ZXJzaW9uX3R5cGUiLCJnZXRTbmFwc2hvdHMiLCJsaW1pdCIsImNvbnNvbGUiLCJsb2ciLCJzbmFwc2hvdHMiLCJtYXAiLCJyb3ciLCJCdWZmZXIiLCJhbGxvYyIsImdldExhdGVzdFNuYXBzaG90IiwiZ2V0U25hcHNob3RCeUlkIiwic25hcHNob3RfaWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/document.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/user.dao.ts":
/*!*****************************!*\
  !*** ./src/dao/user.dao.ts ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserDAO: () => (/* binding */ UserDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass UserDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 根据邮箱查找用户\n   */ async findByEmail(email) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.users WHERE email = $1 AND deleted_at IS NULL\", [\n            email\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 UUID 查找用户\n   */ async findByUuid(uuid) {\n        const result = await this.db.query(\"SELECT uid, uuid, email, name, metadata, deleted_at, created_at, updated_at FROM pikun_db.users WHERE uuid = $1 AND deleted_at IS NULL\", [\n            uuid\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据 UID 查找用户\n   */ async findByUid(uid) {\n        const result = await this.db.query(\"SELECT uid, uuid, email, name, metadata, deleted_at, created_at, updated_at FROM pikun_db.users WHERE uid = $1 AND deleted_at IS NULL\", [\n            uid\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 创建用户\n   */ async create(user) {\n        const result = await this.db.query(`INSERT INTO pikun_db.users (email, password, name, metadata)\n       VALUES ($1, $2, $3, $4)\n       RETURNING uid, uuid, email, name, metadata, deleted_at, created_at, updated_at`, [\n            user.email,\n            user.password,\n            user.name,\n            JSON.stringify(user.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 更新用户信息\n   */ async update(uid, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.email !== undefined) {\n            fields.push(`email = $${paramIndex++}`);\n            values.push(updates.email);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findByUid(uid);\n        }\n        values.push(uid);\n        const result = await this.db.query(`UPDATE pikun_db.users SET ${fields.join(\", \")} WHERE uid = $${paramIndex} AND deleted_at IS NULL\n       RETURNING uid, uuid, email, name, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除用户（软删除）\n   */ async delete(uid) {\n        await this.db.query(\"UPDATE pikun_db.users SET deleted_at = CURRENT_TIMESTAMP WHERE uid = $1\", [\n            uid\n        ]);\n    }\n}\nUserDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"UserDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], UserDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvZGFvL3VzZXIuZGFvLnRzPzYyODQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IFVzZXIsIERvY3VtZW50LCBEb2N1bWVudFNuYXBzaG90LCBXb3Jrc3BhY2UgfSBmcm9tICdAL2VudGl0aWVzJztcblxuLyoqXG4gKiDnlKjmiLcgREFPXG4gKiDotJ/otKPnlKjmiLfnm7jlhbPnmoTmlbDmja7lupPmk43kvZzvvIzkvb/nlKjlj4LmlbDljJbmn6Xor6LpmLLmraIgU1FMIOazqOWFpVxuICovXG5ASW5qZWN0YWJsZSgnVXNlckRBTycpXG5leHBvcnQgY2xhc3MgVXNlckRBTyB7XG4gIHByaXZhdGUgZGI6IERhdGFiYXNlO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZGIgPSBEYXRhYmFzZS5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNrumCrueuseafpeaJvueUqOaIt1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXI+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIudXNlcnMgV0hFUkUgZW1haWwgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFtlbWFpbF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBVVUlEIOafpeaJvueUqOaIt1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5VXVpZCh1dWlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxVc2VyPihcbiAgICAgICdTRUxFQ1QgdWlkLCB1dWlkLCBlbWFpbCwgbmFtZSwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQgRlJPTSBwaWt1bl9kYi51c2VycyBXSEVSRSB1dWlkID0gJDEgQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTCcsXG4gICAgICBbdXVpZF1cbiAgICApO1xuICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBVSUQg5p+l5om+55So5oi3XG4gICAqL1xuICBhc3luYyBmaW5kQnlVaWQodWlkOiBudW1iZXIpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxVc2VyPihcbiAgICAgICdTRUxFQ1QgdWlkLCB1dWlkLCBlbWFpbCwgbmFtZSwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQgRlJPTSBwaWt1bl9kYi51c2VycyBXSEVSRSB1aWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt1aWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rnlKjmiLdcbiAgICovXG4gIGFzeW5jIGNyZWF0ZSh1c2VyOiB7XG4gICAgZW1haWw6IHN0cmluZztcbiAgICBwYXNzd29yZDogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFVzZXI+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFVzZXI+KFxuICAgICAgYElOU0VSVCBJTlRPIHBpa3VuX2RiLnVzZXJzIChlbWFpbCwgcGFzc3dvcmQsIG5hbWUsIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQpXG4gICAgICAgUkVUVVJOSU5HIHVpZCwgdXVpZCwgZW1haWwsIG5hbWUsIG1ldGFkYXRhLCBkZWxldGVkX2F0LCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0YCxcbiAgICAgIFt1c2VyLmVtYWlsLCB1c2VyLnBhc3N3b3JkLCB1c2VyLm5hbWUsIEpTT04uc3RyaW5naWZ5KHVzZXIubWV0YWRhdGEgfHwge30pXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOeUqOaIt+S/oeaBr1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlKHVpZDogbnVtYmVyLCB1cGRhdGVzOiB7XG4gICAgbmFtZT86IHN0cmluZztcbiAgICBlbWFpbD86IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFVzZXI+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLm5hbWUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5lbWFpbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZHMucHVzaChgZW1haWwgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLmVtYWlsKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlVaWQodWlkKSBhcyBQcm9taXNlPFVzZXI+O1xuICAgIH1cblxuICAgIHZhbHVlcy5wdXNoKHVpZCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxVc2VyPihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIudXNlcnMgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIHVpZCA9ICQke3BhcmFtSW5kZXh9IEFORCBkZWxldGVkX2F0IElTIE5VTExcbiAgICAgICBSRVRVUk5JTkcgdWlkLCB1dWlkLCBlbWFpbCwgbmFtZSwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk55So5oi377yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUodWlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi51c2VycyBTRVQgZGVsZXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QIFdIRVJFIHVpZCA9ICQxJyxcbiAgICAgIFt1aWRdXG4gICAgKTtcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiRGF0YWJhc2UiLCJJbmplY3RhYmxlIiwiVXNlckRBTyIsImNvbnN0cnVjdG9yIiwiZGIiLCJnZXRJbnN0YW5jZSIsImZpbmRCeUVtYWlsIiwiZW1haWwiLCJyZXN1bHQiLCJxdWVyeSIsInJvd3MiLCJmaW5kQnlVdWlkIiwidXVpZCIsImZpbmRCeVVpZCIsInVpZCIsImNyZWF0ZSIsInVzZXIiLCJwYXNzd29yZCIsIm5hbWUiLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YWRhdGEiLCJ1cGRhdGUiLCJ1cGRhdGVzIiwiZmllbGRzIiwidmFsdWVzIiwicGFyYW1JbmRleCIsInVuZGVmaW5lZCIsInB1c2giLCJsZW5ndGgiLCJqb2luIiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/user.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/dao/workspace.dao.ts":
/*!**********************************!*\
  !*** ./src/dao/workspace.dao.ts ***!
  \**********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WorkspaceDAO: () => (/* binding */ WorkspaceDAO)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @swc/helpers/_/_ts_metadata */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var _core_database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/core/database */ \"(rsc)/./src/core/database.ts\");\n/* harmony import */ var _decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/decorators/injectable.decorator */ \"(rsc)/./src/decorators/injectable.decorator.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_core_database__WEBPACK_IMPORTED_MODULE_0__]);\n_core_database__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nclass WorkspaceDAO {\n    constructor(){\n        this.db = _core_database__WEBPACK_IMPORTED_MODULE_0__.Database.getInstance();\n    }\n    /**\n   * 创建工作空间\n   */ async create(workspace) {\n        const result = await this.db.query(`INSERT INTO pikun_db.workspaces (name, owner_uid, icon, metadata)\n       VALUES ($1, $2, $3, $4)\n       RETURNING workspace_id, name, owner_uid, icon, metadata, deleted_at, created_at, updated_at`, [\n            workspace.name,\n            workspace.owner_uid,\n            workspace.icon || null,\n            JSON.stringify(workspace.metadata || {})\n        ]);\n        return result.rows[0];\n    }\n    /**\n   * 根据 ID 查找工作空间\n   */ async findById(workspace_id) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.workspaces WHERE workspace_id = $1 AND deleted_at IS NULL\", [\n            workspace_id\n        ]);\n        return result.rows[0] || null;\n    }\n    /**\n   * 根据用户 ID 查找用户的所有工作空间\n   */ async findByOwnerUid(owner_uid) {\n        const result = await this.db.query(\"SELECT * FROM pikun_db.workspaces WHERE owner_uid = $1 AND deleted_at IS NULL ORDER BY created_at DESC\", [\n            owner_uid\n        ]);\n        return result.rows;\n    }\n    /**\n   * 获取用户的默认工作空间（第一个工作空间或创建新的）\n   */ async getOrCreateDefault(owner_uid) {\n        // 先查找用户的工作空间\n        const workspaces = await this.findByOwnerUid(owner_uid);\n        if (workspaces.length > 0) {\n            return workspaces[0];\n        }\n        // 如果没有，创建默认工作空间\n        return await this.create({\n            name: \"我的工作空间\",\n            owner_uid\n        });\n    }\n    /**\n   * 更新工作空间\n   */ async update(workspace_id, updates) {\n        const fields = [];\n        const values = [];\n        let paramIndex = 1;\n        if (updates.name !== undefined) {\n            fields.push(`name = $${paramIndex++}`);\n            values.push(updates.name);\n        }\n        if (updates.icon !== undefined) {\n            fields.push(`icon = $${paramIndex++}`);\n            values.push(updates.icon);\n        }\n        if (updates.metadata !== undefined) {\n            fields.push(`metadata = $${paramIndex++}`);\n            values.push(JSON.stringify(updates.metadata));\n        }\n        if (fields.length === 0) {\n            return this.findById(workspace_id);\n        }\n        values.push(workspace_id);\n        const result = await this.db.query(`UPDATE pikun_db.workspaces SET ${fields.join(\", \")} WHERE workspace_id = $${paramIndex} AND deleted_at IS NULL\n       RETURNING workspace_id, name, owner_uid, icon, metadata, deleted_at, created_at, updated_at`, values);\n        return result.rows[0];\n    }\n    /**\n   * 删除工作空间（软删除）\n   */ async delete(workspace_id) {\n        await this.db.query(\"UPDATE pikun_db.workspaces SET deleted_at = CURRENT_TIMESTAMP WHERE workspace_id = $1\", [\n            workspace_id\n        ]);\n    }\n}\nWorkspaceDAO = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__decorate)([\n    (0,_decorators_injectable_decorator__WEBPACK_IMPORTED_MODULE_1__.Injectable)(\"WorkspaceDAO\"),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_2__.__metadata)(\"design:paramtypes\", [])\n], WorkspaceDAO);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDSyxLQUFLLENBQ2pCLHlGQUNBO1lBQUNTO1NBQWE7SUFFbEI7QUFDRjtBQXZIYWhCLGVBQUFBLG9FQUFBQTtJQURaRCw0RUFBVUEsQ0FBQzs7O0dBQ0NDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL2Rhby93b3Jrc3BhY2UuZGFvLnRzP2VlOGMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdAL2NvcmUvZGF0YWJhc2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0AvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvcic7XG5pbXBvcnQgdHlwZSB7IFdvcmtzcGFjZSB9IGZyb20gJ0AvZW50aXRpZXMnO1xuXG4vKipcbiAqIOW3peS9nOepuumXtCBEQU9cbiAqIOi0n+i0o+W3peS9nOepuumXtOebuOWFs+eahOaVsOaNruW6k+aTjeS9nFxuICovXG5ASW5qZWN0YWJsZSgnV29ya3NwYWNlREFPJylcbmV4cG9ydCBjbGFzcyBXb3Jrc3BhY2VEQU8ge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gRGF0YWJhc2UuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rlt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGNyZWF0ZSh3b3Jrc3BhY2U6IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgb3duZXJfdWlkOiBudW1iZXI7XG4gICAgaWNvbj86IHN0cmluZztcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPFdvcmtzcGFjZT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8V29ya3NwYWNlPihcbiAgICAgIGBJTlNFUlQgSU5UTyBwaWt1bl9kYi53b3Jrc3BhY2VzIChuYW1lLCBvd25lcl91aWQsIGljb24sIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQpXG4gICAgICAgUkVUVVJOSU5HIHdvcmtzcGFjZV9pZCwgbmFtZSwgb3duZXJfdWlkLCBpY29uLCBtZXRhZGF0YSwgZGVsZXRlZF9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdGAsXG4gICAgICBbXG4gICAgICAgIHdvcmtzcGFjZS5uYW1lLFxuICAgICAgICB3b3Jrc3BhY2Uub3duZXJfdWlkLFxuICAgICAgICB3b3Jrc3BhY2UuaWNvbiB8fCBudWxsLFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh3b3Jrc3BhY2UubWV0YWRhdGEgfHwge30pLFxuICAgICAgXVxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBJRCDmn6Xmib7lt6XkvZznqbrpl7RcbiAgICovXG4gIGFzeW5jIGZpbmRCeUlkKHdvcmtzcGFjZV9pZDogc3RyaW5nKTogUHJvbWlzZTxXb3Jrc3BhY2UgfCBudWxsPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeTxXb3Jrc3BhY2U+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gcGlrdW5fZGIud29ya3NwYWNlcyBXSEVSRSB3b3Jrc3BhY2VfaWQgPSAkMSBBTkQgZGVsZXRlZF9hdCBJUyBOVUxMJyxcbiAgICAgIFt3b3Jrc3BhY2VfaWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7nlKjmiLcgSUQg5p+l5om+55So5oi355qE5omA5pyJ5bel5L2c56m66Ze0XG4gICAqL1xuICBhc3luYyBmaW5kQnlPd25lclVpZChvd25lcl91aWQ6IG51bWJlcik6IFByb21pc2U8V29ya3NwYWNlW10+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5PFdvcmtzcGFjZT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBwaWt1bl9kYi53b3Jrc3BhY2VzIFdIRVJFIG93bmVyX3VpZCA9ICQxIEFORCBkZWxldGVkX2F0IElTIE5VTEwgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDJyxcbiAgICAgIFtvd25lcl91aWRdXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3M7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W55So5oi355qE6buY6K6k5bel5L2c56m66Ze077yI56ys5LiA5Liq5bel5L2c56m66Ze05oiW5Yib5bu65paw55qE77yJXG4gICAqL1xuICBhc3luYyBnZXRPckNyZWF0ZURlZmF1bHQob3duZXJfdWlkOiBudW1iZXIpOiBQcm9taXNlPFdvcmtzcGFjZT4ge1xuICAgIC8vIOWFiOafpeaJvueUqOaIt+eahOW3peS9nOepuumXtFxuICAgIGNvbnN0IHdvcmtzcGFjZXMgPSBhd2FpdCB0aGlzLmZpbmRCeU93bmVyVWlkKG93bmVyX3VpZCk7XG4gICAgaWYgKHdvcmtzcGFjZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHdvcmtzcGFjZXNbMF07XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5rKh5pyJ77yM5Yib5bu66buY6K6k5bel5L2c56m66Ze0XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY3JlYXRlKHtcbiAgICAgIG5hbWU6ICfmiJHnmoTlt6XkvZznqbrpl7QnLFxuICAgICAgb3duZXJfdWlkLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOabtOaWsOW3peS9nOepuumXtFxuICAgKi9cbiAgYXN5bmMgdXBkYXRlKFxuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IHtcbiAgICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgICBpY29uPzogc3RyaW5nO1xuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIH1cbiAgKTogUHJvbWlzZTxXb3Jrc3BhY2U+IHtcbiAgICBjb25zdCBmaWVsZHM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICAgIGlmICh1cGRhdGVzLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLm5hbWUpO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5pY29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGBpY29uID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2godXBkYXRlcy5pY29uKTtcbiAgICB9XG4gICAgaWYgKHVwZGF0ZXMubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRzLnB1c2goYG1ldGFkYXRhID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgICAgdmFsdWVzLnB1c2goSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5tZXRhZGF0YSkpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlJZCh3b3Jrc3BhY2VfaWQpIGFzIFByb21pc2U8V29ya3NwYWNlPjtcbiAgICB9XG5cbiAgICB2YWx1ZXMucHVzaCh3b3Jrc3BhY2VfaWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnk8V29ya3NwYWNlPihcbiAgICAgIGBVUERBVEUgcGlrdW5fZGIud29ya3NwYWNlcyBTRVQgJHtmaWVsZHMuam9pbignLCAnKX0gV0hFUkUgd29ya3NwYWNlX2lkID0gJCR7cGFyYW1JbmRleH0gQU5EIGRlbGV0ZWRfYXQgSVMgTlVMTFxuICAgICAgIFJFVFVSTklORyB3b3Jrc3BhY2VfaWQsIG5hbWUsIG93bmVyX3VpZCwgaWNvbiwgbWV0YWRhdGEsIGRlbGV0ZWRfYXQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRgLFxuICAgICAgdmFsdWVzXG4gICAgKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF07XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5bel5L2c56m66Ze077yI6L2v5Yig6Zmk77yJXG4gICAqL1xuICBhc3luYyBkZWxldGUod29ya3NwYWNlX2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRiLnF1ZXJ5KFxuICAgICAgJ1VQREFURSBwaWt1bl9kYi53b3Jrc3BhY2VzIFNFVCBkZWxldGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgd29ya3NwYWNlX2lkID0gJDEnLFxuICAgICAgW3dvcmtzcGFjZV9pZF1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJEYXRhYmFzZSIsIkluamVjdGFibGUiLCJXb3Jrc3BhY2VEQU8iLCJjb25zdHJ1Y3RvciIsImRiIiwiZ2V0SW5zdGFuY2UiLCJjcmVhdGUiLCJ3b3Jrc3BhY2UiLCJyZXN1bHQiLCJxdWVyeSIsIm5hbWUiLCJvd25lcl91aWQiLCJpY29uIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwicm93cyIsImZpbmRCeUlkIiwid29ya3NwYWNlX2lkIiwiZmluZEJ5T3duZXJVaWQiLCJnZXRPckNyZWF0ZURlZmF1bHQiLCJ3b3Jrc3BhY2VzIiwibGVuZ3RoIiwidXBkYXRlIiwidXBkYXRlcyIsImZpZWxkcyIsInZhbHVlcyIsInBhcmFtSW5kZXgiLCJ1bmRlZmluZWQiLCJwdXNoIiwiam9pbiIsImRlbGV0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/dao/workspace.dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/decorators/injectable.decorator.ts":
/*!************************************************!*\
  !*** ./src/decorators/injectable.decorator.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Inject: () => (/* binding */ Inject),\n/* harmony export */   Injectable: () => (/* binding */ Injectable)\n/* harmony export */ });\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! reflect-metadata */ \"(rsc)/../../node_modules/reflect-metadata/Reflect.js\");\n/* harmony import */ var reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\n * 可注入装饰器\n * 标记类可以被依赖注入容器管理\n */ function Injectable(token) {\n    return function(target) {\n        Reflect.defineMetadata(\"injectable\", true, target);\n        if (token) {\n            Reflect.defineMetadata(\"injectionToken\", token, target);\n        }\n    };\n}\n/**\n * 注入依赖装饰器\n */ function Inject(token) {\n    return function(target, propertyKey, parameterIndex) {\n        const existingTokens = Reflect.getMetadata(\"injections\", target) || [];\n        existingTokens.push({\n            index: parameterIndex,\n            token\n        });\n        Reflect.defineMetadata(\"injections\", existingTokens, target);\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGVjb3JhdG9ycy9pbmplY3RhYmxlLmRlY29yYXRvci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTBCO0FBRTFCOzs7Q0FHQyxHQUNNLFNBQVNBLFdBQVdDLEtBQXVCO0lBQ2hELE9BQU8sU0FBVUMsTUFBVztRQUMxQkMsUUFBUUMsY0FBYyxDQUFDLGNBQWMsTUFBTUY7UUFDM0MsSUFBSUQsT0FBTztZQUNURSxRQUFRQyxjQUFjLENBQUMsa0JBQWtCSCxPQUFPQztRQUNsRDtJQUNGO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLFNBQVNHLE9BQU9KLEtBQXNCO0lBQzNDLE9BQU8sU0FBVUMsTUFBVyxFQUFFSSxXQUF3QyxFQUFFQyxjQUFzQjtRQUM1RixNQUFNQyxpQkFBaUJMLFFBQVFNLFdBQVcsQ0FBQyxjQUFjUCxXQUFXLEVBQUU7UUFDdEVNLGVBQWVFLElBQUksQ0FBQztZQUFFQyxPQUFPSjtZQUFnQk47UUFBTTtRQUNuREUsUUFBUUMsY0FBYyxDQUFDLGNBQWNJLGdCQUFnQk47SUFDdkQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnbG9iYWxsaW5rL3NlcnZlci8uL3NyYy9kZWNvcmF0b3JzL2luamVjdGFibGUuZGVjb3JhdG9yLnRzPzZhMzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcblxuLyoqXG4gKiDlj6/ms6jlhaXoo4XppbDlmahcbiAqIOagh+iusOexu+WPr+S7peiiq+S+nei1luazqOWFpeWuueWZqOeuoeeQhlxuICovXG5leHBvcnQgZnVuY3Rpb24gSW5qZWN0YWJsZSh0b2tlbj86IHN0cmluZyB8IHN5bWJvbCk6IENsYXNzRGVjb3JhdG9yIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQ6IGFueSkge1xuICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoJ2luamVjdGFibGUnLCB0cnVlLCB0YXJnZXQpO1xuICAgIGlmICh0b2tlbikge1xuICAgICAgUmVmbGVjdC5kZWZpbmVNZXRhZGF0YSgnaW5qZWN0aW9uVG9rZW4nLCB0b2tlbiwgdGFyZ2V0KTtcbiAgICB9XG4gIH07XG59XG5cbi8qKlxuICog5rOo5YWl5L6d6LWW6KOF6aWw5ZmoXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBJbmplY3QodG9rZW46IHN0cmluZyB8IHN5bWJvbCk6IFBhcmFtZXRlckRlY29yYXRvciB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcgfCBzeW1ib2wgfCB1bmRlZmluZWQsIHBhcmFtZXRlckluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBleGlzdGluZ1Rva2VucyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ2luamVjdGlvbnMnLCB0YXJnZXQpIHx8IFtdO1xuICAgIGV4aXN0aW5nVG9rZW5zLnB1c2goeyBpbmRleDogcGFyYW1ldGVySW5kZXgsIHRva2VuIH0pO1xuICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoJ2luamVjdGlvbnMnLCBleGlzdGluZ1Rva2VucywgdGFyZ2V0KTtcbiAgfTtcbn1cblxuXG5cblxuIl0sIm5hbWVzIjpbIkluamVjdGFibGUiLCJ0b2tlbiIsInRhcmdldCIsIlJlZmxlY3QiLCJkZWZpbmVNZXRhZGF0YSIsIkluamVjdCIsInByb3BlcnR5S2V5IiwicGFyYW1ldGVySW5kZXgiLCJleGlzdGluZ1Rva2VucyIsImdldE1ldGFkYXRhIiwicHVzaCIsImluZGV4Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/decorators/injectable.decorator.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/auth.service.ts":
/*!**************************************!*\
  !*** ./src/services/auth.service.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthService: () => (/* binding */ AuthService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/../../node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/../../node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/dao/user.dao */ \"(rsc)/./src/dao/user.dao.ts\");\n/* harmony import */ var _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/dao/workspace.dao */ \"(rsc)/./src/dao/workspace.dao.ts\");\n/* harmony import */ var _core_redis__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/core/redis */ \"(rsc)/./src/core/redis.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__]);\n([_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\nclass AuthService {\n    constructor(userDAO, workspaceDAO, redis){\n        this.userDAO = userDAO;\n        this.workspaceDAO = workspaceDAO;\n        this.redis = redis;\n        this.redis = _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis.getInstance();\n    }\n    /**\n   * 用户注册\n   */ async register(data) {\n        // 检查邮箱是否已存在\n        const existingUser = await this.userDAO.findByEmail(data.email);\n        if (existingUser) {\n            throw new Error(\"Email already exists\");\n        }\n        // 加密密码\n        const hashedPassword = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().hash(data.password, 10);\n        // 创建用户\n        const user = await this.userDAO.create({\n            email: data.email,\n            password: hashedPassword,\n            name: data.name\n        });\n        // 创建默认工作空间\n        const defaultWorkspace = await this.workspaceDAO.create({\n            name: \"我的工作空间\",\n            owner_uid: user.uid\n        });\n        // 生成 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const refreshToken = this.generateRefreshToken(user.uid);\n        // 保存刷新令牌到数据库（这里简化处理，实际应该保存到数据库）\n        await this.redis.set(`refresh_token:${refreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60); // 30天\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { password, ...userWithoutPassword } = user;\n        return {\n            user: userWithoutPassword,\n            token,\n            refreshToken,\n            defaultWorkspaceId: defaultWorkspace.workspace_id\n        };\n    }\n    /**\n   * 用户登录\n   */ async login(email, password) {\n        const user = await this.userDAO.findByEmail(email);\n        if (!user) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 验证密码\n        const isValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(password, user.password);\n        if (!isValid) {\n            throw new Error(\"Invalid email or password\");\n        }\n        // 获取或创建默认工作空间\n        const defaultWorkspace = await this.workspaceDAO.getOrCreateDefault(user.uid);\n        // 生成 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const refreshToken = this.generateRefreshToken(user.uid);\n        // 保存刷新令牌\n        await this.redis.set(`refresh_token:${refreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60);\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { password: _, ...userWithoutPassword } = user;\n        return {\n            user: userWithoutPassword,\n            token,\n            refreshToken,\n            defaultWorkspaceId: defaultWorkspace.workspace_id\n        };\n    }\n    /**\n   * 刷新 token\n   */ async refreshToken(refreshToken) {\n        const uidStr = await this.redis.get(`refresh_token:${refreshToken}`);\n        if (!uidStr) {\n            throw new Error(\"Invalid refresh token\");\n        }\n        const uid = parseInt(uidStr, 10);\n        const user = await this.userDAO.findByUid(uid);\n        if (!user) {\n            throw new Error(\"User not found\");\n        }\n        // 生成新 token\n        const token = this.generateToken(user.uid, user.uuid);\n        const newRefreshToken = this.generateRefreshToken(user.uid);\n        // 更新刷新令牌\n        await this.redis.del(`refresh_token:${refreshToken}`);\n        await this.redis.set(`refresh_token:${newRefreshToken}`, user.uid.toString(), 30 * 24 * 60 * 60);\n        return {\n            token,\n            refreshToken: newRefreshToken\n        };\n    }\n    /**\n   * 验证 token\n   */ async verifyToken(token) {\n        try {\n            const secret = \"e88b7d11b577a5a638587f93a4b9348ab34152ab9042cb6b096fc29504732171\" || 0;\n            const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().verify(token, secret);\n            return decoded;\n        } catch  {\n            throw new Error(\"Invalid token\");\n        }\n    }\n    /**\n   * 从请求中获取当前用户（验证 token）\n   */ async getCurrentUser(req) {\n        const authHeader = req.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            throw new Error(\"Unauthorized\");\n        }\n        const token = authHeader.substring(7);\n        return await this.verifyToken(token);\n    }\n    /**\n   * 生成 JWT token\n   */ generateToken(uid, uuid) {\n        const secret = \"e88b7d11b577a5a638587f93a4b9348ab34152ab9042cb6b096fc29504732171\" || 0;\n        const expiresIn = \"7d\" || 0;\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().sign({\n            uid,\n            uuid\n        }, secret, {\n            expiresIn\n        });\n    }\n    /**\n   * 生成刷新 token\n   */ generateRefreshToken(uid) {\n        const secret = \"e88b7d11b577a5a638587f93a4b9348ab34152ab9042cb6b096fc29504732171\" || 0;\n        const expiresIn = \"30d\" || 0;\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().sign({\n            uid,\n            type: \"refresh\"\n        }, secret, {\n            expiresIn\n        });\n    }\n}\nAuthService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"UserDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"WorkspaceDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO === \"undefined\" ? Object : _dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO,\n        typeof _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__.WorkspaceDAO === \"undefined\" ? Object : _dao_workspace_dao__WEBPACK_IMPORTED_MODULE_4__.WorkspaceDAO,\n        typeof _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis === \"undefined\" ? Object : _core_redis__WEBPACK_IMPORTED_MODULE_5__.Redis\n    ])\n], AuthService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VCxFQUFFLE9BQU07WUFDTixNQUFNLElBQUlwQyxNQUFNO1FBQ2xCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1zQyxlQUFlQyxHQUFnQixFQUEwQztRQUM3RSxNQUFNQyxhQUFhRCxJQUFJRSxPQUFPLENBQUNmLEdBQUcsQ0FBQztRQUNuQyxJQUFJLENBQUNjLGNBQWMsQ0FBQ0EsV0FBV0UsVUFBVSxDQUFDLFlBQVk7WUFDcEQsTUFBTSxJQUFJMUMsTUFBTTtRQUNsQjtRQUVBLE1BQU1VLFFBQVE4QixXQUFXRyxTQUFTLENBQUM7UUFDbkMsT0FBTyxNQUFNLElBQUksQ0FBQ1osV0FBVyxDQUFDckI7SUFDaEM7SUFFQTs7R0FFQyxHQUNELGNBQXNCRCxHQUFXLEVBQUVHLElBQVksRUFBVTtRQUN2RCxNQUFNb0IsU0FBU0Msa0VBQXNCLElBQUk7UUFDekMsTUFBTVcsWUFBWVgsSUFBMEIsSUFBSTtRQUNoRCxPQUFPaEQsd0RBQVEsQ0FBQztZQUFFd0I7WUFBS0c7UUFBSyxHQUFHb0IsUUFBUTtZQUFFWTtRQUFVO0lBQ3JEO0lBRUE7O0dBRUMsR0FDRCxxQkFBNkJuQyxHQUFXLEVBQVU7UUFDaEQsTUFBTXVCLFNBQVNDLGtFQUFzQixJQUFJO1FBQ3pDLE1BQU1XLFlBQVlYLEtBQWtDLElBQUk7UUFDeEQsT0FBT2hELHdEQUFRLENBQUM7WUFBRXdCO1lBQUt1QyxNQUFNO1FBQVUsR0FBR2hCLFFBQVE7WUFBRVk7UUFBVTtJQUNoRTtBQUNGO0FBaExhdkQsY0FBQUEsb0VBQUFBO0lBRFpQLG9EQUFVQTtJQUdOQyxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7SUFDUEEsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDOzs7ZUFENEIsa0RBQU8sNEJBQVAsa0RBQU87ZUFDRyw0REFBWSw0QkFBWiw0REFBWTtlQUMzQyw4Q0FBSyw0QkFBTCw4Q0FBSzs7R0FKWE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvc2VydmljZXMvYXV0aC5zZXJ2aWNlLnRzP2Q2ZmEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAndHN5cmluZ2UnO1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XG5pbXBvcnQgdHlwZSB7IFNpZ25PcHRpb25zIH0gZnJvbSAnanNvbndlYnRva2VuJztcbmltcG9ydCB0eXBlIHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBVc2VyREFPIH0gZnJvbSAnQC9kYW8vdXNlci5kYW8nO1xuaW1wb3J0IHsgV29ya3NwYWNlREFPIH0gZnJvbSAnQC9kYW8vd29ya3NwYWNlLmRhbyc7XG5pbXBvcnQgdHlwZSB7IFVzZXIgfSBmcm9tICdAL2VudGl0aWVzJztcbmltcG9ydCB7IFJlZGlzIH0gZnJvbSAnQC9jb3JlL3JlZGlzJztcblxuLyoqXG4gKiDorqTor4HmnI3liqFcbiAqL1xuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEF1dGhTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQGluamVjdCgnVXNlckRBTycpIHByaXZhdGUgdXNlckRBTzogVXNlckRBTyxcbiAgICBAaW5qZWN0KCdXb3Jrc3BhY2VEQU8nKSBwcml2YXRlIHdvcmtzcGFjZURBTzogV29ya3NwYWNlREFPLFxuICAgIHByaXZhdGUgcmVkaXM6IFJlZGlzXG4gICkge1xuICAgIHRoaXMucmVkaXMgPSBSZWRpcy5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeUqOaIt+azqOWGjFxuICAgKi9cbiAgYXN5bmMgcmVnaXN0ZXIoZGF0YTogeyBlbWFpbDogc3RyaW5nOyBwYXNzd29yZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfSk6IFByb21pc2U8e1xuICAgIHVzZXI6IE9taXQ8VXNlciwgJ3Bhc3N3b3JkJz47XG4gICAgdG9rZW46IHN0cmluZztcbiAgICByZWZyZXNoVG9rZW46IHN0cmluZztcbiAgICBkZWZhdWx0V29ya3NwYWNlSWQ6IHN0cmluZztcbiAgfT4ge1xuICAgIC8vIOajgOafpemCrueuseaYr+WQpuW3suWtmOWcqFxuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHRoaXMudXNlckRBTy5maW5kQnlFbWFpbChkYXRhLmVtYWlsKTtcbiAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VtYWlsIGFscmVhZHkgZXhpc3RzJyk7XG4gICAgfVxuXG4gICAgLy8g5Yqg5a+G5a+G56CBXG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChkYXRhLnBhc3N3b3JkLCAxMCk7XG5cbiAgICAvLyDliJvlu7rnlKjmiLdcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyREFPLmNyZWF0ZSh7XG4gICAgICBlbWFpbDogZGF0YS5lbWFpbCxcbiAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICB9KTtcblxuICAgIC8vIOWIm+W7uum7mOiupOW3peS9nOepuumXtFxuICAgIGNvbnN0IGRlZmF1bHRXb3Jrc3BhY2UgPSBhd2FpdCB0aGlzLndvcmtzcGFjZURBTy5jcmVhdGUoe1xuICAgICAgbmFtZTogJ+aIkeeahOW3peS9nOepuumXtCcsXG4gICAgICBvd25lcl91aWQ6IHVzZXIudWlkLFxuICAgIH0pO1xuXG4gICAgLy8g55Sf5oiQIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmdlbmVyYXRlVG9rZW4odXNlci51aWQsIHVzZXIudXVpZCk7XG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gdGhpcy5nZW5lcmF0ZVJlZnJlc2hUb2tlbih1c2VyLnVpZCk7XG5cbiAgICAvLyDkv53lrZjliLfmlrDku6TniYzliLDmlbDmja7lupPvvIjov5nph4znroDljJblpITnkIbvvIzlrp7pmYXlupTor6Xkv53lrZjliLDmlbDmja7lupPvvIlcbiAgICBhd2FpdCB0aGlzLnJlZGlzLnNldChgcmVmcmVzaF90b2tlbjoke3JlZnJlc2hUb2tlbn1gLCB1c2VyLnVpZC50b1N0cmluZygpLCAzMCAqIDI0ICogNjAgKiA2MCk7IC8vIDMw5aSpXG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gICAgY29uc3QgeyBwYXNzd29yZCwgLi4udXNlcldpdGhvdXRQYXNzd29yZCB9ID0gdXNlcjtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjogdXNlcldpdGhvdXRQYXNzd29yZCxcbiAgICAgIHRva2VuLFxuICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgZGVmYXVsdFdvcmtzcGFjZUlkOiBkZWZhdWx0V29ya3NwYWNlLndvcmtzcGFjZV9pZCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOeUqOaIt+eZu+W9lVxuICAgKi9cbiAgYXN5bmMgbG9naW4oXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nXG4gICk6IFByb21pc2U8e1xuICAgIHVzZXI6IE9taXQ8VXNlciwgJ3Bhc3N3b3JkJz47XG4gICAgdG9rZW46IHN0cmluZztcbiAgICByZWZyZXNoVG9rZW46IHN0cmluZztcbiAgICBkZWZhdWx0V29ya3NwYWNlSWQ6IHN0cmluZztcbiAgfT4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJEQU8uZmluZEJ5RW1haWwoZW1haWwpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGVtYWlsIG9yIHBhc3N3b3JkJyk7XG4gICAgfVxuXG4gICAgLy8g6aqM6K+B5a+G56CBXG4gICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKTtcbiAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcpO1xuICAgIH1cblxuICAgIC8vIOiOt+WPluaIluWIm+W7uum7mOiupOW3peS9nOepuumXtFxuICAgIGNvbnN0IGRlZmF1bHRXb3Jrc3BhY2UgPSBhd2FpdCB0aGlzLndvcmtzcGFjZURBTy5nZXRPckNyZWF0ZURlZmF1bHQodXNlci51aWQpO1xuXG4gICAgLy8g55Sf5oiQIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmdlbmVyYXRlVG9rZW4odXNlci51aWQsIHVzZXIudXVpZCk7XG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gdGhpcy5nZW5lcmF0ZVJlZnJlc2hUb2tlbih1c2VyLnVpZCk7XG5cbiAgICAvLyDkv53lrZjliLfmlrDku6TniYxcbiAgICBhd2FpdCB0aGlzLnJlZGlzLnNldChgcmVmcmVzaF90b2tlbjoke3JlZnJlc2hUb2tlbn1gLCB1c2VyLnVpZC50b1N0cmluZygpLCAzMCAqIDI0ICogNjAgKiA2MCk7XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gICAgY29uc3QgeyBwYXNzd29yZDogXywgLi4udXNlcldpdGhvdXRQYXNzd29yZCB9ID0gdXNlcjtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjogdXNlcldpdGhvdXRQYXNzd29yZCxcbiAgICAgIHRva2VuLFxuICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgZGVmYXVsdFdvcmtzcGFjZUlkOiBkZWZhdWx0V29ya3NwYWNlLndvcmtzcGFjZV9pZCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOWIt+aWsCB0b2tlblxuICAgKi9cbiAgYXN5bmMgcmVmcmVzaFRva2VuKHJlZnJlc2hUb2tlbjogc3RyaW5nKTogUHJvbWlzZTx7IHRva2VuOiBzdHJpbmc7IHJlZnJlc2hUb2tlbjogc3RyaW5nIH0+IHtcbiAgICBjb25zdCB1aWRTdHIgPSBhd2FpdCB0aGlzLnJlZGlzLmdldChgcmVmcmVzaF90b2tlbjoke3JlZnJlc2hUb2tlbn1gKTtcbiAgICBpZiAoIXVpZFN0cikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHJlZnJlc2ggdG9rZW4nKTtcbiAgICB9XG5cbiAgICBjb25zdCB1aWQgPSBwYXJzZUludCh1aWRTdHIsIDEwKTtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyREFPLmZpbmRCeVVpZCh1aWQpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIOeUn+aIkOaWsCB0b2tlblxuICAgIGNvbnN0IHRva2VuID0gdGhpcy5nZW5lcmF0ZVRva2VuKHVzZXIudWlkLCB1c2VyLnV1aWQpO1xuICAgIGNvbnN0IG5ld1JlZnJlc2hUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSZWZyZXNoVG9rZW4odXNlci51aWQpO1xuXG4gICAgLy8g5pu05paw5Yi35paw5Luk54mMXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5kZWwoYHJlZnJlc2hfdG9rZW46JHtyZWZyZXNoVG9rZW59YCk7XG4gICAgYXdhaXQgdGhpcy5yZWRpcy5zZXQoXG4gICAgICBgcmVmcmVzaF90b2tlbjoke25ld1JlZnJlc2hUb2tlbn1gLFxuICAgICAgdXNlci51aWQudG9TdHJpbmcoKSxcbiAgICAgIDMwICogMjQgKiA2MCAqIDYwXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICB0b2tlbixcbiAgICAgIHJlZnJlc2hUb2tlbjogbmV3UmVmcmVzaFRva2VuLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog6aqM6K+BIHRva2VuXG4gICAqL1xuICBhc3luYyB2ZXJpZnlUb2tlbih0b2tlbjogc3RyaW5nKTogUHJvbWlzZTx7IHVpZDogbnVtYmVyOyB1dWlkOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZWNyZXQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd5b3VyLXNlY3JldC1rZXknO1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHNlY3JldCkgYXMgeyB1aWQ6IG51bWJlcjsgdXVpZDogc3RyaW5nIH07XG4gICAgICByZXR1cm4gZGVjb2RlZDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0b2tlbicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDku47or7fmsYLkuK3ojrflj5blvZPliY3nlKjmiLfvvIjpqozor4EgdG9rZW7vvIlcbiAgICovXG4gIGFzeW5jIGdldEN1cnJlbnRVc2VyKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPHsgdWlkOiBudW1iZXI7IHV1aWQ6IHN0cmluZyB9PiB7XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpO1xuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnN1YnN0cmluZyg3KTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy52ZXJpZnlUb2tlbih0b2tlbik7XG4gIH1cblxuICAvKipcbiAgICog55Sf5oiQIEpXVCB0b2tlblxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVRva2VuKHVpZDogbnVtYmVyLCB1dWlkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG4gICAgY29uc3QgZXhwaXJlc0luID0gcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4gfHwgJzdkJztcbiAgICByZXR1cm4gand0LnNpZ24oeyB1aWQsIHV1aWQgfSwgc2VjcmV0LCB7IGV4cGlyZXNJbiB9IGFzIFNpZ25PcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnlJ/miJDliLfmlrAgdG9rZW5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVSZWZyZXNoVG9rZW4odWlkOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG4gICAgY29uc3QgZXhwaXJlc0luID0gcHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfRVhQSVJFU19JTiB8fCAnMzBkJztcbiAgICByZXR1cm4gand0LnNpZ24oeyB1aWQsIHR5cGU6ICdyZWZyZXNoJyB9LCBzZWNyZXQsIHsgZXhwaXJlc0luIH0gYXMgU2lnbk9wdGlvbnMpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiaW5qZWN0YWJsZSIsImluamVjdCIsImJjcnlwdCIsImp3dCIsIlVzZXJEQU8iLCJXb3Jrc3BhY2VEQU8iLCJSZWRpcyIsIkF1dGhTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJ1c2VyREFPIiwid29ya3NwYWNlREFPIiwicmVkaXMiLCJnZXRJbnN0YW5jZSIsInJlZ2lzdGVyIiwiZGF0YSIsImV4aXN0aW5nVXNlciIsImZpbmRCeUVtYWlsIiwiZW1haWwiLCJFcnJvciIsImhhc2hlZFBhc3N3b3JkIiwiaGFzaCIsInBhc3N3b3JkIiwidXNlciIsImNyZWF0ZSIsIm5hbWUiLCJkZWZhdWx0V29ya3NwYWNlIiwib3duZXJfdWlkIiwidWlkIiwidG9rZW4iLCJnZW5lcmF0ZVRva2VuIiwidXVpZCIsInJlZnJlc2hUb2tlbiIsImdlbmVyYXRlUmVmcmVzaFRva2VuIiwic2V0IiwidG9TdHJpbmciLCJ1c2VyV2l0aG91dFBhc3N3b3JkIiwiZGVmYXVsdFdvcmtzcGFjZUlkIiwid29ya3NwYWNlX2lkIiwibG9naW4iLCJpc1ZhbGlkIiwiY29tcGFyZSIsImdldE9yQ3JlYXRlRGVmYXVsdCIsIl8iLCJ1aWRTdHIiLCJnZXQiLCJwYXJzZUludCIsImZpbmRCeVVpZCIsIm5ld1JlZnJlc2hUb2tlbiIsImRlbCIsInZlcmlmeVRva2VuIiwic2VjcmV0IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJkZWNvZGVkIiwidmVyaWZ5IiwiZ2V0Q3VycmVudFVzZXIiLCJyZXEiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsInN0YXJ0c1dpdGgiLCJzdWJzdHJpbmciLCJleHBpcmVzSW4iLCJKV1RfRVhQSVJFU19JTiIsInNpZ24iLCJKV1RfUkVGUkVTSF9FWFBJUkVTX0lOIiwidHlwZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/auth.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/document.service.ts":
/*!******************************************!*\
  !*** ./src/services/document.service.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DocumentService: () => (/* binding */ DocumentService)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var yjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! yjs */ \"(rsc)/../../node_modules/yjs/dist/yjs.mjs\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/dao/document-change.dao */ \"(rsc)/./src/dao/document-change.dao.ts\");\n/* harmony import */ var _core_redis__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/core/redis */ \"(rsc)/./src/core/redis.ts\");\n/* harmony import */ var _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./snapshot-scheduler.service */ \"(rsc)/./src/services/snapshot-scheduler.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__, _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__]);\n([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__, _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__, _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\nclass DocumentService {\n    constructor(documentDAO, redis, snapshotScheduler, changeDAO){\n        this.documentDAO = documentDAO;\n        this.redis = redis;\n        this.snapshotScheduler = snapshotScheduler;\n        this.changeDAO = changeDAO;\n        this.redis = _core_redis__WEBPACK_IMPORTED_MODULE_3__.Redis.getInstance();\n    }\n    /**\n   * 创建文档\n   */ async createDocument(data) {\n        const document = await this.documentDAO.create({\n            workspace_id: data.workspace_id,\n            title: data.title,\n            content: data.content,\n            content_length: data.content.length,\n            owner_uid: data.owner_uid,\n            metadata: data.metadata\n        });\n        // 创建初始快照（无论是否有内容，都应该创建初始快照）\n        // 这样即使文档创建时为空，也能有一个基准快照用于时间间隔计算\n        if (this.snapshotScheduler) {\n            try {\n                console.log(`[DocumentService] Creating initial snapshot for document ${document.object_id}, contentLength: ${data.content?.length || 0}`);\n                // 创建初始快照（强制创建大版本）\n                // 即使 content 为空，也创建一个空内容的快照\n                const contentToSnapshot = data.content && data.content.length > 0 ? data.content : Buffer.alloc(0); // 空内容也创建快照\n                const snapshotResult = await this.snapshotScheduler.createSnapshotManually(document.object_id, document.workspace_id, contentToSnapshot, undefined, true // 强制创建大版本\n                );\n                console.log(`[DocumentService] Initial snapshot created:`, {\n                    snapshot_id: snapshotResult.snapshot_id,\n                    version_type: snapshotResult.version_type,\n                    created_at: snapshotResult.created_at\n                });\n            } catch (error) {\n                // 快照创建失败不应该影响文档创建，只记录错误\n                console.error(\"[DocumentService] Failed to create initial snapshot:\", error);\n            }\n        } else {\n            console.warn(`[DocumentService] SnapshotScheduler not available, cannot create initial snapshot`);\n        }\n        // 清除缓存\n        await this.redis.del(`document:${document.object_id}`);\n        // 清除该工作空间的所有文档列表缓存（因为缓存键包含 options 参数）\n        await this.redis.delByPattern(`documents:workspace:${data.workspace_id}:*`);\n        return document;\n    }\n    /**\n   * 获取文档\n   */ async getDocument(object_id, includeContent = true) {\n        // 尝试从缓存获取\n        const cacheKey = `document:${object_id}`;\n        const cached = await this.redis.getJSON(cacheKey);\n        if (cached) {\n            return cached;\n        }\n        const document = await this.documentDAO.findById(object_id);\n        if (!document) {\n            return null;\n        }\n        // 缓存文档（不包含 content，减少内存占用）\n        if (!includeContent) {\n            const { content, ...docWithoutContent } = document;\n            await this.redis.setJSON(cacheKey, docWithoutContent, 300); // 5分钟缓存\n        }\n        return document;\n    }\n    /**\n   * 更新文档\n   *\n   * 优化策略：\n   * - 如果只有 change_data（增量），应用增量到现有文档状态，然后更新数据库\n   * - 如果有 content（全量），直接使用全量更新数据库\n   */ async updateDocument(object_id, updates) {\n        // 如果更新了内容，先获取当前文档信息以便创建快照\n        const currentDoc = await this.documentDAO.findById(object_id);\n        if (!currentDoc) {\n            throw new Error(\"Document not found\");\n        }\n        // 优化：如果只有增量更新，应用增量到现有文档状态\n        let finalContent;\n        let finalContentLength;\n        if (updates.change_data && !updates.content) {\n            // 只有增量更新：应用增量到现有文档状态\n            console.log(`[DocumentService] Applying incremental update, size: ${updates.change_data.length} bytes`);\n            try {\n                // 创建临时 Y.Doc 并应用现有状态\n                const ydoc = new yjs__WEBPACK_IMPORTED_MODULE_5__.Doc();\n                if (currentDoc.content && currentDoc.content.length > 0) {\n                    yjs__WEBPACK_IMPORTED_MODULE_5__.applyUpdate(ydoc, currentDoc.content);\n                }\n                // 应用增量更新\n                yjs__WEBPACK_IMPORTED_MODULE_5__.applyUpdate(ydoc, updates.change_data);\n                // 获取新的完整状态\n                finalContent = Buffer.from(yjs__WEBPACK_IMPORTED_MODULE_5__.encodeStateAsUpdate(ydoc));\n                finalContentLength = finalContent.length;\n                console.log(`[DocumentService] Incremental update applied, new content size: ${finalContentLength} bytes`);\n            } catch (error) {\n                console.error(\"[DocumentService] Failed to apply incremental update:\", error);\n                throw new Error(\"Failed to apply incremental update\");\n            }\n        } else if (updates.content) {\n            // 有全量更新：直接使用\n            finalContent = updates.content;\n            finalContentLength = updates.content.length;\n            console.log(`[DocumentService] Using full update, size: ${finalContentLength} bytes`);\n        }\n        const updateData = {};\n        if (updates.title) updateData.title = updates.title;\n        if (finalContent) {\n            updateData.content = finalContent;\n            updateData.content_length = finalContentLength;\n        }\n        if (updates.metadata) updateData.metadata = updates.metadata;\n        const document = await this.documentDAO.update(object_id, updateData);\n        // 如果更新了内容，记录变更日志和快照\n        if (finalContent && finalContent.length > 0) {\n            try {\n                // 确定变更数据（用于变更日志）\n                // 优先使用 change_data（增量更新），如果没有则使用完整状态\n                const changeData = updates.change_data || finalContent;\n                // 2. 记录变更日志（每次保存都记录）\n                let snapshotId = null;\n                if (this.changeDAO) {\n                    // 检查是否已有快照\n                    const hasSnapshot = await this.documentDAO.getLatestSnapshot(document.object_id);\n                    // 如果是手动保存，使用策略判断是否创建快照及版本类型\n                    // 如果没有快照，强制创建大版本（初始快照）\n                    // 如果有快照，根据策略判断是否创建快照（避免频繁创建）\n                    if (updates.forceSnapshot && this.snapshotScheduler) {\n                        if (!hasSnapshot) {\n                            // 没有快照，强制创建大版本（初始快照）\n                            const snapshot = await this.snapshotScheduler.createSnapshotManually(document.object_id, document.workspace_id, finalContent, updates.snapshot, true // 强制创建大版本\n                            );\n                            snapshotId = snapshot.snapshot_id;\n                        } else {\n                            // 有快照，使用策略判断是否创建快照\n                            // 手动保存时，也使用 recordEdit 来判断（复用相同的策略）\n                            const snapshotResult = await this.snapshotScheduler.recordEdit(document.object_id, document.workspace_id, finalContent, updates.snapshot);\n                            // 如果 recordEdit 创建了快照，使用它；否则不创建快照\n                            if (snapshotResult) {\n                                snapshotId = snapshotResult.snapshot_id;\n                            }\n                        // 如果 recordEdit 没有创建快照（不满足条件），snapshotId 保持为 null\n                        }\n                    }\n                    await this.changeDAO.create({\n                        object_id: document.object_id,\n                        workspace_id: document.workspace_id,\n                        snapshot_id: snapshotId,\n                        change_type: updates.forceSnapshot ? \"manual_save\" : \"auto_save\",\n                        change_data: changeData,\n                        before_state_vector: updates.snapshot || null,\n                        after_state_vector: updates.snapshot || null,\n                        metadata: {\n                            content_length: finalContent?.length || 0,\n                            change_length: changeData.length,\n                            is_incremental: !!updates.change_data\n                        }\n                    });\n                }\n                // 3. 处理快照（自动保存时，由调度器决定是否创建快照及版本类型）\n                if (this.snapshotScheduler && !updates.forceSnapshot) {\n                    // 检查是否已有快照，如果没有，创建初始快照\n                    const hasSnapshot = await this.documentDAO.getLatestSnapshot(document.object_id);\n                    if (!hasSnapshot) {\n                        // 没有快照，创建初始快照（强制大版本）\n                        console.log(`[DocumentService] No snapshot found, creating initial snapshot for ${document.object_id}`);\n                        await this.snapshotScheduler.createSnapshotManually(document.object_id, document.workspace_id, finalContent, updates.snapshot, true // 强制创建大版本\n                        );\n                    } else {\n                        // 自动保存，由调度器决定是否创建快照\n                        await this.snapshotScheduler.recordEdit(document.object_id, document.workspace_id, finalContent, updates.snapshot);\n                    }\n                }\n            } catch (error) {\n                // 变更日志和快照创建失败不应该影响文档更新，只记录错误\n                console.error(\"Failed to create change log or snapshot:\", error);\n            }\n        }\n        // 清除缓存\n        await this.redis.del(`document:${object_id}`);\n        const doc = await this.documentDAO.findById(object_id);\n        if (doc) {\n            // 清除该工作空间的所有文档列表缓存（因为缓存键包含 options 参数）\n            await this.redis.delByPattern(`documents:workspace:${doc.workspace_id}:*`);\n        }\n        return document;\n    }\n    /**\n   * 获取文档列表\n   */ async getDocuments(workspace_id, options = {}) {\n        // 尝试从缓存获取\n        const cacheKey = `documents:workspace:${workspace_id}:${JSON.stringify(options)}`;\n        const cached = await this.redis.getJSON(cacheKey);\n        if (cached) {\n            return {\n                ...cached,\n                page: options.page || 1,\n                page_size: options.page_size || 20\n            };\n        }\n        const result = await this.documentDAO.findByWorkspaceId(workspace_id, options);\n        // 缓存结果\n        await this.redis.setJSON(cacheKey, result, 60); // 1分钟缓存\n        return {\n            ...result,\n            page: options.page || 1,\n            page_size: options.page_size || 20\n        };\n    }\n    /**\n   * 删除文档\n   */ async deleteDocument(object_id) {\n        // 先获取文档信息以便清除缓存\n        const doc = await this.documentDAO.findById(object_id);\n        await this.documentDAO.delete(object_id);\n        // 清除缓存\n        await this.redis.del(`document:${object_id}`);\n        if (doc) {\n            // 清除该工作空间的所有文档列表缓存（因为缓存键包含 options 参数）\n            await this.redis.delByPattern(`documents:workspace:${doc.workspace_id}:*`);\n        }\n    }\n    /**\n   * 创建文档快照\n   */ async createSnapshot(data) {\n        return await this.documentDAO.createSnapshot({\n            object_id: data.object_id,\n            workspace_id: data.workspace_id,\n            snapshot_data: data.snapshot_data,\n            snapshot_version: data.snapshot_version || 1,\n            doc_state: data.doc_state,\n            doc_state_version: data.doc_state_version || 1,\n            metadata: data.metadata\n        });\n    }\n    /**\n   * 获取文档快照列表\n   */ async getSnapshots(object_id, options = {}) {\n        return await this.documentDAO.getSnapshots(object_id, options);\n    }\n    /**\n   * 获取最新快照\n   */ async getLatestSnapshot(object_id) {\n        return await this.documentDAO.getLatestSnapshot(object_id);\n    }\n    /**\n   * 根据 snapshot_id 获取快照内容\n   */ async getSnapshotById(snapshot_id) {\n        return await this.documentDAO.getSnapshotById(snapshot_id);\n    }\n    /**\n   * 搜索文档（简化版，实际应该使用向量搜索）\n   */ async searchDocuments(workspace_id, query, options = {}) {\n        // 这里简化实现，实际应该使用向量嵌入搜索\n        // 暂时使用简单的文本搜索\n        // TODO: 实现向量搜索\n        // 这里返回空数组，实际应该查询 document_embeddings 表\n        return [];\n    }\n    /**\n   * 计算两个文档状态之间的变更（简化版）\n   * 实际应该使用 Yjs 的 diff 算法\n   * 注意：当前实现中，change_data 存储的是完整的文档状态\n   * TODO: 优化为真正的增量更新\n   */ calculateChange(previousContent, currentContent) {\n        // 简化实现：直接返回当前内容\n        // TODO: 使用 Yjs 的 diff 算法计算真正的增量变更\n        // 或者，前端应该发送增量更新（Yjs update 事件），而不是完整状态\n        return currentContent;\n    }\n    /**\n   * 获取文档变更列表\n   */ async getDocumentChanges(object_id, options = {}) {\n        if (!this.changeDAO) {\n            throw new Error(\"DocumentChangeDAO not initialized\");\n        }\n        return await this.changeDAO.findByObjectId(object_id, options);\n    }\n    /**\n   * 获取两个快照之间的变更\n   */ async getChangesBetweenSnapshots(object_id, from_snapshot_id, to_snapshot_id) {\n        if (!this.changeDAO) {\n            throw new Error(\"DocumentChangeDAO not initialized\");\n        }\n        return await this.changeDAO.getChangesBetweenSnapshots(object_id, from_snapshot_id, to_snapshot_id);\n    }\n}\nDocumentService = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(2, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"SnapshotScheduler\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__param)(3, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentChangeDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_6__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO === \"undefined\" ? Object : _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO,\n        typeof _core_redis__WEBPACK_IMPORTED_MODULE_3__.Redis === \"undefined\" ? Object : _core_redis__WEBPACK_IMPORTED_MODULE_3__.Redis,\n        typeof _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__.SnapshotScheduler === \"undefined\" ? Object : _snapshot_scheduler_service__WEBPACK_IMPORTED_MODULE_4__.SnapshotScheduler,\n        typeof _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__.DocumentChangeDAO === \"undefined\" ? Object : _dao_document_change_dao__WEBPACK_IMPORTED_MODULE_2__.DocumentChangeDAO\n    ])\n], DocumentService);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFNBQVMsRUFBRTtZQUNuQixNQUFNLElBQUl3QyxNQUFNO1FBQ2xCO1FBQ0EsT0FBTyxNQUFNLElBQUksQ0FBQ3hDLFNBQVMsQ0FBQ3VGLGNBQWMsQ0FBQ3hFLFdBQVdrRDtJQUN4RDtJQUVBOztHQUVDLEdBQ0QsTUFBTXVCLDJCQUNKekUsU0FBaUIsRUFDakIwRSxnQkFBd0IsRUFDeEJDLGNBQXNCLEVBQ0s7UUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQzFGLFNBQVMsRUFBRTtZQUNuQixNQUFNLElBQUl3QyxNQUFNO1FBQ2xCO1FBQ0EsT0FBTyxNQUFNLElBQUksQ0FBQ3hDLFNBQVMsQ0FBQ3dGLDBCQUEwQixDQUNwRHpFLFdBQ0EwRSxrQkFDQUM7SUFFSjtBQUNGO0FBamNhL0Ysa0JBQUFBLG9FQUFBQTtJQURaUCxvREFBVUE7SUFHTkMsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDO0lBRVBBLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQztJQUNQQSxpRUFBQUEsSUFBQUEsZ0RBQU1BLENBQUM7OztlQUhvQywwREFBVyw0QkFBWCwwREFBVztlQUN4Qyw4Q0FBSyw0QkFBTCw4Q0FBSztlQUNxQywwRUFBaUIsNEJBQWpCLDBFQUFpQjtlQUN6Qix1RUFBaUIsNEJBQWpCLHVFQUFpQjs7R0FMekRNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL3NlcnZpY2VzL2RvY3VtZW50LnNlcnZpY2UudHM/Y2QxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgKiBhcyBZIGZyb20gJ3lqcyc7XG5pbXBvcnQgeyBEb2N1bWVudERBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LmRhbyc7XG5pbXBvcnQgeyBEb2N1bWVudENoYW5nZURBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LWNoYW5nZS5kYW8nO1xuaW1wb3J0IHR5cGUgeyBEb2N1bWVudCwgRG9jdW1lbnRTbmFwc2hvdCwgRG9jdW1lbnRDaGFuZ2UgfSBmcm9tICdAL2VudGl0aWVzJztcbmltcG9ydCB7IFJlZGlzIH0gZnJvbSAnQC9jb3JlL3JlZGlzJztcbmltcG9ydCB7IFNuYXBzaG90U2NoZWR1bGVyIH0gZnJvbSAnLi9zbmFwc2hvdC1zY2hlZHVsZXIuc2VydmljZSc7XG5cbi8qKlxuICog5paH5qGj5pyN5YqhXG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEb2N1bWVudFNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdEb2N1bWVudERBTycpIHByaXZhdGUgZG9jdW1lbnREQU86IERvY3VtZW50REFPLFxuICAgIHByaXZhdGUgcmVkaXM6IFJlZGlzLFxuICAgIEBpbmplY3QoJ1NuYXBzaG90U2NoZWR1bGVyJykgcHJpdmF0ZSBzbmFwc2hvdFNjaGVkdWxlcj86IFNuYXBzaG90U2NoZWR1bGVyLFxuICAgIEBpbmplY3QoJ0RvY3VtZW50Q2hhbmdlREFPJykgcHJpdmF0ZSBjaGFuZ2VEQU8/OiBEb2N1bWVudENoYW5nZURBT1xuICApIHtcbiAgICB0aGlzLnJlZGlzID0gUmVkaXMuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlofmoaNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZURvY3VtZW50KGRhdGE6IHtcbiAgICB3b3Jrc3BhY2VfaWQ6IHN0cmluZztcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IEJ1ZmZlcjtcbiAgICBvd25lcl91aWQ6IG51bWJlcjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPERvY3VtZW50PiB7XG4gICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmNyZWF0ZSh7XG4gICAgICB3b3Jrc3BhY2VfaWQ6IGRhdGEud29ya3NwYWNlX2lkLFxuICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICBjb250ZW50X2xlbmd0aDogZGF0YS5jb250ZW50Lmxlbmd0aCxcbiAgICAgIG93bmVyX3VpZDogZGF0YS5vd25lcl91aWQsXG4gICAgICBtZXRhZGF0YTogZGF0YS5tZXRhZGF0YSxcbiAgICB9KTtcblxuICAgIC8vIOWIm+W7uuWIneWni+W/q+eFp++8iOaXoOiuuuaYr+WQpuacieWGheWuue+8jOmDveW6lOivpeWIm+W7uuWIneWni+W/q+eFp++8iVxuICAgIC8vIOi/meagt+WNs+S9v+aWh+aho+WIm+W7uuaXtuS4uuepuu+8jOS5n+iDveacieS4gOS4quWfuuWHhuW/q+eFp+eUqOS6juaXtumXtOmXtOmalOiuoeeul1xuICAgIGlmICh0aGlzLnNuYXBzaG90U2NoZWR1bGVyKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBgW0RvY3VtZW50U2VydmljZV0gQ3JlYXRpbmcgaW5pdGlhbCBzbmFwc2hvdCBmb3IgZG9jdW1lbnQgJHtcbiAgICAgICAgICAgIGRvY3VtZW50Lm9iamVjdF9pZFxuICAgICAgICAgIH0sIGNvbnRlbnRMZW5ndGg6ICR7ZGF0YS5jb250ZW50Py5sZW5ndGggfHwgMH1gXG4gICAgICAgICk7XG4gICAgICAgIC8vIOWIm+W7uuWIneWni+W/q+eFp++8iOW8uuWItuWIm+W7uuWkp+eJiOacrO+8iVxuICAgICAgICAvLyDljbPkvb8gY29udGVudCDkuLrnqbrvvIzkuZ/liJvlu7rkuIDkuKrnqbrlhoXlrrnnmoTlv6vnhadcbiAgICAgICAgY29uc3QgY29udGVudFRvU25hcHNob3QgPVxuICAgICAgICAgIGRhdGEuY29udGVudCAmJiBkYXRhLmNvbnRlbnQubGVuZ3RoID4gMCA/IGRhdGEuY29udGVudCA6IEJ1ZmZlci5hbGxvYygwKTsgLy8g56m65YaF5a655Lmf5Yib5bu65b+r54WnXG5cbiAgICAgICAgY29uc3Qgc25hcHNob3RSZXN1bHQgPSBhd2FpdCB0aGlzLnNuYXBzaG90U2NoZWR1bGVyLmNyZWF0ZVNuYXBzaG90TWFudWFsbHkoXG4gICAgICAgICAgZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgIGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgICBjb250ZW50VG9TbmFwc2hvdCxcbiAgICAgICAgICB1bmRlZmluZWQsIC8vIOWIneWni+W/q+eFp+WPr+iDveayoeaciSBzbmFwc2hvdFxuICAgICAgICAgIHRydWUgLy8g5by65Yi25Yib5bu65aSn54mI5pysXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbRG9jdW1lbnRTZXJ2aWNlXSBJbml0aWFsIHNuYXBzaG90IGNyZWF0ZWQ6YCwge1xuICAgICAgICAgIHNuYXBzaG90X2lkOiBzbmFwc2hvdFJlc3VsdC5zbmFwc2hvdF9pZCxcbiAgICAgICAgICB2ZXJzaW9uX3R5cGU6IHNuYXBzaG90UmVzdWx0LnZlcnNpb25fdHlwZSxcbiAgICAgICAgICBjcmVhdGVkX2F0OiBzbmFwc2hvdFJlc3VsdC5jcmVhdGVkX2F0LFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIOW/q+eFp+WIm+W7uuWksei0peS4jeW6lOivpeW9seWTjeaWh+aho+WIm+W7uu+8jOWPquiusOW9lemUmeivr1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbRG9jdW1lbnRTZXJ2aWNlXSBGYWlsZWQgdG8gY3JlYXRlIGluaXRpYWwgc25hcHNob3Q6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBbRG9jdW1lbnRTZXJ2aWNlXSBTbmFwc2hvdFNjaGVkdWxlciBub3QgYXZhaWxhYmxlLCBjYW5ub3QgY3JlYXRlIGluaXRpYWwgc25hcHNob3RgXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIOa4hemZpOe8k+WtmFxuICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKGBkb2N1bWVudDoke2RvY3VtZW50Lm9iamVjdF9pZH1gKTtcbiAgICAvLyDmuIXpmaTor6Xlt6XkvZznqbrpl7TnmoTmiYDmnInmlofmoaPliJfooajnvJPlrZjvvIjlm6DkuLrnvJPlrZjplK7ljIXlkKsgb3B0aW9ucyDlj4LmlbDvvIlcbiAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbEJ5UGF0dGVybihgZG9jdW1lbnRzOndvcmtzcGFjZToke2RhdGEud29ya3NwYWNlX2lkfToqYCk7XG5cbiAgICByZXR1cm4gZG9jdW1lbnQ7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5paH5qGjXG4gICAqL1xuICBhc3luYyBnZXREb2N1bWVudChvYmplY3RfaWQ6IHN0cmluZywgaW5jbHVkZUNvbnRlbnQ6IGJvb2xlYW4gPSB0cnVlKTogUHJvbWlzZTxEb2N1bWVudCB8IG51bGw+IHtcbiAgICAvLyDlsJ3or5Xku47nvJPlrZjojrflj5ZcbiAgICBjb25zdCBjYWNoZUtleSA9IGBkb2N1bWVudDoke29iamVjdF9pZH1gO1xuICAgIGNvbnN0IGNhY2hlZCA9IGF3YWl0IHRoaXMucmVkaXMuZ2V0SlNPTjxEb2N1bWVudD4oY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIHJldHVybiBjYWNoZWQ7XG4gICAgfVxuXG4gICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmZpbmRCeUlkKG9iamVjdF9pZCk7XG4gICAgaWYgKCFkb2N1bWVudCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8g57yT5a2Y5paH5qGj77yI5LiN5YyF5ZCrIGNvbnRlbnTvvIzlh4/lsJHlhoXlrZjljaDnlKjvvIlcbiAgICBpZiAoIWluY2x1ZGVDb250ZW50KSB7XG4gICAgICBjb25zdCB7IGNvbnRlbnQsIC4uLmRvY1dpdGhvdXRDb250ZW50IH0gPSBkb2N1bWVudDtcbiAgICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0SlNPTihjYWNoZUtleSwgZG9jV2l0aG91dENvbnRlbnQsIDMwMCk7IC8vIDXliIbpkp/nvJPlrZhcbiAgICB9XG5cbiAgICByZXR1cm4gZG9jdW1lbnQ7XG4gIH1cblxuICAvKipcbiAgICog5pu05paw5paH5qGjXG4gICAqXG4gICAqIOS8mOWMluetlueVpe+8mlxuICAgKiAtIOWmguaenOWPquaciSBjaGFuZ2VfZGF0Ye+8iOWinumHj++8ie+8jOW6lOeUqOWinumHj+WIsOeOsOacieaWh+aho+eKtuaAge+8jOeEtuWQjuabtOaWsOaVsOaNruW6k1xuICAgKiAtIOWmguaenOaciSBjb250ZW5077yI5YWo6YeP77yJ77yM55u05o6l5L2/55So5YWo6YeP5pu05paw5pWw5o2u5bqTXG4gICAqL1xuICBhc3luYyB1cGRhdGVEb2N1bWVudChcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiB7XG4gICAgICB0aXRsZT86IHN0cmluZztcbiAgICAgIGNvbnRlbnQ/OiBCdWZmZXI7XG4gICAgICBjaGFuZ2VfZGF0YT86IEJ1ZmZlcjsgLy8g5aKe6YeP5pu05paw77yIWWpzIFVwZGF0Ze+8iVxuICAgICAgc25hcHNob3Q/OiBCdWZmZXI7IC8vIFlqcyBTbmFwc2hvdO+8iOeKtuaAgeWQkemHj++8ie+8jOWPr+mAiVxuICAgICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgICAgZm9yY2VTbmFwc2hvdD86IGJvb2xlYW47IC8vIOaYr+WQpuW8uuWItuWIm+W7uuW/q+eFp++8iOaJi+WKqOS/neWtmO+8iVxuICAgIH1cbiAgKTogUHJvbWlzZTxEb2N1bWVudD4ge1xuICAgIC8vIOWmguaenOabtOaWsOS6huWGheWuue+8jOWFiOiOt+WPluW9k+WJjeaWh+aho+S/oeaBr+S7peS+v+WIm+W7uuW/q+eFp1xuICAgIGNvbnN0IGN1cnJlbnREb2MgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmZpbmRCeUlkKG9iamVjdF9pZCk7XG4gICAgaWYgKCFjdXJyZW50RG9jKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RvY3VtZW50IG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIOS8mOWMlu+8muWmguaenOWPquacieWinumHj+abtOaWsO+8jOW6lOeUqOWinumHj+WIsOeOsOacieaWh+aho+eKtuaAgVxuICAgIGxldCBmaW5hbENvbnRlbnQ6IEJ1ZmZlciB8IHVuZGVmaW5lZDtcbiAgICBsZXQgZmluYWxDb250ZW50TGVuZ3RoOiBudW1iZXIgfCB1bmRlZmluZWQ7XG5cbiAgICBpZiAodXBkYXRlcy5jaGFuZ2VfZGF0YSAmJiAhdXBkYXRlcy5jb250ZW50KSB7XG4gICAgICAvLyDlj6rmnInlop7ph4/mm7TmlrDvvJrlupTnlKjlop7ph4/liLDnjrDmnInmlofmoaPnirbmgIFcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBgW0RvY3VtZW50U2VydmljZV0gQXBwbHlpbmcgaW5jcmVtZW50YWwgdXBkYXRlLCBzaXplOiAke3VwZGF0ZXMuY2hhbmdlX2RhdGEubGVuZ3RofSBieXRlc2BcbiAgICAgICk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIOWIm+W7uuS4tOaXtiBZLkRvYyDlubblupTnlKjnjrDmnInnirbmgIFcbiAgICAgICAgY29uc3QgeWRvYyA9IG5ldyBZLkRvYygpO1xuICAgICAgICBpZiAoY3VycmVudERvYy5jb250ZW50ICYmIGN1cnJlbnREb2MuY29udGVudC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgWS5hcHBseVVwZGF0ZSh5ZG9jLCBjdXJyZW50RG9jLmNvbnRlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5bqU55So5aKe6YeP5pu05pawXG4gICAgICAgIFkuYXBwbHlVcGRhdGUoeWRvYywgdXBkYXRlcy5jaGFuZ2VfZGF0YSk7XG5cbiAgICAgICAgLy8g6I635Y+W5paw55qE5a6M5pW054q25oCBXG4gICAgICAgIGZpbmFsQ29udGVudCA9IEJ1ZmZlci5mcm9tKFkuZW5jb2RlU3RhdGVBc1VwZGF0ZSh5ZG9jKSk7XG4gICAgICAgIGZpbmFsQ29udGVudExlbmd0aCA9IGZpbmFsQ29udGVudC5sZW5ndGg7XG5cbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYFtEb2N1bWVudFNlcnZpY2VdIEluY3JlbWVudGFsIHVwZGF0ZSBhcHBsaWVkLCBuZXcgY29udGVudCBzaXplOiAke2ZpbmFsQ29udGVudExlbmd0aH0gYnl0ZXNgXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbRG9jdW1lbnRTZXJ2aWNlXSBGYWlsZWQgdG8gYXBwbHkgaW5jcmVtZW50YWwgdXBkYXRlOicsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gYXBwbHkgaW5jcmVtZW50YWwgdXBkYXRlJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh1cGRhdGVzLmNvbnRlbnQpIHtcbiAgICAgIC8vIOacieWFqOmHj+abtOaWsO+8muebtOaOpeS9v+eUqFxuICAgICAgZmluYWxDb250ZW50ID0gdXBkYXRlcy5jb250ZW50O1xuICAgICAgZmluYWxDb250ZW50TGVuZ3RoID0gdXBkYXRlcy5jb250ZW50Lmxlbmd0aDtcbiAgICAgIGNvbnNvbGUubG9nKGBbRG9jdW1lbnRTZXJ2aWNlXSBVc2luZyBmdWxsIHVwZGF0ZSwgc2l6ZTogJHtmaW5hbENvbnRlbnRMZW5ndGh9IGJ5dGVzYCk7XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge307XG4gICAgaWYgKHVwZGF0ZXMudGl0bGUpIHVwZGF0ZURhdGEudGl0bGUgPSB1cGRhdGVzLnRpdGxlO1xuICAgIGlmIChmaW5hbENvbnRlbnQpIHtcbiAgICAgIHVwZGF0ZURhdGEuY29udGVudCA9IGZpbmFsQ29udGVudDtcbiAgICAgIHVwZGF0ZURhdGEuY29udGVudF9sZW5ndGggPSBmaW5hbENvbnRlbnRMZW5ndGghO1xuICAgIH1cbiAgICBpZiAodXBkYXRlcy5tZXRhZGF0YSkgdXBkYXRlRGF0YS5tZXRhZGF0YSA9IHVwZGF0ZXMubWV0YWRhdGE7XG5cbiAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8udXBkYXRlKG9iamVjdF9pZCwgdXBkYXRlRGF0YSk7XG5cbiAgICAvLyDlpoLmnpzmm7TmlrDkuoblhoXlrrnvvIzorrDlvZXlj5jmm7Tml6Xlv5flkozlv6vnhadcbiAgICBpZiAoZmluYWxDb250ZW50ICYmIGZpbmFsQ29udGVudC5sZW5ndGggPiAwKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyDnoa7lrprlj5jmm7TmlbDmja7vvIjnlKjkuo7lj5jmm7Tml6Xlv5fvvIlcbiAgICAgICAgLy8g5LyY5YWI5L2/55SoIGNoYW5nZV9kYXRh77yI5aKe6YeP5pu05paw77yJ77yM5aaC5p6c5rKh5pyJ5YiZ5L2/55So5a6M5pW054q25oCBXG4gICAgICAgIGNvbnN0IGNoYW5nZURhdGEgPSB1cGRhdGVzLmNoYW5nZV9kYXRhIHx8IGZpbmFsQ29udGVudCE7XG5cbiAgICAgICAgLy8gMi4g6K6w5b2V5Y+Y5pu05pel5b+X77yI5q+P5qyh5L+d5a2Y6YO96K6w5b2V77yJXG4gICAgICAgIGxldCBzbmFwc2hvdElkOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuY2hhbmdlREFPKSB7XG4gICAgICAgICAgLy8g5qOA5p+l5piv5ZCm5bey5pyJ5b+r54WnXG4gICAgICAgICAgY29uc3QgaGFzU25hcHNob3QgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmdldExhdGVzdFNuYXBzaG90KGRvY3VtZW50Lm9iamVjdF9pZCk7XG5cbiAgICAgICAgICAvLyDlpoLmnpzmmK/miYvliqjkv53lrZjvvIzkvb/nlKjnrZbnlaXliKTmlq3mmK/lkKbliJvlu7rlv6vnhaflj4rniYjmnKznsbvlnotcbiAgICAgICAgICAvLyDlpoLmnpzmsqHmnInlv6vnhafvvIzlvLrliLbliJvlu7rlpKfniYjmnKzvvIjliJ3lp4vlv6vnhafvvIlcbiAgICAgICAgICAvLyDlpoLmnpzmnInlv6vnhafvvIzmoLnmja7nrZbnlaXliKTmlq3mmK/lkKbliJvlu7rlv6vnhafvvIjpgb/lhY3popHnuYHliJvlu7rvvIlcbiAgICAgICAgICBpZiAodXBkYXRlcy5mb3JjZVNuYXBzaG90ICYmIHRoaXMuc25hcHNob3RTY2hlZHVsZXIpIHtcbiAgICAgICAgICAgIGlmICghaGFzU25hcHNob3QpIHtcbiAgICAgICAgICAgICAgLy8g5rKh5pyJ5b+r54Wn77yM5by65Yi25Yib5bu65aSn54mI5pys77yI5Yid5aeL5b+r54Wn77yJXG4gICAgICAgICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgdGhpcy5zbmFwc2hvdFNjaGVkdWxlci5jcmVhdGVTbmFwc2hvdE1hbnVhbGx5KFxuICAgICAgICAgICAgICAgIGRvY3VtZW50Lm9iamVjdF9pZCxcbiAgICAgICAgICAgICAgICBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICAgICAgZmluYWxDb250ZW50ISxcbiAgICAgICAgICAgICAgICB1cGRhdGVzLnNuYXBzaG90LFxuICAgICAgICAgICAgICAgIHRydWUgLy8g5by65Yi25Yib5bu65aSn54mI5pysXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHNuYXBzaG90SWQgPSBzbmFwc2hvdC5zbmFwc2hvdF9pZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIOacieW/q+eFp++8jOS9v+eUqOetlueVpeWIpOaWreaYr+WQpuWIm+W7uuW/q+eFp1xuICAgICAgICAgICAgICAvLyDmiYvliqjkv53lrZjml7bvvIzkuZ/kvb/nlKggcmVjb3JkRWRpdCDmnaXliKTmlq3vvIjlpI3nlKjnm7jlkIznmoTnrZbnlaXvvIlcbiAgICAgICAgICAgICAgY29uc3Qgc25hcHNob3RSZXN1bHQgPSBhd2FpdCB0aGlzLnNuYXBzaG90U2NoZWR1bGVyLnJlY29yZEVkaXQoXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50LndvcmtzcGFjZV9pZCxcbiAgICAgICAgICAgICAgICBmaW5hbENvbnRlbnQhLFxuICAgICAgICAgICAgICAgIHVwZGF0ZXMuc25hcHNob3RcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgLy8g5aaC5p6cIHJlY29yZEVkaXQg5Yib5bu65LqG5b+r54Wn77yM5L2/55So5a6D77yb5ZCm5YiZ5LiN5Yib5bu65b+r54WnXG4gICAgICAgICAgICAgIGlmIChzbmFwc2hvdFJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHNuYXBzaG90SWQgPSBzbmFwc2hvdFJlc3VsdC5zbmFwc2hvdF9pZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvLyDlpoLmnpwgcmVjb3JkRWRpdCDmsqHmnInliJvlu7rlv6vnhafvvIjkuI3mu6HotrPmnaHku7bvvInvvIxzbmFwc2hvdElkIOS/neaMgeS4uiBudWxsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgYXdhaXQgdGhpcy5jaGFuZ2VEQU8uY3JlYXRlKHtcbiAgICAgICAgICAgIG9iamVjdF9pZDogZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgICAgd29ya3NwYWNlX2lkOiBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICBzbmFwc2hvdF9pZDogc25hcHNob3RJZCxcbiAgICAgICAgICAgIGNoYW5nZV90eXBlOiB1cGRhdGVzLmZvcmNlU25hcHNob3QgPyAnbWFudWFsX3NhdmUnIDogJ2F1dG9fc2F2ZScsXG4gICAgICAgICAgICBjaGFuZ2VfZGF0YTogY2hhbmdlRGF0YSxcbiAgICAgICAgICAgIGJlZm9yZV9zdGF0ZV92ZWN0b3I6IHVwZGF0ZXMuc25hcHNob3QgfHwgbnVsbCxcbiAgICAgICAgICAgIGFmdGVyX3N0YXRlX3ZlY3RvcjogdXBkYXRlcy5zbmFwc2hvdCB8fCBudWxsLFxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgY29udGVudF9sZW5ndGg6IGZpbmFsQ29udGVudD8ubGVuZ3RoIHx8IDAsXG4gICAgICAgICAgICAgIGNoYW5nZV9sZW5ndGg6IGNoYW5nZURhdGEubGVuZ3RoLFxuICAgICAgICAgICAgICBpc19pbmNyZW1lbnRhbDogISF1cGRhdGVzLmNoYW5nZV9kYXRhLCAvLyDmoIforrDmmK/lkKbkuLrlop7ph4/mm7TmlrBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAzLiDlpITnkIblv6vnhafvvIjoh6rliqjkv53lrZjml7bvvIznlLHosIPluqblmajlhrPlrprmmK/lkKbliJvlu7rlv6vnhaflj4rniYjmnKznsbvlnovvvIlcbiAgICAgICAgaWYgKHRoaXMuc25hcHNob3RTY2hlZHVsZXIgJiYgIXVwZGF0ZXMuZm9yY2VTbmFwc2hvdCkge1xuICAgICAgICAgIC8vIOajgOafpeaYr+WQpuW3suacieW/q+eFp++8jOWmguaenOayoeacie+8jOWIm+W7uuWIneWni+W/q+eFp1xuICAgICAgICAgIGNvbnN0IGhhc1NuYXBzaG90ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5nZXRMYXRlc3RTbmFwc2hvdChkb2N1bWVudC5vYmplY3RfaWQpO1xuICAgICAgICAgIGlmICghaGFzU25hcHNob3QpIHtcbiAgICAgICAgICAgIC8vIOayoeacieW/q+eFp++8jOWIm+W7uuWIneWni+W/q+eFp++8iOW8uuWItuWkp+eJiOacrO+8iVxuICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgIGBbRG9jdW1lbnRTZXJ2aWNlXSBObyBzbmFwc2hvdCBmb3VuZCwgY3JlYXRpbmcgaW5pdGlhbCBzbmFwc2hvdCBmb3IgJHtkb2N1bWVudC5vYmplY3RfaWR9YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc25hcHNob3RTY2hlZHVsZXIuY3JlYXRlU25hcHNob3RNYW51YWxseShcbiAgICAgICAgICAgICAgZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgICAgICBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICAgIGZpbmFsQ29udGVudCEsXG4gICAgICAgICAgICAgIHVwZGF0ZXMuc25hcHNob3QsXG4gICAgICAgICAgICAgIHRydWUgLy8g5by65Yi25Yib5bu65aSn54mI5pysXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyDoh6rliqjkv53lrZjvvIznlLHosIPluqblmajlhrPlrprmmK/lkKbliJvlu7rlv6vnhadcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc25hcHNob3RTY2hlZHVsZXIucmVjb3JkRWRpdChcbiAgICAgICAgICAgICAgZG9jdW1lbnQub2JqZWN0X2lkLFxuICAgICAgICAgICAgICBkb2N1bWVudC53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICAgIGZpbmFsQ29udGVudCEsXG4gICAgICAgICAgICAgIHVwZGF0ZXMuc25hcHNob3RcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyDlj5jmm7Tml6Xlv5flkozlv6vnhafliJvlu7rlpLHotKXkuI3lupTor6XlvbHlk43mlofmoaPmm7TmlrDvvIzlj6rorrDlvZXplJnor69cbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBjaGFuZ2UgbG9nIG9yIHNuYXBzaG90OicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmuIXpmaTnvJPlrZhcbiAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChgZG9jdW1lbnQ6JHtvYmplY3RfaWR9YCk7XG4gICAgY29uc3QgZG9jID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlJZChvYmplY3RfaWQpO1xuICAgIGlmIChkb2MpIHtcbiAgICAgIC8vIOa4hemZpOivpeW3peS9nOepuumXtOeahOaJgOacieaWh+aho+WIl+ihqOe8k+WtmO+8iOWboOS4uue8k+WtmOmUruWMheWQqyBvcHRpb25zIOWPguaVsO+8iVxuICAgICAgYXdhaXQgdGhpcy5yZWRpcy5kZWxCeVBhdHRlcm4oYGRvY3VtZW50czp3b3Jrc3BhY2U6JHtkb2Mud29ya3NwYWNlX2lkfToqYCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRvY3VtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho+WIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0RG9jdW1lbnRzKFxuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgICBwYWdlX3NpemU/OiBudW1iZXI7XG4gICAgICBzb3J0X2J5PzogJ2NyZWF0ZWRfYXQnIHwgJ3VwZGF0ZWRfYXQnIHwgJ3RpdGxlJztcbiAgICAgIG9yZGVyPzogJ2FzYycgfCAnZGVzYyc7XG4gICAgfSA9IHt9XG4gICk6IFByb21pc2U8eyBkb2N1bWVudHM6IERvY3VtZW50W107IHRvdGFsOiBudW1iZXI7IHBhZ2U6IG51bWJlcjsgcGFnZV9zaXplOiBudW1iZXIgfT4ge1xuICAgIC8vIOWwneivleS7jue8k+WtmOiOt+WPllxuICAgIGNvbnN0IGNhY2hlS2V5ID0gYGRvY3VtZW50czp3b3Jrc3BhY2U6JHt3b3Jrc3BhY2VfaWR9OiR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucyl9YDtcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCB0aGlzLnJlZGlzLmdldEpTT048e1xuICAgICAgZG9jdW1lbnRzOiBEb2N1bWVudFtdO1xuICAgICAgdG90YWw6IG51bWJlcjtcbiAgICB9PihjYWNoZUtleSk7XG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uY2FjaGVkLFxuICAgICAgICBwYWdlOiBvcHRpb25zLnBhZ2UgfHwgMSxcbiAgICAgICAgcGFnZV9zaXplOiBvcHRpb25zLnBhZ2Vfc2l6ZSB8fCAyMCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5maW5kQnlXb3Jrc3BhY2VJZCh3b3Jrc3BhY2VfaWQsIG9wdGlvbnMpO1xuXG4gICAgLy8g57yT5a2Y57uT5p6cXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5zZXRKU09OKGNhY2hlS2V5LCByZXN1bHQsIDYwKTsgLy8gMeWIhumSn+e8k+WtmFxuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnJlc3VsdCxcbiAgICAgIHBhZ2U6IG9wdGlvbnMucGFnZSB8fCAxLFxuICAgICAgcGFnZV9zaXplOiBvcHRpb25zLnBhZ2Vfc2l6ZSB8fCAyMCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOaWh+aho1xuICAgKi9cbiAgYXN5bmMgZGVsZXRlRG9jdW1lbnQob2JqZWN0X2lkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyDlhYjojrflj5bmlofmoaPkv6Hmga/ku6Xkvr/muIXpmaTnvJPlrZhcbiAgICBjb25zdCBkb2MgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmZpbmRCeUlkKG9iamVjdF9pZCk7XG5cbiAgICBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmRlbGV0ZShvYmplY3RfaWQpO1xuXG4gICAgLy8g5riF6Zmk57yT5a2YXG4gICAgYXdhaXQgdGhpcy5yZWRpcy5kZWwoYGRvY3VtZW50OiR7b2JqZWN0X2lkfWApO1xuICAgIGlmIChkb2MpIHtcbiAgICAgIC8vIOa4hemZpOivpeW3peS9nOepuumXtOeahOaJgOacieaWh+aho+WIl+ihqOe8k+WtmO+8iOWboOS4uue8k+WtmOmUruWMheWQqyBvcHRpb25zIOWPguaVsO+8iVxuICAgICAgYXdhaXQgdGhpcy5yZWRpcy5kZWxCeVBhdHRlcm4oYGRvY3VtZW50czp3b3Jrc3BhY2U6JHtkb2Mud29ya3NwYWNlX2lkfToqYCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuaWh+aho+W/q+eFp1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlU25hcHNob3QoZGF0YToge1xuICAgIG9iamVjdF9pZDogc3RyaW5nO1xuICAgIHdvcmtzcGFjZV9pZDogc3RyaW5nO1xuICAgIHNuYXBzaG90X2RhdGE6IEJ1ZmZlcjtcbiAgICBzbmFwc2hvdF92ZXJzaW9uPzogbnVtYmVyO1xuICAgIGRvY19zdGF0ZT86IEJ1ZmZlcjtcbiAgICBkb2Nfc3RhdGVfdmVyc2lvbj86IG51bWJlcjtcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPERvY3VtZW50U25hcHNob3Q+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5jcmVhdGVTbmFwc2hvdCh7XG4gICAgICBvYmplY3RfaWQ6IGRhdGEub2JqZWN0X2lkLFxuICAgICAgd29ya3NwYWNlX2lkOiBkYXRhLndvcmtzcGFjZV9pZCxcbiAgICAgIHNuYXBzaG90X2RhdGE6IGRhdGEuc25hcHNob3RfZGF0YSxcbiAgICAgIHNuYXBzaG90X3ZlcnNpb246IGRhdGEuc25hcHNob3RfdmVyc2lvbiB8fCAxLFxuICAgICAgZG9jX3N0YXRlOiBkYXRhLmRvY19zdGF0ZSxcbiAgICAgIGRvY19zdGF0ZV92ZXJzaW9uOiBkYXRhLmRvY19zdGF0ZV92ZXJzaW9uIHx8IDEsXG4gICAgICBtZXRhZGF0YTogZGF0YS5tZXRhZGF0YSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofmoaPlv6vnhafliJfooahcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90cyhcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSA9IHt9XG4gICk6IFByb21pc2U8eyBzbmFwc2hvdHM6IERvY3VtZW50U25hcHNob3RbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZ2V0U25hcHNob3RzKG9iamVjdF9pZCwgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5pyA5paw5b+r54WnXG4gICAqL1xuICBhc3luYyBnZXRMYXRlc3RTbmFwc2hvdChvYmplY3RfaWQ6IHN0cmluZyk6IFByb21pc2U8RG9jdW1lbnRTbmFwc2hvdCB8IG51bGw+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5nZXRMYXRlc3RTbmFwc2hvdChvYmplY3RfaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNriBzbmFwc2hvdF9pZCDojrflj5blv6vnhaflhoXlrrlcbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90QnlJZChzbmFwc2hvdF9pZDogc3RyaW5nKTogUHJvbWlzZTxEb2N1bWVudFNuYXBzaG90IHwgbnVsbD4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmdldFNuYXBzaG90QnlJZChzbmFwc2hvdF9pZCk7XG4gIH1cblxuICAvKipcbiAgICog5pCc57Si5paH5qGj77yI566A5YyW54mI77yM5a6e6ZmF5bqU6K+l5L2/55So5ZCR6YeP5pCc57Si77yJXG4gICAqL1xuICBhc3luYyBzZWFyY2hEb2N1bWVudHMoXG4gICAgd29ya3NwYWNlX2lkOiBzdHJpbmcsXG4gICAgcXVlcnk6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7XG4gICAgICBsaW1pdD86IG51bWJlcjtcbiAgICAgIG9mZnNldD86IG51bWJlcjtcbiAgICAgIHRocmVzaG9sZD86IG51bWJlcjtcbiAgICB9ID0ge31cbiAgKTogUHJvbWlzZTxcbiAgICBBcnJheTx7XG4gICAgICBvYmplY3RfaWQ6IHN0cmluZztcbiAgICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgICBwcmV2aWV3OiBzdHJpbmc7XG4gICAgICBzY29yZTogbnVtYmVyO1xuICAgICAgdXBkYXRlZF9hdDogRGF0ZTtcbiAgICB9PlxuICA+IHtcbiAgICAvLyDov5nph4znroDljJblrp7njrDvvIzlrp7pmYXlupTor6Xkvb/nlKjlkJHph4/ltYzlhaXmkJzntKJcbiAgICAvLyDmmoLml7bkvb/nlKjnroDljZXnmoTmlofmnKzmkJzntKJcbiAgICAvLyBUT0RPOiDlrp7njrDlkJHph4/mkJzntKJcbiAgICAvLyDov5nph4zov5Tlm57nqbrmlbDnu4TvvIzlrp7pmYXlupTor6Xmn6Xor6IgZG9jdW1lbnRfZW1iZWRkaW5ncyDooahcbiAgICByZXR1cm4gW107XG4gIH1cblxuICAvKipcbiAgICog6K6h566X5Lik5Liq5paH5qGj54q25oCB5LmL6Ze055qE5Y+Y5pu077yI566A5YyW54mI77yJXG4gICAqIOWunumZheW6lOivpeS9v+eUqCBZanMg55qEIGRpZmYg566X5rOVXG4gICAqIOazqOaEj++8muW9k+WJjeWunueOsOS4re+8jGNoYW5nZV9kYXRhIOWtmOWCqOeahOaYr+WujOaVtOeahOaWh+aho+eKtuaAgVxuICAgKiBUT0RPOiDkvJjljJbkuLrnnJ/mraPnmoTlop7ph4/mm7TmlrBcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlQ2hhbmdlKHByZXZpb3VzQ29udGVudDogQnVmZmVyLCBjdXJyZW50Q29udGVudDogQnVmZmVyKTogQnVmZmVyIHtcbiAgICAvLyDnroDljJblrp7njrDvvJrnm7TmjqXov5Tlm57lvZPliY3lhoXlrrlcbiAgICAvLyBUT0RPOiDkvb/nlKggWWpzIOeahCBkaWZmIOeul+azleiuoeeul+ecn+ato+eahOWinumHj+WPmOabtFxuICAgIC8vIOaIluiAhe+8jOWJjeerr+W6lOivpeWPkemAgeWinumHj+abtOaWsO+8iFlqcyB1cGRhdGUg5LqL5Lu277yJ77yM6ICM5LiN5piv5a6M5pW054q25oCBXG4gICAgcmV0dXJuIGN1cnJlbnRDb250ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluaWh+aho+WPmOabtOWIl+ihqFxuICAgKi9cbiAgYXN5bmMgZ2V0RG9jdW1lbnRDaGFuZ2VzKFxuICAgIG9iamVjdF9pZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIGxpbWl0PzogbnVtYmVyO1xuICAgICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgICAgYWZ0ZXJfc25hcHNob3RfaWQ/OiBzdHJpbmcgfCBudWxsO1xuICAgIH0gPSB7fVxuICApOiBQcm9taXNlPHsgY2hhbmdlczogRG9jdW1lbnRDaGFuZ2VbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgaWYgKCF0aGlzLmNoYW5nZURBTykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb2N1bWVudENoYW5nZURBTyBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2hhbmdlREFPLmZpbmRCeU9iamVjdElkKG9iamVjdF9pZCwgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5Lik5Liq5b+r54Wn5LmL6Ze055qE5Y+Y5pu0XG4gICAqL1xuICBhc3luYyBnZXRDaGFuZ2VzQmV0d2VlblNuYXBzaG90cyhcbiAgICBvYmplY3RfaWQ6IHN0cmluZyxcbiAgICBmcm9tX3NuYXBzaG90X2lkOiBzdHJpbmcsXG4gICAgdG9fc25hcHNob3RfaWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPERvY3VtZW50Q2hhbmdlW10+IHtcbiAgICBpZiAoIXRoaXMuY2hhbmdlREFPKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RvY3VtZW50Q2hhbmdlREFPIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jaGFuZ2VEQU8uZ2V0Q2hhbmdlc0JldHdlZW5TbmFwc2hvdHMoXG4gICAgICBvYmplY3RfaWQsXG4gICAgICBmcm9tX3NuYXBzaG90X2lkLFxuICAgICAgdG9fc25hcHNob3RfaWRcbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiaW5qZWN0YWJsZSIsImluamVjdCIsIlkiLCJEb2N1bWVudERBTyIsIkRvY3VtZW50Q2hhbmdlREFPIiwiUmVkaXMiLCJTbmFwc2hvdFNjaGVkdWxlciIsIkRvY3VtZW50U2VydmljZSIsImNvbnN0cnVjdG9yIiwiZG9jdW1lbnREQU8iLCJyZWRpcyIsInNuYXBzaG90U2NoZWR1bGVyIiwiY2hhbmdlREFPIiwiZ2V0SW5zdGFuY2UiLCJjcmVhdGVEb2N1bWVudCIsImRhdGEiLCJkb2N1bWVudCIsImNyZWF0ZSIsIndvcmtzcGFjZV9pZCIsInRpdGxlIiwiY29udGVudCIsImNvbnRlbnRfbGVuZ3RoIiwibGVuZ3RoIiwib3duZXJfdWlkIiwibWV0YWRhdGEiLCJjb25zb2xlIiwibG9nIiwib2JqZWN0X2lkIiwiY29udGVudFRvU25hcHNob3QiLCJCdWZmZXIiLCJhbGxvYyIsInNuYXBzaG90UmVzdWx0IiwiY3JlYXRlU25hcHNob3RNYW51YWxseSIsInVuZGVmaW5lZCIsInNuYXBzaG90X2lkIiwidmVyc2lvbl90eXBlIiwiY3JlYXRlZF9hdCIsImVycm9yIiwid2FybiIsImRlbCIsImRlbEJ5UGF0dGVybiIsImdldERvY3VtZW50IiwiaW5jbHVkZUNvbnRlbnQiLCJjYWNoZUtleSIsImNhY2hlZCIsImdldEpTT04iLCJmaW5kQnlJZCIsImRvY1dpdGhvdXRDb250ZW50Iiwic2V0SlNPTiIsInVwZGF0ZURvY3VtZW50IiwidXBkYXRlcyIsImN1cnJlbnREb2MiLCJFcnJvciIsImZpbmFsQ29udGVudCIsImZpbmFsQ29udGVudExlbmd0aCIsImNoYW5nZV9kYXRhIiwieWRvYyIsIkRvYyIsImFwcGx5VXBkYXRlIiwiZnJvbSIsImVuY29kZVN0YXRlQXNVcGRhdGUiLCJ1cGRhdGVEYXRhIiwidXBkYXRlIiwiY2hhbmdlRGF0YSIsInNuYXBzaG90SWQiLCJoYXNTbmFwc2hvdCIsImdldExhdGVzdFNuYXBzaG90IiwiZm9yY2VTbmFwc2hvdCIsInNuYXBzaG90IiwicmVjb3JkRWRpdCIsImNoYW5nZV90eXBlIiwiYmVmb3JlX3N0YXRlX3ZlY3RvciIsImFmdGVyX3N0YXRlX3ZlY3RvciIsImNoYW5nZV9sZW5ndGgiLCJpc19pbmNyZW1lbnRhbCIsImRvYyIsImdldERvY3VtZW50cyIsIm9wdGlvbnMiLCJKU09OIiwic3RyaW5naWZ5IiwicGFnZSIsInBhZ2Vfc2l6ZSIsInJlc3VsdCIsImZpbmRCeVdvcmtzcGFjZUlkIiwiZGVsZXRlRG9jdW1lbnQiLCJkZWxldGUiLCJjcmVhdGVTbmFwc2hvdCIsInNuYXBzaG90X2RhdGEiLCJzbmFwc2hvdF92ZXJzaW9uIiwiZG9jX3N0YXRlIiwiZG9jX3N0YXRlX3ZlcnNpb24iLCJnZXRTbmFwc2hvdHMiLCJnZXRTbmFwc2hvdEJ5SWQiLCJzZWFyY2hEb2N1bWVudHMiLCJxdWVyeSIsImNhbGN1bGF0ZUNoYW5nZSIsInByZXZpb3VzQ29udGVudCIsImN1cnJlbnRDb250ZW50IiwiZ2V0RG9jdW1lbnRDaGFuZ2VzIiwiZmluZEJ5T2JqZWN0SWQiLCJnZXRDaGFuZ2VzQmV0d2VlblNuYXBzaG90cyIsImZyb21fc25hcHNob3RfaWQiLCJ0b19zbmFwc2hvdF9pZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/document.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/snapshot-scheduler.service.ts":
/*!****************************************************!*\
  !*** ./src/services/snapshot-scheduler.service.ts ***!
  \****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CompositeOrStrategy: () => (/* binding */ CompositeOrStrategy),\n/* harmony export */   ContentChangeStrategy: () => (/* binding */ ContentChangeStrategy),\n/* harmony export */   EditFrequencyStrategy: () => (/* binding */ EditFrequencyStrategy),\n/* harmony export */   SnapshotScheduler: () => (/* binding */ SnapshotScheduler),\n/* harmony export */   TimeIntervalStrategy: () => (/* binding */ TimeIntervalStrategy)\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_ts_param */ \"(rsc)/../../node_modules/tslib/tslib.es6.mjs\");\n/* harmony import */ var tsyringe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tsyringe */ \"(rsc)/../../node_modules/tsyringe/dist/esm5/index.js\");\n/* harmony import */ var _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/dao/document.dao */ \"(rsc)/./src/dao/document.dao.ts\");\n/* harmony import */ var _services_snapshot_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/snapshot.service */ \"(rsc)/./src/services/snapshot.service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__]);\n_dao_document_dao__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n/**\n * 时间间隔策略：如果距离上次快照超过指定时间，创建大版本\n */ class TimeIntervalStrategy {\n    constructor(timeThresholdMs = 300000){\n        // 默认 5 分钟（300000 毫秒）\n        this.timeThreshold = timeThresholdMs;\n    }\n    shouldCreateMajorVersion(context) {\n        return context.timeSinceLastSnapshot >= this.timeThreshold;\n    }\n}\n/**\n * 内容变化策略：如果内容变化很大，创建大版本\n */ class ContentChangeStrategy {\n    constructor(changeThresholdBytes = 10000){\n        // 默认 10KB\n        this.changeThreshold = changeThresholdBytes;\n    }\n    shouldCreateMajorVersion(context) {\n        if (!context.lastSnapshotDocStateSize) {\n            // 如果没有上次快照，不基于内容变化判断\n            return false;\n        }\n        const currentSize = context.currentDocState.length;\n        const sizeChange = Math.abs(currentSize - context.lastSnapshotDocStateSize);\n        // 如果内容变化超过阈值，创建大版本\n        return sizeChange >= this.changeThreshold;\n    }\n}\n/**\n * 变更频次策略：如果变更频次超过阈值，创建大版本\n */ class EditFrequencyStrategy {\n    constructor(editThreshold = 50){\n        // 默认 50 次\n        this.editThreshold = editThreshold;\n    }\n    shouldCreateMajorVersion(context) {\n        return context.editCount >= this.editThreshold;\n    }\n}\n/**\n * 组合策略：多个策略中任意一个满足条件就创建大版本\n */ class CompositeOrStrategy {\n    constructor(strategies){\n        this.strategies = strategies;\n    }\n    async shouldCreateMajorVersion(context) {\n        for (const strategy of this.strategies){\n            const result = await strategy.shouldCreateMajorVersion(context);\n            if (result) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\nclass SnapshotScheduler {\n    constructor(documentDAO, snapshotService){\n        this.documentDAO = documentDAO;\n        this.snapshotService = snapshotService;\n        this.editCounts = new Map();\n        this.lastSnapshotTimes = new Map();\n        this.lastSnapshotSizes = new Map();\n        this.EDITS_THRESHOLD = parseInt(process.env.SNAPSHOT_EDITS_THRESHOLD || \"10\", 10);\n        this.TIME_THRESHOLD = parseInt(process.env.SNAPSHOT_TIME_THRESHOLD || \"300000\", 10);\n        // 初始化组合策略：时间间隔、内容变化、变更频次\n        const timeStrategy = new TimeIntervalStrategy(this.TIME_THRESHOLD);\n        const contentStrategy = new ContentChangeStrategy(parseInt(process.env.SNAPSHOT_CONTENT_CHANGE_THRESHOLD || \"10000\", 10));\n        const frequencyStrategy = new EditFrequencyStrategy(parseInt(process.env.SNAPSHOT_EDIT_FREQUENCY_THRESHOLD || \"50\", 10));\n        this.versionStrategy = new CompositeOrStrategy([\n            timeStrategy,\n            contentStrategy,\n            frequencyStrategy\n        ]);\n    }\n    /**\n   * 记录一次编辑\n   * @param objectId 文档 ID\n   * @param workspaceId 工作空间 ID\n   * @param docState 文档状态（Y.encodeStateAsUpdate）\n   * @param snapshot Yjs Snapshot（可选）\n   * @returns 如果创建了快照，返回快照信息；否则返回 null\n   */ async recordEdit(objectId, workspaceId, docState, snapshot) {\n        const key = objectId;\n        const editCount = (this.editCounts.get(key) || 0) + 1;\n        this.editCounts.set(key, editCount);\n        const now = Date.now();\n        let lastSnapshotTime = this.lastSnapshotTimes.get(key);\n        let lastSnapshotSize = this.lastSnapshotSizes.get(key);\n        // 如果内存中没有记录，从数据库查询最后一个快照的信息\n        if (!lastSnapshotTime || lastSnapshotSize === undefined) {\n            try {\n                const latestSnapshot = await this.documentDAO.getLatestSnapshot(objectId);\n                if (latestSnapshot) {\n                    lastSnapshotTime = latestSnapshot.created_at;\n                    lastSnapshotSize = latestSnapshot.doc_state?.length || 0;\n                    this.lastSnapshotTimes.set(key, lastSnapshotTime);\n                    this.lastSnapshotSizes.set(key, lastSnapshotSize);\n                } else {\n                    // 如果没有快照，尝试使用文档的创建时间作为基准\n                    // 这样可以确保即使没有快照，也能正确计算时间间隔\n                    try {\n                        const document = await this.documentDAO.findById(objectId);\n                        if (document && document.created_at) {\n                            // 文档创建时间（转换为毫秒时间戳）\n                            const docCreatedAt = typeof document.created_at === \"string\" ? new Date(document.created_at).getTime() : document.created_at instanceof Date ? document.created_at.getTime() : document.created_at;\n                            lastSnapshotTime = docCreatedAt;\n                            lastSnapshotSize = document.content_length || 0;\n                            console.log(`[SnapshotScheduler] No snapshot found, using document created_at: ${lastSnapshotTime}`);\n                        } else {\n                            // 如果连文档都找不到，设置为0\n                            lastSnapshotTime = 0;\n                            lastSnapshotSize = 0;\n                        }\n                    } catch (docError) {\n                        console.error(`Failed to get document for ${objectId}:`, docError);\n                        lastSnapshotTime = 0;\n                        lastSnapshotSize = 0;\n                    }\n                    this.lastSnapshotTimes.set(key, lastSnapshotTime);\n                    this.lastSnapshotSizes.set(key, lastSnapshotSize);\n                }\n            } catch (error) {\n                console.error(`Failed to get latest snapshot for ${objectId}:`, error);\n                lastSnapshotTime = 0;\n                lastSnapshotSize = 0;\n                this.lastSnapshotTimes.set(key, 0);\n                this.lastSnapshotSizes.set(key, 0);\n            }\n        }\n        const timeSinceLastSnapshot = now - lastSnapshotTime;\n        // 判断是否需要创建快照\n        // 如果时间间隔超过阈值，即使编辑次数不够，也应该创建快照\n        // 这样可以确保长时间不编辑的文档也能定期创建快照\n        const shouldCreateSnapshot = editCount >= this.EDITS_THRESHOLD || timeSinceLastSnapshot >= this.TIME_THRESHOLD;\n        console.log(`[SnapshotScheduler] recordEdit for ${objectId}:`, {\n            editCount,\n            timeSinceLastSnapshot,\n            timeSinceLastSnapshotMinutes: Math.round(timeSinceLastSnapshot / 60000),\n            shouldCreateSnapshot,\n            EDITS_THRESHOLD: this.EDITS_THRESHOLD,\n            TIME_THRESHOLD: this.TIME_THRESHOLD\n        });\n        if (shouldCreateSnapshot) {\n            // 使用策略判断版本类型\n            const context = {\n                objectId,\n                workspaceId,\n                currentDocState: docState,\n                currentTime: now,\n                editCount,\n                timeSinceLastSnapshot,\n                lastSnapshotDocStateSize: lastSnapshotSize,\n                lastSnapshotTime\n            };\n            const isMajor = await this.versionStrategy.shouldCreateMajorVersion(context);\n            const versionType = isMajor ? \"major\" : \"minor\";\n            console.log(`[SnapshotScheduler] Creating ${versionType} snapshot for ${objectId}`);\n            const result = await this.createSnapshot(objectId, workspaceId, docState, snapshot, versionType);\n            // 重置计数和时间\n            this.editCounts.set(key, 0);\n            this.lastSnapshotTimes.set(key, now);\n            this.lastSnapshotSizes.set(key, docState.length);\n            console.log(`[SnapshotScheduler] Snapshot created:`, {\n                snapshot_id: result.snapshot_id,\n                version_type: versionType\n            });\n            return {\n                ...result,\n                version_type: versionType\n            };\n        }\n        return null;\n    }\n    /**\n   * 创建快照\n   */ async createSnapshot(objectId, workspaceId, docState, snapshot, versionType = \"major\") {\n        try {\n            // 使用 SnapshotService 创建快照\n            const result = await this.snapshotService.createSnapshot({\n                workspaceId,\n                objectId,\n                docState,\n                snapshot,\n                metadata: {\n                    auto_save: versionType === \"major\",\n                    doc_state_length: docState.length,\n                    version_type: versionType\n                }\n            });\n            // 在数据库中记录快照元数据\n            console.log(`[SnapshotScheduler] Saving snapshot to database:`, {\n                object_id: objectId,\n                workspace_id: workspaceId,\n                version_type: versionType,\n                doc_state_length: docState.length,\n                snapshot_length: snapshot?.length || 0\n            });\n            const snapshotRecord = await this.documentDAO.createSnapshot({\n                object_id: objectId,\n                workspace_id: workspaceId,\n                snapshot_data: snapshot || Buffer.alloc(0),\n                snapshot_version: 1,\n                doc_state: docState,\n                doc_state_version: 1,\n                version_type: versionType,\n                metadata: {\n                    snapshot_id: result.snapshotId,\n                    created_at: result.createdAt,\n                    stored_in: \"file\"\n                }\n            });\n            console.log(`[SnapshotScheduler] Snapshot record saved to database:`, {\n                snapshot_id: snapshotRecord.snapshot_id,\n                object_id: objectId,\n                version_type: versionType,\n                created_at: snapshotRecord.created_at,\n                db_created_at_type: typeof snapshotRecord.created_at\n            });\n            return {\n                snapshot_id: snapshotRecord.snapshot_id,\n                created_at: result.createdAt\n            };\n        } catch (error) {\n            console.error(`Failed to create snapshot for document ${objectId}:`, error);\n            throw error;\n        }\n    }\n    /**\n   * 手动触发快照创建（用于手动保存）\n   * 会根据策略判断创建大版本还是小版本\n   * @param forceMajorVersion 是否强制创建大版本（用于初始快照等场景）\n   */ async createSnapshotManually(objectId, workspaceId, docState, snapshot, forceMajorVersion = false) {\n        const key = objectId;\n        const editCount = this.editCounts.get(key) || 0;\n        const now = Date.now();\n        let lastSnapshotTime = this.lastSnapshotTimes.get(key);\n        let lastSnapshotSize = this.lastSnapshotSizes.get(key);\n        // 如果内存中没有记录，从数据库查询\n        if (!lastSnapshotTime || lastSnapshotSize === undefined) {\n            try {\n                const latestSnapshot = await this.documentDAO.getLatestSnapshot(objectId);\n                if (latestSnapshot) {\n                    lastSnapshotTime = latestSnapshot.created_at;\n                    lastSnapshotSize = latestSnapshot.doc_state?.length || 0;\n                } else {\n                    // 如果没有快照，尝试使用文档的创建时间作为基准\n                    try {\n                        const document = await this.documentDAO.findById(objectId);\n                        if (document && document.created_at) {\n                            const docCreatedAt = typeof document.created_at === \"string\" ? new Date(document.created_at).getTime() : document.created_at instanceof Date ? document.created_at.getTime() : document.created_at;\n                            lastSnapshotTime = docCreatedAt;\n                            lastSnapshotSize = document.content_length || 0;\n                            console.log(`[SnapshotScheduler] No snapshot found, using document created_at: ${lastSnapshotTime}`);\n                        } else {\n                            lastSnapshotTime = 0;\n                            lastSnapshotSize = 0;\n                        }\n                    } catch (docError) {\n                        console.error(`Failed to get document for ${objectId}:`, docError);\n                        lastSnapshotTime = 0;\n                        lastSnapshotSize = 0;\n                    }\n                }\n            } catch (error) {\n                console.error(`Failed to get latest snapshot for ${objectId}:`, error);\n                lastSnapshotTime = 0;\n                lastSnapshotSize = 0;\n            }\n        }\n        const timeSinceLastSnapshot = now - (lastSnapshotTime || 0);\n        // 判断版本类型\n        let versionType;\n        if (forceMajorVersion) {\n            // 强制创建大版本（用于初始快照等场景）\n            versionType = \"major\";\n        } else {\n            // 使用策略判断版本类型\n            const context = {\n                objectId,\n                workspaceId,\n                currentDocState: docState,\n                currentTime: now,\n                editCount,\n                timeSinceLastSnapshot,\n                lastSnapshotDocStateSize: lastSnapshotSize,\n                lastSnapshotTime\n            };\n            const isMajor = await this.versionStrategy.shouldCreateMajorVersion(context);\n            versionType = isMajor ? \"major\" : \"minor\";\n        }\n        const result = await this.createSnapshot(objectId, workspaceId, docState, snapshot, versionType);\n        // 重置计数和时间\n        this.editCounts.set(key, 0);\n        this.lastSnapshotTimes.set(key, now);\n        this.lastSnapshotSizes.set(key, docState.length);\n        return {\n            ...result,\n            version_type: versionType\n        };\n    }\n    /**\n   * 重置文档的编辑计数（用于文档关闭等场景）\n   */ reset(objectId) {\n        this.editCounts.delete(objectId);\n        this.lastSnapshotTimes.delete(objectId);\n        this.lastSnapshotSizes.delete(objectId);\n    }\n}\nSnapshotScheduler = (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__decorate)([\n    (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.injectable)(),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__param)(0, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"DocumentDAO\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__param)(1, (0,tsyringe__WEBPACK_IMPORTED_MODULE_0__.inject)(\"SnapshotService\")),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:type\", Function),\n    (0,_swc_helpers_ts_decorate__WEBPACK_IMPORTED_MODULE_3__.__metadata)(\"design:paramtypes\", [\n        typeof _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO === \"undefined\" ? Object : _dao_document_dao__WEBPACK_IMPORTED_MODULE_1__.DocumentDAO,\n        typeof _services_snapshot_service__WEBPACK_IMPORTED_MODULE_2__.SnapshotService === \"undefined\" ? Object : _services_snapshot_service__WEBPACK_IMPORTED_MODULE_2__.SnapshotService\n    ])\n], SnapshotScheduler);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvc25hcHNob3Qtc2NoZWR1bGVyLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQThDO0FBQ0c7QUFDYTtBQTZCOUQ7O0NBRUMsR0FDTSxNQUFNSTtJQUdYQyxZQUFZQyxrQkFBMEIsTUFBTSxDQUFFO1FBQzVDLHFCQUFxQjtRQUNyQixJQUFJLENBQUNDLGFBQWEsR0FBR0Q7SUFDdkI7SUFFQUUseUJBQXlCQyxPQUErQixFQUFXO1FBQ2pFLE9BQU9BLFFBQVFDLHFCQUFxQixJQUFJLElBQUksQ0FBQ0gsYUFBYTtJQUM1RDtBQUNGO0FBRUE7O0NBRUMsR0FDTSxNQUFNSTtJQUdYTixZQUFZTyx1QkFBK0IsS0FBSyxDQUFFO1FBQ2hELFVBQVU7UUFDVixJQUFJLENBQUNDLGVBQWUsR0FBR0Q7SUFDekI7SUFFQUoseUJBQXlCQyxPQUErQixFQUFXO1FBQ2pFLElBQUksQ0FBQ0EsUUFBUUssd0JBQXdCLEVBQUU7WUFDckMscUJBQXFCO1lBQ3JCLE9BQU87UUFDVDtRQUVBLE1BQU1DLGNBQWNOLFFBQVFPLGVBQWUsQ0FBQ0MsTUFBTTtRQUNsRCxNQUFNQyxhQUFhQyxLQUFLQyxHQUFHLENBQUNMLGNBQWNOLFFBQVFLLHdCQUF3QjtRQUUxRSxtQkFBbUI7UUFDbkIsT0FBT0ksY0FBYyxJQUFJLENBQUNMLGVBQWU7SUFDM0M7QUFDRjtBQUVBOztDQUVDLEdBQ00sTUFBTVE7SUFHWGhCLFlBQVlpQixnQkFBd0IsRUFBRSxDQUFFO1FBQ3RDLFVBQVU7UUFDVixJQUFJLENBQUNBLGFBQWEsR0FBR0E7SUFDdkI7SUFFQWQseUJBQXlCQyxPQUErQixFQUFXO1FBQ2pFLE9BQU9BLFFBQVFjLFNBQVMsSUFBSSxJQUFJLENBQUNELGFBQWE7SUFDaEQ7QUFDRjtBQUVBOztDQUVDLEdBQ00sTUFBTUU7SUFHWG5CLFlBQVlvQixVQUFxQyxDQUFFO1FBQ2pELElBQUksQ0FBQ0EsVUFBVSxHQUFHQTtJQUNwQjtJQUVBLE1B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Q3JEO1FBQ3ZCLElBQUksQ0FBQ2hCLGlCQUFpQixDQUFDcUUsTUFBTSxDQUFDckQ7UUFDOUIsSUFBSSxDQUFDZixpQkFBaUIsQ0FBQ29FLE1BQU0sQ0FBQ3JEO0lBQ2hDO0FBQ0Y7QUFuVmFyQixvQkFBQUEsb0VBQUFBO0lBRFo1QixvREFBVUE7SUFZTkMsaUVBQUFBLElBQUFBLGdEQUFNQSxDQUFDO0lBQ1BBLGlFQUFBQSxJQUFBQSxnREFBTUEsQ0FBQzs7O2VBRG9DLDBEQUFXLDRCQUFYLDBEQUFXO2VBQ0gsdUVBQWUsNEJBQWYsdUVBQWU7O0dBWjFEMkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2xvYmFsbGluay9zZXJ2ZXIvLi9zcmMvc2VydmljZXMvc25hcHNob3Qtc2NoZWR1bGVyLnNlcnZpY2UudHM/ZWJhNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICd0c3lyaW5nZSc7XG5pbXBvcnQgeyBEb2N1bWVudERBTyB9IGZyb20gJ0AvZGFvL2RvY3VtZW50LmRhbyc7XG5pbXBvcnQgeyBTbmFwc2hvdFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL3NuYXBzaG90LnNlcnZpY2UnO1xuXG4vKipcbiAqIOW/q+eFp+eJiOacrOexu+Wei+WIpOaWreetlueVpeaOpeWPo1xuICog55So5LqO5Yik5pat5piv5ZCm5bqU6K+l5Yib5bu65aSn54mI5pys5b+r54WnXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU25hcHNob3RWZXJzaW9uU3RyYXRlZ3kge1xuICAvKipcbiAgICog5Yik5pat5piv5ZCm5bqU6K+l5Yib5bu65aSn54mI5pys5b+r54WnXG4gICAqIEBwYXJhbSBjb250ZXh0IOWIpOaWreS4iuS4i+aWh1xuICAgKiBAcmV0dXJucyB0cnVlIOihqOekuuW6lOivpeWIm+W7uuWkp+eJiOacrO+8jGZhbHNlIOihqOekuuWIm+W7uuWwj+eJiOacrFxuICAgKi9cbiAgc2hvdWxkQ3JlYXRlTWFqb3JWZXJzaW9uKGNvbnRleHQ6IFNuYXBzaG90VmVyc2lvbkNvbnRleHQpOiBib29sZWFuIHwgUHJvbWlzZTxib29sZWFuPjtcbn1cblxuLyoqXG4gKiDlv6vnhafniYjmnKzliKTmlq3kuIrkuIvmlodcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTbmFwc2hvdFZlcnNpb25Db250ZXh0IHtcbiAgb2JqZWN0SWQ6IHN0cmluZztcbiAgd29ya3NwYWNlSWQ6IHN0cmluZztcbiAgY3VycmVudERvY1N0YXRlOiBCdWZmZXI7IC8vIOW9k+WJjeaWh+aho+eKtuaAgVxuICBjdXJyZW50VGltZTogbnVtYmVyOyAvLyDlvZPliY3ml7bpl7TmiLNcbiAgZWRpdENvdW50OiBudW1iZXI7IC8vIOiHquS4iuasoeW/q+eFp+S7peadpeeahOe8lui+keasoeaVsFxuICB0aW1lU2luY2VMYXN0U25hcHNob3Q6IG51bWJlcjsgLy8g6Led56a75LiK5qyh5b+r54Wn55qE5pe26Ze077yI5q+r56eS77yJXG4gIGxhc3RTbmFwc2hvdERvY1N0YXRlU2l6ZT86IG51bWJlcjsgLy8g5LiK5qyh5b+r54Wn55qE5paH5qGj54q25oCB5aSn5bCP77yI5a2X6IqC77yJXG4gIGxhc3RTbmFwc2hvdFRpbWU/OiBudW1iZXI7IC8vIOS4iuasoeW/q+eFp+eahOaXtumXtOaIs1xufVxuXG4vKipcbiAqIOaXtumXtOmXtOmalOetlueVpe+8muWmguaenOi3neemu+S4iuasoeW/q+eFp+i2hei/h+aMh+WumuaXtumXtO+8jOWIm+W7uuWkp+eJiOacrFxuICovXG5leHBvcnQgY2xhc3MgVGltZUludGVydmFsU3RyYXRlZ3kgaW1wbGVtZW50cyBTbmFwc2hvdFZlcnNpb25TdHJhdGVneSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgdGltZVRocmVzaG9sZDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKHRpbWVUaHJlc2hvbGRNczogbnVtYmVyID0gMzAwMDAwKSB7XG4gICAgLy8g6buY6K6kIDUg5YiG6ZKf77yIMzAwMDAwIOavq+enku+8iVxuICAgIHRoaXMudGltZVRocmVzaG9sZCA9IHRpbWVUaHJlc2hvbGRNcztcbiAgfVxuXG4gIHNob3VsZENyZWF0ZU1ham9yVmVyc2lvbihjb250ZXh0OiBTbmFwc2hvdFZlcnNpb25Db250ZXh0KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGNvbnRleHQudGltZVNpbmNlTGFzdFNuYXBzaG90ID49IHRoaXMudGltZVRocmVzaG9sZDtcbiAgfVxufVxuXG4vKipcbiAqIOWGheWuueWPmOWMluetlueVpe+8muWmguaenOWGheWuueWPmOWMluW+iOWkp++8jOWIm+W7uuWkp+eJiOacrFxuICovXG5leHBvcnQgY2xhc3MgQ29udGVudENoYW5nZVN0cmF0ZWd5IGltcGxlbWVudHMgU25hcHNob3RWZXJzaW9uU3RyYXRlZ3kge1xuICBwcml2YXRlIHJlYWRvbmx5IGNoYW5nZVRocmVzaG9sZDogbnVtYmVyOyAvLyDlj5jljJbpmIjlgLzvvIjlrZfoioLvvIlcblxuICBjb25zdHJ1Y3RvcihjaGFuZ2VUaHJlc2hvbGRCeXRlczogbnVtYmVyID0gMTAwMDApIHtcbiAgICAvLyDpu5jorqQgMTBLQlxuICAgIHRoaXMuY2hhbmdlVGhyZXNob2xkID0gY2hhbmdlVGhyZXNob2xkQnl0ZXM7XG4gIH1cblxuICBzaG91bGRDcmVhdGVNYWpvclZlcnNpb24oY29udGV4dDogU25hcHNob3RWZXJzaW9uQ29udGV4dCk6IGJvb2xlYW4ge1xuICAgIGlmICghY29udGV4dC5sYXN0U25hcHNob3REb2NTdGF0ZVNpemUpIHtcbiAgICAgIC8vIOWmguaenOayoeacieS4iuasoeW/q+eFp++8jOS4jeWfuuS6juWGheWuueWPmOWMluWIpOaWrVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRTaXplID0gY29udGV4dC5jdXJyZW50RG9jU3RhdGUubGVuZ3RoO1xuICAgIGNvbnN0IHNpemVDaGFuZ2UgPSBNYXRoLmFicyhjdXJyZW50U2l6ZSAtIGNvbnRleHQubGFzdFNuYXBzaG90RG9jU3RhdGVTaXplKTtcblxuICAgIC8vIOWmguaenOWGheWuueWPmOWMlui2hei/h+mYiOWAvO+8jOWIm+W7uuWkp+eJiOacrFxuICAgIHJldHVybiBzaXplQ2hhbmdlID49IHRoaXMuY2hhbmdlVGhyZXNob2xkO1xuICB9XG59XG5cbi8qKlxuICog5Y+Y5pu06aKR5qyh562W55Wl77ya5aaC5p6c5Y+Y5pu06aKR5qyh6LaF6L+H6ZiI5YC877yM5Yib5bu65aSn54mI5pysXG4gKi9cbmV4cG9ydCBjbGFzcyBFZGl0RnJlcXVlbmN5U3RyYXRlZ3kgaW1wbGVtZW50cyBTbmFwc2hvdFZlcnNpb25TdHJhdGVneSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgZWRpdFRocmVzaG9sZDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKGVkaXRUaHJlc2hvbGQ6IG51bWJlciA9IDUwKSB7XG4gICAgLy8g6buY6K6kIDUwIOasoVxuICAgIHRoaXMuZWRpdFRocmVzaG9sZCA9IGVkaXRUaHJlc2hvbGQ7XG4gIH1cblxuICBzaG91bGRDcmVhdGVNYWpvclZlcnNpb24oY29udGV4dDogU25hcHNob3RWZXJzaW9uQ29udGV4dCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBjb250ZXh0LmVkaXRDb3VudCA+PSB0aGlzLmVkaXRUaHJlc2hvbGQ7XG4gIH1cbn1cblxuLyoqXG4gKiDnu4TlkIjnrZbnlaXvvJrlpJrkuKrnrZbnlaXkuK3ku7vmhI/kuIDkuKrmu6HotrPmnaHku7blsLHliJvlu7rlpKfniYjmnKxcbiAqL1xuZXhwb3J0IGNsYXNzIENvbXBvc2l0ZU9yU3RyYXRlZ3kgaW1wbGVtZW50cyBTbmFwc2hvdFZlcnNpb25TdHJhdGVneSB7XG4gIHByaXZhdGUgc3RyYXRlZ2llczogU25hcHNob3RWZXJzaW9uU3RyYXRlZ3lbXTtcblxuICBjb25zdHJ1Y3RvcihzdHJhdGVnaWVzOiBTbmFwc2hvdFZlcnNpb25TdHJhdGVneVtdKSB7XG4gICAgdGhpcy5zdHJhdGVnaWVzID0gc3RyYXRlZ2llcztcbiAgfVxuXG4gIGFzeW5jIHNob3VsZENyZWF0ZU1ham9yVmVyc2lvbihjb250ZXh0OiBTbmFwc2hvdFZlcnNpb25Db250ZXh0KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgZm9yIChjb25zdCBzdHJhdGVneSBvZiB0aGlzLnN0cmF0ZWdpZXMpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN0cmF0ZWd5LnNob3VsZENyZWF0ZU1ham9yVmVyc2lvbihjb250ZXh0KTtcbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIOW/q+eFp+iwg+W6puWZqFxuICog6LSf6LSj5a6a5pyf5Yib5bu65paH5qGj5b+r54Wn77yM6ICM5LiN5piv5q+P5qyh5L+d5a2Y6YO95Yib5bu6XG4gKi9cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBTbmFwc2hvdFNjaGVkdWxlciB7XG4gIHByaXZhdGUgZWRpdENvdW50czogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTsgLy8gb2JqZWN0SWQgLT4gZWRpdENvdW50XG4gIHByaXZhdGUgbGFzdFNuYXBzaG90VGltZXM6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwKCk7IC8vIG9iamVjdElkIC0+IGxhc3RTbmFwc2hvdFRpbWVcbiAgcHJpdmF0ZSBsYXN0U25hcHNob3RTaXplczogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTsgLy8gb2JqZWN0SWQgLT4gbGFzdFNuYXBzaG90U2l6ZVxuXG4gIC8vIOetlueVpemFjee9rlxuICBwcml2YXRlIHJlYWRvbmx5IHZlcnNpb25TdHJhdGVneTogU25hcHNob3RWZXJzaW9uU3RyYXRlZ3k7XG4gIHByaXZhdGUgcmVhZG9ubHkgRURJVFNfVEhSRVNIT0xEID0gcGFyc2VJbnQocHJvY2Vzcy5lbnYuU05BUFNIT1RfRURJVFNfVEhSRVNIT0xEIHx8ICcxMCcsIDEwKTtcbiAgcHJpdmF0ZSByZWFkb25seSBUSU1FX1RIUkVTSE9MRCA9IHBhcnNlSW50KHByb2Nlc3MuZW52LlNOQVBTSE9UX1RJTUVfVEhSRVNIT0xEIHx8ICczMDAwMDAnLCAxMCk7IC8vIDXliIbpkp9cblxuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KCdEb2N1bWVudERBTycpIHByaXZhdGUgZG9jdW1lbnREQU86IERvY3VtZW50REFPLFxuICAgIEBpbmplY3QoJ1NuYXBzaG90U2VydmljZScpIHByaXZhdGUgc25hcHNob3RTZXJ2aWNlOiBTbmFwc2hvdFNlcnZpY2VcbiAgKSB7XG4gICAgLy8g5Yid5aeL5YyW57uE5ZCI562W55Wl77ya5pe26Ze06Ze06ZqU44CB5YaF5a655Y+Y5YyW44CB5Y+Y5pu06aKR5qyhXG4gICAgY29uc3QgdGltZVN0cmF0ZWd5ID0gbmV3IFRpbWVJbnRlcnZhbFN0cmF0ZWd5KHRoaXMuVElNRV9USFJFU0hPTEQpO1xuICAgIGNvbnN0IGNvbnRlbnRTdHJhdGVneSA9IG5ldyBDb250ZW50Q2hhbmdlU3RyYXRlZ3koXG4gICAgICBwYXJzZUludChwcm9jZXNzLmVudi5TTkFQU0hPVF9DT05URU5UX0NIQU5HRV9USFJFU0hPTEQgfHwgJzEwMDAwJywgMTApXG4gICAgKTtcbiAgICBjb25zdCBmcmVxdWVuY3lTdHJhdGVneSA9IG5ldyBFZGl0RnJlcXVlbmN5U3RyYXRlZ3koXG4gICAgICBwYXJzZUludChwcm9jZXNzLmVudi5TTkFQU0hPVF9FRElUX0ZSRVFVRU5DWV9USFJFU0hPTEQgfHwgJzUwJywgMTApXG4gICAgKTtcblxuICAgIHRoaXMudmVyc2lvblN0cmF0ZWd5ID0gbmV3IENvbXBvc2l0ZU9yU3RyYXRlZ3koW1xuICAgICAgdGltZVN0cmF0ZWd5LFxuICAgICAgY29udGVudFN0cmF0ZWd5LFxuICAgICAgZnJlcXVlbmN5U3RyYXRlZ3ksXG4gICAgXSk7XG4gIH1cblxuICAvKipcbiAgICog6K6w5b2V5LiA5qyh57yW6L6RXG4gICAqIEBwYXJhbSBvYmplY3RJZCDmlofmoaMgSURcbiAgICogQHBhcmFtIHdvcmtzcGFjZUlkIOW3peS9nOepuumXtCBJRFxuICAgKiBAcGFyYW0gZG9jU3RhdGUg5paH5qGj54q25oCB77yIWS5lbmNvZGVTdGF0ZUFzVXBkYXRl77yJXG4gICAqIEBwYXJhbSBzbmFwc2hvdCBZanMgU25hcHNob3TvvIjlj6/pgInvvIlcbiAgICogQHJldHVybnMg5aaC5p6c5Yib5bu65LqG5b+r54Wn77yM6L+U5Zue5b+r54Wn5L+h5oGv77yb5ZCm5YiZ6L+U5ZueIG51bGxcbiAgICovXG4gIGFzeW5jIHJlY29yZEVkaXQoXG4gICAgb2JqZWN0SWQ6IHN0cmluZyxcbiAgICB3b3Jrc3BhY2VJZDogc3RyaW5nLFxuICAgIGRvY1N0YXRlOiBCdWZmZXIsXG4gICAgc25hcHNob3Q/OiBCdWZmZXJcbiAgKTogUHJvbWlzZTx7IHNuYXBzaG90X2lkOiBzdHJpbmc7IGNyZWF0ZWRfYXQ6IG51bWJlcjsgdmVyc2lvbl90eXBlOiAnbWFqb3InIHwgJ21pbm9yJyB9IHwgbnVsbD4ge1xuICAgIGNvbnN0IGtleSA9IG9iamVjdElkO1xuICAgIGNvbnN0IGVkaXRDb3VudCA9ICh0aGlzLmVkaXRDb3VudHMuZ2V0KGtleSkgfHwgMCkgKyAxO1xuICAgIHRoaXMuZWRpdENvdW50cy5zZXQoa2V5LCBlZGl0Q291bnQpO1xuXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgbGFzdFNuYXBzaG90VGltZSA9IHRoaXMubGFzdFNuYXBzaG90VGltZXMuZ2V0KGtleSk7XG4gICAgbGV0IGxhc3RTbmFwc2hvdFNpemUgPSB0aGlzLmxhc3RTbmFwc2hvdFNpemVzLmdldChrZXkpO1xuXG4gICAgLy8g5aaC5p6c5YaF5a2Y5Lit5rKh5pyJ6K6w5b2V77yM5LuO5pWw5o2u5bqT5p+l6K+i5pyA5ZCO5LiA5Liq5b+r54Wn55qE5L+h5oGvXG4gICAgaWYgKCFsYXN0U25hcHNob3RUaW1lIHx8IGxhc3RTbmFwc2hvdFNpemUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbGF0ZXN0U25hcHNob3QgPSBhd2FpdCB0aGlzLmRvY3VtZW50REFPLmdldExhdGVzdFNuYXBzaG90KG9iamVjdElkKTtcbiAgICAgICAgaWYgKGxhdGVzdFNuYXBzaG90KSB7XG4gICAgICAgICAgbGFzdFNuYXBzaG90VGltZSA9IGxhdGVzdFNuYXBzaG90LmNyZWF0ZWRfYXQ7XG4gICAgICAgICAgbGFzdFNuYXBzaG90U2l6ZSA9IGxhdGVzdFNuYXBzaG90LmRvY19zdGF0ZT8ubGVuZ3RoIHx8IDA7XG4gICAgICAgICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5zZXQoa2V5LCBsYXN0U25hcHNob3RUaW1lKTtcbiAgICAgICAgICB0aGlzLmxhc3RTbmFwc2hvdFNpemVzLnNldChrZXksIGxhc3RTbmFwc2hvdFNpemUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOWmguaenOayoeacieW/q+eFp++8jOWwneivleS9v+eUqOaWh+aho+eahOWIm+W7uuaXtumXtOS9nOS4uuWfuuWHhlxuICAgICAgICAgIC8vIOi/meagt+WPr+S7peehruS/neWNs+S9v+ayoeacieW/q+eFp++8jOS5n+iDveato+ehruiuoeeul+aXtumXtOmXtOmalFxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZmluZEJ5SWQob2JqZWN0SWQpO1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50ICYmIGRvY3VtZW50LmNyZWF0ZWRfYXQpIHtcbiAgICAgICAgICAgICAgLy8g5paH5qGj5Yib5bu65pe26Ze077yI6L2s5o2i5Li65q+r56eS5pe26Ze05oiz77yJXG4gICAgICAgICAgICAgIGNvbnN0IGRvY0NyZWF0ZWRBdCA9XG4gICAgICAgICAgICAgICAgdHlwZW9mIGRvY3VtZW50LmNyZWF0ZWRfYXQgPT09ICdzdHJpbmcnXG4gICAgICAgICAgICAgICAgICA/IG5ldyBEYXRlKGRvY3VtZW50LmNyZWF0ZWRfYXQpLmdldFRpbWUoKVxuICAgICAgICAgICAgICAgICAgOiBkb2N1bWVudC5jcmVhdGVkX2F0IGluc3RhbmNlb2YgRGF0ZVxuICAgICAgICAgICAgICAgICAgPyBkb2N1bWVudC5jcmVhdGVkX2F0LmdldFRpbWUoKVxuICAgICAgICAgICAgICAgICAgOiBkb2N1bWVudC5jcmVhdGVkX2F0O1xuICAgICAgICAgICAgICBsYXN0U25hcHNob3RUaW1lID0gZG9jQ3JlYXRlZEF0O1xuICAgICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gZG9jdW1lbnQuY29udGVudF9sZW5ndGggfHwgMDtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgICAgYFtTbmFwc2hvdFNjaGVkdWxlcl0gTm8gc25hcHNob3QgZm91bmQsIHVzaW5nIGRvY3VtZW50IGNyZWF0ZWRfYXQ6ICR7bGFzdFNuYXBzaG90VGltZX1gXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyDlpoLmnpzov57mlofmoaPpg73mib7kuI3liLDvvIzorr7nva7kuLowXG4gICAgICAgICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSAwO1xuICAgICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChkb2NFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGdldCBkb2N1bWVudCBmb3IgJHtvYmplY3RJZH06YCwgZG9jRXJyb3IpO1xuICAgICAgICAgICAgbGFzdFNuYXBzaG90VGltZSA9IDA7XG4gICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5zZXQoa2V5LCBsYXN0U25hcHNob3RUaW1lKTtcbiAgICAgICAgICB0aGlzLmxhc3RTbmFwc2hvdFNpemVzLnNldChrZXksIGxhc3RTbmFwc2hvdFNpemUpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZ2V0IGxhdGVzdCBzbmFwc2hvdCBmb3IgJHtvYmplY3RJZH06YCwgZXJyb3IpO1xuICAgICAgICBsYXN0U25hcHNob3RUaW1lID0gMDtcbiAgICAgICAgbGFzdFNuYXBzaG90U2l6ZSA9IDA7XG4gICAgICAgIHRoaXMubGFzdFNuYXBzaG90VGltZXMuc2V0KGtleSwgMCk7XG4gICAgICAgIHRoaXMubGFzdFNuYXBzaG90U2l6ZXMuc2V0KGtleSwgMCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgdGltZVNpbmNlTGFzdFNuYXBzaG90ID0gbm93IC0gbGFzdFNuYXBzaG90VGltZTtcblxuICAgIC8vIOWIpOaWreaYr+WQpumcgOimgeWIm+W7uuW/q+eFp1xuICAgIC8vIOWmguaenOaXtumXtOmXtOmalOi2hei/h+mYiOWAvO+8jOWNs+S9v+e8lui+keasoeaVsOS4jeWkn++8jOS5n+W6lOivpeWIm+W7uuW/q+eFp1xuICAgIC8vIOi/meagt+WPr+S7peehruS/nemVv+aXtumXtOS4jee8lui+keeahOaWh+aho+S5n+iDveWumuacn+WIm+W7uuW/q+eFp1xuICAgIGNvbnN0IHNob3VsZENyZWF0ZVNuYXBzaG90ID1cbiAgICAgIGVkaXRDb3VudCA+PSB0aGlzLkVESVRTX1RIUkVTSE9MRCB8fCB0aW1lU2luY2VMYXN0U25hcHNob3QgPj0gdGhpcy5USU1FX1RIUkVTSE9MRDtcblxuICAgIGNvbnNvbGUubG9nKGBbU25hcHNob3RTY2hlZHVsZXJdIHJlY29yZEVkaXQgZm9yICR7b2JqZWN0SWR9OmAsIHtcbiAgICAgIGVkaXRDb3VudCxcbiAgICAgIHRpbWVTaW5jZUxhc3RTbmFwc2hvdCxcbiAgICAgIHRpbWVTaW5jZUxhc3RTbmFwc2hvdE1pbnV0ZXM6IE1hdGgucm91bmQodGltZVNpbmNlTGFzdFNuYXBzaG90IC8gNjAwMDApLFxuICAgICAgc2hvdWxkQ3JlYXRlU25hcHNob3QsXG4gICAgICBFRElUU19USFJFU0hPTEQ6IHRoaXMuRURJVFNfVEhSRVNIT0xELFxuICAgICAgVElNRV9USFJFU0hPTEQ6IHRoaXMuVElNRV9USFJFU0hPTEQsXG4gICAgfSk7XG5cbiAgICBpZiAoc2hvdWxkQ3JlYXRlU25hcHNob3QpIHtcbiAgICAgIC8vIOS9v+eUqOetlueVpeWIpOaWreeJiOacrOexu+Wei1xuICAgICAgY29uc3QgY29udGV4dDogU25hcHNob3RWZXJzaW9uQ29udGV4dCA9IHtcbiAgICAgICAgb2JqZWN0SWQsXG4gICAgICAgIHdvcmtzcGFjZUlkLFxuICAgICAgICBjdXJyZW50RG9jU3RhdGU6IGRvY1N0YXRlLFxuICAgICAgICBjdXJyZW50VGltZTogbm93LFxuICAgICAgICBlZGl0Q291bnQsXG4gICAgICAgIHRpbWVTaW5jZUxhc3RTbmFwc2hvdCxcbiAgICAgICAgbGFzdFNuYXBzaG90RG9jU3RhdGVTaXplOiBsYXN0U25hcHNob3RTaXplLFxuICAgICAgICBsYXN0U25hcHNob3RUaW1lLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgaXNNYWpvciA9IGF3YWl0IHRoaXMudmVyc2lvblN0cmF0ZWd5LnNob3VsZENyZWF0ZU1ham9yVmVyc2lvbihjb250ZXh0KTtcbiAgICAgIGNvbnN0IHZlcnNpb25UeXBlOiAnbWFqb3InIHwgJ21pbm9yJyA9IGlzTWFqb3IgPyAnbWFqb3InIDogJ21pbm9yJztcblxuICAgICAgY29uc29sZS5sb2coYFtTbmFwc2hvdFNjaGVkdWxlcl0gQ3JlYXRpbmcgJHt2ZXJzaW9uVHlwZX0gc25hcHNob3QgZm9yICR7b2JqZWN0SWR9YCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY3JlYXRlU25hcHNob3QoXG4gICAgICAgIG9iamVjdElkLFxuICAgICAgICB3b3Jrc3BhY2VJZCxcbiAgICAgICAgZG9jU3RhdGUsXG4gICAgICAgIHNuYXBzaG90LFxuICAgICAgICB2ZXJzaW9uVHlwZVxuICAgICAgKTtcblxuICAgICAgLy8g6YeN572u6K6h5pWw5ZKM5pe26Ze0XG4gICAgICB0aGlzLmVkaXRDb3VudHMuc2V0KGtleSwgMCk7XG4gICAgICB0aGlzLmxhc3RTbmFwc2hvdFRpbWVzLnNldChrZXksIG5vdyk7XG4gICAgICB0aGlzLmxhc3RTbmFwc2hvdFNpemVzLnNldChrZXksIGRvY1N0YXRlLmxlbmd0aCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGBbU25hcHNob3RTY2hlZHVsZXJdIFNuYXBzaG90IGNyZWF0ZWQ6YCwge1xuICAgICAgICBzbmFwc2hvdF9pZDogcmVzdWx0LnNuYXBzaG90X2lkLFxuICAgICAgICB2ZXJzaW9uX3R5cGU6IHZlcnNpb25UeXBlLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgdmVyc2lvbl90eXBlOiB2ZXJzaW9uVHlwZSxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuW/q+eFp1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVTbmFwc2hvdChcbiAgICBvYmplY3RJZDogc3RyaW5nLFxuICAgIHdvcmtzcGFjZUlkOiBzdHJpbmcsXG4gICAgZG9jU3RhdGU6IEJ1ZmZlcixcbiAgICBzbmFwc2hvdD86IEJ1ZmZlcixcbiAgICB2ZXJzaW9uVHlwZTogJ21ham9yJyB8ICdtaW5vcicgPSAnbWFqb3InXG4gICk6IFByb21pc2U8eyBzbmFwc2hvdF9pZDogc3RyaW5nOyBjcmVhdGVkX2F0OiBudW1iZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyDkvb/nlKggU25hcHNob3RTZXJ2aWNlIOWIm+W7uuW/q+eFp1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zbmFwc2hvdFNlcnZpY2UuY3JlYXRlU25hcHNob3Qoe1xuICAgICAgICB3b3Jrc3BhY2VJZCxcbiAgICAgICAgb2JqZWN0SWQsXG4gICAgICAgIGRvY1N0YXRlLFxuICAgICAgICBzbmFwc2hvdCxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBhdXRvX3NhdmU6IHZlcnNpb25UeXBlID09PSAnbWFqb3InLFxuICAgICAgICAgIGRvY19zdGF0ZV9sZW5ndGg6IGRvY1N0YXRlLmxlbmd0aCxcbiAgICAgICAgICB2ZXJzaW9uX3R5cGU6IHZlcnNpb25UeXBlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIOWcqOaVsOaNruW6k+S4reiusOW9leW/q+eFp+WFg+aVsOaNrlxuICAgICAgY29uc29sZS5sb2coYFtTbmFwc2hvdFNjaGVkdWxlcl0gU2F2aW5nIHNuYXBzaG90IHRvIGRhdGFiYXNlOmAsIHtcbiAgICAgICAgb2JqZWN0X2lkOiBvYmplY3RJZCxcbiAgICAgICAgd29ya3NwYWNlX2lkOiB3b3Jrc3BhY2VJZCxcbiAgICAgICAgdmVyc2lvbl90eXBlOiB2ZXJzaW9uVHlwZSxcbiAgICAgICAgZG9jX3N0YXRlX2xlbmd0aDogZG9jU3RhdGUubGVuZ3RoLFxuICAgICAgICBzbmFwc2hvdF9sZW5ndGg6IHNuYXBzaG90Py5sZW5ndGggfHwgMCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzbmFwc2hvdFJlY29yZCA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uY3JlYXRlU25hcHNob3Qoe1xuICAgICAgICBvYmplY3RfaWQ6IG9iamVjdElkLFxuICAgICAgICB3b3Jrc3BhY2VfaWQ6IHdvcmtzcGFjZUlkLFxuICAgICAgICBzbmFwc2hvdF9kYXRhOiBzbmFwc2hvdCB8fCBCdWZmZXIuYWxsb2MoMCksIC8vIFNuYXBzaG9077yI54q25oCB5ZCR6YeP77yJXG4gICAgICAgIHNuYXBzaG90X3ZlcnNpb246IDEsXG4gICAgICAgIGRvY19zdGF0ZTogZG9jU3RhdGUsIC8vIERvYyBTdGF0Ze+8iOWujOaVtOeKtuaAge+8iVxuICAgICAgICBkb2Nfc3RhdGVfdmVyc2lvbjogMSxcbiAgICAgICAgdmVyc2lvbl90eXBlOiB2ZXJzaW9uVHlwZSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBzbmFwc2hvdF9pZDogcmVzdWx0LnNuYXBzaG90SWQsXG4gICAgICAgICAgY3JlYXRlZF9hdDogcmVzdWx0LmNyZWF0ZWRBdCxcbiAgICAgICAgICBzdG9yZWRfaW46ICdmaWxlJywgLy8g5a2Y5YKo5Zyo5paH5Lu257O757uf5LitXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc29sZS5sb2coYFtTbmFwc2hvdFNjaGVkdWxlcl0gU25hcHNob3QgcmVjb3JkIHNhdmVkIHRvIGRhdGFiYXNlOmAsIHtcbiAgICAgICAgc25hcHNob3RfaWQ6IHNuYXBzaG90UmVjb3JkLnNuYXBzaG90X2lkLFxuICAgICAgICBvYmplY3RfaWQ6IG9iamVjdElkLFxuICAgICAgICB2ZXJzaW9uX3R5cGU6IHZlcnNpb25UeXBlLFxuICAgICAgICBjcmVhdGVkX2F0OiBzbmFwc2hvdFJlY29yZC5jcmVhdGVkX2F0LFxuICAgICAgICBkYl9jcmVhdGVkX2F0X3R5cGU6IHR5cGVvZiBzbmFwc2hvdFJlY29yZC5jcmVhdGVkX2F0LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNuYXBzaG90X2lkOiBzbmFwc2hvdFJlY29yZC5zbmFwc2hvdF9pZCxcbiAgICAgICAgY3JlYXRlZF9hdDogcmVzdWx0LmNyZWF0ZWRBdCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgc25hcHNob3QgZm9yIGRvY3VtZW50ICR7b2JqZWN0SWR9OmAsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmiYvliqjop6blj5Hlv6vnhafliJvlu7rvvIjnlKjkuo7miYvliqjkv53lrZjvvIlcbiAgICog5Lya5qC55o2u562W55Wl5Yik5pat5Yib5bu65aSn54mI5pys6L+Y5piv5bCP54mI5pysXG4gICAqIEBwYXJhbSBmb3JjZU1ham9yVmVyc2lvbiDmmK/lkKblvLrliLbliJvlu7rlpKfniYjmnKzvvIjnlKjkuo7liJ3lp4vlv6vnhafnrYnlnLrmma/vvIlcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVNuYXBzaG90TWFudWFsbHkoXG4gICAgb2JqZWN0SWQ6IHN0cmluZyxcbiAgICB3b3Jrc3BhY2VJZDogc3RyaW5nLFxuICAgIGRvY1N0YXRlOiBCdWZmZXIsXG4gICAgc25hcHNob3Q/OiBCdWZmZXIsXG4gICAgZm9yY2VNYWpvclZlcnNpb246IGJvb2xlYW4gPSBmYWxzZVxuICApOiBQcm9taXNlPHsgc25hcHNob3RfaWQ6IHN0cmluZzsgY3JlYXRlZF9hdDogbnVtYmVyOyB2ZXJzaW9uX3R5cGU6ICdtYWpvcicgfCAnbWlub3InIH0+IHtcbiAgICBjb25zdCBrZXkgPSBvYmplY3RJZDtcbiAgICBjb25zdCBlZGl0Q291bnQgPSB0aGlzLmVkaXRDb3VudHMuZ2V0KGtleSkgfHwgMDtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG4gICAgbGV0IGxhc3RTbmFwc2hvdFRpbWUgPSB0aGlzLmxhc3RTbmFwc2hvdFRpbWVzLmdldChrZXkpO1xuICAgIGxldCBsYXN0U25hcHNob3RTaXplID0gdGhpcy5sYXN0U25hcHNob3RTaXplcy5nZXQoa2V5KTtcblxuICAgIC8vIOWmguaenOWGheWtmOS4reayoeacieiusOW9le+8jOS7juaVsOaNruW6k+afpeivolxuICAgIGlmICghbGFzdFNuYXBzaG90VGltZSB8fCBsYXN0U25hcHNob3RTaXplID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGxhdGVzdFNuYXBzaG90ID0gYXdhaXQgdGhpcy5kb2N1bWVudERBTy5nZXRMYXRlc3RTbmFwc2hvdChvYmplY3RJZCk7XG4gICAgICAgIGlmIChsYXRlc3RTbmFwc2hvdCkge1xuICAgICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSBsYXRlc3RTbmFwc2hvdC5jcmVhdGVkX2F0O1xuICAgICAgICAgIGxhc3RTbmFwc2hvdFNpemUgPSBsYXRlc3RTbmFwc2hvdC5kb2Nfc3RhdGU/Lmxlbmd0aCB8fCAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOWmguaenOayoeacieW/q+eFp++8jOWwneivleS9v+eUqOaWh+aho+eahOWIm+W7uuaXtumXtOS9nOS4uuWfuuWHhlxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHRoaXMuZG9jdW1lbnREQU8uZmluZEJ5SWQob2JqZWN0SWQpO1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50ICYmIGRvY3VtZW50LmNyZWF0ZWRfYXQpIHtcbiAgICAgICAgICAgICAgY29uc3QgZG9jQ3JlYXRlZEF0ID1cbiAgICAgICAgICAgICAgICB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlZF9hdCA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgICAgID8gbmV3IERhdGUoZG9jdW1lbnQuY3JlYXRlZF9hdCkuZ2V0VGltZSgpXG4gICAgICAgICAgICAgICAgICA6IGRvY3VtZW50LmNyZWF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlXG4gICAgICAgICAgICAgICAgICA/IGRvY3VtZW50LmNyZWF0ZWRfYXQuZ2V0VGltZSgpXG4gICAgICAgICAgICAgICAgICA6IGRvY3VtZW50LmNyZWF0ZWRfYXQ7XG4gICAgICAgICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSBkb2NDcmVhdGVkQXQ7XG4gICAgICAgICAgICAgIGxhc3RTbmFwc2hvdFNpemUgPSBkb2N1bWVudC5jb250ZW50X2xlbmd0aCB8fCAwO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICBgW1NuYXBzaG90U2NoZWR1bGVyXSBObyBzbmFwc2hvdCBmb3VuZCwgdXNpbmcgZG9jdW1lbnQgY3JlYXRlZF9hdDogJHtsYXN0U25hcHNob3RUaW1lfWBcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSAwO1xuICAgICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChkb2NFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGdldCBkb2N1bWVudCBmb3IgJHtvYmplY3RJZH06YCwgZG9jRXJyb3IpO1xuICAgICAgICAgICAgbGFzdFNuYXBzaG90VGltZSA9IDA7XG4gICAgICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBnZXQgbGF0ZXN0IHNuYXBzaG90IGZvciAke29iamVjdElkfTpgLCBlcnJvcik7XG4gICAgICAgIGxhc3RTbmFwc2hvdFRpbWUgPSAwO1xuICAgICAgICBsYXN0U25hcHNob3RTaXplID0gMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCB0aW1lU2luY2VMYXN0U25hcHNob3QgPSBub3cgLSAobGFzdFNuYXBzaG90VGltZSB8fCAwKTtcblxuICAgIC8vIOWIpOaWreeJiOacrOexu+Wei1xuICAgIGxldCB2ZXJzaW9uVHlwZTogJ21ham9yJyB8ICdtaW5vcic7XG5cbiAgICBpZiAoZm9yY2VNYWpvclZlcnNpb24pIHtcbiAgICAgIC8vIOW8uuWItuWIm+W7uuWkp+eJiOacrO+8iOeUqOS6juWIneWni+W/q+eFp+etieWcuuaZr++8iVxuICAgICAgdmVyc2lvblR5cGUgPSAnbWFqb3InO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyDkvb/nlKjnrZbnlaXliKTmlq3niYjmnKznsbvlnotcbiAgICAgIGNvbnN0IGNvbnRleHQ6IFNuYXBzaG90VmVyc2lvbkNvbnRleHQgPSB7XG4gICAgICAgIG9iamVjdElkLFxuICAgICAgICB3b3Jrc3BhY2VJZCxcbiAgICAgICAgY3VycmVudERvY1N0YXRlOiBkb2NTdGF0ZSxcbiAgICAgICAgY3VycmVudFRpbWU6IG5vdyxcbiAgICAgICAgZWRpdENvdW50LFxuICAgICAgICB0aW1lU2luY2VMYXN0U25hcHNob3QsXG4gICAgICAgIGxhc3RTbmFwc2hvdERvY1N0YXRlU2l6ZTogbGFzdFNuYXBzaG90U2l6ZSxcbiAgICAgICAgbGFzdFNuYXBzaG90VGltZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGlzTWFqb3IgPSBhd2FpdCB0aGlzLnZlcnNpb25TdHJhdGVneS5zaG91bGRDcmVhdGVNYWpvclZlcnNpb24oY29udGV4dCk7XG4gICAgICB2ZXJzaW9uVHlwZSA9IGlzTWFqb3IgPyAnbWFqb3InIDogJ21pbm9yJztcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNyZWF0ZVNuYXBzaG90KFxuICAgICAgb2JqZWN0SWQsXG4gICAgICB3b3Jrc3BhY2VJZCxcbiAgICAgIGRvY1N0YXRlLFxuICAgICAgc25hcHNob3QsXG4gICAgICB2ZXJzaW9uVHlwZVxuICAgICk7XG5cbiAgICAvLyDph43nva7orqHmlbDlkozml7bpl7RcbiAgICB0aGlzLmVkaXRDb3VudHMuc2V0KGtleSwgMCk7XG4gICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5zZXQoa2V5LCBub3cpO1xuICAgIHRoaXMubGFzdFNuYXBzaG90U2l6ZXMuc2V0KGtleSwgZG9jU3RhdGUubGVuZ3RoKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5yZXN1bHQsXG4gICAgICB2ZXJzaW9uX3R5cGU6IHZlcnNpb25UeXBlLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog6YeN572u5paH5qGj55qE57yW6L6R6K6h5pWw77yI55So5LqO5paH5qGj5YWz6Zet562J5Zy65pmv77yJXG4gICAqL1xuICByZXNldChvYmplY3RJZDogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5lZGl0Q291bnRzLmRlbGV0ZShvYmplY3RJZCk7XG4gICAgdGhpcy5sYXN0U25hcHNob3RUaW1lcy5kZWxldGUob2JqZWN0SWQpO1xuICAgIHRoaXMubGFzdFNuYXBzaG90U2l6ZXMuZGVsZXRlKG9iamVjdElkKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImluamVjdGFibGUiLCJpbmplY3QiLCJEb2N1bWVudERBTyIsIlNuYXBzaG90U2VydmljZSIsIlRpbWVJbnRlcnZhbFN0cmF0ZWd5IiwiY29uc3RydWN0b3IiLCJ0aW1lVGhyZXNob2xkTXMiLCJ0aW1lVGhyZXNob2xkIiwic2hvdWxkQ3JlYXRlTWFqb3JWZXJzaW9uIiwiY29udGV4dCIsInRpbWVTaW5jZUxhc3RTbmFwc2hvdCIsIkNvbnRlbnRDaGFuZ2VTdHJhdGVneSIsImNoYW5nZVRocmVzaG9sZEJ5dGVzIiwiY2hhbmdlVGhyZXNob2xkIiwibGFzdFNuYXBzaG90RG9jU3RhdGVTaXplIiwiY3VycmVudFNpemUiLCJjdXJyZW50RG9jU3RhdGUiLCJsZW5ndGgiLCJzaXplQ2hhbmdlIiwiTWF0aCIsImFicyIsIkVkaXRGcmVxdWVuY3lTdHJhdGVneSIsImVkaXRUaHJlc2hvbGQiLCJlZGl0Q291bnQiLCJDb21wb3NpdGVPclN0cmF0ZWd5Iiwic3RyYXRlZ2llcyIsInN0cmF0ZWd5IiwicmVzdWx0IiwiU25hcHNob3RTY2hlZHVsZXIiLCJkb2N1bWVudERBTyIsInNuYXBzaG90U2VydmljZSIsImVkaXRDb3VudHMiLCJNYXAiLCJsYXN0U25hcHNob3RUaW1lcyIsImxhc3RTbmFwc2hvdFNpemVzIiwiRURJVFNfVEhSRVNIT0xEIiwicGFyc2VJbnQiLCJwcm9jZXNzIiwiZW52IiwiU05BUFNIT1RfRURJVFNfVEhSRVNIT0xEIiwiVElNRV9USFJFU0hPTEQiLCJTTkFQU0hPVF9USU1FX1RIUkVTSE9MRCIsInRpbWVTdHJhdGVneSIsImNvbnRlbnRTdHJhdGVneSIsIlNOQVBTSE9UX0NPTlRFTlRfQ0hBTkdFX1RIUkVTSE9MRCIsImZyZXF1ZW5jeVN0cmF0ZWd5IiwiU05BUFNIT1RfRURJVF9GUkVRVUVOQ1lfVEhSRVNIT0xEIiwidmVyc2lvblN0cmF0ZWd5IiwicmVjb3JkRWRpdCIsIm9iamVjdElkIiwid29ya3NwYWNlSWQiLCJkb2NTdGF0ZSIsInNuYXBzaG90Iiwia2V5IiwiZ2V0Iiwic2V0Iiwibm93IiwiRGF0ZSIsImxhc3RTbmFwc2hvdFRpbWUiLCJsYXN0U25hcHNob3RTaXplIiwidW5kZWZpbmVkIiwibGF0ZXN0U25hcHNob3QiLCJnZXRMYXRlc3RTbmFwc2hvdCIsImNyZWF0ZWRfYXQiLCJkb2Nfc3RhdGUiLCJkb2N1bWVudCIsImZpbmRCeUlkIiwiZG9jQ3JlYXRlZEF0IiwiZ2V0VGltZSIsImNvbnRlbnRfbGVuZ3RoIiwiY29uc29sZSIsImxvZyIsImRvY0Vycm9yIiwiZXJyb3IiLCJzaG91bGRDcmVhdGVTbmFwc2hvdCIsInRpbWVTaW5jZUxhc3RTbmFwc2hvdE1pbnV0ZXMiLCJyb3VuZCIsImN1cnJlbnRUaW1lIiwiaXNNYWpvciIsInZlcnNpb25UeXBlIiwiY3JlYXRlU25hcHNob3QiLCJzbmFwc2hvdF9pZCIsInZlcnNpb25fdHlwZSIsIm1ldGFkYXRhIiwiYXV0b19zYXZlIiwiZG9jX3N0YXRlX2xlbmd0aCIsIm9iamVjdF9pZCIsIndvcmtzcGFjZV9pZCIsInNuYXBzaG90X2xlbmd0aCIsInNuYXBzaG90UmVjb3JkIiwic25hcHNob3RfZGF0YSIsIkJ1ZmZlciIsImFsbG9jIiwic25hcHNob3RfdmVyc2lvbiIsImRvY19zdGF0ZV92ZXJzaW9uIiwic25hcHNob3RJZCIsImNyZWF0ZWRBdCIsInN0b3JlZF9pbiIsImRiX2NyZWF0ZWRfYXRfdHlwZSIsImNyZWF0ZVNuYXBzaG90TWFudWFsbHkiLCJmb3JjZU1ham9yVmVyc2lvbiIsInJlc2V0IiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/services/snapshot-scheduler.service.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/snapshot.service.ts":
/*!******************************************!*\
  !*** ./src/services/snapshot.service.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SnapshotService: () => (/* binding */ SnapshotService)\n/* harmony export */ });\n/* harmony import */ var _core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/storage/storage.factory */ \"(rsc)/./src/core/storage/storage.factory.ts\");\n/* harmony import */ var zlib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zlib */ \"zlib\");\n/* harmony import */ var zlib__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(zlib__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! util */ \"util\");\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nconst gzip = (0,util__WEBPACK_IMPORTED_MODULE_2__.promisify)(zlib__WEBPACK_IMPORTED_MODULE_1__.gzip);\nconst gunzip = (0,util__WEBPACK_IMPORTED_MODULE_2__.promisify)(zlib__WEBPACK_IMPORTED_MODULE_1__.gunzip);\n/**\n * 快照服务\n * 负责创建、存储和管理文档快照\n */ class SnapshotService {\n    constructor(){\n        this.SNAPSHOT_LIMIT = parseInt(process.env.SNAPSHOT_LIMIT || \"100\", 10);\n        this.storage = _core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.StorageFactory.getInstance();\n    }\n    /**\n   * 创建并存储快照\n   * @param params 快照参数\n   * @returns 快照元数据（包含 snapshot_id 和 created_at）\n   */ async createSnapshot(params) {\n        const timestamp = Date.now();\n        const snapshotId = timestamp; // 使用时间戳作为 snapshot_id\n        // 压缩 doc_state（使用 gzip，后续可以切换到 zstd）\n        const compressed = await gzip(params.docState);\n        // 生成存储键\n        const key = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotKey)(params.workspaceId, params.objectId, timestamp);\n        // 存储到文件系统\n        await this.storage.put(key, compressed, {\n            snapshot_id: snapshotId,\n            object_id: params.objectId,\n            workspace_id: params.workspaceId,\n            doc_state_length: params.docState.length,\n            compressed_length: compressed.length,\n            snapshot_length: params.snapshot?.length || 0,\n            ...params.metadata\n        });\n        // 清理旧快照（如果超过限制）\n        await this.cleanupOldSnapshots(params.workspaceId, params.objectId);\n        return {\n            snapshotId,\n            createdAt: timestamp\n        };\n    }\n    /**\n   * 获取快照数据\n   */ async getSnapshot(workspaceId, objectId, snapshotId) {\n        // 从数据库查询快照元数据，获取时间戳\n        // 这里简化处理，直接使用 snapshotId 作为时间戳\n        const timestamp = snapshotId;\n        const key = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotKey)(workspaceId, objectId, timestamp);\n        const compressed = await this.storage.get(key);\n        if (!compressed) {\n            return null;\n        }\n        // 解压缩\n        const docState = await gunzip(compressed);\n        return docState;\n    }\n    /**\n   * 获取快照列表\n   */ async listSnapshots(workspaceId, objectId, limit) {\n        const prefix = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotPrefix)(workspaceId, objectId);\n        const keys = await this.storage.list(prefix, limit);\n        return keys.map((key)=>{\n            const timestamp = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.extractTimestampFromKey)(key);\n            if (!timestamp) return null;\n            return {\n                snapshotId: timestamp,\n                createdAt: timestamp,\n                key\n            };\n        }).filter((item)=>item !== null).sort((a, b)=>b.createdAt - a.createdAt); // 按时间降序\n    }\n    /**\n   * 删除快照\n   */ async deleteSnapshot(workspaceId, objectId, snapshotId) {\n        const timestamp = snapshotId;\n        const key = (0,_core_storage_storage_factory__WEBPACK_IMPORTED_MODULE_0__.getSnapshotKey)(workspaceId, objectId, timestamp);\n        await this.storage.delete(key);\n    }\n    /**\n   * 清理旧快照（保留最新的 N 个）\n   */ async cleanupOldSnapshots(workspaceId, objectId) {\n        const snapshots = await this.listSnapshots(workspaceId, objectId);\n        if (snapshots.length > this.SNAPSHOT_LIMIT) {\n            const toDelete = snapshots.slice(this.SNAPSHOT_LIMIT);\n            const keysToDelete = toDelete.map((s)=>s.key);\n            await this.storage.deleteMany(keysToDelete);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvc25hcHNob3Quc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFLeUM7QUFFWjtBQUNJO0FBRWpDLE1BQU1NLE9BQU9ELCtDQUFTQSxDQUFDRCxzQ0FBUztBQUNoQyxNQUFNRyxTQUFTRiwrQ0FBU0EsQ0FBQ0Qsd0NBQVc7QUFFcEM7OztDQUdDLEdBQ00sTUFBTUk7SUFJWEMsYUFBYzthQUZHQyxpQkFBaUJDLFNBQVNDLFFBQVFDLEdBQUcsQ0FBQ0gsY0FBYyxJQUFJLE9BQU87UUFHOUUsSUFBSSxDQUFDSSxPQUFPLEdBQUdkLHlFQUFjQSxDQUFDZSxXQUFXO0lBQzNDO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1DLGVBQWVDLE1BTXBCLEVBQXNEO1FBQ3JELE1BQU1DLFlBQVlDLEtBQUtDLEdBQUc7UUFDMUIsTUFBTUMsYUFBYUgsV0FBVyxzQkFBc0I7UUFFcEQscUNBQXFDO1FBQ3JDLE1BQU1JLGFBQWEsTUFBTWhCLEtBQUtXLE9BQU9NLFFBQVE7UUFFN0MsUUFBUTtRQUNSLE1BQU1DLE1BQU12Qiw2RUFBY0EsQ0FBQ2dCLE9BQU9RLFdBQVcsRUFBRVIsT0FBT1MsUUFBUSxFQUFFUjtRQUVoRSxVQUFVO1FBQ1YsTUFBTSxJQUFJLENBQUNKLE9BQU8sQ0FBQ2EsR0FBRyxDQUFDSCxLQUFLRixZQUFZO1lBQ3RDTSxhQUFhUDtZQUNiUSxXQUFXWixPQUFPUyxRQUFRO1lBQzFCSSxjQUFjYixPQUFPUSxXQUFXO1lBQ2hDTSxrQkFBa0JkLE9BQU9NLFFBQVEsQ0FBQ1MsTUFBTTtZQUN4Q0MsbUJBQW1CWCxXQUFXVSxNQUFNO1lBQ3BDRSxpQkFBaUJqQixPQUFPa0IsUUFBUSxFQUFFSCxVQUFVO1lBQzVDLEdBQUdmLE9BQU9tQixRQUFRO1FBQ3BCO1FBRUEsZ0JBQWdCO1FBQ2hCLE1BQU0sSUFBSSxDQUFDQyxtQkFBbUIsQ0FBQ3BCLE9BQU9RLFdBQVcsRUFBRVIsT0FBT1MsUUFBUTtRQUVsRSxPQUFPO1lBQ0xMO1lBQ0FpQixXQUFXcEI7UUFDYjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFNcUIsWUFDSmQsV0FBbUIsRUFDbkJDLFFBQWdCLEVBQ2hCTCxVQUFrQixFQUNNO1FBQ3hCLG9CQUFvQjtRQUNwQiwrQkFBK0I7UUFDL0IsTUFBTUgsWUFBWUc7UUFDbEIsTUFBTUcsTUFBTXZCLDZFQUFjQSxDQUFDd0IsYUFBYUMsVUFBVVI7UUFFbEQsTUFBTUksYUFBYSxNQUFNLElBQUksQ0FBQ1IsT0FBTyxDQUFDMEIsR0FBRyxDQUFDaEI7UUFDMUMsSUFBSSxDQUFDRixZQUFZO1lBQ2YsT0FBTztRQUNUO1FBRUEsTUFBTTtRQUNOLE1BQU1DLFdBQVcsTUFBTWhCLE9BQU9lO1FBQzlCLE9BQU9DO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE1BQU1rQixjQUNKaEIsV0FBbUIsRUFDbkJDLFFBQWdCLEVBQ2hCZ0IsS0FBYyxFQUMwRDtRQUN4RSxNQUFNQyxTQUFTekMsZ0ZBQWlCQSxDQUFDdUIsYUFBYUM7UUFDOUMsTUFBTWtCLE9BQU8sTUFBTSxJQUFJLENBQUM5QixPQUFPLENBQUMrQixJQUFJLENBQUNGLFFBQVFEO1FBRTdDLE9BQU9FLEtBQ0pFLEdBQUcsQ0FBQyxDQUFDdEI7WUFDSixNQUFNTixZQUFZZixzRkFBdUJBLENBQUNxQjtZQUMxQyxJQUFJLENBQUNOLFdBQVcsT0FBTztZQUV2QixPQUFPO2dCQUNMRyxZQUFZSDtnQkFDWm9CLFdBQVdwQjtnQkFDWE07WUFDRjtRQUNGLEdBQ0N1QixNQUFNLENBQUMsQ0FBQ0MsT0FBMkNBLFNBQVMsTUFDNURDLElBQUksQ0FBQyxDQUFDQyxHQUFHQyxJQUFNQSxFQUFFYixTQUFTLEdBQUdZLEVBQUVaLFNBQVMsR0FBRyxRQUFRO0lBQ3hEO0lBRUE7O0dBRUMsR0FDRCxNQUFNYyxlQUFlM0IsV0FBbUIsRUFBRUMsUUFBZ0IsRUFBRUwsVUFBa0IsRUFBaUI7UUFDN0YsTUFBTUgsWUFBWUc7UUFDbEIsTUFBTUcsTUFBTXZCLDZFQUFjQSxDQUFDd0IsYUFBYUMsVUFBVVI7UUFDbEQsTUFBTSxJQUFJLENBQUNKLE9BQU8sQ0FBQ3VDLE1BQU0sQ0FBQzdCO0lBQzVCO0lBRUE7O0dBRUMsR0FDRCxNQUFjYSxvQkFBb0JaLFdBQW1CLEVBQUVDLFFBQWdCLEVBQWlCO1FBQ3RGLE1BQU00QixZQUFZLE1BQU0sSUFBSSxDQUFDYixhQUFhLENBQUNoQixhQUFhQztRQUV4RCxJQUFJNEIsVUFBVXRCLE1BQU0sR0FBRyxJQUFJLENBQUN0QixjQUFjLEVBQUU7WUFDMUMsTUFBTTZDLFdBQVdELFVBQVVFLEtBQUssQ0FBQyxJQUFJLENBQUM5QyxjQUFjO1lBQ3BELE1BQU0rQyxlQUFlRixTQUFTVCxHQUFHLENBQUMsQ0FBQ1ksSUFBTUEsRUFBRWxDLEdBQUc7WUFDOUMsTUFBTSxJQUFJLENBQUNWLE9BQU8sQ0FBQzZDLFVBQVUsQ0FBQ0Y7UUFDaEM7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdsb2JhbGxpbmsvc2VydmVyLy4vc3JjL3NlcnZpY2VzL3NuYXBzaG90LnNlcnZpY2UudHM/YWViMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBTdG9yYWdlRmFjdG9yeSxcbiAgZ2V0U25hcHNob3RLZXksXG4gIGdldFNuYXBzaG90UHJlZml4LFxuICBleHRyYWN0VGltZXN0YW1wRnJvbUtleSxcbn0gZnJvbSAnLi4vY29yZS9zdG9yYWdlL3N0b3JhZ2UuZmFjdG9yeSc7XG5pbXBvcnQgeyBTdG9yYWdlQWRhcHRlciB9IGZyb20gJy4uL2NvcmUvc3RvcmFnZS9zdG9yYWdlLmludGVyZmFjZSc7XG5pbXBvcnQgKiBhcyB6bGliIGZyb20gJ3psaWInO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSAndXRpbCc7XG5cbmNvbnN0IGd6aXAgPSBwcm9taXNpZnkoemxpYi5nemlwKTtcbmNvbnN0IGd1bnppcCA9IHByb21pc2lmeSh6bGliLmd1bnppcCk7XG5cbi8qKlxuICog5b+r54Wn5pyN5YqhXG4gKiDotJ/otKPliJvlu7rjgIHlrZjlgqjlkoznrqHnkIbmlofmoaPlv6vnhadcbiAqL1xuZXhwb3J0IGNsYXNzIFNuYXBzaG90U2VydmljZSB7XG4gIHByaXZhdGUgc3RvcmFnZTogU3RvcmFnZUFkYXB0ZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgU05BUFNIT1RfTElNSVQgPSBwYXJzZUludChwcm9jZXNzLmVudi5TTkFQU0hPVF9MSU1JVCB8fCAnMTAwJywgMTApO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc3RvcmFnZSA9IFN0b3JhZ2VGYWN0b3J5LmdldEluc3RhbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65bm25a2Y5YKo5b+r54WnXG4gICAqIEBwYXJhbSBwYXJhbXMg5b+r54Wn5Y+C5pWwXG4gICAqIEByZXR1cm5zIOW/q+eFp+WFg+aVsOaNru+8iOWMheWQqyBzbmFwc2hvdF9pZCDlkowgY3JlYXRlZF9hdO+8iVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlU25hcHNob3QocGFyYW1zOiB7XG4gICAgd29ya3NwYWNlSWQ6IHN0cmluZztcbiAgICBvYmplY3RJZDogc3RyaW5nO1xuICAgIGRvY1N0YXRlOiBCdWZmZXI7IC8vIOWujOaVtOaWh+aho+eKtuaAge+8iFkuZW5jb2RlU3RhdGVBc1VwZGF0Ze+8iVxuICAgIHNuYXBzaG90PzogQnVmZmVyOyAvLyBZanMgU25hcHNob3TvvIjnirbmgIHlkJHph4/vvInvvIzlj6/pgIlcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH0pOiBQcm9taXNlPHsgc25hcHNob3RJZDogbnVtYmVyOyBjcmVhdGVkQXQ6IG51bWJlciB9PiB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCBzbmFwc2hvdElkID0gdGltZXN0YW1wOyAvLyDkvb/nlKjml7bpl7TmiLPkvZzkuLogc25hcHNob3RfaWRcblxuICAgIC8vIOWOi+e8qSBkb2Nfc3RhdGXvvIjkvb/nlKggZ3ppcO+8jOWQjue7reWPr+S7peWIh+aNouWIsCB6c3Rk77yJXG4gICAgY29uc3QgY29tcHJlc3NlZCA9IGF3YWl0IGd6aXAocGFyYW1zLmRvY1N0YXRlKTtcblxuICAgIC8vIOeUn+aIkOWtmOWCqOmUrlxuICAgIGNvbnN0IGtleSA9IGdldFNuYXBzaG90S2V5KHBhcmFtcy53b3Jrc3BhY2VJZCwgcGFyYW1zLm9iamVjdElkLCB0aW1lc3RhbXApO1xuXG4gICAgLy8g5a2Y5YKo5Yiw5paH5Lu257O757ufXG4gICAgYXdhaXQgdGhpcy5zdG9yYWdlLnB1dChrZXksIGNvbXByZXNzZWQsIHtcbiAgICAgIHNuYXBzaG90X2lkOiBzbmFwc2hvdElkLFxuICAgICAgb2JqZWN0X2lkOiBwYXJhbXMub2JqZWN0SWQsXG4gICAgICB3b3Jrc3BhY2VfaWQ6IHBhcmFtcy53b3Jrc3BhY2VJZCxcbiAgICAgIGRvY19zdGF0ZV9sZW5ndGg6IHBhcmFtcy5kb2NTdGF0ZS5sZW5ndGgsXG4gICAgICBjb21wcmVzc2VkX2xlbmd0aDogY29tcHJlc3NlZC5sZW5ndGgsXG4gICAgICBzbmFwc2hvdF9sZW5ndGg6IHBhcmFtcy5zbmFwc2hvdD8ubGVuZ3RoIHx8IDAsXG4gICAgICAuLi5wYXJhbXMubWV0YWRhdGEsXG4gICAgfSk7XG5cbiAgICAvLyDmuIXnkIbml6flv6vnhafvvIjlpoLmnpzotoXov4fpmZDliLbvvIlcbiAgICBhd2FpdCB0aGlzLmNsZWFudXBPbGRTbmFwc2hvdHMocGFyYW1zLndvcmtzcGFjZUlkLCBwYXJhbXMub2JqZWN0SWQpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHNuYXBzaG90SWQsXG4gICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluW/q+eFp+aVsOaNrlxuICAgKi9cbiAgYXN5bmMgZ2V0U25hcHNob3QoXG4gICAgd29ya3NwYWNlSWQ6IHN0cmluZyxcbiAgICBvYmplY3RJZDogc3RyaW5nLFxuICAgIHNuYXBzaG90SWQ6IG51bWJlclxuICApOiBQcm9taXNlPEJ1ZmZlciB8IG51bGw+IHtcbiAgICAvLyDku47mlbDmja7lupPmn6Xor6Llv6vnhaflhYPmlbDmja7vvIzojrflj5bml7bpl7TmiLNcbiAgICAvLyDov5nph4znroDljJblpITnkIbvvIznm7TmjqXkvb/nlKggc25hcHNob3RJZCDkvZzkuLrml7bpl7TmiLNcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBzbmFwc2hvdElkO1xuICAgIGNvbnN0IGtleSA9IGdldFNuYXBzaG90S2V5KHdvcmtzcGFjZUlkLCBvYmplY3RJZCwgdGltZXN0YW1wKTtcblxuICAgIGNvbnN0IGNvbXByZXNzZWQgPSBhd2FpdCB0aGlzLnN0b3JhZ2UuZ2V0KGtleSk7XG4gICAgaWYgKCFjb21wcmVzc2VkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyDop6PljovnvKlcbiAgICBjb25zdCBkb2NTdGF0ZSA9IGF3YWl0IGd1bnppcChjb21wcmVzc2VkKTtcbiAgICByZXR1cm4gZG9jU3RhdGU7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5b+r54Wn5YiX6KGoXG4gICAqL1xuICBhc3luYyBsaXN0U25hcHNob3RzKFxuICAgIHdvcmtzcGFjZUlkOiBzdHJpbmcsXG4gICAgb2JqZWN0SWQ6IHN0cmluZyxcbiAgICBsaW1pdD86IG51bWJlclxuICApOiBQcm9taXNlPEFycmF5PHsgc25hcHNob3RJZDogbnVtYmVyOyBjcmVhdGVkQXQ6IG51bWJlcjsga2V5OiBzdHJpbmcgfT4+IHtcbiAgICBjb25zdCBwcmVmaXggPSBnZXRTbmFwc2hvdFByZWZpeCh3b3Jrc3BhY2VJZCwgb2JqZWN0SWQpO1xuICAgIGNvbnN0IGtleXMgPSBhd2FpdCB0aGlzLnN0b3JhZ2UubGlzdChwcmVmaXgsIGxpbWl0KTtcblxuICAgIHJldHVybiBrZXlzXG4gICAgICAubWFwKChrZXkpID0+IHtcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gZXh0cmFjdFRpbWVzdGFtcEZyb21LZXkoa2V5KTtcbiAgICAgICAgaWYgKCF0aW1lc3RhbXApIHJldHVybiBudWxsO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc25hcHNob3RJZDogdGltZXN0YW1wLFxuICAgICAgICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wLFxuICAgICAgICAgIGtleSxcbiAgICAgICAgfTtcbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKChpdGVtKTogaXRlbSBpcyBOb25OdWxsYWJsZTx0eXBlb2YgaXRlbT4gPT4gaXRlbSAhPT0gbnVsbClcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmNyZWF0ZWRBdCAtIGEuY3JlYXRlZEF0KTsgLy8g5oyJ5pe26Ze06ZmN5bqPXG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5b+r54WnXG4gICAqL1xuICBhc3luYyBkZWxldGVTbmFwc2hvdCh3b3Jrc3BhY2VJZDogc3RyaW5nLCBvYmplY3RJZDogc3RyaW5nLCBzbmFwc2hvdElkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBzbmFwc2hvdElkO1xuICAgIGNvbnN0IGtleSA9IGdldFNuYXBzaG90S2V5KHdvcmtzcGFjZUlkLCBvYmplY3RJZCwgdGltZXN0YW1wKTtcbiAgICBhd2FpdCB0aGlzLnN0b3JhZ2UuZGVsZXRlKGtleSk7XG4gIH1cblxuICAvKipcbiAgICog5riF55CG5pen5b+r54Wn77yI5L+d55WZ5pyA5paw55qEIE4g5Liq77yJXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNsZWFudXBPbGRTbmFwc2hvdHMod29ya3NwYWNlSWQ6IHN0cmluZywgb2JqZWN0SWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHNuYXBzaG90cyA9IGF3YWl0IHRoaXMubGlzdFNuYXBzaG90cyh3b3Jrc3BhY2VJZCwgb2JqZWN0SWQpO1xuXG4gICAgaWYgKHNuYXBzaG90cy5sZW5ndGggPiB0aGlzLlNOQVBTSE9UX0xJTUlUKSB7XG4gICAgICBjb25zdCB0b0RlbGV0ZSA9IHNuYXBzaG90cy5zbGljZSh0aGlzLlNOQVBTSE9UX0xJTUlUKTtcbiAgICAgIGNvbnN0IGtleXNUb0RlbGV0ZSA9IHRvRGVsZXRlLm1hcCgocykgPT4gcy5rZXkpO1xuICAgICAgYXdhaXQgdGhpcy5zdG9yYWdlLmRlbGV0ZU1hbnkoa2V5c1RvRGVsZXRlKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJTdG9yYWdlRmFjdG9yeSIsImdldFNuYXBzaG90S2V5IiwiZ2V0U25hcHNob3RQcmVmaXgiLCJleHRyYWN0VGltZXN0YW1wRnJvbUtleSIsInpsaWIiLCJwcm9taXNpZnkiLCJnemlwIiwiZ3VuemlwIiwiU25hcHNob3RTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJTTkFQU0hPVF9MSU1JVCIsInBhcnNlSW50IiwicHJvY2VzcyIsImVudiIsInN0b3JhZ2UiLCJnZXRJbnN0YW5jZSIsImNyZWF0ZVNuYXBzaG90IiwicGFyYW1zIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsInNuYXBzaG90SWQiLCJjb21wcmVzc2VkIiwiZG9jU3RhdGUiLCJrZXkiLCJ3b3Jrc3BhY2VJZCIsIm9iamVjdElkIiwicHV0Iiwic25hcHNob3RfaWQiLCJvYmplY3RfaWQiLCJ3b3Jrc3BhY2VfaWQiLCJkb2Nfc3RhdGVfbGVuZ3RoIiwibGVuZ3RoIiwiY29tcHJlc3NlZF9sZW5ndGgiLCJzbmFwc2hvdF9sZW5ndGgiLCJzbmFwc2hvdCIsIm1ldGFkYXRhIiwiY2xlYW51cE9sZFNuYXBzaG90cyIsImNyZWF0ZWRBdCIsImdldFNuYXBzaG90IiwiZ2V0IiwibGlzdFNuYXBzaG90cyIsImxpbWl0IiwicHJlZml4Iiwia2V5cyIsImxpc3QiLCJtYXAiLCJmaWx0ZXIiLCJpdGVtIiwic29ydCIsImEiLCJiIiwiZGVsZXRlU25hcHNob3QiLCJkZWxldGUiLCJzbmFwc2hvdHMiLCJ0b0RlbGV0ZSIsInNsaWNlIiwia2V5c1RvRGVsZXRlIiwicyIsImRlbGV0ZU1hbnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/snapshot.service.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@redis","vendor-chunks/yjs","vendor-chunks/next","vendor-chunks/zod","vendor-chunks/lib0","vendor-chunks/semver","vendor-chunks/reflect-metadata","vendor-chunks/bcryptjs","vendor-chunks/tsyringe","vendor-chunks/generic-pool","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/tslib","vendor-chunks/jws","vendor-chunks/lodash.once","vendor-chunks/jwa","vendor-chunks/cluster-key-slot","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/uuid","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/redis","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute&page=%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkspace%2F%5Bworkspace_id%5D%2Fdocuments%2F%5Bobject_id%5D%2Froute.ts&appDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkp%2FDocuments%2Fai-works%2Fpikun-editor-monorepo%2Fapps%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();