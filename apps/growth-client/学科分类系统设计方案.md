# 学科分类系统设计方案

## 一、设计理念

学科分类系统用于管理所有学科及其分类，支持树形分类结构，并与能力模型关联。每个学科可以关联多个能力项，并指定所需的能力等级要求。

## 二、核心设计思路

### 2.1 树形分类结构

- **学科分类（Subject Category）**：支持多层级树形结构
- **层级管理**：通过 `parent_id` 实现父子关系
- **路径管理**：通过 `path` 字段（如：`/1/2/3`）便于查询所有子分类
- **层级标识**：通过 `level` 字段标识分类层级

### 2.2 学科与能力关联

- **多能力关联**：一个学科可以关联多个能力项
- **等级要求**：每个关联可以指定 `required_level`（必需等级）和 `recommended_level`（推荐等级）
- **重要性权重**：通过 `importance_weight` 标识能力在该学科中的重要性
- **主要能力标识**：通过 `is_primary` 标识主要关联能力

### 2.3 学科详情管理

- **详细信息**：定义、描述、作用、价值、应用场景等
- **学习目标**：明确学习该学科的目标
- **前置要求**：学习该学科的前置条件
- **相关学科**：关联其他相关学科

## 三、数据库设计

### 3.1 学科分类表（subject_categories）

支持树形结构的分类表。

**字段说明**：
- `parent_id`：父分类ID，NULL表示顶级分类
- `code`：分类代码，全局唯一
- `level`：分类层级（1为顶级）
- `path`：分类路径，如：`/1/2/3`，便于查询所有子分类

### 3.2 学科表（subjects）

存储学科基本信息。

**字段说明**：
- `category_id`：所属分类
- `code`：学科代码，全局唯一
- `icon_url`：学科图标
- `cover_image_url`：封面图

### 3.3 学科详情表（subject_details）

存储学科的详细信息。

**字段说明**：
- `definition`：定义
- `description`：描述
- `purpose`：作用
- `value`：价值
- `application_scenarios`：应用场景
- `learning_objectives`：学习目标
- `prerequisites`：前置要求
- `related_subjects`：相关学科ID列表（JSONB数组）

### 3.4 学科能力关联表（subject_ability_bindings）

建立学科与能力项的关联关系。

**字段说明**：
- `required_level`：需要达到的能力等级（1-10）
- `recommended_level`：推荐达到的能力等级（可选）
- `is_primary`：是否为主要关联能力
- `importance_weight`：重要性权重（0-10，用于排序和筛选）

## 四、数据录入策略

由于数据量较大，采用分批次录入的方式：

1. **第一批**：创建顶级分类和主要二级分类
2. **第二批**：创建学科分类的完整树形结构
3. **第三批**：录入主要学科基本信息
4. **第四批**：录入学科详情信息
5. **第五批**：建立学科与能力的关联关系

每个批次使用独立的 SQL 文件，便于管理和维护。

## 五、示例数据结构

### 5.1 学科分类示例

```
一级分类：理学
  ├─ 二级分类：数学
  │   ├─ 三级分类：基础数学
  │   ├─ 三级分类：应用数学
  │   └─ 三级分类：统计学
  ├─ 二级分类：物理学
  └─ 二级分类：化学

一级分类：工学
  ├─ 二级分类：计算机科学
  │   ├─ 三级分类：软件工程
  │   ├─ 三级分类：人工智能
  │   └─ 三级分类：数据科学
  └─ 二级分类：机械工程
```

### 5.2 学科示例

**学科**：Python 编程
- **分类**：工学 > 计算机科学 > 软件工程
- **关联能力**：
  - 逻辑思维（必需等级：3，推荐等级：5，主要能力：是）
  - 学习力（必需等级：2，推荐等级：4，主要能力：否）
  - 专注力（必需等级：2，推荐等级：3，主要能力：否）

### 5.3 学科详情示例

**学科**：Python 编程
- **定义**：Python 是一种高级编程语言，具有简洁、易读的语法特点
- **描述**：Python 广泛应用于 Web 开发、数据分析、人工智能等领域
- **作用**：掌握 Python 可以快速开发应用程序，提高工作效率
- **价值**：Python 是当前最热门的编程语言之一，就业前景广阔
- **应用场景**：Web 开发、数据分析、机器学习、自动化脚本等
- **学习目标**：掌握 Python 基础语法、面向对象编程、常用库的使用
- **前置要求**：具备基本的计算机操作能力和逻辑思维能力

## 六、查询示例

### 6.1 查询某个分类下的所有学科

```sql
SELECT s.* 
FROM pikun_db.subjects s
WHERE s.category_id = 'xxx'
  AND s.deleted_at IS NULL
ORDER BY s.sort_order;
```

### 6.2 查询某个学科关联的所有能力

```sql
SELECT 
  sab.*,
  ai.name as ability_name,
  ai.code as ability_code,
  ad.name as dimension_name,
  ac.name as category_name
FROM pikun_db.subject_ability_bindings sab
JOIN pikun_db.ability_items ai ON sab.item_id = ai.item_id
JOIN pikun_db.ability_dimensions ad ON ai.dimension_id = ad.dimension_id
JOIN pikun_db.ability_categories ac ON ad.category_id = ac.category_id
WHERE sab.subject_id = 'xxx'
ORDER BY sab.is_primary DESC, sab.importance_weight DESC, sab.sort_order;
```

### 6.3 查询某个分类及其所有子分类

```sql
-- 使用 path 字段查询
SELECT * 
FROM pikun_db.subject_categories
WHERE path LIKE '/1/%'  -- 查询 ID 为 1 的分类及其所有子分类
  AND deleted_at IS NULL
ORDER BY level, sort_order;
```

## 七、扩展性设计

1. **分类层级**：通过 `parent_id` 和 `path` 支持无限层级
2. **能力关联**：通过 `subject_ability_bindings` 表支持多能力关联
3. **详细信息**：通过 `subject_details` 表存储丰富的学科信息
4. **元数据**：通过 `metadata` JSONB 字段支持未来扩展

## 八、后续工作

1. 根据 PDF 文件内容，整理学科分类树形结构
2. 录入学科基本信息
3. 录入学科详情信息
4. 建立学科与能力的关联关系
5. 实现学科管理的前后端功能

